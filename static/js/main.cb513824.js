/*! For license information please see main.cb513824.js.LICENSE.txt */
!function(){var e={345:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],l=s+1,c=e[l];if(0>i(u,n))l<a&&0>i(c,u)?(e[r]=c,e[l]=n,r=l):(e[r]=u,e[s]=n,r=s);else{if(!(l<a&&0>i(c,n)))break e;e[r]=c,e[l]=n,r=l}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],h=1,d=null,f=3,p=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(c);null!==t;){if(null===t.callback)a(c);else{if(!(t.startTime<=e))break;a(c),t.sortIndex=t.expirationTime,n(l,t)}t=r(c)}}function w(e){if(m=!1,x(e),!v)if(null!==r(l))v=!0,L(k);else{var t=r(c);null!==t&&P(w,t.startTime-e)}}function k(e,n){v=!1,m&&(m=!1,y(T),T=-1),p=!0;var i=f;try{for(x(n),d=r(l);null!==d&&(!(d.expirationTime>n)||e&&!I());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(l)&&a(l),x(n)}else a(l);d=r(l)}if(null!==d)var u=!0;else{var h=r(c);null!==h&&P(w,h.startTime-n),u=!1}return u}finally{d=null,f=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,_=!1,E=null,T=-1,M=5,C=-1;function I(){return!(t.unstable_now()-C<M)}function A(){if(null!==E){var e=t.unstable_now();C=e;var n=!0;try{n=E(!0,e)}finally{n?S():(_=!1,E=null)}}else _=!1}if("function"===typeof b)S=function(){b(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,N=R.port2;R.port1.onmessage=A,S=function(){N.postMessage(null)}}else S=function(){g(A,0)};function L(e){E=e,_||(_=!0,S())}function P(e,n){T=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,L(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(c,e),null===r(l)&&e===r(c)&&(m?(y(T),T=-1):m=!0,P(w,i-o))):(e.sortIndex=s,n(l,e),v||p||(v=!0,L(k))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},545:function(e,t,n){"use strict";e.exports=n(345)},494:function(e){function t(e,t,n){var r,a,i,o,s;function u(){var l=Date.now()-o;l<t&&l>=0?r=setTimeout(u,t-l):(r=null,n||(s=e.apply(i,a),i=a=null))}null==t&&(t=100);var l=function(){i=this,a=arguments,o=Date.now();var l=n&&!r;return r||(r=setTimeout(u,t)),l&&(s=e.apply(i,a),i=a=null),s};return l.clear=function(){r&&(clearTimeout(r),r=null)},l.flush=function(){r&&(s=e.apply(i,a),i=a=null,clearTimeout(r),r=null)},l}t.debounce=t,e.exports=t},987:function(e){e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(E){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function o(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=u(e,(0|e)<0?-1:0,!0),o&&(i[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=u(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function s(e,t){if(isNaN(e))return t?g:m;if(t){if(e<0)return g;if(e>=f)return k}else{if(e<=-p)return S;if(e+1>=p)return w}return e<0?s(-e,t).neg():u(e%d|0,e/d|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=s,n.fromBits=u;var l=Math.pow;function c(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(e.substring(1),t,n).neg();for(var a=s(l(n,8)),i=m,o=0;o<e.length;o+=8){var u=Math.min(8,e.length-o),h=parseInt(e.substring(o,o+u),n);if(u<8){var d=s(l(n,u));i=i.mul(d).add(s(h))}else i=(i=i.mul(a)).add(s(h))}return i.unsigned=t,i}function h(e,t){return"number"===typeof e?s(e,t):"string"===typeof e?c(e,t):u(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=c,n.fromValue=h;var d=4294967296,f=d*d,p=f/2,v=o(1<<24),m=o(0);n.ZERO=m;var g=o(0,!0);n.UZERO=g;var y=o(1);n.ONE=y;var b=o(1,!0);n.UONE=b;var x=o(-1);n.NEG_ONE=x;var w=u(-1,2147483647,!1);n.MAX_VALUE=w;var k=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=k;var S=u(0,-2147483648,!1);n.MIN_VALUE=S;var _=n.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},_.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=s(l(e,6),this.unsigned),i=this,o="";;){var u=i.div(a),c=(i.sub(u.mul(a)).toInt()>>>0).toString(e);if((i=u).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},_.isZero=function(){return 0===this.high&&0===this.low},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return 1===(1&this.low)},_.isEven=function(){return 0===(1&this.low)},_.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},_.eq=_.equals,_.notEquals=function(e){return!this.eq(e)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(e){return this.comp(e)<0},_.lt=_.lessThan,_.lessThanOrEqual=function(e){return this.comp(e)<=0},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(e){return this.comp(e)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(e){return this.comp(e)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(y)},_.neg=_.negate,_.add=function(e){r(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,l=e.low>>>16,c=0,d=0,f=0,p=0;return f+=(p+=i+(65535&e.low))>>>16,d+=(f+=a+l)>>>16,c+=(d+=n+s)>>>16,c+=t+o,u((f&=65535)<<16|(p&=65535),(c&=65535)<<16|(d&=65535),this.unsigned)},_.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},_.sub=_.subtract,_.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=h(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(S))return e.isOdd()?S:m;if(e.eq(S))return this.isOdd()?S:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,d=e.low>>>16,f=65535&e.low,p=0,g=0,y=0,b=0;return y+=(b+=o*f)>>>16,g+=(y+=i*f)>>>16,y&=65535,g+=(y+=o*d)>>>16,p+=(g+=a*f)>>>16,g&=65535,p+=(g+=i*d)>>>16,g&=65535,p+=(g+=o*c)>>>16,p+=n*f+a*d+i*c+o*l,u((y&=65535)<<16|(b&=65535),(p&=65535)<<16|(g&=65535),this.unsigned)},_.mul=_.multiply,_.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return b;i=g}else{if(this.eq(S))return e.eq(y)||e.eq(x)?S:e.eq(S)?y:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?y:x:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(S))return this.unsigned?g:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=m}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),c=o<=48?1:l(2,o-48),d=s(n),f=d.mul(e);f.isNegative()||f.gt(a);)f=(d=s(n-=c,this.unsigned)).mul(e);d.isZero()&&(d=y),i=i.add(d),a=a.sub(f)}return i},_.div=_.divide,_.modulo=function(e){return r(e)||(e=h(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return u(~this.low,~this.high,this.unsigned)},_.and=function(e){return r(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},_.or=function(e){return r(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},_.xor=function(e){return r(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},_.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},_.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},_.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},463:function(e,t,n){"use strict";var r=n(791),a=n(296);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function v(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var a=m.hasOwnProperty(t)?m[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),k=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),M=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),N=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var F,O=Object.assign;function z(e){if(void 0===F)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var U=!1;function B(e,t){if(!e||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var a=l.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var u="\n"+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{U=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?z(e):""}function W(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case k:return"Portal";case E:return"Profiler";case _:return"StrictMode";case I:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case M:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function j(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function X(e){e._valueTracker||(e._valueTracker=function(e){var t=j(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=j(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return O({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Z(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Q(e,t){J(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return O({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ie(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ce,he=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ce(e,t)}))}:ce);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=ve(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(fe).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ge=O({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ke=null,Se=null,_e=null;function Ee(e){if(e=ba(e)){if("function"!==typeof ke)throw Error(i(280));var t=e.stateNode;t&&(t=wa(t),ke(e.stateNode,e.type,t))}}function Te(e){Se?_e?_e.push(e):_e=[e]:Se=e}function Me(){if(Se){var e=Se,t=_e;if(_e=Se=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Ce(e,t){return e(t)}function Ie(){}var Ae=!1;function Re(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Ce(e,t,n)}finally{Ae=!1,(null!==Se||null!==_e)&&(Ie(),Me())}}function Ne(e,t){var n=e.stateNode;if(null===n)return null;var r=wa(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Le=!1;if(c)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){Le=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(ce){Le=!1}function De(e,t,n,r,a,i,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var Fe=!1,Oe=null,ze=!1,Ue=null,Be={onError:function(e){Fe=!0,Oe=e}};function We(e,t,n,r,a,i,o,s,u){Fe=!1,Oe=null,De.apply(Be,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ve(e)!==e)throw Error(i(188))}function je(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return He(a),e;if(o===r)return He(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=o;break}if(u===r){s=!0,r=a,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=a;break}if(u===r){s=!0,r=o,n=a;break}u=u.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?Xe(e):null}function Xe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Xe(e);if(null!==t)return t;e=e.sibling}return null}var qe=a.unstable_scheduleCallback,Ke=a.unstable_cancelCallback,Ye=a.unstable_shouldYield,Ze=a.unstable_requestPaint,Je=a.unstable_now,Qe=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var lt=64,ct=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=ht(s):0!==(i&=o)&&(r=ht(i))}else 0!==(o=n&~a)?r=ht(o):0!==i&&(r=ht(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-ot(t)),r|=e[n],t&=~a;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,kt,St,_t,Et,Tt=!1,Mt=[],Ct=null,It=null,At=null,Rt=new Map,Nt=new Map,Lt=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dt(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nt.delete(t.pointerId)}}function Ft(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=ba(t))&&kt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Ot(e){var t=ya(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void Et(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ba(n))&&kt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Ut(e,t,n){zt(e)&&n.delete(t)}function Bt(){Tt=!1,null!==Ct&&zt(Ct)&&(Ct=null),null!==It&&zt(It)&&(It=null),null!==At&&zt(At)&&(At=null),Rt.forEach(Ut),Nt.forEach(Ut)}function Wt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Bt)))}function Vt(e){function t(t){return Wt(t,e)}if(0<Mt.length){Wt(Mt[0],e);for(var n=1;n<Mt.length;n++){var r=Mt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Ct&&Wt(Ct,e),null!==It&&Wt(It,e),null!==At&&Wt(At,e),Rt.forEach(t),Nt.forEach(t),n=0;n<Lt.length;n++)(r=Lt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Lt.length&&null===(n=Lt[0]).blockedOn;)Ot(n),null===n.blockedOn&&Lt.shift()}var Gt=x.ReactCurrentBatchConfig,Ht=!0;function jt(e,t,n,r){var a=bt,i=Gt.transition;Gt.transition=null;try{bt=1,qt(e,t,n,r)}finally{bt=a,Gt.transition=i}}function Xt(e,t,n,r){var a=bt,i=Gt.transition;Gt.transition=null;try{bt=4,qt(e,t,n,r)}finally{bt=a,Gt.transition=i}}function qt(e,t,n,r){if(Ht){var a=Yt(e,t,n,r);if(null===a)Hr(e,t,r,Kt,n),Dt(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Ct=Ft(Ct,e,t,n,r,a),!0;case"dragenter":return It=Ft(It,e,t,n,r,a),!0;case"mouseover":return At=Ft(At,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Rt.set(i,Ft(Rt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Nt.set(i,Ft(Nt.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Dt(e,r),4&t&&-1<Pt.indexOf(e)){for(;null!==a;){var i=ba(a);if(null!==i&&wt(i),null===(i=Yt(e,t,n,r))&&Hr(e,t,r,Kt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Kt=null;function Yt(e,t,n,r){if(Kt=null,null!==(e=ya(e=we(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Zt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Qt=null,$t=null;function en(){if($t)return $t;var e,t,n=Qt,r=n.length,a="value"in Jt?Jt.value:Jt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return O(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=an(ln),hn=O({},ln,{view:0,detail:0}),dn=an(hn),fn=O({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(fn),vn=an(O({},fn,{dataTransfer:0})),mn=an(O({},hn,{relatedTarget:0})),gn=an(O({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=O({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),xn=an(O({},ln,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _n(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function En(){return _n}var Tn=O({},hn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?kn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Mn=an(Tn),Cn=an(O({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=an(O({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),An=an(O({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=O({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Nn=an(Rn),Ln=[9,13,27,32],Pn=c&&"CompositionEvent"in window,Dn=null;c&&"documentMode"in document&&(Dn=document.documentMode);var Fn=c&&"TextEvent"in window&&!Dn,On=c&&(!Pn||Dn&&8<Dn&&11>=Dn),zn=String.fromCharCode(32),Un=!1;function Bn(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function jn(e,t,n,r){Te(r),0<(t=Xr(t,"onChange")).length&&(n=new cn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Xn=null,qn=null;function Kn(e){zr(e,0)}function Yn(e){if(q(xa(e)))return e}function Zn(e,t){if("change"===e)return t}var Jn=!1;if(c){var Qn;if(c){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Qn=$n}else Qn=!1;Jn=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){Xn&&(Xn.detachEvent("onpropertychange",nr),qn=Xn=null)}function nr(e){if("value"===e.propertyName&&Yn(qn)){var t=[];jn(t,qn,e,we(e)),Re(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),qn=n,(Xn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(qn)}function ir(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!h.call(t,a)||!sr(e[a],t[a]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cr(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=cr(n,i);var o=cr(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=c&&"documentMode"in document&&11>=document.documentMode,mr=null,gr=null,yr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==K(r)||("selectionStart"in(r=mr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=Xr(gr,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var kr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Sr={},_r={};function Er(e){if(Sr[e])return Sr[e];if(!kr[e])return e;var t,n=kr[e];for(t in n)if(n.hasOwnProperty(t)&&t in _r)return Sr[e]=n[t];return e}c&&(_r=document.createElement("div").style,"AnimationEvent"in window||(delete kr.animationend.animation,delete kr.animationiteration.animation,delete kr.animationstart.animation),"TransitionEvent"in window||delete kr.transitionend.transition);var Tr=Er("animationend"),Mr=Er("animationiteration"),Cr=Er("animationstart"),Ir=Er("transitionend"),Ar=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Nr(e,t){Ar.set(e,t),u(t,[e])}for(var Lr=0;Lr<Rr.length;Lr++){var Pr=Rr[Lr];Nr(Pr.toLowerCase(),"on"+(Pr[0].toUpperCase()+Pr.slice(1)))}Nr(Tr,"onAnimationEnd"),Nr(Mr,"onAnimationIteration"),Nr(Cr,"onAnimationStart"),Nr("dblclick","onDoubleClick"),Nr("focusin","onFocus"),Nr("focusout","onBlur"),Nr(Ir,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dr));function Or(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,u,l){if(We.apply(this,arguments),Fe){if(!Fe)throw Error(i(198));var c=Oe;Fe=!1,Oe=null,ze||(ze=!0,Ue=c)}}(r,t,void 0,e),e.currentTarget=null}function zr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;Or(a,s,l),i=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,l=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;Or(a,s,l),i=u}}}if(ze)throw e=Ue,ze=!1,Ue=null,e}function Ur(e,t){var n=t[va];void 0===n&&(n=t[va]=new Set);var r=e+"__bubble";n.has(r)||(Gr(t,e,2,!1),n.add(r))}function Br(e,t,n){var r=0;t&&(r|=4),Gr(n,e,r,t)}var Wr="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[Wr]){e[Wr]=!0,o.forEach((function(t){"selectionchange"!==t&&(Fr.has(t)||Br(t,!1,e),Br(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Wr]||(t[Wr]=!0,Br("selectionchange",!1,t))}}function Gr(e,t,n,r){switch(Zt(t)){case 1:var a=jt;break;case 4:a=Xt;break;default:a=qt}n=a.bind(null,t,n,e),a=void 0,!Le||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===a||8===u.nodeType&&u.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ya(s)))return;if(5===(u=o.tag)||6===u){r=i=o;continue e}s=s.parentNode}}r=r.return}Re((function(){var r=i,a=we(n),o=[];e:{var s=Ar.get(e);if(void 0!==s){var u=cn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=Mn;break;case"focusin":l="focus",u=mn;break;case"focusout":l="blur",u=mn;break;case"beforeblur":case"afterblur":u=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=In;break;case Tr:case Mr:case Cr:u=gn;break;case Ir:u=An;break;case"scroll":u=dn;break;case"wheel":u=Nn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Cn}var c=0!==(4&t),h=!c&&"scroll"===e,d=c?null!==s?s+"Capture":null:s;c=[];for(var f,p=r;null!==p;){var v=(f=p).stateNode;if(5===f.tag&&null!==v&&(f=v,null!==d&&(null!=(v=Ne(p,d))&&c.push(jr(p,v,f)))),h)break;p=p.return}0<c.length&&(s=new u(s,l,null,n,a),o.push({event:s,listeners:c}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(l=n.relatedTarget||n.fromElement)||!ya(l)&&!l[pa])&&(u||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(l=(l=n.relatedTarget||n.toElement)?ya(l):null)&&(l!==(h=Ve(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(u=null,l=r),u!==l)){if(c=pn,v="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=Cn,v="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==u?s:xa(u),f=null==l?s:xa(l),(s=new c(v,p+"leave",u,n,a)).target=h,s.relatedTarget=f,v=null,ya(a)===r&&((c=new c(d,p+"enter",l,n,a)).target=f,c.relatedTarget=h,v=c),h=v,u&&l)e:{for(d=l,p=0,f=c=u;f;f=qr(f))p++;for(f=0,v=d;v;v=qr(v))f++;for(;0<p-f;)c=qr(c),p--;for(;0<f-p;)d=qr(d),f--;for(;p--;){if(c===d||null!==d&&c===d.alternate)break e;c=qr(c),d=qr(d)}c=null}else c=null;null!==u&&Kr(o,s,u,c,!1),null!==l&&null!==h&&Kr(o,h,l,c,!0)}if("select"===(u=(s=r?xa(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var m=Zn;else if(Hn(s))if(Jn)m=or;else{m=ar;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ir);switch(m&&(m=m(e,r))?jn(o,m,n,a):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?xa(r):window,e){case"focusin":(Hn(g)||"true"===g.contentEditable)&&(mr=g,gr=r,yr=null);break;case"focusout":yr=gr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(o,n,a);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":xr(o,n,a)}var y;if(Pn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vn?Bn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(On&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(y=en()):(Qt="value"in(Jt=a)?Jt.value:Jt.textContent,Vn=!0)),0<(g=Xr(r,b)).length&&(b=new xn(b,e,null,n,a),o.push({event:b,listeners:g}),y?b.data=y:null!==(y=Wn(n))&&(b.data=y))),(y=Fn?function(e,t){switch(e){case"compositionend":return Wn(t);case"keypress":return 32!==t.which?null:(Un=!0,zn);case"textInput":return(e=t.data)===zn&&Un?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Pn&&Bn(e,t)?(e=en(),$t=Qt=Jt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return On&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Xr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=y))}zr(o,t)}))}function jr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Xr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Ne(e,n))&&r.unshift(jr(e,i,a)),null!=(i=Ne(e,t))&&r.push(jr(e,i,a))),e=e.return}return r}function qr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==l&&(s=l,a?null!=(u=Ne(n,i))&&o.unshift(jr(n,u,s)):a||null!=(u=Ne(n,i))&&o.push(jr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,Zr=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Zr,"")}function Qr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(i(425))}function $r(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,oa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(sa)}:ra;function sa(e){setTimeout((function(){throw e}))}function ua(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Vt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Vt(t)}function la(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ca(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ha=Math.random().toString(36).slice(2),da="__reactFiber$"+ha,fa="__reactProps$"+ha,pa="__reactContainer$"+ha,va="__reactEvents$"+ha,ma="__reactListeners$"+ha,ga="__reactHandles$"+ha;function ya(e){var t=e[da];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pa]||n[da]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ca(e);null!==e;){if(n=e[da])return n;e=ca(e)}return t}n=(e=n).parentNode}return null}function ba(e){return!(e=e[da]||e[pa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function wa(e){return e[fa]||null}var ka=[],Sa=-1;function _a(e){return{current:e}}function Ea(e){0>Sa||(e.current=ka[Sa],ka[Sa]=null,Sa--)}function Ta(e,t){Sa++,ka[Sa]=e.current,e.current=t}var Ma={},Ca=_a(Ma),Ia=_a(!1),Aa=Ma;function Ra(e,t){var n=e.type.contextTypes;if(!n)return Ma;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Na(e){return null!==(e=e.childContextTypes)&&void 0!==e}function La(){Ea(Ia),Ea(Ca)}function Pa(e,t,n){if(Ca.current!==Ma)throw Error(i(168));Ta(Ca,t),Ta(Ia,n)}function Da(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,G(e)||"Unknown",a));return O({},n,r)}function Fa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ma,Aa=Ca.current,Ta(Ca,e),Ta(Ia,Ia.current),!0}function Oa(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Da(e,t,Aa),r.__reactInternalMemoizedMergedChildContext=e,Ea(Ia),Ea(Ca),Ta(Ca,e)):Ea(Ia),Ta(Ia,n)}var za=null,Ua=!1,Ba=!1;function Wa(e){null===za?za=[e]:za.push(e)}function Va(){if(!Ba&&null!==za){Ba=!0;var e=0,t=bt;try{var n=za;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}za=null,Ua=!1}catch(a){throw null!==za&&(za=za.slice(e+1)),qe($e,Va),a}finally{bt=t,Ba=!1}}return null}var Ga=[],Ha=0,ja=null,Xa=0,qa=[],Ka=0,Ya=null,Za=1,Ja="";function Qa(e,t){Ga[Ha++]=Xa,Ga[Ha++]=ja,ja=e,Xa=t}function $a(e,t,n){qa[Ka++]=Za,qa[Ka++]=Ja,qa[Ka++]=Ya,Ya=e;var r=Za;e=Ja;var a=32-ot(r)-1;r&=~(1<<a),n+=1;var i=32-ot(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Za=1<<32-ot(t)+a|n<<a|r,Ja=i+e}else Za=1<<i|n<<a|r,Ja=e}function ei(e){null!==e.return&&(Qa(e,1),$a(e,1,0))}function ti(e){for(;e===ja;)ja=Ga[--Ha],Ga[Ha]=null,Xa=Ga[--Ha],Ga[Ha]=null;for(;e===Ya;)Ya=qa[--Ka],qa[Ka]=null,Ja=qa[--Ka],qa[Ka]=null,Za=qa[--Ka],qa[Ka]=null}var ni=null,ri=null,ai=!1,ii=null;function oi(e,t){var n=Nl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function si(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=la(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ya?{id:Za,overflow:Ja}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Nl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function ui(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function li(e){if(ai){var t=ri;if(t){var n=t;if(!si(e,t)){if(ui(e))throw Error(i(418));t=la(n.nextSibling);var r=ni;t&&si(e,t)?oi(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(ui(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function ci(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function hi(e){if(e!==ni)return!1;if(!ai)return ci(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(ui(e))throw di(),Error(i(418));for(;t;)oi(e,t),t=la(t.nextSibling)}if(ci(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=la(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?la(e.stateNode.nextSibling):null;return!0}function di(){for(var e=ri;e;)e=la(e.nextSibling)}function fi(){ri=ni=null,ai=!1}function pi(e){null===ii?ii=[e]:ii.push(e)}var vi=x.ReactCurrentBatchConfig;function mi(e,t){if(e&&e.defaultProps){for(var n in t=O({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var gi=_a(null),yi=null,bi=null,xi=null;function wi(){xi=bi=yi=null}function ki(e){var t=gi.current;Ea(gi),e._currentValue=t}function Si(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function _i(e,t){yi=e,xi=bi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Ei(e){var t=e._currentValue;if(xi!==e)if(e={context:e,memoizedValue:t,next:null},null===bi){if(null===yi)throw Error(i(308));bi=e,yi.dependencies={lanes:0,firstContext:e}}else bi=bi.next=e;return t}var Ti=null;function Mi(e){null===Ti?Ti=[e]:Ti.push(e)}function Ci(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Mi(t)):(n.next=a.next,a.next=n),t.interleaved=n,Ii(e,r)}function Ii(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ai=!1;function Ri(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ni(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Li(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Pi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Iu)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Ii(e,n)}return null===(a=r.interleaved)?(t.next=t,Mi(r)):(t.next=a.next,a.next=t),r.interleaved=t,Ii(e,n)}function Di(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Fi(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Oi(e,t,n,r){var a=e.updateQueue;Ai=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var u=s,l=u.next;u.next=null,null===o?i=l:o.next=l,o=u;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==o&&(null===s?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(null!==i){var h=a.baseState;for(o=0,c=l=u=null,s=i;;){var d=s.lane,f=s.eventTime;if((r&d)===d){null!==c&&(c=c.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,v=s;switch(d=t,f=n,v.tag){case 1:if("function"===typeof(p=v.payload)){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=v.payload)?p.call(f,h,d):p)||void 0===d)break e;h=O({},h,d);break e;case 2:Ai=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=a.effects)?a.effects=[s]:d.push(s))}else f={eventTime:f,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(l=c=f,u=h):c=c.next=f,o|=d;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(d=s).next,d.next=null,a.lastBaseUpdate=d,a.shared.pending=null}}if(null===c&&(u=h),a.baseState=u,a.firstBaseUpdate=l,a.lastBaseUpdate=c,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);Ou|=o,e.lanes=o,e.memoizedState=h}}function zi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Ui=(new r.Component).refs;function Bi(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:O({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Wi={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tl(),a=nl(e),i=Li(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Pi(e,i,a))&&(rl(t,e,a,r),Di(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tl(),a=nl(e),i=Li(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Pi(e,i,a))&&(rl(t,e,a,r),Di(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tl(),r=nl(e),a=Li(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Pi(e,a,r))&&(rl(t,e,r,n),Di(t,e,r))}};function Vi(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(a,i))}function Gi(e,t,n){var r=!1,a=Ma,i=t.contextType;return"object"===typeof i&&null!==i?i=Ei(i):(a=Na(t)?Aa:Ca.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ra(e,a):Ma),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Wi,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Hi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Wi.enqueueReplaceState(t,t.state,null)}function ji(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=Ui,Ri(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=Ei(i):(i=Na(t)?Aa:Ca.current,a.context=Ra(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Bi(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Wi.enqueueReplaceState(a,a.state,null),Oi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function Xi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;t===Ui&&(t=a.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function qi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ki(e){return(0,e._init)(e._payload)}function Yi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Pl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=zl(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function l(e,t,n,r){var i=n.type;return i===S?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===N&&Ki(i)===t.type)?((r=a(t,n.props)).ref=Xi(e,t,n),r.return=e,r):((r=Dl(n.type,n.key,n.props,null,e.mode,r)).ref=Xi(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ul(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function h(e,t,n,r,i){return null===t||7!==t.tag?((t=Fl(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=zl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Dl(t.type,t.key,t.props,null,e.mode,n)).ref=Xi(e,null,t),n.return=e,n;case k:return(t=Ul(t,e.mode,n)).return=e,t;case N:return d(e,(0,t._init)(t._payload),n)}if(te(t)||D(t))return(t=Fl(t,e.mode,n,null)).return=e,t;qi(e,t)}return null}function f(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===a?l(e,t,n,r):null;case k:return n.key===a?c(e,t,n,r):null;case N:return f(e,t,(a=n._init)(n._payload),r)}if(te(n)||D(n))return null!==a?null:h(e,t,n,r,null);qi(e,n)}return null}function p(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a);case k:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case N:return p(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||D(r))return h(t,e=e.get(n)||null,r,a,null);qi(t,r)}return null}function v(a,i,s,u){for(var l=null,c=null,h=i,v=i=0,m=null;null!==h&&v<s.length;v++){h.index>v?(m=h,h=null):m=h.sibling;var g=f(a,h,s[v],u);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(a,h),i=o(g,i,v),null===c?l=g:c.sibling=g,c=g,h=m}if(v===s.length)return n(a,h),ai&&Qa(a,v),l;if(null===h){for(;v<s.length;v++)null!==(h=d(a,s[v],u))&&(i=o(h,i,v),null===c?l=h:c.sibling=h,c=h);return ai&&Qa(a,v),l}for(h=r(a,h);v<s.length;v++)null!==(m=p(h,a,v,s[v],u))&&(e&&null!==m.alternate&&h.delete(null===m.key?v:m.key),i=o(m,i,v),null===c?l=m:c.sibling=m,c=m);return e&&h.forEach((function(e){return t(a,e)})),ai&&Qa(a,v),l}function m(a,s,u,l){var c=D(u);if("function"!==typeof c)throw Error(i(150));if(null==(u=c.call(u)))throw Error(i(151));for(var h=c=null,v=s,m=s=0,g=null,y=u.next();null!==v&&!y.done;m++,y=u.next()){v.index>m?(g=v,v=null):g=v.sibling;var b=f(a,v,y.value,l);if(null===b){null===v&&(v=g);break}e&&v&&null===b.alternate&&t(a,v),s=o(b,s,m),null===h?c=b:h.sibling=b,h=b,v=g}if(y.done)return n(a,v),ai&&Qa(a,m),c;if(null===v){for(;!y.done;m++,y=u.next())null!==(y=d(a,y.value,l))&&(s=o(y,s,m),null===h?c=y:h.sibling=y,h=y);return ai&&Qa(a,m),c}for(v=r(a,v);!y.done;m++,y=u.next())null!==(y=p(v,a,m,y.value,l))&&(e&&null!==y.alternate&&v.delete(null===y.key?m:y.key),s=o(y,s,m),null===h?c=y:h.sibling=y,h=y);return e&&v.forEach((function(e){return t(a,e)})),ai&&Qa(a,m),c}return function e(r,i,o,u){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var l=o.key,c=i;null!==c;){if(c.key===l){if((l=o.type)===S){if(7===c.tag){n(r,c.sibling),(i=a(c,o.props.children)).return=r,r=i;break e}}else if(c.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===N&&Ki(l)===c.type){n(r,c.sibling),(i=a(c,o.props)).ref=Xi(r,c,o),i.return=r,r=i;break e}n(r,c);break}t(r,c),c=c.sibling}o.type===S?((i=Fl(o.props.children,r.mode,u,o.key)).return=r,r=i):((u=Dl(o.type,o.key,o.props,null,r.mode,u)).ref=Xi(r,i,o),u.return=r,r=u)}return s(r);case k:e:{for(c=o.key;null!==i;){if(i.key===c){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Ul(o,r.mode,u)).return=r,r=i}return s(r);case N:return e(r,i,(c=o._init)(o._payload),u)}if(te(o))return v(r,i,o,u);if(D(o))return m(r,i,o,u);qi(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=zl(o,r.mode,u)).return=r,r=i),s(r)):n(r,i)}}var Zi=Yi(!0),Ji=Yi(!1),Qi={},$i=_a(Qi),eo=_a(Qi),to=_a(Qi);function no(e){if(e===Qi)throw Error(i(174));return e}function ro(e,t){switch(Ta(to,t),Ta(eo,e),Ta($i,Qi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ea($i),Ta($i,t)}function ao(){Ea($i),Ea(eo),Ea(to)}function io(e){no(to.current);var t=no($i.current),n=ue(t,e.type);t!==n&&(Ta(eo,e),Ta($i,n))}function oo(e){eo.current===e&&(Ea($i),Ea(eo))}var so=_a(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var lo=[];function co(){for(var e=0;e<lo.length;e++)lo[e]._workInProgressVersionPrimary=null;lo.length=0}var ho=x.ReactCurrentDispatcher,fo=x.ReactCurrentBatchConfig,po=0,vo=null,mo=null,go=null,yo=!1,bo=!1,xo=0,wo=0;function ko(){throw Error(i(321))}function So(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function _o(e,t,n,r,a,o){if(po=o,vo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?ss:us,e=n(r,a),bo){o=0;do{if(bo=!1,xo=0,25<=o)throw Error(i(301));o+=1,go=mo=null,t.updateQueue=null,ho.current=ls,e=n(r,a)}while(bo)}if(ho.current=os,t=null!==mo&&null!==mo.next,po=0,go=mo=vo=null,yo=!1,t)throw Error(i(300));return e}function Eo(){var e=0!==xo;return xo=0,e}function To(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?vo.memoizedState=go=e:go=go.next=e,go}function Mo(){if(null===mo){var e=vo.alternate;e=null!==e?e.memoizedState:null}else e=mo.next;var t=null===go?vo.memoizedState:go.next;if(null!==t)go=t,mo=e;else{if(null===e)throw Error(i(310));e={memoizedState:(mo=e).memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},null===go?vo.memoizedState=go=e:go=go.next=e}return go}function Co(e,t){return"function"===typeof t?t(e):t}function Io(e){var t=Mo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=mo,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var u=s=null,l=null,c=o;do{var h=c.lane;if((po&h)===h)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(u=l=d,s=r):l=l.next=d,vo.lanes|=h,Ou|=h}c=c.next}while(null!==c&&c!==o);null===l?s=r:l.next=u,sr(r,t.memoizedState)||(xs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,vo.lanes|=o,Ou|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ao(e){var t=Mo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);sr(o,t.memoizedState)||(xs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ro(){}function No(e,t){var n=vo,r=Mo(),a=t(),o=!sr(r.memoizedState,a);if(o&&(r.memoizedState=a,xs=!0),r=r.queue,Ho(Do.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Uo(9,Po.bind(null,n,r,a,t),void 0,null),null===Au)throw Error(i(349));0!==(30&po)||Lo(n,t,a)}return a}function Lo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Po(e,t,n,r){t.value=n,t.getSnapshot=r,Fo(t)&&Oo(e)}function Do(e,t,n){return n((function(){Fo(t)&&Oo(e)}))}function Fo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Oo(e){var t=Ii(e,1);null!==t&&rl(t,e,1,-1)}function zo(e){var t=To();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Co,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,vo,e),[t.memoizedState,e]}function Uo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Bo(){return Mo().memoizedState}function Wo(e,t,n,r){var a=To();vo.flags|=e,a.memoizedState=Uo(1|t,n,void 0,void 0===r?null:r)}function Vo(e,t,n,r){var a=Mo();r=void 0===r?null:r;var i=void 0;if(null!==mo){var o=mo.memoizedState;if(i=o.destroy,null!==r&&So(r,o.deps))return void(a.memoizedState=Uo(t,n,i,r))}vo.flags|=e,a.memoizedState=Uo(1|t,n,i,r)}function Go(e,t){return Wo(8390656,8,e,t)}function Ho(e,t){return Vo(2048,8,e,t)}function jo(e,t){return Vo(4,2,e,t)}function Xo(e,t){return Vo(4,4,e,t)}function qo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ko(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Vo(4,4,qo.bind(null,t,e),n)}function Yo(){}function Zo(e,t){var n=Mo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Jo(e,t){var n=Mo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Qo(e,t,n){return 0===(21&po)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(sr(n,t)||(n=vt(),vo.lanes|=n,Ou|=n,e.baseState=!0),t)}function $o(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=fo.transition;fo.transition={};try{e(!1),t()}finally{bt=n,fo.transition=r}}function es(){return Mo().memoizedState}function ts(e,t,n){var r=nl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))as(t,n);else if(null!==(n=Ci(e,t,n,r))){rl(n,e,r,tl()),is(n,t,r)}}function ns(e,t,n){var r=nl(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))as(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,sr(s,o)){var u=t.interleaved;return null===u?(a.next=a,Mi(t)):(a.next=u.next,u.next=a),void(t.interleaved=a)}}catch(l){}null!==(n=Ci(e,t,a,r))&&(rl(n,e,r,a=tl()),is(n,t,r))}}function rs(e){var t=e.alternate;return e===vo||null!==t&&t===vo}function as(e,t){bo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function is(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var os={readContext:Ei,useCallback:ko,useContext:ko,useEffect:ko,useImperativeHandle:ko,useInsertionEffect:ko,useLayoutEffect:ko,useMemo:ko,useReducer:ko,useRef:ko,useState:ko,useDebugValue:ko,useDeferredValue:ko,useTransition:ko,useMutableSource:ko,useSyncExternalStore:ko,useId:ko,unstable_isNewReconciler:!1},ss={readContext:Ei,useCallback:function(e,t){return To().memoizedState=[e,void 0===t?null:t],e},useContext:Ei,useEffect:Go,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Wo(4194308,4,qo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Wo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Wo(4,2,e,t)},useMemo:function(e,t){var n=To();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=To();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,vo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},To().memoizedState=e},useState:zo,useDebugValue:Yo,useDeferredValue:function(e){return To().memoizedState=e},useTransition:function(){var e=zo(!1),t=e[0];return e=$o.bind(null,e[1]),To().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=vo,a=To();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Au)throw Error(i(349));0!==(30&po)||Lo(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Go(Do.bind(null,r,o,e),[e]),r.flags|=2048,Uo(9,Po.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=To(),t=Au.identifierPrefix;if(ai){var n=Ja;t=":"+t+"R"+(n=(Za&~(1<<32-ot(Za)-1)).toString(32)+n),0<(n=xo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=wo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:Ei,useCallback:Zo,useContext:Ei,useEffect:Ho,useImperativeHandle:Ko,useInsertionEffect:jo,useLayoutEffect:Xo,useMemo:Jo,useReducer:Io,useRef:Bo,useState:function(){return Io(Co)},useDebugValue:Yo,useDeferredValue:function(e){return Qo(Mo(),mo.memoizedState,e)},useTransition:function(){return[Io(Co)[0],Mo().memoizedState]},useMutableSource:Ro,useSyncExternalStore:No,useId:es,unstable_isNewReconciler:!1},ls={readContext:Ei,useCallback:Zo,useContext:Ei,useEffect:Ho,useImperativeHandle:Ko,useInsertionEffect:jo,useLayoutEffect:Xo,useMemo:Jo,useReducer:Ao,useRef:Bo,useState:function(){return Ao(Co)},useDebugValue:Yo,useDeferredValue:function(e){var t=Mo();return null===mo?t.memoizedState=e:Qo(t,mo.memoizedState,e)},useTransition:function(){return[Ao(Co)[0],Mo().memoizedState]},useMutableSource:Ro,useSyncExternalStore:No,useId:es,unstable_isNewReconciler:!1};function cs(e,t){try{var n="",r=t;do{n+=W(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function hs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Li(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ju||(ju=!0,Xu=r),ds(0,t)},n}function vs(e,t,n){(n=Li(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){ds(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof r&&(null===qu?qu=new Set([this]):qu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fs;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Tl.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Li(-1,1)).tag=2,Pi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=x.ReactCurrentOwner,xs=!1;function ws(e,t,n,r){t.child=null===e?Ji(t,null,n,r):Zi(t,e.child,n,r)}function ks(e,t,n,r,a){n=n.render;var i=t.ref;return _i(t,a),r=_o(e,t,n,r,i,a),n=Eo(),null===e||xs?(ai&&n&&ei(t),t.flags|=1,ws(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,js(e,t,a))}function Ss(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Ll(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Dl(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,_s(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return js(e,t,a)}return t.flags|=1,(e=Pl(i,r)).ref=t.ref,e.return=t,t.child=e}function _s(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(ur(i,r)&&e.ref===t.ref){if(xs=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,js(e,t,a);0!==(131072&e.flags)&&(xs=!0)}}return Ms(e,t,n,r,a)}function Es(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ta(Pu,Lu),Lu|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ta(Pu,Lu),Lu|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ta(Pu,Lu),Lu|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ta(Pu,Lu),Lu|=r;return ws(e,t,a,n),t.child}function Ts(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ms(e,t,n,r,a){var i=Na(n)?Aa:Ca.current;return i=Ra(t,i),_i(t,a),n=_o(e,t,n,r,i,a),r=Eo(),null===e||xs?(ai&&r&&ei(t),t.flags|=1,ws(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,js(e,t,a))}function Cs(e,t,n,r,a){if(Na(n)){var i=!0;Fa(t)}else i=!1;if(_i(t,a),null===t.stateNode)Hs(e,t),Gi(t,n,r),ji(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=Ei(l):l=Ra(t,l=Na(n)?Aa:Ca.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==l)&&Hi(t,o,r,l),Ai=!1;var d=t.memoizedState;o.state=d,Oi(t,r,o,a),u=t.memoizedState,s!==r||d!==u||Ia.current||Ai?("function"===typeof c&&(Bi(t,n,c,r),u=t.memoizedState),(s=Ai||Vi(t,n,s,r,d,u,l))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=l,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Ni(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:mi(t.type,s),o.props=l,h=t.pendingProps,d=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=Ei(u):u=Ra(t,u=Na(n)?Aa:Ca.current);var f=n.getDerivedStateFromProps;(c="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==u)&&Hi(t,o,r,u),Ai=!1,d=t.memoizedState,o.state=d,Oi(t,r,o,a);var p=t.memoizedState;s!==h||d!==p||Ia.current||Ai?("function"===typeof f&&(Bi(t,n,f,r),p=t.memoizedState),(l=Ai||Vi(t,n,l,r,d,p,u)||!1)?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=u,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Is(e,t,n,r,i,a)}function Is(e,t,n,r,a,i){Ts(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&Oa(t,n,!1),js(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Zi(t,e.child,null,i),t.child=Zi(t,null,s,i)):ws(e,t,s,i),t.memoizedState=r.state,a&&Oa(t,n,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?Pa(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pa(0,t.context,!1),ro(e,t.containerInfo)}function Rs(e,t,n,r,a){return fi(),pi(a),t.flags|=256,ws(e,t,n,r),t.child}var Ns,Ls,Ps,Ds,Fs={dehydrated:null,treeContext:null,retryLane:0};function Os(e){return{baseLanes:e,cachePool:null,transitions:null}}function zs(e,t,n){var r,a=t.pendingProps,o=so.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ta(so,1&o),null===e)return li(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=a.children,e=a.fallback,s?(a=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Ol(u,a,0,null),e=Fl(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Os(n),t.memoizedState=Fs,e):Us(t,u));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,r=hs(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Ol({mode:"visible",children:r.children},a,0,null),(o=Fl(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Zi(t,e.child,null,s),t.child.memoizedState=Os(s),t.memoizedState=Fs,o);if(0===(1&t.mode))return Bs(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var u=r.dgst;return r=u,Bs(e,t,s,r=hs(o=Error(i(419)),r,void 0))}if(u=0!==(s&e.childLanes),xs||u){if(null!==(r=Au)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,Ii(e,a),rl(r,e,a,-1))}return ml(),Bs(e,t,s,r=hs(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Cl.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ri=la(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(qa[Ka++]=Za,qa[Ka++]=Ja,qa[Ka++]=Ya,Za=e.id,Ja=e.overflow,Ya=t),t=Us(t,r.children),t.flags|=4096,t)}(e,t,u,a,r,o,n);if(s){s=a.fallback,u=t.mode,r=(o=e.child).sibling;var l={mode:"hidden",children:a.children};return 0===(1&u)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=l,t.deletions=null):(a=Pl(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Pl(r,s):(s=Fl(s,u,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,u=null===(u=e.child.memoizedState)?Os(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Fs,a}return e=(s=e.child).sibling,a=Pl(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Us(e,t){return(t=Ol({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,r){return null!==r&&pi(r),Zi(t,e.child,null,n),(e=Us(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ws(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Si(e.return,t,n)}function Vs(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Gs(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(ws(e,t,r.children,n),0!==(2&(r=so.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ws(e,n,t);else if(19===e.tag)Ws(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ta(so,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Vs(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===uo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Vs(t,!0,n,null,i);break;case"together":Vs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Hs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function js(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ou|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Pl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Xs(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ks(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(t),null;case 1:case 17:return Na(t.type)&&La(),qs(t),null;case 3:return r=t.stateNode,ao(),Ea(Ia),Ea(Ca),co(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(hi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(sl(ii),ii=null))),Ls(e,t),qs(t),null;case 5:oo(t);var a=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ps(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return qs(t),null}if(e=no($i.current),hi(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[da]=t,r[fa]=o,e=0!==(1&t.mode),n){case"dialog":Ur("cancel",r),Ur("close",r);break;case"iframe":case"object":case"embed":Ur("load",r);break;case"video":case"audio":for(a=0;a<Dr.length;a++)Ur(Dr[a],r);break;case"source":Ur("error",r);break;case"img":case"image":case"link":Ur("error",r),Ur("load",r);break;case"details":Ur("toggle",r);break;case"input":Z(r,o),Ur("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Ur("invalid",r);break;case"textarea":ae(r,o),Ur("invalid",r)}for(var u in ye(n,o),a=null,o)if(o.hasOwnProperty(u)){var l=o[u];"children"===u?"string"===typeof l?r.textContent!==l&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,l,e),a=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,l,e),a=["children",""+l]):s.hasOwnProperty(u)&&null!=l&&"onScroll"===u&&Ur("scroll",r)}switch(n){case"input":X(r),$(r,o,!0);break;case"textarea":X(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[da]=t,e[fa]=r,Ns(e,t,!1,!1),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Ur("cancel",e),Ur("close",e),a=r;break;case"iframe":case"object":case"embed":Ur("load",e),a=r;break;case"video":case"audio":for(a=0;a<Dr.length;a++)Ur(Dr[a],e);a=r;break;case"source":Ur("error",e),a=r;break;case"img":case"image":case"link":Ur("error",e),Ur("load",e),a=r;break;case"details":Ur("toggle",e),a=r;break;case"input":Z(e,r),a=Y(e,r),Ur("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=O({},r,{value:void 0}),Ur("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),Ur("invalid",e)}for(o in ye(n,a),l=a)if(l.hasOwnProperty(o)){var c=l[o];"style"===o?me(e,c):"dangerouslySetInnerHTML"===o?null!=(c=c?c.__html:void 0)&&he(e,c):"children"===o?"string"===typeof c?("textarea"!==n||""!==c)&&de(e,c):"number"===typeof c&&de(e,""+c):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=c&&"onScroll"===o&&Ur("scroll",e):null!=c&&b(e,o,c,u))}switch(n){case"input":X(e),$(e,r,!1);break;case"textarea":X(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qs(t),null;case 6:if(e&&null!=t.stateNode)Ds(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=no(to.current),no($i.current),hi(t)){if(r=t.stateNode,n=t.memoizedProps,r[da]=t,(o=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Qr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[da]=t,t.stateNode=r}return qs(t),null;case 13:if(Ea(so),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))di(),fi(),t.flags|=98560,o=!1;else if(o=hi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[da]=t}else fi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qs(t),o=!1}else null!==ii&&(sl(ii),ii=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Du&&(Du=3):ml())),null!==t.updateQueue&&(t.flags|=4),qs(t),null);case 4:return ao(),Ls(e,t),null===e&&Vr(t.stateNode.containerInfo),qs(t),null;case 10:return ki(t.type._context),qs(t),null;case 19:if(Ea(so),null===(o=t.memoizedState))return qs(t),null;if(r=0!==(128&t.flags),null===(u=o.rendering))if(r)Xs(o,!1);else{if(0!==Du||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=uo(e))){for(t.flags|=128,Xs(o,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ta(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Gu&&(t.flags|=128,r=!0,Xs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=uo(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Xs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ai)return qs(t),null}else 2*Je()-o.renderingStartTime>Gu&&1073741824!==n&&(t.flags|=128,r=!0,Xs(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=so.current,Ta(so,r?1&n|2:1&n),t):(qs(t),null);case 22:case 23:return dl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Lu)&&(qs(t),6&t.subtreeFlags&&(t.flags|=8192)):qs(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Ys(e,t){switch(ti(t),t.tag){case 1:return Na(t.type)&&La(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ao(),Ea(Ia),Ea(Ca),co(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Ea(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));fi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ea(so),null;case 4:return ao(),null;case 10:return ki(t.type._context),null;case 22:case 23:return dl(),null;default:return null}}Ns=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ls=function(){},Ps=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,no($i.current);var i,o=null;switch(n){case"input":a=Y(e,a),r=Y(e,r),o=[];break;case"select":a=O({},a,{value:void 0}),r=O({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(c in ye(n,r),n=null,a)if(!r.hasOwnProperty(c)&&a.hasOwnProperty(c)&&null!=a[c])if("style"===c){var u=a[c];for(i in u)u.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(s.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(u=null!=a?a[c]:void 0,r.hasOwnProperty(c)&&l!==u&&(null!=l||null!=u))if("style"===c)if(u){for(i in u)!u.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in l)l.hasOwnProperty(i)&&u[i]!==l[i]&&(n||(n={}),n[i]=l[i])}else n||(o||(o=[]),o.push(c,n)),n=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(o=o||[]).push(c,l)):"children"===c?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(s.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&Ur("scroll",e),o||u===l||(o=[])):(o=o||[]).push(c,l))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},Ds=function(e,t,n,r){n!==r&&(t.flags|=4)};var Zs=!1,Js=!1,Qs="function"===typeof WeakSet?WeakSet:Set,$s=null;function eu(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){El(e,t,r)}else n.current=null}function tu(e,t,n){try{n()}catch(r){El(e,t,r)}}var nu=!1;function ru(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&tu(t,n,i)}a=a.next}while(a!==r)}}function au(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function iu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ou(e){var t=e.alternate;null!==t&&(e.alternate=null,ou(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[da],delete t[fa],delete t[va],delete t[ma],delete t[ga])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function su(e){return 5===e.tag||3===e.tag||4===e.tag}function uu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||su(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(lu(e,t,n),e=e.sibling;null!==e;)lu(e,t,n),e=e.sibling}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}var hu=null,du=!1;function fu(e,t,n){for(n=n.child;null!==n;)pu(e,t,n),n=n.sibling}function pu(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(s){}switch(n.tag){case 5:Js||eu(n,t);case 6:var r=hu,a=du;hu=null,fu(e,t,n),du=a,null!==(hu=r)&&(du?(e=hu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hu.removeChild(n.stateNode));break;case 18:null!==hu&&(du?(e=hu,n=n.stateNode,8===e.nodeType?ua(e.parentNode,n):1===e.nodeType&&ua(e,n),Vt(e)):ua(hu,n.stateNode));break;case 4:r=hu,a=du,hu=n.stateNode.containerInfo,du=!0,fu(e,t,n),hu=r,du=a;break;case 0:case 11:case 14:case 15:if(!Js&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&tu(n,t,o),a=a.next}while(a!==r)}fu(e,t,n);break;case 1:if(!Js&&(eu(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){El(n,t,s)}fu(e,t,n);break;case 21:fu(e,t,n);break;case 22:1&n.mode?(Js=(r=Js)||null!==n.memoizedState,fu(e,t,n),Js=r):fu(e,t,n);break;default:fu(e,t,n)}}function vu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qs),t.forEach((function(t){var r=Il.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function mu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:hu=u.stateNode,du=!1;break e;case 3:case 4:hu=u.stateNode.containerInfo,du=!0;break e}u=u.return}if(null===hu)throw Error(i(160));pu(o,s,a),hu=null,du=!1;var l=a.alternate;null!==l&&(l.return=null),a.return=null}catch(c){El(a,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gu(t,e),t=t.sibling}function gu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mu(t,e),yu(e),4&r){try{ru(3,e,e.return),au(3,e)}catch(m){El(e,e.return,m)}try{ru(5,e,e.return)}catch(m){El(e,e.return,m)}}break;case 1:mu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return);break;case 5:if(mu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return),32&e.flags){var a=e.stateNode;try{de(a,"")}catch(m){El(e,e.return,m)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===u&&"radio"===o.type&&null!=o.name&&J(a,o),be(u,s);var c=be(u,o);for(s=0;s<l.length;s+=2){var h=l[s],d=l[s+1];"style"===h?me(a,d):"dangerouslySetInnerHTML"===h?he(a,d):"children"===h?de(a,d):b(a,h,d,c)}switch(u){case"input":Q(a,o);break;case"textarea":ie(a,o);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(a,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[fa]=o}catch(m){El(e,e.return,m)}}break;case 6:if(mu(t,e),yu(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(m){El(e,e.return,m)}}break;case 3:if(mu(t,e),yu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(m){El(e,e.return,m)}break;case 4:default:mu(t,e),yu(e);break;case 13:mu(t,e),yu(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Vu=Je())),4&r&&vu(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Js=(c=Js)||h,mu(t,e),Js=c):mu(t,e),yu(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!h&&0!==(1&e.mode))for($s=e,h=e.child;null!==h;){for(d=$s=h;null!==$s;){switch(p=(f=$s).child,f.tag){case 0:case 11:case 14:case 15:ru(4,f,f.return);break;case 1:eu(f,f.return);var v=f.stateNode;if("function"===typeof v.componentWillUnmount){r=f,n=f.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(m){El(r,n,m)}}break;case 5:eu(f,f.return);break;case 22:if(null!==f.memoizedState){ku(d);continue}}null!==p?(p.return=f,$s=p):ku(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{a=d.stateNode,c?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=d.stateNode,s=void 0!==(l=d.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,u.style.display=ve("display",s))}catch(m){El(e,e.return,m)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(m){El(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:mu(t,e),yu(e),4&r&&vu(e);case 21:}}function yu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(su(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(de(a,""),r.flags&=-33),cu(e,uu(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;lu(e,uu(e),o);break;default:throw Error(i(161))}}catch(s){El(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bu(e,t,n){$s=e,xu(e,t,n)}function xu(e,t,n){for(var r=0!==(1&e.mode);null!==$s;){var a=$s,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Zs;if(!o){var s=a.alternate,u=null!==s&&null!==s.memoizedState||Js;s=Zs;var l=Js;if(Zs=o,(Js=u)&&!l)for($s=a;null!==$s;)u=(o=$s).child,22===o.tag&&null!==o.memoizedState?Su(a):null!==u?(u.return=o,$s=u):Su(a);for(;null!==i;)$s=i,xu(i,t,n),i=i.sibling;$s=a,Zs=s,Js=l}wu(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,$s=i):wu(e)}}function wu(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Js||au(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Js)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:mi(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&zi(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}zi(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var h=c.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Vt(d)}}}break;default:throw Error(i(163))}Js||512&t.flags&&iu(t)}catch(f){El(t,t.return,f)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function ku(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function Su(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{au(4,t)}catch(u){El(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(u){El(t,a,u)}}var i=t.return;try{iu(t)}catch(u){El(t,i,u)}break;case 5:var o=t.return;try{iu(t)}catch(u){El(t,o,u)}}}catch(u){El(t,t.return,u)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var _u,Eu=Math.ceil,Tu=x.ReactCurrentDispatcher,Mu=x.ReactCurrentOwner,Cu=x.ReactCurrentBatchConfig,Iu=0,Au=null,Ru=null,Nu=0,Lu=0,Pu=_a(0),Du=0,Fu=null,Ou=0,zu=0,Uu=0,Bu=null,Wu=null,Vu=0,Gu=1/0,Hu=null,ju=!1,Xu=null,qu=null,Ku=!1,Yu=null,Zu=0,Ju=0,Qu=null,$u=-1,el=0;function tl(){return 0!==(6&Iu)?Je():-1!==$u?$u:$u=Je()}function nl(e){return 0===(1&e.mode)?1:0!==(2&Iu)&&0!==Nu?Nu&-Nu:null!==vi.transition?(0===el&&(el=vt()),el):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Zt(e.type)}function rl(e,t,n,r){if(50<Ju)throw Ju=0,Qu=null,Error(i(185));gt(e,n,r),0!==(2&Iu)&&e===Au||(e===Au&&(0===(2&Iu)&&(zu|=n),4===Du&&ul(e,Nu)),al(e,r),1===n&&0===Iu&&0===(1&t.mode)&&(Gu=Je()+500,Ua&&Va()))}function al(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ot(i),s=1<<o,u=a[o];-1===u?0!==(s&n)&&0===(s&r)||(a[o]=ft(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=dt(e,e===Au?Nu:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Ua=!0,Wa(e)}(ll.bind(null,e)):Wa(ll.bind(null,e)),oa((function(){0===(6&Iu)&&Va()})),n=null;else{switch(xt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Al(n,il.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function il(e,t){if($u=-1,el=0,0!==(6&Iu))throw Error(i(327));var n=e.callbackNode;if(Sl()&&e.callbackNode!==n)return null;var r=dt(e,e===Au?Nu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gl(e,r);else{t=r;var a=Iu;Iu|=2;var o=vl();for(Au===e&&Nu===t||(Hu=null,Gu=Je()+500,fl(e,t));;)try{bl();break}catch(u){pl(e,u)}wi(),Tu.current=o,Iu=a,null!==Ru?t=0:(Au=null,Nu=0,t=Du)}if(0!==t){if(2===t&&(0!==(a=pt(e))&&(r=a,t=ol(e,a))),1===t)throw n=Fu,fl(e,0),ul(e,r),al(e,Je()),n;if(6===t)ul(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!sr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=gl(e,r))&&(0!==(o=pt(e))&&(r=o,t=ol(e,o))),1===t))throw n=Fu,fl(e,0),ul(e,r),al(e,Je()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:kl(e,Wu,Hu);break;case 3:if(ul(e,r),(130023424&r)===r&&10<(t=Vu+500-Je())){if(0!==dt(e,0))break;if(((a=e.suspendedLanes)&r)!==r){tl(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(kl.bind(null,e,Wu,Hu),t);break}kl(e,Wu,Hu);break;case 4:if(ul(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Eu(r/1960))-r)){e.timeoutHandle=ra(kl.bind(null,e,Wu,Hu),r);break}kl(e,Wu,Hu);break;default:throw Error(i(329))}}}return al(e,Je()),e.callbackNode===n?il.bind(null,e):null}function ol(e,t){var n=Bu;return e.current.memoizedState.isDehydrated&&(fl(e,t).flags|=256),2!==(e=gl(e,t))&&(t=Wu,Wu=n,null!==t&&sl(t)),e}function sl(e){null===Wu?Wu=e:Wu.push.apply(Wu,e)}function ul(e,t){for(t&=~Uu,t&=~zu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function ll(e){if(0!==(6&Iu))throw Error(i(327));Sl();var t=dt(e,0);if(0===(1&t))return al(e,Je()),null;var n=gl(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ol(e,r))}if(1===n)throw n=Fu,fl(e,0),ul(e,t),al(e,Je()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,kl(e,Wu,Hu),al(e,Je()),null}function cl(e,t){var n=Iu;Iu|=1;try{return e(t)}finally{0===(Iu=n)&&(Gu=Je()+500,Ua&&Va())}}function hl(e){null!==Yu&&0===Yu.tag&&0===(6&Iu)&&Sl();var t=Iu;Iu|=1;var n=Cu.transition,r=bt;try{if(Cu.transition=null,bt=1,e)return e()}finally{bt=r,Cu.transition=n,0===(6&(Iu=t))&&Va()}}function dl(){Lu=Pu.current,Ea(Pu)}function fl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Ru)for(n=Ru.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&La();break;case 3:ao(),Ea(Ia),Ea(Ca),co();break;case 5:oo(r);break;case 4:ao();break;case 13:case 19:Ea(so);break;case 10:ki(r.type._context);break;case 22:case 23:dl()}n=n.return}if(Au=e,Ru=e=Pl(e.current,null),Nu=Lu=t,Du=0,Fu=null,Uu=zu=Ou=0,Wu=Bu=null,null!==Ti){for(t=0;t<Ti.length;t++)if(null!==(r=(n=Ti[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Ti=null}return e}function pl(e,t){for(;;){var n=Ru;try{if(wi(),ho.current=os,yo){for(var r=vo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}yo=!1}if(po=0,go=mo=vo=null,bo=!1,xo=0,Mu.current=null,null===n||null===n.return){Du=1,Fu=t,Ru=null;break}e:{var o=e,s=n.return,u=n,l=t;if(t=Nu,u.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l,h=u,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,ys(p,s,u,0,t),1&p.mode&&ms(o,c,t),l=c;var v=(t=p).updateQueue;if(null===v){var m=new Set;m.add(l),t.updateQueue=m}else v.add(l);break e}if(0===(1&t)){ms(o,c,t),ml();break e}l=Error(i(426))}else if(ai&&1&u.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,u,0,t),pi(cs(l,u));break e}}o=l=cs(l,u),4!==Du&&(Du=2),null===Bu?Bu=[o]:Bu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Fi(o,ps(0,l,t));break e;case 1:u=l;var y=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===qu||!qu.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Fi(o,vs(o,u,t));break e}}o=o.return}while(null!==o)}wl(n)}catch(x){t=x,Ru===n&&null!==n&&(Ru=n=n.return);continue}break}}function vl(){var e=Tu.current;return Tu.current=os,null===e?os:e}function ml(){0!==Du&&3!==Du&&2!==Du||(Du=4),null===Au||0===(268435455&Ou)&&0===(268435455&zu)||ul(Au,Nu)}function gl(e,t){var n=Iu;Iu|=2;var r=vl();for(Au===e&&Nu===t||(Hu=null,fl(e,t));;)try{yl();break}catch(a){pl(e,a)}if(wi(),Iu=n,Tu.current=r,null!==Ru)throw Error(i(261));return Au=null,Nu=0,Du}function yl(){for(;null!==Ru;)xl(Ru)}function bl(){for(;null!==Ru&&!Ye();)xl(Ru)}function xl(e){var t=_u(e.alternate,e,Lu);e.memoizedProps=e.pendingProps,null===t?wl(e):Ru=t,Mu.current=null}function wl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ks(n,t,Lu)))return void(Ru=n)}else{if(null!==(n=Ys(n,t)))return n.flags&=32767,void(Ru=n);if(null===e)return Du=6,void(Ru=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ru=t);Ru=t=e}while(null!==t);0===Du&&(Du=5)}function kl(e,t,n){var r=bt,a=Cu.transition;try{Cu.transition=null,bt=1,function(e,t,n,r){do{Sl()}while(null!==Yu);if(0!==(6&Iu))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ot(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===Au&&(Ru=Au=null,Nu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Ku||(Ku=!0,Al(tt,(function(){return Sl(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Cu.transition,Cu.transition=null;var s=bt;bt=1;var u=Iu;Iu|=4,Mu.current=null,function(e,t){if(ea=Ht,fr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(w){n=null;break e}var s=0,u=-1,l=-1,c=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==a&&3!==d.nodeType||(u=s+a),d!==o||0!==r&&3!==d.nodeType||(l=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++c===a&&(u=s),f===o&&++h===r&&(l=s),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===u||-1===l?null:{start:u,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Ht=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var m=v.memoizedProps,g=v.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:mi(t.type,m),g);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(i(163))}}catch(w){El(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}v=nu,nu=!1}(e,n),gu(n,e),pr(ta),Ht=!!ea,ta=ea=null,e.current=n,bu(n,e,a),Ze(),Iu=u,bt=s,Cu.transition=o}else e.current=n;if(Ku&&(Ku=!1,Yu=e,Zu=a),o=e.pendingLanes,0===o&&(qu=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),al(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(ju)throw ju=!1,e=Xu,Xu=null,e;0!==(1&Zu)&&0!==e.tag&&Sl(),o=e.pendingLanes,0!==(1&o)?e===Qu?Ju++:(Ju=0,Qu=e):Ju=0,Va()}(e,t,n,r)}finally{Cu.transition=a,bt=r}return null}function Sl(){if(null!==Yu){var e=xt(Zu),t=Cu.transition,n=bt;try{if(Cu.transition=null,bt=16>e?16:e,null===Yu)var r=!1;else{if(e=Yu,Yu=null,Zu=0,0!==(6&Iu))throw Error(i(331));var a=Iu;for(Iu|=4,$s=e.current;null!==$s;){var o=$s,s=o.child;if(0!==(16&$s.flags)){var u=o.deletions;if(null!==u){for(var l=0;l<u.length;l++){var c=u[l];for($s=c;null!==$s;){var h=$s;switch(h.tag){case 0:case 11:case 15:ru(8,h,o)}var d=h.child;if(null!==d)d.return=h,$s=d;else for(;null!==$s;){var f=(h=$s).sibling,p=h.return;if(ou(h),h===c){$s=null;break}if(null!==f){f.return=p,$s=f;break}$s=p}}}var v=o.alternate;if(null!==v){var m=v.child;if(null!==m){v.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}$s=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,$s=s;else e:for(;null!==$s;){if(0!==(2048&(o=$s).flags))switch(o.tag){case 0:case 11:case 15:ru(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,$s=y;break e}$s=o.return}}var b=e.current;for($s=b;null!==$s;){var x=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,$s=x;else e:for(s=b;null!==$s;){if(0!==(2048&(u=$s).flags))try{switch(u.tag){case 0:case 11:case 15:au(9,u)}}catch(k){El(u,u.return,k)}if(u===s){$s=null;break e}var w=u.sibling;if(null!==w){w.return=u.return,$s=w;break e}$s=u.return}}if(Iu=a,Va(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(k){}r=!0}return r}finally{bt=n,Cu.transition=t}}return!1}function _l(e,t,n){e=Pi(e,t=ps(0,t=cs(n,t),1),1),t=tl(),null!==e&&(gt(e,1,t),al(e,t))}function El(e,t,n){if(3===e.tag)_l(e,e,n);else for(;null!==t;){if(3===t.tag){_l(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===qu||!qu.has(r))){t=Pi(t,e=vs(t,e=cs(n,e),1),1),e=tl(),null!==t&&(gt(t,1,e),al(t,e));break}}t=t.return}}function Tl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tl(),e.pingedLanes|=e.suspendedLanes&n,Au===e&&(Nu&n)===n&&(4===Du||3===Du&&(130023424&Nu)===Nu&&500>Je()-Vu?fl(e,0):Uu|=n),al(e,t)}function Ml(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=tl();null!==(e=Ii(e,t))&&(gt(e,t,n),al(e,n))}function Cl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ml(e,n)}function Il(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Ml(e,n)}function Al(e,t){return qe(e,t)}function Rl(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nl(e,t,n,r){return new Rl(e,t,n,r)}function Ll(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pl(e,t){var n=e.alternate;return null===n?((n=Nl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dl(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)Ll(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Fl(n.children,a,o,t);case _:s=8,a|=8;break;case E:return(e=Nl(12,n,t,2|a)).elementType=E,e.lanes=o,e;case I:return(e=Nl(13,n,t,a)).elementType=I,e.lanes=o,e;case A:return(e=Nl(19,n,t,a)).elementType=A,e.lanes=o,e;case L:return Ol(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:s=10;break e;case M:s=9;break e;case C:s=11;break e;case R:s=14;break e;case N:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Nl(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Fl(e,t,n,r){return(e=Nl(7,e,r,t)).lanes=n,e}function Ol(e,t,n,r){return(e=Nl(22,e,r,t)).elementType=L,e.lanes=n,e.stateNode={isHidden:!1},e}function zl(e,t,n){return(e=Nl(6,e,null,t)).lanes=n,e}function Ul(e,t,n){return(t=Nl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bl(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Wl(e,t,n,r,a,i,o,s,u){return e=new Bl(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Nl(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ri(i),e}function Vl(e){if(!e)return Ma;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Na(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Na(n))return Da(e,n,t)}return t}function Gl(e,t,n,r,a,i,o,s,u){return(e=Wl(n,r,!0,e,0,i,0,s,u)).context=Vl(null),n=e.current,(i=Li(r=tl(),a=nl(n))).callback=void 0!==t&&null!==t?t:null,Pi(n,i,a),e.current.lanes=a,gt(e,a,r),al(e,r),e}function Hl(e,t,n,r){var a=t.current,i=tl(),o=nl(a);return n=Vl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Li(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Pi(a,t,o))&&(rl(e,a,o,i),Di(e,a,o)),o}function jl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Xl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ql(e,t){Xl(e,t),(e=e.alternate)&&Xl(e,t)}_u=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ia.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:As(t),fi();break;case 5:io(t);break;case 1:Na(t.type)&&Fa(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ta(gi,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ta(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?zs(e,t,n):(Ta(so,1&so.current),null!==(e=js(e,t,n))?e.sibling:null);Ta(so,1&so.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Gs(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ta(so,so.current),r)break;return null;case 22:case 23:return t.lanes=0,Es(e,t,n)}return js(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,ai&&0!==(1048576&t.flags)&&$a(t,Xa,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Hs(e,t),e=t.pendingProps;var a=Ra(t,Ca.current);_i(t,n),a=_o(null,t,r,e,a,n);var o=Eo();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Na(r)?(o=!0,Fa(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ri(t),a.updater=Wi,t.stateNode=a,a._reactInternals=t,ji(t,r,e,n),t=Is(null,t,r,!0,o,n)):(t.tag=0,ai&&o&&ei(t),ws(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Hs(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Ll(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===R)return 14}return 2}(r),e=mi(r,e),a){case 0:t=Ms(null,t,r,e,n);break e;case 1:t=Cs(null,t,r,e,n);break e;case 11:t=ks(null,t,r,e,n);break e;case 14:t=Ss(null,t,r,mi(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Ms(e,t,r,a=t.elementType===r?a:mi(r,a),n);case 1:return r=t.type,a=t.pendingProps,Cs(e,t,r,a=t.elementType===r?a:mi(r,a),n);case 3:e:{if(As(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,Ni(e,t),Oi(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Rs(e,t,r,n,a=cs(Error(i(423)),t));break e}if(r!==a){t=Rs(e,t,r,n,a=cs(Error(i(424)),t));break e}for(ri=la(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=Ji(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fi(),r===a){t=js(e,t,n);break e}ws(e,t,r,n)}t=t.child}return t;case 5:return io(t),null===e&&li(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,na(r,a)?s=null:null!==o&&na(r,o)&&(t.flags|=32),Ts(e,t),ws(e,t,s,n),t.child;case 6:return null===e&&li(t),null;case 13:return zs(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Zi(t,null,r,n):ws(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,ks(e,t,r,a=t.elementType===r?a:mi(r,a),n);case 7:return ws(e,t,t.pendingProps,n),t.child;case 8:case 12:return ws(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Ta(gi,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===a.children&&!Ia.current){t=js(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var l=u.firstContext;null!==l;){if(l.context===r){if(1===o.tag){(l=Li(-1,n&-n)).tag=2;var c=o.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Si(o.return,n,t),u.lanes|=n;break}l=l.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Si(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ws(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,_i(t,n),r=r(a=Ei(a)),t.flags|=1,ws(e,t,r,n),t.child;case 14:return a=mi(r=t.type,t.pendingProps),Ss(e,t,r,a=mi(r.type,a),n);case 15:return _s(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:mi(r,a),Hs(e,t),t.tag=1,Na(r)?(e=!0,Fa(t)):e=!1,_i(t,n),Gi(t,r,a),ji(t,r,a,n),Is(null,t,r,!0,e,n);case 19:return Gs(e,t,n);case 22:return Es(e,t,n)}throw Error(i(156,t.tag))};var Kl="function"===typeof reportError?reportError:function(e){console.error(e)};function Yl(e){this._internalRoot=e}function Zl(e){this._internalRoot=e}function Jl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Ql(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $l(){}function ec(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=jl(o);s.call(e)}}Hl(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=jl(o);i.call(e)}}var o=Gl(t,r,e,0,null,!1,0,"",$l);return e._reactRootContainer=o,e[pa]=o.current,Vr(8===e.nodeType?e.parentNode:e),hl(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=jl(u);s.call(e)}}var u=Wl(e,0,!1,null,0,!1,0,"",$l);return e._reactRootContainer=u,e[pa]=u.current,Vr(8===e.nodeType?e.parentNode:e),hl((function(){Hl(t,u,n,r)})),u}(n,t,e,a,r);return jl(o)}Zl.prototype.render=Yl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Hl(e,t,null,null)},Zl.prototype.unmount=Yl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hl((function(){Hl(null,e,null,null)})),t[pa]=null}},Zl.prototype.unstable_scheduleHydration=function(e){if(e){var t=_t();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lt.length&&0!==t&&t<Lt[n].priority;n++);Lt.splice(n,0,e),0===n&&Ot(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),al(t,Je()),0===(6&Iu)&&(Gu=Je()+500,Va()))}break;case 13:hl((function(){var t=Ii(e,1);if(null!==t){var n=tl();rl(t,e,1,n)}})),ql(e,1)}},kt=function(e){if(13===e.tag){var t=Ii(e,134217728);if(null!==t)rl(t,e,134217728,tl());ql(e,134217728)}},St=function(e){if(13===e.tag){var t=nl(e),n=Ii(e,t);if(null!==n)rl(n,e,t,tl());ql(e,t)}},_t=function(){return bt},Et=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},ke=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=wa(r);if(!a)throw Error(i(90));q(r),Q(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ce=cl,Ie=hl;var tc={usingClientEntryPoint:!1,Events:[ba,xa,wa,Te,Me,cl]},nc={findFiberByHostInstance:ya,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rc={bundleType:nc.bundleType,version:nc.version,rendererPackageName:nc.rendererPackageName,rendererConfig:nc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=je(e))?null:e.stateNode},findFiberByHostInstance:nc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ac=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ac.isDisabled&&ac.supportsFiber)try{at=ac.inject(rc),it=ac}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Jl(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:k,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Jl(e))throw Error(i(299));var n=!1,r="",a=Kl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Wl(e,1,!1,null,0,n,0,r,a),e[pa]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Yl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=je(t))?null:e.stateNode},t.flushSync=function(e){return hl(e)},t.hydrate=function(e,t,n){if(!Ql(t))throw Error(i(200));return ec(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Jl(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=Kl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Gl(t,null,e,1,null!=n?n:null,a,0,o,s),e[pa]=t.current,Vr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Zl(t)},t.render=function(e,t,n){if(!Ql(t))throw Error(i(200));return ec(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Ql(e))throw Error(i(40));return!!e._reactRootContainer&&(hl((function(){ec(null,null,e,!1,(function(){e._reactRootContainer=null,e[pa]=null}))})),!0)},t.unstable_batchedUpdates=cl,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Ql(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return ec(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},250:function(e,t,n){"use strict";var r=n(164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},976:function(e,t){"use strict";t.ConcurrentRoot=1,t.ContinuousEventPriority=4,t.DefaultEventPriority=16,t.DiscreteEventPriority=1},721:function(e,t,n){e.exports=function(e){var t={},r=n(791),a=n(100),i=Object.assign;function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u=Symbol.for("react.element"),l=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),p=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),b=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var x=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var w=Symbol.iterator;function k(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=w&&e[w]||e["@@iterator"])?e:null}function S(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case c:return"Fragment";case l:return"Portal";case d:return"Profiler";case h:return"StrictMode";case m:return"Suspense";case g:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case p:return(e.displayName||"Context")+".Consumer";case f:return(e._context.displayName||"Context")+".Provider";case v:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:S(e.type)||"Memo";case b:t=e._payload,e=e._init;try{return S(e(t))}catch(n){}}return null}function _(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return S(t);case 8:return t===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function E(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function T(e){if(E(e)!==e)throw Error(o(188))}function M(e){var t=e.alternate;if(!t){if(null===(t=E(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(r=a.return)){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return T(a),e;if(i===r)return T(a),t;i=i.sibling}throw Error(o(188))}if(n.return!==r.return)n=a,r=i;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=i;break}if(u===r){s=!0,r=a,n=i;break}u=u.sibling}if(!s){for(u=i.child;u;){if(u===n){s=!0,n=i,r=a;break}if(u===r){s=!0,r=i,n=a;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}function C(e){return null!==(e=M(e))?I(e):null}function I(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=I(e);if(null!==t)return t;e=e.sibling}return null}function A(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=A(e);if(null!==t)return t}e=e.sibling}return null}var R,N=Array.isArray,L=e.getPublicInstance,P=e.getRootHostContext,D=e.getChildHostContext,F=e.prepareForCommit,O=e.resetAfterCommit,z=e.createInstance,U=e.appendInitialChild,B=e.finalizeInitialChildren,W=e.prepareUpdate,V=e.shouldSetTextContent,G=e.createTextInstance,H=e.scheduleTimeout,j=e.cancelTimeout,X=e.noTimeout,q=e.isPrimaryRenderer,K=e.supportsMutation,Y=e.supportsPersistence,Z=e.supportsHydration,J=e.getInstanceFromNode,Q=e.preparePortalMount,$=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,re=e.supportsTestSelectors,ae=e.findFiberRoot,ie=e.getBoundingRect,oe=e.getTextContent,se=e.isHiddenSubtree,ue=e.matchAccessibilityRole,le=e.setFocusIfFocusable,ce=e.setupIntersectionObserver,he=e.appendChild,de=e.appendChildToContainer,fe=e.commitTextUpdate,pe=e.commitMount,ve=e.commitUpdate,me=e.insertBefore,ge=e.insertInContainerBefore,ye=e.removeChild,be=e.removeChildFromContainer,xe=e.resetTextContent,we=e.hideInstance,ke=e.hideTextInstance,Se=e.unhideInstance,_e=e.unhideTextInstance,Ee=e.clearContainer,Te=e.cloneInstance,Me=e.createContainerChildSet,Ce=e.appendChildToContainerChildSet,Ie=e.finalizeContainerChildren,Ae=e.replaceContainerChildren,Re=e.cloneHiddenInstance,Ne=e.cloneHiddenTextInstance,Le=e.canHydrateInstance,Pe=e.canHydrateTextInstance,De=e.canHydrateSuspenseInstance,Fe=e.isSuspenseInstancePending,Oe=e.isSuspenseInstanceFallback,ze=e.registerSuspenseInstanceRetry,Ue=e.getNextHydratableSibling,Be=e.getFirstHydratableChild,We=e.getFirstHydratableChildWithinContainer,Ve=e.getFirstHydratableChildWithinSuspenseInstance,Ge=e.hydrateInstance,He=e.hydrateTextInstance,je=e.hydrateSuspenseInstance,Xe=e.getNextHydratableInstanceAfterSuspenseInstance,qe=e.commitHydratedContainer,Ke=e.commitHydratedSuspenseInstance,Ye=e.clearSuspenseBoundary,Ze=e.clearSuspenseBoundaryFromContainer,Je=e.shouldDeleteUnhydratedTailInstances,Qe=e.didNotMatchHydratedContainerTextInstance,$e=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===R)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);R=t&&t[1]||""}return"\n"+R+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var a=l.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var u="\n"+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var rt=Object.prototype.hasOwnProperty,at=[],it=-1;function ot(e){return{current:e}}function st(e){0>it||(e.current=at[it],at[it]=null,it--)}function ut(e,t){it++,at[it]=e.current,e.current=t}var lt={},ct=ot(lt),ht=ot(!1),dt=lt;function ft(e,t){var n=e.type.contextTypes;if(!n)return lt;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function pt(e){return null!==(e=e.childContextTypes)&&void 0!==e}function vt(){st(ht),st(ct)}function mt(e,t,n){if(ct.current!==lt)throw Error(o(168));ut(ct,t),ut(ht,n)}function gt(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(o(108,_(e)||"Unknown",a));return i({},n,r)}function yt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||lt,dt=ct.current,ut(ct,e),ut(ht,ht.current),!0}function bt(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=gt(e,t,dt),r.__reactInternalMemoizedMergedChildContext=e,st(ht),st(ct),ut(ct,e)):st(ht),ut(ht,n)}var xt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(wt(e)/kt|0)|0},wt=Math.log,kt=Math.LN2;var St=64,_t=4194304;function Et(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Tt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=Et(s):0!==(i&=o)&&(r=Et(i))}else 0!==(o=n&~a)?r=Et(o):0!==i&&(r=Et(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-xt(t)),r|=e[n],t&=~a;return r}function Mt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ct(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function It(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function At(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-xt(t)]=n}function Rt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-xt(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var Nt=0;function Lt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Pt=a.unstable_scheduleCallback,Dt=a.unstable_cancelCallback,Ft=a.unstable_shouldYield,Ot=a.unstable_requestPaint,zt=a.unstable_now,Ut=a.unstable_ImmediatePriority,Bt=a.unstable_UserBlockingPriority,Wt=a.unstable_NormalPriority,Vt=a.unstable_IdlePriority,Gt=null,Ht=null;var jt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Xt=null,qt=!1,Kt=!1;function Yt(e){null===Xt?Xt=[e]:Xt.push(e)}function Zt(){if(!Kt&&null!==Xt){Kt=!0;var e=0,t=Nt;try{var n=Xt;for(Nt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Xt=null,qt=!1}catch(a){throw null!==Xt&&(Xt=Xt.slice(e+1)),Pt(Ut,Zt),a}finally{Nt=t,Kt=!1}}return null}var Jt=s.ReactCurrentBatchConfig;function Qt(e,t){if(jt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!rt.call(t,a)||!jt(e[a],t[a]))return!1}return!0}function $t(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=ot(null),nn=null,rn=null,an=null;function on(){an=rn=nn=null}function sn(e,t,n){q?(ut(tn,t._currentValue),t._currentValue=n):(ut(tn,t._currentValue2),t._currentValue2=n)}function un(e){var t=tn.current;st(tn),q?e._currentValue=t:e._currentValue2=t}function ln(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function cn(e,t){nn=e,an=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Fa=!0),e.firstContext=null)}function hn(e){var t=q?e._currentValue:e._currentValue2;if(an!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(o(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var dn=null,fn=!1;function pn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function gn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==Ki&&0!==(1&e.mode)&&0===(2&qi)?(null===(e=n.interleaved)?(t.next=t,null===dn?dn=[n]:dn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function yn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Rt(e,n)}}function bn(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function xn(e,t,n,r){var a=e.updateQueue;fn=!1;var o=a.firstBaseUpdate,s=a.lastBaseUpdate,u=a.shared.pending;if(null!==u){a.shared.pending=null;var l=u,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var h=e.alternate;null!==h&&((u=(h=h.updateQueue).lastBaseUpdate)!==s&&(null===u?h.firstBaseUpdate=c:u.next=c,h.lastBaseUpdate=l))}if(null!==o){var d=a.baseState;for(s=0,h=c=l=null,u=o;;){var f=u.lane,p=u.eventTime;if((r&f)===f){null!==h&&(h=h.next={eventTime:p,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var v=e,m=u;switch(f=t,p=n,m.tag){case 1:if("function"===typeof(v=m.payload)){d=v.call(p,d,f);break e}d=v;break e;case 3:v.flags=-65537&v.flags|128;case 0:if(null===(f="function"===typeof(v=m.payload)?v.call(p,d,f):v)||void 0===f)break e;d=i({},d,f);break e;case 2:fn=!0}}null!==u.callback&&0!==u.lane&&(e.flags|=64,null===(f=a.effects)?a.effects=[u]:f.push(u))}else p={eventTime:p,lane:f,tag:u.tag,payload:u.payload,callback:u.callback,next:null},null===h?(c=h=p,l=d):h=h.next=p,s|=f;if(null===(u=u.next)){if(null===(u=a.shared.pending))break;u=(f=u).next,f.next=null,a.lastBaseUpdate=f,a.shared.pending=null}}if(null===h&&(l=d),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=h,null!==(t=a.shared.interleaved)){a=t;do{s|=a.lane,a=a.next}while(a!==t)}else null===o&&(a.shared.lanes=0);to|=s,e.lanes=s,e.memoizedState=d}}function wn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(o(191,a));a.call(r)}}}var kn=(new r.Component).refs;function Sn(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var _n={isMounted:function(e){return!!(e=e._reactInternals)&&E(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=wo(),a=ko(e),i=mn(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),gn(e,i),null!==(t=So(e,a,r))&&yn(t,e,a)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=wo(),a=ko(e),i=mn(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),gn(e,i),null!==(t=So(e,a,r))&&yn(t,e,a)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=wo(),r=ko(e),a=mn(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),gn(e,a),null!==(t=So(e,r,n))&&yn(t,e,r)}};function En(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!Qt(n,r)||!Qt(a,i))}function Tn(e,t,n){var r=!1,a=lt,i=t.contextType;return"object"===typeof i&&null!==i?i=hn(i):(a=pt(t)?dt:ct.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?ft(e,a):lt),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=_n,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Mn(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&_n.enqueueReplaceState(t,t.state,null)}function Cn(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=kn,pn(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=hn(i):(i=pt(t)?dt:ct.current,a.context=ft(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Sn(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&_n.enqueueReplaceState(a,a.state,null),xn(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}var In=[],An=0,Rn=null,Nn=0,Ln=[],Pn=0,Dn=null,Fn=1,On="";function zn(e,t){In[An++]=Nn,In[An++]=Rn,Rn=e,Nn=t}function Un(e,t,n){Ln[Pn++]=Fn,Ln[Pn++]=On,Ln[Pn++]=Dn,Dn=e;var r=Fn;e=On;var a=32-xt(r)-1;r&=~(1<<a),n+=1;var i=32-xt(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Fn=1<<32-xt(t)+a|n<<a|r,On=i+e}else Fn=1<<i|n<<a|r,On=e}function Bn(e){null!==e.return&&(zn(e,1),Un(e,1,0))}function Wn(e){for(;e===Rn;)Rn=In[--An],In[An]=null,Nn=In[--An],In[An]=null;for(;e===Dn;)Dn=Ln[--Pn],Ln[Pn]=null,On=Ln[--Pn],Ln[Pn]=null,Fn=Ln[--Pn],Ln[Pn]=null}var Vn=null,Gn=null,Hn=!1,jn=!1,Xn=null;function qn(e,t){var n=Qo(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Kn(e,t){switch(e.tag){case 5:return null!==(t=Le(t,e.type,e.pendingProps))&&(e.stateNode=t,Vn=e,Gn=Be(t),!0);case 6:return null!==(t=Pe(t,e.pendingProps))&&(e.stateNode=t,Vn=e,Gn=null,!0);case 13:if(null!==(t=De(t))){var n=null!==Dn?{id:Fn,overflow:On}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Qo(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Vn=e,Gn=null,!0}return!1;default:return!1}}function Yn(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function Zn(e){if(Hn){var t=Gn;if(t){var n=t;if(!Kn(e,t)){if(Yn(e))throw Error(o(418));t=Ue(n);var r=Vn;t&&Kn(e,t)?qn(r,n):(e.flags=-4097&e.flags|2,Hn=!1,Vn=e)}}else{if(Yn(e))throw Error(o(418));e.flags=-4097&e.flags|2,Hn=!1,Vn=e}}}function Jn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Vn=e}function Qn(e){if(!Z||e!==Vn)return!1;if(!Hn)return Jn(e),Hn=!0,!1;if(3!==e.tag&&(5!==e.tag||Je(e.type)&&!V(e.type,e.memoizedProps))){var t=Gn;if(t){if(Yn(e)){for(e=Gn;e;)e=Ue(e);throw Error(o(418))}for(;t;)qn(e,t),t=Ue(t)}}if(Jn(e),13===e.tag){if(!Z)throw Error(o(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));Gn=Xe(e)}else Gn=Vn?Ue(e.stateNode):null;return!0}function $n(){Z&&(Gn=Vn=null,jn=Hn=!1)}function er(e){null===Xn?Xn=[e]:Xn.push(e)}function tr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var a=r,i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=a.refs;t===kn&&(t=a.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function nr(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function rr(e){return(0,e._init)(e._payload)}function ar(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=es(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function h(e,t,n,r){return null===t||6!==t.tag?((t=as(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n,r){var i=n.type;return i===c?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===b&&rr(i)===t.type)?((r=a(t,n.props)).ref=tr(e,t,n),r.return=e,r):((r=ts(n.type,n.key,n.props,null,e.mode,r)).ref=tr(e,t,n),r.return=e,r)}function f(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=is(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function p(e,t,n,r,i){return null===t||7!==t.tag?((t=ns(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function v(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=as(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case u:return(n=ts(t.type,t.key,t.props,null,e.mode,n)).ref=tr(e,null,t),n.return=e,n;case l:return(t=is(t,e.mode,n)).return=e,t;case b:return v(e,(0,t._init)(t._payload),n)}if(N(t)||k(t))return(t=ns(t,e.mode,n,null)).return=e,t;nr(e,t)}return null}function m(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:h(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case u:return n.key===a?d(e,t,n,r):null;case l:return n.key===a?f(e,t,n,r):null;case b:return m(e,t,(a=n._init)(n._payload),r)}if(N(n)||k(n))return null!==a?null:p(e,t,n,r,null);nr(e,n)}return null}function g(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return h(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case u:return d(t,e=e.get(null===r.key?n:r.key)||null,r,a);case l:return f(t,e=e.get(null===r.key?n:r.key)||null,r,a);case b:return g(e,t,n,(0,r._init)(r._payload),a)}if(N(r)||k(r))return p(t,e=e.get(n)||null,r,a,null);nr(t,r)}return null}function y(a,o,s,u){for(var l=null,c=null,h=o,d=o=0,f=null;null!==h&&d<s.length;d++){h.index>d?(f=h,h=null):f=h.sibling;var p=m(a,h,s[d],u);if(null===p){null===h&&(h=f);break}e&&h&&null===p.alternate&&t(a,h),o=i(p,o,d),null===c?l=p:c.sibling=p,c=p,h=f}if(d===s.length)return n(a,h),Hn&&zn(a,d),l;if(null===h){for(;d<s.length;d++)null!==(h=v(a,s[d],u))&&(o=i(h,o,d),null===c?l=h:c.sibling=h,c=h);return Hn&&zn(a,d),l}for(h=r(a,h);d<s.length;d++)null!==(f=g(h,a,d,s[d],u))&&(e&&null!==f.alternate&&h.delete(null===f.key?d:f.key),o=i(f,o,d),null===c?l=f:c.sibling=f,c=f);return e&&h.forEach((function(e){return t(a,e)})),Hn&&zn(a,d),l}function x(a,s,u,l){var c=k(u);if("function"!==typeof c)throw Error(o(150));if(null==(u=c.call(u)))throw Error(o(151));for(var h=c=null,d=s,f=s=0,p=null,y=u.next();null!==d&&!y.done;f++,y=u.next()){d.index>f?(p=d,d=null):p=d.sibling;var b=m(a,d,y.value,l);if(null===b){null===d&&(d=p);break}e&&d&&null===b.alternate&&t(a,d),s=i(b,s,f),null===h?c=b:h.sibling=b,h=b,d=p}if(y.done)return n(a,d),Hn&&zn(a,f),c;if(null===d){for(;!y.done;f++,y=u.next())null!==(y=v(a,y.value,l))&&(s=i(y,s,f),null===h?c=y:h.sibling=y,h=y);return Hn&&zn(a,f),c}for(d=r(a,d);!y.done;f++,y=u.next())null!==(y=g(d,a,f,y.value,l))&&(e&&null!==y.alternate&&d.delete(null===y.key?f:y.key),s=i(y,s,f),null===h?c=y:h.sibling=y,h=y);return e&&d.forEach((function(e){return t(a,e)})),Hn&&zn(a,f),c}return function e(r,i,o,h){if("object"===typeof o&&null!==o&&o.type===c&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case u:e:{for(var d=o.key,f=i;null!==f;){if(f.key===d){if((d=o.type)===c){if(7===f.tag){n(r,f.sibling),(i=a(f,o.props.children)).return=r,r=i;break e}}else if(f.elementType===d||"object"===typeof d&&null!==d&&d.$$typeof===b&&rr(d)===f.type){n(r,f.sibling),(i=a(f,o.props)).ref=tr(r,f,o),i.return=r,r=i;break e}n(r,f);break}t(r,f),f=f.sibling}o.type===c?((i=ns(o.props.children,r.mode,h,o.key)).return=r,r=i):((h=ts(o.type,o.key,o.props,null,r.mode,h)).ref=tr(r,i,o),h.return=r,r=h)}return s(r);case l:e:{for(f=o.key;null!==i;){if(i.key===f){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=is(o,r.mode,h)).return=r,r=i}return s(r);case b:return e(r,i,(f=o._init)(o._payload),h)}if(N(o))return y(r,i,o,h);if(k(o))return x(r,i,o,h);nr(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=as(o,r.mode,h)).return=r,r=i),s(r)):n(r,i)}}var ir=ar(!0),or=ar(!1),sr={},ur=ot(sr),lr=ot(sr),cr=ot(sr);function hr(e){if(e===sr)throw Error(o(174));return e}function dr(e,t){ut(cr,t),ut(lr,e),ut(ur,sr),e=P(t),st(ur),ut(ur,e)}function fr(){st(ur),st(lr),st(cr)}function pr(e){var t=hr(cr.current),n=hr(ur.current);n!==(t=D(n,e.type,t))&&(ut(lr,e),ut(ur,t))}function vr(e){lr.current===e&&(st(ur),st(lr))}var mr=ot(0);function gr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Fe(n)||Oe(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yr=[];function br(){for(var e=0;e<yr.length;e++){var t=yr[e];q?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}yr.length=0}var xr=s.ReactCurrentDispatcher,wr=s.ReactCurrentBatchConfig,kr=0,Sr=null,_r=null,Er=null,Tr=!1,Mr=!1,Cr=0,Ir=0;function Ar(){throw Error(o(321))}function Rr(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!jt(e[n],t[n]))return!1;return!0}function Nr(e,t,n,r,a,i){if(kr=i,Sr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xr.current=null===e||null===e.memoizedState?pa:va,e=n(r,a),Mr){i=0;do{if(Mr=!1,Cr=0,25<=i)throw Error(o(301));i+=1,Er=_r=null,t.updateQueue=null,xr.current=ma,e=n(r,a)}while(Mr)}if(xr.current=fa,t=null!==_r&&null!==_r.next,kr=0,Er=_r=Sr=null,Tr=!1,t)throw Error(o(300));return e}function Lr(){var e=0!==Cr;return Cr=0,e}function Pr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Er?Sr.memoizedState=Er=e:Er=Er.next=e,Er}function Dr(){if(null===_r){var e=Sr.alternate;e=null!==e?e.memoizedState:null}else e=_r.next;var t=null===Er?Sr.memoizedState:Er.next;if(null!==t)Er=t,_r=e;else{if(null===e)throw Error(o(310));e={memoizedState:(_r=e).memoizedState,baseState:_r.baseState,baseQueue:_r.baseQueue,queue:_r.queue,next:null},null===Er?Sr.memoizedState=Er=e:Er=Er.next=e}return Er}function Fr(e,t){return"function"===typeof t?t(e):t}function Or(e){var t=Dr(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=_r,a=r.baseQueue,i=n.pending;if(null!==i){if(null!==a){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,n.pending=null}if(null!==a){i=a.next,r=r.baseState;var u=s=null,l=null,c=i;do{var h=c.lane;if((kr&h)===h)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(u=l=d,s=r):l=l.next=d,Sr.lanes|=h,to|=h}c=c.next}while(null!==c&&c!==i);null===l?s=r:l.next=u,jt(r,t.memoizedState)||(Fa=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{i=a.lane,Sr.lanes|=i,to|=i,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function zr(e){var t=Dr(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{i=e(i,s.action),s=s.next}while(s!==a);jt(i,t.memoizedState)||(Fa=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Ur(){}function Br(e,t){var n=Sr,r=Dr(),a=t(),i=!jt(r.memoizedState,a);if(i&&(r.memoizedState=a,Fa=!0),r=r.queue,Jr(Gr.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==Er&&1&Er.memoizedState.tag){if(n.flags|=2048,Xr(9,Vr.bind(null,n,r,a,t),void 0,null),null===Ki)throw Error(o(349));0!==(30&kr)||Wr(n,t,a)}return a}function Wr(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Sr.updateQueue)?(t={lastEffect:null,stores:null},Sr.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Vr(e,t,n,r){t.value=n,t.getSnapshot=r,Hr(t)&&So(e,1,-1)}function Gr(e,t,n){return n((function(){Hr(t)&&So(e,1,-1)}))}function Hr(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!jt(e,n)}catch(r){return!0}}function jr(e){var t=Pr();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fr,lastRenderedState:e},t.queue=e,e=e.dispatch=ua.bind(null,Sr,e),[t.memoizedState,e]}function Xr(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Sr.updateQueue)?(t={lastEffect:null,stores:null},Sr.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function qr(){return Dr().memoizedState}function Kr(e,t,n,r){var a=Pr();Sr.flags|=e,a.memoizedState=Xr(1|t,n,void 0,void 0===r?null:r)}function Yr(e,t,n,r){var a=Dr();r=void 0===r?null:r;var i=void 0;if(null!==_r){var o=_r.memoizedState;if(i=o.destroy,null!==r&&Rr(r,o.deps))return void(a.memoizedState=Xr(t,n,i,r))}Sr.flags|=e,a.memoizedState=Xr(1|t,n,i,r)}function Zr(e,t){return Kr(8390656,8,e,t)}function Jr(e,t){return Yr(2048,8,e,t)}function Qr(e,t){return Yr(4,2,e,t)}function $r(e,t){return Yr(4,4,e,t)}function ea(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ta(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Yr(4,4,ea.bind(null,t,e),n)}function na(){}function ra(e,t){var n=Dr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Rr(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function aa(e,t){var n=Dr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Rr(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function ia(e,t){var n=Nt;Nt=0!==n&&4>n?n:4,e(!0);var r=wr.transition;wr.transition={};try{e(!1),t()}finally{Nt=n,wr.transition=r}}function oa(){return Dr().memoizedState}function sa(e,t,n){var r=ko(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},la(e)?ca(t,n):(ha(e,t,n),null!==(e=So(e,r,n=wo()))&&da(e,t,r))}function ua(e,t,n){var r=ko(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(la(e))ca(t,a);else{ha(e,t,a);var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,jt(s,o))return}catch(u){}null!==(e=So(e,r,n=wo()))&&da(e,t,r)}}function la(e){var t=e.alternate;return e===Sr||null!==t&&t===Sr}function ca(e,t){Mr=Tr=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ha(e,t,n){null!==Ki&&0!==(1&e.mode)&&0===(2&qi)?(null===(e=t.interleaved)?(n.next=n,null===dn?dn=[t]:dn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function da(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Rt(e,n)}}var fa={readContext:hn,useCallback:Ar,useContext:Ar,useEffect:Ar,useImperativeHandle:Ar,useInsertionEffect:Ar,useLayoutEffect:Ar,useMemo:Ar,useReducer:Ar,useRef:Ar,useState:Ar,useDebugValue:Ar,useDeferredValue:Ar,useTransition:Ar,useMutableSource:Ar,useSyncExternalStore:Ar,useId:Ar,unstable_isNewReconciler:!1},pa={readContext:hn,useCallback:function(e,t){return Pr().memoizedState=[e,void 0===t?null:t],e},useContext:hn,useEffect:Zr,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Kr(4194308,4,ea.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Kr(4194308,4,e,t)},useInsertionEffect:function(e,t){return Kr(4,2,e,t)},useMemo:function(e,t){var n=Pr();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Pr();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=sa.bind(null,Sr,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Pr().memoizedState=e},useState:jr,useDebugValue:na,useDeferredValue:function(e){var t=jr(e),n=t[0],r=t[1];return Zr((function(){var t=wr.transition;wr.transition={};try{r(e)}finally{wr.transition=t}}),[e]),n},useTransition:function(){var e=jr(!1),t=e[0];return e=ia.bind(null,e[1]),Pr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Sr,a=Pr();if(Hn){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Ki)throw Error(o(349));0!==(30&kr)||Wr(r,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,Zr(Gr.bind(null,r,i,e),[e]),r.flags|=2048,Xr(9,Vr.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Pr(),t=Ki.identifierPrefix;if(Hn){var n=On;t=":"+t+"R"+(n=(Fn&~(1<<32-xt(Fn)-1)).toString(32)+n),0<(n=Cr++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Ir++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},va={readContext:hn,useCallback:ra,useContext:hn,useEffect:Jr,useImperativeHandle:ta,useInsertionEffect:Qr,useLayoutEffect:$r,useMemo:aa,useReducer:Or,useRef:qr,useState:function(){return Or(Fr)},useDebugValue:na,useDeferredValue:function(e){var t=Or(Fr),n=t[0],r=t[1];return Jr((function(){var t=wr.transition;wr.transition={};try{r(e)}finally{wr.transition=t}}),[e]),n},useTransition:function(){return[Or(Fr)[0],Dr().memoizedState]},useMutableSource:Ur,useSyncExternalStore:Br,useId:oa,unstable_isNewReconciler:!1},ma={readContext:hn,useCallback:ra,useContext:hn,useEffect:Jr,useImperativeHandle:ta,useInsertionEffect:Qr,useLayoutEffect:$r,useMemo:aa,useReducer:zr,useRef:qr,useState:function(){return zr(Fr)},useDebugValue:na,useDeferredValue:function(e){var t=zr(Fr),n=t[0],r=t[1];return Jr((function(){var t=wr.transition;wr.transition={};try{r(e)}finally{wr.transition=t}}),[e]),n},useTransition:function(){return[zr(Fr)[0],Dr().memoizedState]},useMutableSource:Ur,useSyncExternalStore:Br,useId:oa,unstable_isNewReconciler:!1};function ga(e,t){try{var n="",r=t;do{n+=$t(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a}}function ya(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ba,xa,wa,ka,Sa="function"===typeof WeakMap?WeakMap:Map;function _a(e,t,n){(n=mn(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){co||(co=!0,ho=r),ya(0,t)},n}function Ea(e,t,n){(n=mn(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){ya(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){ya(0,t),"function"!==typeof r&&(null===fo?fo=new Set([this]):fo.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function Ta(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new Sa;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Xo.bind(null,e,t,n),t.then(e,e))}function Ma(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Ca(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=mn(-1,1)).tag=2,gn(n,t))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}function Ia(e){e.flags|=4}function Aa(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!==(12854&e.flags)||0!==(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if(K)ba=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)U(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},xa=function(){},wa=function(e,t,n,r,a){if((e=e.memoizedProps)!==r){var i=t.stateNode,o=hr(ur.current);n=W(i,n,e,r,a,o),(t.updateQueue=n)&&Ia(t)}},ka=function(e,t,n,r){n!==r&&Ia(t)};else if(Y){ba=function(e,t,n,r){for(var a=t.child;null!==a;){if(5===a.tag){var i=a.stateNode;n&&r&&(i=Re(i,a.type,a.memoizedProps,a)),U(e,i)}else if(6===a.tag)i=a.stateNode,n&&r&&(i=Ne(i,a.memoizedProps,a)),U(e,i);else if(4!==a.tag)if(22===a.tag&&null!==a.memoizedState)null!==(i=a.child)&&(i.return=a),ba(e,a,!0,!0);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};var Ra=function e(t,n,r,a){for(var i=n.child;null!==i;){if(5===i.tag){var o=i.stateNode;r&&a&&(o=Re(o,i.type,i.memoizedProps,i)),Ce(t,o)}else if(6===i.tag)o=i.stateNode,r&&a&&(o=Ne(o,i.memoizedProps,i)),Ce(t,o);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(o=i.child)&&(o.return=i),e(t,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===n)break;for(;null===i.sibling;){if(null===i.return||i.return===n)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};xa=function(e,t){var n=t.stateNode;if(!Aa(e,t)){e=n.containerInfo;var r=Me(e);Ra(r,t,!1,!1),n.pendingChildren=r,Ia(t),Ie(e,r)}},wa=function(e,t,n,r,a){var i=e.stateNode,o=e.memoizedProps;if((e=Aa(e,t))&&o===r)t.stateNode=i;else{var s=t.stateNode,u=hr(ur.current),l=null;o!==r&&(l=W(s,n,o,r,a,u)),e&&null===l?t.stateNode=i:(i=Te(i,l,n,o,r,t,e,s),B(i,n,r,a,u)&&Ia(t),t.stateNode=i,e?Ia(t):ba(i,t,!1,!1))}},ka=function(e,t,n,r){n!==r?(e=hr(cr.current),n=hr(ur.current),t.stateNode=G(r,e,n,t),Ia(t)):t.stateNode=e.stateNode}}else xa=function(){},wa=function(){},ka=function(){};function Na(e,t){if(!Hn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function La(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Pa(e,t,n){var r=t.pendingProps;switch(Wn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return La(t),null;case 1:case 17:return pt(t.type)&&vt(),La(t),null;case 3:return r=t.stateNode,fr(),st(ht),st(ct),br(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Qn(t)?Ia(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Xn&&(Co(Xn),Xn=null))),xa(e,t),La(t),null;case 5:vr(t),n=hr(cr.current);var a=t.type;if(null!==e&&null!=t.stateNode)wa(e,t,a,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return La(t),null}if(e=hr(ur.current),Qn(t)){if(!Z)throw Error(o(175));e=Ge(t.stateNode,t.type,t.memoizedProps,n,e,t,!jn),t.updateQueue=e,null!==e&&Ia(t)}else{var i=z(a,r,n,e,t);ba(i,t,!1,!1),t.stateNode=i,B(i,a,r,n,e)&&Ia(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return La(t),null;case 6:if(e&&null!=t.stateNode)ka(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(e=hr(cr.current),n=hr(ur.current),Qn(t)){if(!Z)throw Error(o(176));if(e=t.stateNode,r=t.memoizedProps,(n=He(e,r,t,!jn))&&null!==(a=Vn))switch(i=0!==(1&a.mode),a.tag){case 3:Qe(a.stateNode.containerInfo,e,r,i);break;case 5:$e(a.type,a.memoizedProps,a.stateNode,e,r,i)}n&&Ia(t)}else t.stateNode=G(r,e,n,t)}return La(t),null;case 13:if(st(mr),r=t.memoizedState,Hn&&null!==Gn&&0!==(1&t.mode)&&0===(128&t.flags)){for(e=Gn;e;)e=Ue(e);return $n(),t.flags|=98560,t}if(null!==r&&null!==r.dehydrated){if(r=Qn(t),null===e){if(!r)throw Error(o(318));if(!Z)throw Error(o(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(o(317));je(e,t)}else $n(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return La(t),null}return null!==Xn&&(Co(Xn),Xn=null),0!==(128&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?Qn(t):n=null!==e.memoizedState,r&&!n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&mr.current)?0===$i&&($i=3):Fo())),null!==t.updateQueue&&(t.flags|=4),La(t),null);case 4:return fr(),xa(e,t),null===e&&Q(t.stateNode.containerInfo),La(t),null;case 10:return un(t.type._context),La(t),null;case 19:if(st(mr),null===(a=t.memoizedState))return La(t),null;if(r=0!==(128&t.flags),null===(i=a.rendering))if(r)Na(a,!1);else{if(0!==$i||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(i=gr(e))){for(t.flags|=128,Na(a,!1),null!==(e=i.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,r=t.child;null!==r;)a=e,(n=r).flags&=14680066,null===(i=n.alternate)?(n.childLanes=0,n.lanes=a,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=i.childLanes,n.lanes=i.lanes,n.child=i.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=i.memoizedProps,n.memoizedState=i.memoizedState,n.updateQueue=i.updateQueue,n.type=i.type,a=i.dependencies,n.dependencies=null===a?null:{lanes:a.lanes,firstContext:a.firstContext}),r=r.sibling;return ut(mr,1&mr.current|2),t.child}e=e.sibling}null!==a.tail&&zt()>so&&(t.flags|=128,r=!0,Na(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=gr(i))){if(t.flags|=128,r=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Na(a,!0),null===a.tail&&"hidden"===a.tailMode&&!i.alternate&&!Hn)return La(t),null}else 2*zt()-a.renderingStartTime>so&&1073741824!==n&&(t.flags|=128,r=!0,Na(a,!1),t.lanes=4194304);a.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=a.last)?e.sibling=i:t.child=i,a.last=i)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=zt(),t.sibling=null,e=mr.current,ut(mr,r?1&e|2:1&e),t):(La(t),null);case 22:case 23:return No(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ji)&&(La(t),K&&6&t.subtreeFlags&&(t.flags|=8192)):La(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}var Da=s.ReactCurrentOwner,Fa=!1;function Oa(e,t,n,r){t.child=null===e?or(t,null,n,r):ir(t,e.child,n,r)}function za(e,t,n,r,a){n=n.render;var i=t.ref;return cn(t,a),r=Nr(e,t,n,r,i,a),n=Lr(),null===e||Fa?(Hn&&n&&Bn(t),t.flags|=1,Oa(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ai(e,t,a))}function Ua(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||$o(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ts(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Ba(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:Qt)(o,r)&&e.ref===t.ref)return ai(e,t,a)}return t.flags|=1,(e=es(i,r)).ref=t.ref,e.return=t,t.child=e}function Ba(e,t,n,r,a){if(null!==e&&Qt(e.memoizedProps,r)&&e.ref===t.ref){if(Fa=!1,0===(e.lanes&a))return t.lanes=e.lanes,ai(e,t,a);0!==(131072&e.flags)&&(Fa=!0)}return Ga(e,t,n,r,a)}function Wa(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},ut(Qi,Ji),Ji|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,ut(Qi,Ji),Ji|=e,null;t.memoizedState={baseLanes:0,cachePool:null},r=null!==i?i.baseLanes:n,ut(Qi,Ji),Ji|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,ut(Qi,Ji),Ji|=r;return Oa(e,t,a,n),t.child}function Va(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ga(e,t,n,r,a){var i=pt(n)?dt:ct.current;return i=ft(t,i),cn(t,a),n=Nr(e,t,n,r,i,a),r=Lr(),null===e||Fa?(Hn&&r&&Bn(t),t.flags|=1,Oa(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ai(e,t,a))}function Ha(e,t,n,r,a){if(pt(n)){var i=!0;yt(t)}else i=!1;if(cn(t,a),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Tn(t,n,r),Cn(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=hn(l):l=ft(t,l=pt(n)?dt:ct.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==l)&&Mn(t,o,r,l),fn=!1;var d=t.memoizedState;o.state=d,xn(t,r,o,a),u=t.memoizedState,s!==r||d!==u||ht.current||fn?("function"===typeof c&&(Sn(t,n,c,r),u=t.memoizedState),(s=fn||En(t,n,s,r,d,u,l))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=l,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,vn(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:en(t.type,s),o.props=l,h=t.pendingProps,d=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=hn(u):u=ft(t,u=pt(n)?dt:ct.current);var f=n.getDerivedStateFromProps;(c="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==u)&&Mn(t,o,r,u),fn=!1,d=t.memoizedState,o.state=d,xn(t,r,o,a);var p=t.memoizedState;s!==h||d!==p||ht.current||fn?("function"===typeof f&&(Sn(t,n,f,r),p=t.memoizedState),(l=fn||En(t,n,l,r,d,p,u)||!1)?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=u,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return ja(e,t,n,r,i,a)}function ja(e,t,n,r,a,i){Va(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&bt(t,n,!1),ai(e,t,i);r=t.stateNode,Da.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=ir(t,e.child,null,i),t.child=ir(t,null,s,i)):Oa(e,t,s,i),t.memoizedState=r.state,a&&bt(t,n,!0),t.child}function Xa(e){var t=e.stateNode;t.pendingContext?mt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&mt(0,t.context,!1),dr(e,t.containerInfo)}function qa(e,t,n,r,a){return $n(),er(a),t.flags|=256,Oa(e,t,n,r),t.child}var Ka={dehydrated:null,treeContext:null,retryLane:0};function Ya(e){return{baseLanes:e,cachePool:null}}function Za(e,t,n){var r,a=t.pendingProps,i=mr.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&i)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),ut(mr,1&i),null===e)return Zn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:Oe(e)?t.lanes=8:t.lanes=1073741824,null):(i=a.children,e=a.fallback,s?(a=t.mode,s=t.child,i={mode:"hidden",children:i},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=i):s=rs(i,a,0,null),e=ns(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ya(n),t.memoizedState=Ka,e):Ja(t,i));if(null!==(i=e.memoizedState)){if(null!==(r=i.dehydrated)){if(u)return 256&t.flags?(t.flags&=-257,ei(e,t,n,Error(o(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=a.fallback,i=t.mode,a=rs({mode:"visible",children:a.children},i,0,null),(s=ns(s,i,n,null)).flags|=2,a.return=t,s.return=t,a.sibling=s,t.child=a,0!==(1&t.mode)&&ir(t,e.child,null,n),t.child.memoizedState=Ya(n),t.memoizedState=Ka,s);if(0===(1&t.mode))t=ei(e,t,n,null);else if(Oe(r))t=ei(e,t,n,Error(o(419)));else if(a=0!==(n&e.childLanes),Fa||a){if(null!==(a=Ki)){switch(n&-n){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(a=0!==(s&(a.suspendedLanes|n))?0:s)&&a!==i.retryLane&&(i.retryLane=a,So(e,a,-1))}Fo(),t=ei(e,t,n,Error(o(421)))}else Fe(r)?(t.flags|=128,t.child=e.child,t=Ko.bind(null,e),ze(r,t),t=null):(n=i.treeContext,Z&&(Gn=Ve(r),Vn=t,Hn=!0,Xn=null,jn=!1,null!==n&&(Ln[Pn++]=Fn,Ln[Pn++]=On,Ln[Pn++]=Dn,Fn=n.id,On=n.overflow,Dn=t)),(t=Ja(t,t.pendingProps.children)).flags|=4096);return t}return s?(a=$a(e,t,a.children,a.fallback,n),s=t.child,i=e.child.memoizedState,s.memoizedState=null===i?Ya(n):{baseLanes:i.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=Ka,a):(n=Qa(e,t,a.children,n),t.memoizedState=null,n)}return s?(a=$a(e,t,a.children,a.fallback,n),s=t.child,i=e.child.memoizedState,s.memoizedState=null===i?Ya(n):{baseLanes:i.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=Ka,a):(n=Qa(e,t,a.children,n),t.memoizedState=null,n)}function Ja(e,t){return(t=rs({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Qa(e,t,n,r){var a=e.child;return e=a.sibling,n=es(a,{mode:"visible",children:n}),0===(1&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n}function $a(e,t,n,r,a){var i=t.mode,o=(e=e.child).sibling,s={mode:"hidden",children:n};return 0===(1&i)&&t.child!==e?((n=t.child).childLanes=0,n.pendingProps=s,t.deletions=null):(n=es(e,s)).subtreeFlags=14680064&e.subtreeFlags,null!==o?r=es(o,r):(r=ns(r,i,a,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function ei(e,t,n,r){return null!==r&&er(r),ir(t,e.child,null,n),(e=Ja(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ti(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),ln(e.return,t,n)}function ni(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function ri(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Oa(e,t,r.children,n),0!==(2&(r=mr.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ti(e,n,t);else if(19===e.tag)ti(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ut(mr,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===gr(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),ni(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===gr(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}ni(t,!0,n,null,i);break;case"together":ni(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ai(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),to|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=es(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=es(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function ii(e,t){switch(Wn(t),t.tag){case 1:return pt(t.type)&&vt(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return fr(),st(ht),st(ct),br(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return vr(t),null;case 13:if(st(mr),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));$n()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return st(mr),null;case 4:return fr(),null;case 10:return un(t.type._context),null;case 22:case 23:return No(),null;default:return null}}var oi=!1,si=!1,ui="function"===typeof WeakSet?WeakSet:Set,li=null;function ci(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){jo(e,t,r)}else n.current=null}function hi(e,t,n){try{n()}catch(r){jo(e,t,r)}}var di=!1;function fi(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&hi(t,n,i)}a=a.next}while(a!==r)}}function pi(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function vi(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=L(n);else e=n;"function"===typeof t?t(e):t.current=e}}function mi(e,t,n){if(Ht&&"function"===typeof Ht.onCommitFiberUnmount)try{Ht.onCommitFiberUnmount(Gt,t)}catch(o){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var a=r,i=a.destroy;a=a.tag,void 0!==i&&(0!==(2&a)||0!==(4&a))&&hi(t,n,i),r=r.next}while(r!==e)}break;case 1:if(ci(t,n),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(o){jo(t,n,o)}break;case 5:ci(t,n);break;case 4:K?_i(e,t,n):Y&&Y&&(t=t.stateNode.containerInfo,n=Me(t),Ae(t,n))}}function gi(e,t,n){for(var r=t;;)if(mi(e,r,n),null===r.child||K&&4===r.tag){if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function yi(e){var t=e.alternate;null!==t&&(e.alternate=null,yi(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function bi(e){return 5===e.tag||3===e.tag||4===e.tag}function xi(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||bi(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function wi(e){if(K){e:{for(var t=e.return;null!==t;){if(bi(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(xe(t),n.flags&=-33),Si(e,n=xi(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,ki(e,n=xi(e),t);break;default:throw Error(o(161))}}}function ki(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ge(n,e,t):de(n,e);else if(4!==r&&null!==(e=e.child))for(ki(e,t,n),e=e.sibling;null!==e;)ki(e,t,n),e=e.sibling}function Si(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?me(n,e,t):he(n,e);else if(4!==r&&null!==(e=e.child))for(Si(e,t,n),e=e.sibling;null!==e;)Si(e,t,n),e=e.sibling}function _i(e,t,n){for(var r,a,i=t,s=!1;;){if(!s){s=i.return;e:for(;;){if(null===s)throw Error(o(160));switch(r=s.stateNode,s.tag){case 5:a=!1;break e;case 3:case 4:r=r.containerInfo,a=!0;break e}s=s.return}s=!0}if(5===i.tag||6===i.tag)gi(e,i,n),a?be(r,i.stateNode):ye(r,i.stateNode);else if(18===i.tag)a?Ze(r,i.stateNode):Ye(r,i.stateNode);else if(4===i.tag){if(null!==i.child){r=i.stateNode.containerInfo,a=!0,i.child.return=i,i=i.child;continue}}else if(mi(e,i,n),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(s=!1)}i.sibling.return=i.return,i=i.sibling}}function Ei(e,t){if(K){switch(t.tag){case 0:case 11:case 14:case 15:return fi(3,t,t.return),pi(3,t),void fi(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var a=t.type,i=t.updateQueue;t.updateQueue=null,null!==i&&ve(n,i,a,e,r,t)}return;case 6:if(null===t.stateNode)throw Error(o(162));return n=t.memoizedProps,void fe(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(Z&&null!==e&&e.memoizedState.isDehydrated&&qe(t.stateNode.containerInfo));case 13:case 19:return void Ti(t)}throw Error(o(163))}switch(t.tag){case 0:case 11:case 14:case 15:return fi(3,t,t.return),pi(3,t),void fi(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void Ti(t);case 3:Z&&null!==e&&e.memoizedState.isDehydrated&&qe(t.stateNode.containerInfo)}e:if(Y){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Ae(t.containerInfo,t.pendingChildren);break e}throw Error(o(163))}}function Ti(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ui),t.forEach((function(t){var r=Yo.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function Mi(e,t,n){li=e,Ci(e,t,n)}function Ci(e,t,n){for(var r=0!==(1&e.mode);null!==li;){var a=li,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||oi;if(!o){var s=a.alternate,u=null!==s&&null!==s.memoizedState||si;s=oi;var l=si;if(oi=o,(si=u)&&!l)for(li=a;null!==li;)u=(o=li).child,22===o.tag&&null!==o.memoizedState?Ri(a):null!==u?(u.return=o,li=u):Ri(a);for(;null!==i;)li=i,Ci(i,t,n),i=i.sibling;li=a,oi=s,si=l}Ii(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,li=i):Ii(e)}}function Ii(e){for(;null!==li;){var t=li;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:si||pi(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!si)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&wn(t,i,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=L(t.child.stateNode);break;case 1:n=t.child.stateNode}wn(t,s,n)}break;case 5:var u=t.stateNode;null===n&&4&t.flags&&pe(u,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(Z&&null===t.memoizedState){var l=t.alternate;if(null!==l){var c=l.memoizedState;if(null!==c){var h=c.dehydrated;null!==h&&Ke(h)}}}break;default:throw Error(o(163))}si||512&t.flags&&vi(t)}catch(d){jo(t,t.return,d)}}if(t===e){li=null;break}if(null!==(n=t.sibling)){n.return=t.return,li=n;break}li=t.return}}function Ai(e){for(;null!==li;){var t=li;if(t===e){li=null;break}var n=t.sibling;if(null!==n){n.return=t.return,li=n;break}li=t.return}}function Ri(e){for(;null!==li;){var t=li;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{pi(4,t)}catch(u){jo(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(u){jo(t,a,u)}}var i=t.return;try{vi(t)}catch(u){jo(t,i,u)}break;case 5:var o=t.return;try{vi(t)}catch(u){jo(t,o,u)}}}catch(u){jo(t,t.return,u)}if(t===e){li=null;break}var s=t.sibling;if(null!==s){s.return=t.return,li=s;break}li=t.return}}var Ni=0,Li=1,Pi=2,Di=3,Fi=4;if("function"===typeof Symbol&&Symbol.for){var Oi=Symbol.for;Ni=Oi("selector.component"),Li=Oi("selector.has_pseudo_class"),Pi=Oi("selector.role"),Di=Oi("selector.test_id"),Fi=Oi("selector.text")}function zi(e){var t=J(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(o(364));return t}if(null===(e=ae(e)))throw Error(o(362));return e.stateNode.current}function Ui(e,t){switch(t.$$typeof){case Ni:if(e.type===t.value)return!0;break;case Li:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var r=e[n++],a=e[n++],i=t[a];if(5!==r.tag||!se(r)){for(;null!=i&&Ui(r,i);)i=t[++a];if(a===t.length){t=!0;break e}for(r=r.child;null!==r;)e.push(r,a),r=r.sibling}}t=!1}return t;case Pi:if(5===e.tag&&ue(e.stateNode,t.value))return!0;break;case Fi:if((5===e.tag||6===e.tag)&&(null!==(e=oe(e))&&0<=e.indexOf(t.value)))return!0;break;case Di:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function Bi(e){switch(e.$$typeof){case Ni:return"<"+(S(e.value)||"Unknown")+">";case Li:return":has("+(Bi(e)||"")+")";case Pi:return'[role="'+e.value+'"]';case Fi:return'"'+e.value+'"';case Di:return'[data-testname="'+e.value+'"]';default:throw Error(o(365))}}function Wi(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var a=e[r++],i=e[r++],o=t[i];if(5!==a.tag||!se(a)){for(;null!=o&&Ui(a,o);)o=t[++i];if(i===t.length)n.push(a);else for(a=a.child;null!==a;)e.push(a,i),a=a.sibling}}return n}function Vi(e,t){if(!re)throw Error(o(363));e=Wi(e=zi(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var r=e[n++];if(5===r.tag)se(r)||t.push(r.stateNode);else for(r=r.child;null!==r;)e.push(r),r=r.sibling}return t}var Gi=Math.ceil,Hi=s.ReactCurrentDispatcher,ji=s.ReactCurrentOwner,Xi=s.ReactCurrentBatchConfig,qi=0,Ki=null,Yi=null,Zi=0,Ji=0,Qi=ot(0),$i=0,eo=null,to=0,no=0,ro=0,ao=null,io=null,oo=0,so=1/0;function uo(){so=zt()+500}var lo,co=!1,ho=null,fo=null,po=!1,vo=null,mo=0,go=0,yo=null,bo=-1,xo=0;function wo(){return 0!==(6&qi)?zt():-1!==bo?bo:bo=zt()}function ko(e){return 0===(1&e.mode)?1:0!==(2&qi)&&0!==Zi?Zi&-Zi:null!==Jt.transition?(0===xo&&(e=St,0===(4194240&(St<<=1))&&(St=64),xo=e),xo):0!==(e=Nt)?e:$()}function So(e,t,n){if(50<go)throw go=0,yo=null,Error(o(185));var r=_o(e,t);return null===r?null:(At(r,t,n),0!==(2&qi)&&r===Ki||(r===Ki&&(0===(2&qi)&&(no|=t),4===$i&&Io(r,Zi)),Eo(r,n),1===t&&0===qi&&0===(1&e.mode)&&(uo(),qt&&Zt())),r)}function _o(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Eo(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-xt(i),s=1<<o,u=a[o];-1===u?0!==(s&n)&&0===(s&r)||(a[o]=Mt(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=Tt(e,e===Ki?Zi:0);if(0===r)null!==n&&Dt(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Dt(n),1===t)0===e.tag?function(e){qt=!0,Yt(e)}(Ao.bind(null,e)):Yt(Ao.bind(null,e)),te?ne((function(){0===qi&&Zt()})):Pt(Ut,Zt),n=null;else{switch(Lt(r)){case 1:n=Ut;break;case 4:n=Bt;break;case 16:default:n=Wt;break;case 536870912:n=Vt}n=Zo(n,To.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function To(e,t){if(bo=-1,xo=0,0!==(6&qi))throw Error(o(327));var n=e.callbackNode;if(Go()&&e.callbackNode!==n)return null;var r=Tt(e,e===Ki?Zi:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=Oo(e,r);else{t=r;var a=qi;qi|=2;var i=Do();for(Ki===e&&Zi===t||(uo(),Lo(e,t));;)try{Uo();break}catch(u){Po(e,u)}on(),Hi.current=i,qi=a,null!==Yi?t=0:(Ki=null,Zi=0,t=$i)}if(0!==t){if(2===t&&(0!==(a=Ct(e))&&(r=a,t=Mo(e,a))),1===t)throw n=eo,Lo(e,0),Io(e,r),Eo(e,zt()),n;if(6===t)Io(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!jt(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=Oo(e,r))&&(0!==(i=Ct(e))&&(r=i,t=Mo(e,i))),1===t))throw n=eo,Lo(e,0),Io(e,r),Eo(e,zt()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:Vo(e,io);break;case 3:if(Io(e,r),(130023424&r)===r&&10<(t=oo+500-zt())){if(0!==Tt(e,0))break;if(((a=e.suspendedLanes)&r)!==r){wo(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=H(Vo.bind(null,e,io),t);break}Vo(e,io);break;case 4:if(Io(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-xt(r);i=1<<s,(s=t[s])>a&&(a=s),r&=~i}if(r=a,10<(r=(120>(r=zt()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Gi(r/1960))-r)){e.timeoutHandle=H(Vo.bind(null,e,io),r);break}Vo(e,io);break;default:throw Error(o(329))}}}return Eo(e,zt()),e.callbackNode===n?To.bind(null,e):null}function Mo(e,t){var n=ao;return e.current.memoizedState.isDehydrated&&(Lo(e,t).flags|=256),2!==(e=Oo(e,t))&&(t=io,io=n,null!==t&&Co(t)),e}function Co(e){null===io?io=e:io.push.apply(io,e)}function Io(e,t){for(t&=~ro,t&=~no,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-xt(t),r=1<<n;e[n]=-1,t&=~r}}function Ao(e){if(0!==(6&qi))throw Error(o(327));Go();var t=Tt(e,0);if(0===(1&t))return Eo(e,zt()),null;var n=Oo(e,t);if(0!==e.tag&&2===n){var r=Ct(e);0!==r&&(t=r,n=Mo(e,r))}if(1===n)throw n=eo,Lo(e,0),Io(e,t),Eo(e,zt()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Vo(e,io),Eo(e,zt()),null}function Ro(e){null!==vo&&0===vo.tag&&0===(6&qi)&&Go();var t=qi;qi|=1;var n=Xi.transition,r=Nt;try{if(Xi.transition=null,Nt=1,e)return e()}finally{Nt=r,Xi.transition=n,0===(6&(qi=t))&&Zt()}}function No(){Ji=Qi.current,st(Qi)}function Lo(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==X&&(e.timeoutHandle=X,j(n)),null!==Yi)for(n=Yi.return;null!==n;){var r=n;switch(Wn(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&vt();break;case 3:fr(),st(ht),st(ct),br();break;case 5:vr(r);break;case 4:fr();break;case 13:case 19:st(mr);break;case 10:un(r.type._context);break;case 22:case 23:No()}n=n.return}if(Ki=e,Yi=e=es(e.current,null),Zi=Ji=t,$i=0,eo=null,ro=no=to=0,io=ao=null,null!==dn){for(t=0;t<dn.length;t++)if(null!==(r=(n=dn[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}dn=null}return e}function Po(e,t){for(;;){var n=Yi;try{if(on(),xr.current=fa,Tr){for(var r=Sr.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}Tr=!1}if(kr=0,Er=_r=Sr=null,Mr=!1,Cr=0,ji.current=null,null===n||null===n.return){$i=1,eo=t,Yi=null;break}e:{var i=e,s=n.return,u=n,l=t;if(t=Zi,u.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l,h=u,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=Ma(s);if(null!==p){p.flags&=-257,Ca(p,s,u,0,t),1&p.mode&&Ta(i,c,t),l=c;var v=(t=p).updateQueue;if(null===v){var m=new Set;m.add(l),t.updateQueue=m}else v.add(l);break e}if(0===(1&t)){Ta(i,c,t),Fo();break e}l=Error(o(426))}else if(Hn&&1&u.mode){var g=Ma(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),Ca(g,s,u,0,t),er(l);break e}}i=l,4!==$i&&($i=2),null===ao?ao=[i]:ao.push(i),l=ga(l,u),u=s;do{switch(u.tag){case 3:u.flags|=65536,t&=-t,u.lanes|=t,bn(u,_a(0,l,t));break e;case 1:i=l;var y=u.type,b=u.stateNode;if(0===(128&u.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===fo||!fo.has(b)))){u.flags|=65536,t&=-t,u.lanes|=t,bn(u,Ea(u,i,t));break e}}u=u.return}while(null!==u)}Wo(n)}catch(x){t=x,Yi===n&&null!==n&&(Yi=n=n.return);continue}break}}function Do(){var e=Hi.current;return Hi.current=fa,null===e?fa:e}function Fo(){0!==$i&&3!==$i&&2!==$i||($i=4),null===Ki||0===(268435455&to)&&0===(268435455&no)||Io(Ki,Zi)}function Oo(e,t){var n=qi;qi|=2;var r=Do();for(Ki===e&&Zi===t||Lo(e,t);;)try{zo();break}catch(a){Po(e,a)}if(on(),qi=n,Hi.current=r,null!==Yi)throw Error(o(261));return Ki=null,Zi=0,$i}function zo(){for(;null!==Yi;)Bo(Yi)}function Uo(){for(;null!==Yi&&!Ft();)Bo(Yi)}function Bo(e){var t=lo(e.alternate,e,Ji);e.memoizedProps=e.pendingProps,null===t?Wo(e):Yi=t,ji.current=null}function Wo(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Pa(n,t,Ji)))return void(Yi=n)}else{if(null!==(n=ii(n,t)))return n.flags&=32767,void(Yi=n);if(null===e)return $i=6,void(Yi=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Yi=t);Yi=t=e}while(null!==t);0===$i&&($i=5)}function Vo(e,t){var n=Nt,r=Xi.transition;try{Xi.transition=null,Nt=1,function(e,t,n){do{Go()}while(null!==vo);if(0!==(6&qi))throw Error(o(327));var r=e.finishedWork,a=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-xt(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,i),e===Ki&&(Yi=Ki=null,Zi=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||po||(po=!0,Zo(Wt,(function(){return Go(),null}))),i=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||i){i=Xi.transition,Xi.transition=null;var s=Nt;Nt=1;var u=qi;qi|=4,ji.current=null,function(e,t){for(F(e.containerInfo),li=t;null!==li;)if(t=(e=li).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,li=t;else for(;null!==li;){e=li;try{var n=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var r=n.memoizedProps,a=n.memoizedState,i=e.stateNode,s=i.getSnapshotBeforeUpdate(e.elementType===e.type?r:en(e.type,r),a);i.__reactInternalSnapshotBeforeUpdate=s}break;case 3:K&&Ee(e.stateNode.containerInfo);break;default:throw Error(o(163))}}catch(u){jo(e,e.return,u)}if(null!==(t=e.sibling)){t.return=e.return,li=t;break}li=e.return}n=di,di=!1}(e,r),function(e,t){for(li=t;null!==li;){var n=(t=li).deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var i=e;K?_i(i,a,t):gi(i,a,t);var o=a.alternate;null!==o&&(o.return=null),a.return=null}catch(w){jo(a,t,w)}}if(n=t.child,0!==(12854&t.subtreeFlags)&&null!==n)n.return=t,li=n;else for(;null!==li;){t=li;try{var s=t.flags;if(32&s&&K&&xe(t.stateNode),512&s){var u=t.alternate;if(null!==u){var l=u.ref;null!==l&&("function"===typeof l?l(null):l.current=null)}}if(8192&s)switch(t.tag){case 13:if(null!==t.memoizedState){var c=t.alternate;null!==c&&null!==c.memoizedState||(oo=zt())}break;case 22:var h=null!==t.memoizedState,d=t.alternate,f=null!==d&&null!==d.memoizedState;if(n=t,K)e:if(r=n,a=h,i=null,K)for(var p=r;;){if(5===p.tag){if(null===i){i=p;var v=p.stateNode;a?we(v):Se(p.stateNode,p.memoizedProps)}}else if(6===p.tag){if(null===i){var m=p.stateNode;a?ke(m):_e(m,p.memoizedProps)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===r)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===r)break;for(;null===p.sibling;){if(null===p.return||p.return===r)break e;i===p&&(i=null),p=p.return}i===p&&(i=null),p.sibling.return=p.return,p=p.sibling}if(h&&!f&&0!==(1&n.mode)){li=n;for(var g=n.child;null!==g;){for(n=li=g;null!==li;){var y=(r=li).child;switch(r.tag){case 0:case 11:case 14:case 15:fi(4,r,r.return);break;case 1:ci(r,r.return);var b=r.stateNode;if("function"===typeof b.componentWillUnmount){var x=r.return;try{b.props=r.memoizedProps,b.state=r.memoizedState,b.componentWillUnmount()}catch(w){jo(r,x,w)}}break;case 5:ci(r,r.return);break;case 22:if(null!==r.memoizedState){Ai(n);continue}}null!==y?(y.return=r,li=y):Ai(n)}g=g.sibling}}}switch(4102&s){case 2:wi(t),t.flags&=-3;break;case 6:wi(t),t.flags&=-3,Ei(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,Ei(t.alternate,t);break;case 4:Ei(t.alternate,t)}}catch(w){jo(t,t.return,w)}if(null!==(n=t.sibling)){n.return=t.return,li=n;break}li=t.return}}}(e,r),O(e.containerInfo),e.current=r,Mi(r,e,a),Ot(),qi=u,Nt=s,Xi.transition=i}else e.current=r;if(po&&(po=!1,vo=e,mo=a),i=e.pendingLanes,0===i&&(fo=null),function(e){if(Ht&&"function"===typeof Ht.onCommitFiberRoot)try{Ht.onCommitFiberRoot(Gt,e,void 0,128===(128&e.current.flags))}catch(t){}}(r.stateNode),Eo(e,zt()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)n(t[r]);if(co)throw co=!1,e=ho,ho=null,e;0!==(1&mo)&&0!==e.tag&&Go(),i=e.pendingLanes,0!==(1&i)?e===yo?go++:(go=0,yo=e):go=0,Zt()}(e,t,n)}finally{Xi.transition=r,Nt=n}return null}function Go(){if(null!==vo){var e=Lt(mo),t=Xi.transition,n=Nt;try{if(Xi.transition=null,Nt=16>e?16:e,null===vo)var r=!1;else{if(e=vo,vo=null,mo=0,0!==(6&qi))throw Error(o(331));var a=qi;for(qi|=4,li=e.current;null!==li;){var i=li,s=i.child;if(0!==(16&li.flags)){var u=i.deletions;if(null!==u){for(var l=0;l<u.length;l++){var c=u[l];for(li=c;null!==li;){var h=li;switch(h.tag){case 0:case 11:case 15:fi(8,h,i)}var d=h.child;if(null!==d)d.return=h,li=d;else for(;null!==li;){var f=(h=li).sibling,p=h.return;if(yi(h),h===c){li=null;break}if(null!==f){f.return=p,li=f;break}li=p}}}var v=i.alternate;if(null!==v){var m=v.child;if(null!==m){v.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}li=i}}if(0!==(2064&i.subtreeFlags)&&null!==s)s.return=i,li=s;else e:for(;null!==li;){if(0!==(2048&(i=li).flags))switch(i.tag){case 0:case 11:case 15:fi(9,i,i.return)}var y=i.sibling;if(null!==y){y.return=i.return,li=y;break e}li=i.return}}var b=e.current;for(li=b;null!==li;){var x=(s=li).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,li=x;else e:for(s=b;null!==li;){if(0!==(2048&(u=li).flags))try{switch(u.tag){case 0:case 11:case 15:pi(9,u)}}catch(k){jo(u,u.return,k)}if(u===s){li=null;break e}var w=u.sibling;if(null!==w){w.return=u.return,li=w;break e}li=u.return}}if(qi=a,Zt(),Ht&&"function"===typeof Ht.onPostCommitFiberRoot)try{Ht.onPostCommitFiberRoot(Gt,e)}catch(k){}r=!0}return r}finally{Nt=n,Xi.transition=t}}return!1}function Ho(e,t,n){gn(e,t=_a(0,t=ga(n,t),1)),t=wo(),null!==(e=_o(e,1))&&(At(e,1,t),Eo(e,t))}function jo(e,t,n){if(3===e.tag)Ho(e,e,n);else for(;null!==t;){if(3===t.tag){Ho(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===fo||!fo.has(r))){gn(t,e=Ea(t,e=ga(n,e),1)),e=wo(),null!==(t=_o(t,1))&&(At(t,1,e),Eo(t,e));break}}t=t.return}}function Xo(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=wo(),e.pingedLanes|=e.suspendedLanes&n,Ki===e&&(Zi&n)===n&&(4===$i||3===$i&&(130023424&Zi)===Zi&&500>zt()-oo?Lo(e,0):ro|=n),Eo(e,t)}function qo(e,t){0===t&&(0===(1&e.mode)?t=1:(t=_t,0===(130023424&(_t<<=1))&&(_t=4194304)));var n=wo();null!==(e=_o(e,t))&&(At(e,t,n),Eo(e,n))}function Ko(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),qo(e,n)}function Yo(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),qo(e,n)}function Zo(e,t){return Pt(e,t)}function Jo(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qo(e,t,n,r){return new Jo(e,t,n,r)}function $o(e){return!(!(e=e.prototype)||!e.isReactComponent)}function es(e,t){var n=e.alternate;return null===n?((n=Qo(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ts(e,t,n,r,a,i){var s=2;if(r=e,"function"===typeof e)$o(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case c:return ns(n.children,a,i,t);case h:s=8,a|=8;break;case d:return(e=Qo(12,n,t,2|a)).elementType=d,e.lanes=i,e;case m:return(e=Qo(13,n,t,a)).elementType=m,e.lanes=i,e;case g:return(e=Qo(19,n,t,a)).elementType=g,e.lanes=i,e;case x:return rs(n,a,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case f:s=10;break e;case p:s=9;break e;case v:s=11;break e;case y:s=14;break e;case b:s=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Qo(s,n,t,a)).elementType=e,t.type=r,t.lanes=i,t}function ns(e,t,n,r){return(e=Qo(7,e,r,t)).lanes=n,e}function rs(e,t,n,r){return(e=Qo(22,e,r,t)).elementType=x,e.lanes=n,e.stateNode={},e}function as(e,t,n){return(e=Qo(6,e,null,t)).lanes=n,e}function is(e,t,n){return(t=Qo(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function os(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=X,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=It(0),this.expirationTimes=It(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=It(0),this.identifierPrefix=r,this.onRecoverableError=a,Z&&(this.mutableSourceEagerHydrationData=null)}function ss(e,t,n,r,a,i,o,s,u){return e=new os(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Qo(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null},pn(i),e}function us(e){if(!e)return lt;e:{if(E(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(pt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(pt(n))return gt(e,n,t)}return t}function ls(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return null===(e=C(t))?null:e.stateNode}function cs(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function hs(e,t){cs(e,t),(e=e.alternate)&&cs(e,t)}function ds(e){return null===(e=C(e))?null:e.stateNode}function fs(){return null}return lo=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ht.current)Fa=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Fa=!1,function(e,t,n){switch(t.tag){case 3:Xa(t),$n();break;case 5:pr(t);break;case 1:pt(t.type)&&yt(t);break;case 4:dr(t,t.stateNode.containerInfo);break;case 10:sn(0,t.type._context,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(ut(mr,1&mr.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Za(e,t,n):(ut(mr,1&mr.current),null!==(e=ai(e,t,n))?e.sibling:null);ut(mr,1&mr.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return ri(e,t,n);t.flags|=128}var a=t.memoizedState;if(null!==a&&(a.rendering=null,a.tail=null,a.lastEffect=null),ut(mr,mr.current),r)break;return null;case 22:case 23:return t.lanes=0,Wa(e,t,n)}return ai(e,t,n)}(e,t,n);Fa=0!==(131072&e.flags)}else Fa=!1,Hn&&0!==(1048576&t.flags)&&Un(t,Nn,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var a=ft(t,ct.current);cn(t,n),a=Nr(null,t,r,e,a,n);var i=Lr();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,pt(r)?(i=!0,yt(t)):i=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,pn(t),a.updater=_n,t.stateNode=a,a._reactInternals=t,Cn(t,r,e,n),t=ja(null,t,r,!0,i,n)):(t.tag=0,Hn&&i&&Bn(t),Oa(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return $o(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===v)return 11;if(e===y)return 14}return 2}(r),e=en(r,e),a){case 0:t=Ga(null,t,r,e,n);break e;case 1:t=Ha(null,t,r,e,n);break e;case 11:t=za(null,t,r,e,n);break e;case 14:t=Ua(null,t,r,en(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Ga(e,t,r,a=t.elementType===r?a:en(r,a),n);case 1:return r=t.type,a=t.pendingProps,Ha(e,t,r,a=t.elementType===r?a:en(r,a),n);case 3:e:{if(Xa(t),null===e)throw Error(o(387));r=t.pendingProps,a=(i=t.memoizedState).element,vn(e,t),xn(t,r,null,n);var s=t.memoizedState;if(r=s.element,Z&&i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:s.cache,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=qa(e,t,r,n,a=Error(o(423)));break e}if(r!==a){t=qa(e,t,r,n,a=Error(o(424)));break e}for(Z&&(Gn=We(t.stateNode.containerInfo),Vn=t,Hn=!0,Xn=null,jn=!1),n=or(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if($n(),r===a){t=ai(e,t,n);break e}Oa(e,t,r,n)}t=t.child}return t;case 5:return pr(t),null===e&&Zn(t),r=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,s=a.children,V(r,a)?s=null:null!==i&&V(r,i)&&(t.flags|=32),Va(e,t),Oa(e,t,s,n),t.child;case 6:return null===e&&Zn(t),null;case 13:return Za(e,t,n);case 4:return dr(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ir(t,null,r,n):Oa(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,za(e,t,r,a=t.elementType===r?a:en(r,a),n);case 7:return Oa(e,t,t.pendingProps,n),t.child;case 8:case 12:return Oa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,sn(0,r,s=a.value),null!==i)if(jt(i.value,s)){if(i.children===a.children&&!ht.current){t=ai(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var u=i.dependencies;if(null!==u){s=i.child;for(var l=u.firstContext;null!==l;){if(l.context===r){if(1===i.tag){(l=mn(-1,n&-n)).tag=2;var c=i.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}i.lanes|=n,null!==(l=i.alternate)&&(l.lanes|=n),ln(i.return,n,t),u.lanes|=n;break}l=l.next}}else if(10===i.tag)s=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(s=i.return))throw Error(o(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),ln(s,n,t),s=i.sibling}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===t){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}Oa(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,cn(t,n),r=r(a=hn(a)),t.flags|=1,Oa(e,t,r,n),t.child;case 14:return a=en(r=t.type,t.pendingProps),Ua(e,t,r,a=en(r.type,a),n);case 15:return Ba(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:en(r,a),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pt(r)?(e=!0,yt(t)):e=!1,cn(t,n),Tn(t,r,a),Cn(t,r,a,n),ja(null,t,r,!0,e,n);case 19:return ri(e,t,n);case 22:return Wa(e,t,n)}throw Error(o(156,t.tag))},t.attemptContinuousHydration=function(e){13===e.tag&&(So(e,134217728,wo()),hs(e,134217728))},t.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=wo(),n=ko(e);So(e,n,t),hs(e,n)}},t.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Et(t.pendingLanes);0!==n&&(Rt(t,1|n),Eo(t,zt()),0===(6&qi)&&(uo(),Zt()))}break;case 13:var r=wo();Ro((function(){return So(e,1,r)})),hs(e,1)}},t.batchedUpdates=function(e,t){var n=qi;qi|=1;try{return e(t)}finally{0===(qi=n)&&(uo(),qt&&Zt())}},t.createComponentSelector=function(e){return{$$typeof:Ni,value:e}},t.createContainer=function(e,t,n,r,a,i,o){return ss(e,t,!1,null,0,r,0,i,o)},t.createHasPseudoClassSelector=function(e){return{$$typeof:Li,value:e}},t.createHydrationContainer=function(e,t,n,r,a,i,o,s,u){return(e=ss(n,r,!0,e,0,i,0,s,u)).context=us(null),n=e.current,(i=mn(r=wo(),a=ko(n))).callback=void 0!==t&&null!==t?t:null,gn(n,i),e.current.lanes=a,At(e,a,r),Eo(e,r),e},t.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:l,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},t.createRoleSelector=function(e){return{$$typeof:Pi,value:e}},t.createTestNameSelector=function(e){return{$$typeof:Di,value:e}},t.createTextSelector=function(e){return{$$typeof:Fi,value:e}},t.deferredUpdates=function(e){var t=Nt,n=Xi.transition;try{return Xi.transition=null,Nt=16,e()}finally{Nt=t,Xi.transition=n}},t.discreteUpdates=function(e,t,n,r,a){var i=Nt,o=Xi.transition;try{return Xi.transition=null,Nt=1,e(t,n,r,a)}finally{Nt=i,Xi.transition=o,0===qi&&uo()}},t.findAllNodes=Vi,t.findBoundingRects=function(e,t){if(!re)throw Error(o(363));t=Vi(e,t),e=[];for(var n=0;n<t.length;n++)e.push(ie(t[n]));for(t=e.length-1;0<t;t--)for(var r=(n=e[t]).x,a=r+n.width,i=n.y,s=i+n.height,u=t-1;0<=u;u--)if(t!==u){var l=e[u],c=l.x,h=c+l.width,d=l.y,f=d+l.height;if(r>=c&&i>=d&&a<=h&&s<=f){e.splice(t,1);break}if(!(r!==c||n.width!==l.width||f<i||d>s)){d>i&&(l.height+=d-i,l.y=i),f<s&&(l.height=s-d),e.splice(t,1);break}if(!(i!==d||n.height!==l.height||h<r||c>a)){c>r&&(l.width+=c-r,l.x=r),h<a&&(l.width=a-c),e.splice(t,1);break}}return e},t.findHostInstance=ls,t.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=M(e))?A(e):null)?null:e.stateNode},t.findHostInstanceWithWarning=function(e){return ls(e)},t.flushControlled=function(e){var t=qi;qi|=1;var n=Xi.transition,r=Nt;try{Xi.transition=null,Nt=1,e()}finally{Nt=r,Xi.transition=n,0===(qi=t)&&(uo(),Zt())}},t.flushPassiveEffects=Go,t.flushSync=Ro,t.focusWithin=function(e,t){if(!re)throw Error(o(363));for(t=Wi(e=zi(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!se(n)){if(5===n.tag&&le(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Nt},t.getFindAllNodesFailureDescription=function(e,t){if(!re)throw Error(o(363));var n=0,r=[];e=[zi(e),0];for(var a=0;a<e.length;){var i=e[a++],s=e[a++],u=t[s];if((5!==i.tag||!se(i))&&(Ui(i,u)&&(r.push(Bi(u)),++s>n&&(n=s)),s<t.length))for(i=i.child;null!==i;)e.push(i,s),i=i.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(Bi(t[n]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},t.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?L(e.child.stateNode):e.child.stateNode:null},t.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:ds,findFiberByHostInstance:e.findFiberByHostInstance||fs,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Gt=t.inject(e),Ht=t}catch(n){}e=!!t.checkDCE}}return e},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(e,t,n,r){if(!re)throw Error(o(363));e=Vi(e,t);var a=ce(e,n,r).disconnect;return{disconnect:function(){a()}}},t.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},t.runWithPriority=function(e,t){var n=Nt;try{return Nt=e,t()}finally{Nt=n}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(e,t,n,r){var a=t.current,i=wo(),o=ko(a);return n=us(n),null===t.context?t.context=n:t.pendingContext=n,(t=mn(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),gn(a,t),null!==(e=So(a,o,i))&&yn(e,a,o),o},t}},585:function(e,t,n){"use strict";e.exports=n(976)},258:function(e,t,n){"use strict";e.exports=n(721)},783:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],l=s+1,c=e[l];if(0>i(u,n))l<a&&0>i(c,u)?(e[r]=c,e[l]=n,r=l):(e[r]=u,e[s]=n,r=s);else{if(!(l<a&&0>i(c,n)))break e;e[r]=c,e[l]=n,r=l}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],h=1,d=null,f=3,p=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(c);null!==t;){if(null===t.callback)a(c);else{if(!(t.startTime<=e))break;a(c),t.sortIndex=t.expirationTime,n(l,t)}t=r(c)}}function w(e){if(m=!1,x(e),!v)if(null!==r(l))v=!0,L(k);else{var t=r(c);null!==t&&P(w,t.startTime-e)}}function k(e,n){v=!1,m&&(m=!1,y(T),T=-1),p=!0;var i=f;try{for(x(n),d=r(l);null!==d&&(!(d.expirationTime>n)||e&&!I());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(l)&&a(l),x(n)}else a(l);d=r(l)}if(null!==d)var u=!0;else{var h=r(c);null!==h&&P(w,h.startTime-n),u=!1}return u}finally{d=null,f=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,_=!1,E=null,T=-1,M=5,C=-1;function I(){return!(t.unstable_now()-C<M)}function A(){if(null!==E){var e=t.unstable_now();C=e;var n=!0;try{n=E(!0,e)}finally{n?S():(_=!1,E=null)}}else _=!1}if("function"===typeof b)S=function(){b(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,N=R.port2;R.port1.onmessage=A,S=function(){N.postMessage(null)}}else S=function(){g(A,0)};function L(e){E=e,_||(_=!0,S())}function P(e,n){T=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,L(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(c,e),null===r(l)&&e===r(c)&&(m?(y(T),T=-1):m=!0,P(w,i-o))):(e.sortIndex=s,n(l,e),v||p||(v=!0,L(k))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},100:function(e,t,n){"use strict";e.exports=n(783)},374:function(e,t,n){"use strict";var r=n(791),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,i={},l=null,c=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:l,ref:c,props:i,_owner:s.current}}t.jsx=l,t.jsxs=l},117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=b.prototype=new y;x.constructor=b,v(x,g.prototype),x.isPureReactComponent=!0;var w=Array.isArray,k=Object.prototype.hasOwnProperty,S={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)k.call(t,a)&&!_.hasOwnProperty(a)&&(i[a]=t[a]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];i.children=l}if(e&&e.defaultProps)for(a in u=e.defaultProps)void 0===i[a]&&(i[a]=u[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:S.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var M=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return o=o(u=e),e=""===i?"."+C(u,0):i,w(o)?(a="",null!=e&&(a=e.replace(M,"$&/")+"/"),I(o,t,a,"",(function(e){return e}))):null!=o&&(T(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(M,"$&/")+"/")+e)),t.push(o)),1;if(u=0,i=""===i?".":i+":",w(e))for(var l=0;l<e.length;l++){var c=i+C(s=e[l],l);u+=I(s,t,a,c,o)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),l=0;!(s=e.next()).done;)u+=I(s=s.value,t,a,c=i+C(s,l++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function A(e,t,n){if(null==e)return e;var r=[],a=0;return I(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N={current:null},L={transition:null},P={ReactCurrentDispatcher:N,ReactCurrentBatchConfig:L,ReactCurrentOwner:S};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=a,t.Profiler=o,t.PureComponent=b,t.StrictMode=i,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=v({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)k.call(t,l)&&!_.hasOwnProperty(l)&&(a[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){u=Array(l);for(var c=0;c<l;c++)u[c]=arguments[c+2];a.children=u}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return N.current.useCallback(e,t)},t.useContext=function(e){return N.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return N.current.useDeferredValue(e)},t.useEffect=function(e,t){return N.current.useEffect(e,t)},t.useId=function(){return N.current.useId()},t.useImperativeHandle=function(e,t,n){return N.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return N.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return N.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return N.current.useMemo(e,t)},t.useReducer=function(e,t,n){return N.current.useReducer(e,t,n)},t.useRef=function(e){return N.current.useRef(e)},t.useState=function(e){return N.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return N.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return N.current.useTransition()},t.version="18.2.0"},791:function(e,t,n){"use strict";e.exports=n(117)},184:function(e,t,n){"use strict";e.exports=n(374)},813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],l=s+1,c=e[l];if(0>i(u,n))l<a&&0>i(c,u)?(e[r]=c,e[l]=n,r=l):(e[r]=u,e[s]=n,r=s);else{if(!(l<a&&0>i(c,n)))break e;e[r]=c,e[l]=n,r=l}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],h=1,d=null,f=3,p=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(c);null!==t;){if(null===t.callback)a(c);else{if(!(t.startTime<=e))break;a(c),t.sortIndex=t.expirationTime,n(l,t)}t=r(c)}}function w(e){if(m=!1,x(e),!v)if(null!==r(l))v=!0,L(k);else{var t=r(c);null!==t&&P(w,t.startTime-e)}}function k(e,n){v=!1,m&&(m=!1,y(T),T=-1),p=!0;var i=f;try{for(x(n),d=r(l);null!==d&&(!(d.expirationTime>n)||e&&!I());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(l)&&a(l),x(n)}else a(l);d=r(l)}if(null!==d)var u=!0;else{var h=r(c);null!==h&&P(w,h.startTime-n),u=!1}return u}finally{d=null,f=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,_=!1,E=null,T=-1,M=5,C=-1;function I(){return!(t.unstable_now()-C<M)}function A(){if(null!==E){var e=t.unstable_now();C=e;var n=!0;try{n=E(!0,e)}finally{n?S():(_=!1,E=null)}}else _=!1}if("function"===typeof b)S=function(){b(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,N=R.port2;R.port1.onmessage=A,S=function(){N.postMessage(null)}}else S=function(){g(A,0)};function L(e){E=e,_||(_=!0,S())}function P(e,n){T=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,L(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(c,e),null===r(l)&&e===r(c)&&(m?(y(T),T=-1):m=!0,P(w,i-o))):(e.sortIndex=s,n(l,e),v||p||(v=!0,L(k))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},296:function(e,t,n){"use strict";e.exports=n(813)},699:function(e,t,n){var r=n(501),a=n(112),i=n(132),o=n(890),s=n(113),u=n(725),l=n(411);l.alea=r,l.xor128=a,l.xorwow=i,l.xorshift7=o,l.xor4096=s,l.tychei=u,e.exports=l},501:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},725:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},112:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},113:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},890:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},132:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},411:function(e,t,n){var r;!function(a,i,o){var s,u=256,l=o.pow(u,6),c=o.pow(2,52),h=2*c,d=u-1;function f(e,t,n){var r=[],d=g(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(u):(e=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,y(i)]}}():e,3),r),f=new p(r),b=function(){for(var e=f.g(6),t=l,n=0;e<c;)e=(e+n)*u,t*=u,n=f.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|f.g(4)},b.quick=function(){return f.g(4)/4294967296},b.double=b,g(y(f.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&v(r,f),e.state=function(){return v(f,{})}),n?(o.random=e,t):e})(b,d,"global"in t?t.global:this==o,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<u;)o[a]=a++;for(a=0;a<u;a++)o[a]=o[i=d&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=d&a+1],n=n*u+o[d&(o[a]=o[i=d&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(u)}function v(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(m(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[d&a]=d&(n^=19*t[d&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(o.random(),i),e.exports){e.exports=f;try{s=n(42)}catch(b){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},410:function(){},628:function(){},601:function(){},792:function(){},977:function(){},42:function(){}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.p="/visualize-cnn/",function(){"use strict";var e={};n.r(e),n.d(e,{ACESFilmicToneMapping:function(){return Pe},AddEquation:function(){return re},AddOperation:function(){return Ie},AdditiveAnimationBlendMode:function(){return cn},AdditiveBlending:function(){return $},AlphaFormat:function(){return dt},AlwaysDepth:function(){return xe},AlwaysStencilFunc:function(){return Un},AmbientLight:function(){return Xd},AmbientLightProbe:function(){return lf},AnimationAction:function(){return zf},AnimationClip:function(){return vd},AnimationLoader:function(){return Ed},AnimationMixer:function(){return Bf},AnimationObjectGroup:function(){return Of},AnimationUtils:function(){return nd},ArcCurve:function(){return bc},ArrayCamera:function(){return Xu},ArrowHelper:function(){return Rp},Audio:function(){return wf},AudioAnalyser:function(){return Mf},AudioContext:function(){return of},AudioListener:function(){return xf},AudioLoader:function(){return sf},AxesHelper:function(){return Np},BackSide:function(){return K},BasicDepthPacking:function(){return mn},BasicShadowMap:function(){return G},Bone:function(){return Pl},BooleanKeyframeTrack:function(){return ud},Box2:function(){return Qf},Box3:function(){return Xr},Box3Helper:function(){return Cp},BoxBufferGeometry:function(){return Pp},BoxGeometry:function(){return ro},BoxHelper:function(){return Mp},BufferAttribute:function(){return bi},BufferGeometry:function(){return Oi},BufferGeometryLoader:function(){return $d},ByteType:function(){return nt},Cache:function(){return yd},Camera:function(){return lo},CameraHelper:function(){return kp},CanvasTexture:function(){return mc},CapsuleBufferGeometry:function(){return Dp},CapsuleGeometry:function(){return Bc},CatmullRomCurve3:function(){return Ec},CineonToneMapping:function(){return Le},CircleBufferGeometry:function(){return Fp},CircleGeometry:function(){return Wc},ClampToEdgeWrapping:function(){return Ge},Clock:function(){return pf},Color:function(){return li},ColorKeyframeTrack:function(){return ld},ColorManagement:function(){return Ir},CompressedArrayTexture:function(){return vc},CompressedTexture:function(){return pc},CompressedTextureLoader:function(){return Td},ConeBufferGeometry:function(){return Op},ConeGeometry:function(){return Gc},CubeCamera:function(){return fo},CubeReflectionMapping:function(){return Oe},CubeRefractionMapping:function(){return ze},CubeTexture:function(){return po},CubeTextureLoader:function(){return Cd},CubeUVReflectionMapping:function(){return We},CubicBezierCurve:function(){return Ic},CubicBezierCurve3:function(){return Ac},CubicInterpolant:function(){return ad},CullFaceBack:function(){return B},CullFaceFront:function(){return W},CullFaceFrontBack:function(){return V},CullFaceNone:function(){return U},Curve:function(){return gc},CurvePath:function(){return Oc},CustomBlending:function(){return ne},CustomToneMapping:function(){return De},CylinderBufferGeometry:function(){return zp},CylinderGeometry:function(){return Vc},Cylindrical:function(){return Zf},Data3DTexture:function(){return Ur},DataArrayTexture:function(){return Or},DataTexture:function(){return Dl},DataTextureLoader:function(){return Id},DataUtils:function(){return mi},DecrementStencilOp:function(){return Cn},DecrementWrapStencilOp:function(){return An},DefaultLoadingManager:function(){return xd},DepthFormat:function(){return mt},DepthStencilFormat:function(){return gt},DepthTexture:function(){return Zu},DirectionalLight:function(){return jd},DirectionalLightHelper:function(){return bp},DiscreteInterpolant:function(){return od},DisplayP3ColorSpace:function(){return Sn},DodecahedronBufferGeometry:function(){return Up},DodecahedronGeometry:function(){return jc},DoubleSide:function(){return Y},DstAlphaFactor:function(){return pe},DstColorFactor:function(){return me},DynamicCopyUsage:function(){return qn},DynamicDrawUsage:function(){return Wn},DynamicReadUsage:function(){return Hn},EdgesGeometry:function(){return Zc},EllipseCurve:function(){return yc},EqualDepth:function(){return Se},EqualStencilFunc:function(){return Pn},EquirectangularReflectionMapping:function(){return Ue},EquirectangularRefractionMapping:function(){return Be},Euler:function(){return Ia},EventDispatcher:function(){return Qn},ExtrudeBufferGeometry:function(){return Bp},ExtrudeGeometry:function(){return Th},FileLoader:function(){return _d},Float16BufferAttribute:function(){return Mi},Float32BufferAttribute:function(){return Ci},Float64BufferAttribute:function(){return Ii},FloatType:function(){return st},Fog:function(){return al},FogExp2:function(){return rl},FramebufferTexture:function(){return fc},FrontSide:function(){return q},Frustum:function(){return ko},GLBufferAttribute:function(){return jf},GLSL1:function(){return Yn},GLSL3:function(){return Zn},GreaterDepth:function(){return Ee},GreaterEqualDepth:function(){return _e},GreaterEqualStencilFunc:function(){return zn},GreaterStencilFunc:function(){return Fn},GridHelper:function(){return pp},Group:function(){return qu},HalfFloatType:function(){return ut},HemisphereLight:function(){return Nd},HemisphereLightHelper:function(){return fp},HemisphereLightProbe:function(){return uf},IcosahedronBufferGeometry:function(){return Wp},IcosahedronGeometry:function(){return Ch},ImageBitmapLoader:function(){return af},ImageLoader:function(){return Md},ImageUtils:function(){return Ar},IncrementStencilOp:function(){return Mn},IncrementWrapStencilOp:function(){return In},InstancedBufferAttribute:function(){return Ul},InstancedBufferGeometry:function(){return Qd},InstancedInterleavedBuffer:function(){return Hf},InstancedMesh:function(){return ql},Int16BufferAttribute:function(){return Si},Int32BufferAttribute:function(){return Ei},Int8BufferAttribute:function(){return xi},IntType:function(){return it},InterleavedBuffer:function(){return ol},InterleavedBufferAttribute:function(){return ul},Interpolant:function(){return rd},InterpolateDiscrete:function(){return nn},InterpolateLinear:function(){return rn},InterpolateSmooth:function(){return an},InvertStencilOp:function(){return Rn},KeepStencilOp:function(){return En},KeyframeTrack:function(){return sd},LOD:function(){return Tl},LatheBufferGeometry:function(){return Vp},LatheGeometry:function(){return Uc},Layers:function(){return Aa},LessDepth:function(){return we},LessEqualDepth:function(){return ke},LessEqualStencilFunc:function(){return Dn},LessStencilFunc:function(){return Ln},Light:function(){return Rd},LightProbe:function(){return Yd},Line:function(){return ec},Line3:function(){return tp},LineBasicMaterial:function(){return Kl},LineCurve:function(){return Rc},LineCurve3:function(){return Nc},LineDashedMaterial:function(){return Yh},LineLoop:function(){return ac},LineSegments:function(){return rc},LinearEncoding:function(){return pn},LinearFilter:function(){return Ze},LinearInterpolant:function(){return id},LinearMipMapLinearFilter:function(){return et},LinearMipMapNearestFilter:function(){return Qe},LinearMipmapLinearFilter:function(){return $e},LinearMipmapNearestFilter:function(){return Je},LinearSRGBColorSpace:function(){return kn},LinearToneMapping:function(){return Re},Loader:function(){return wd},LoaderUtils:function(){return Jd},LoadingManager:function(){return bd},LoopOnce:function(){return $t},LoopPingPong:function(){return tn},LoopRepeat:function(){return en},LuminanceAlphaFormat:function(){return vt},LuminanceFormat:function(){return pt},MOUSE:function(){return O},Material:function(){return ai},MaterialLoader:function(){return Zd},MathUtils:function(){return dr},Matrix3:function(){return pr},Matrix4:function(){return ba},MaxEquation:function(){return se},Mesh:function(){return to},MeshBasicMaterial:function(){return hi},MeshDepthMaterial:function(){return Bu},MeshDistanceMaterial:function(){return Wu},MeshLambertMaterial:function(){return qh},MeshMatcapMaterial:function(){return Kh},MeshNormalMaterial:function(){return Xh},MeshPhongMaterial:function(){return Hh},MeshPhysicalMaterial:function(){return Gh},MeshStandardMaterial:function(){return Vh},MeshToonMaterial:function(){return jh},MinEquation:function(){return oe},MirroredRepeatWrapping:function(){return He},MixOperation:function(){return Ce},MultiplyBlending:function(){return te},MultiplyOperation:function(){return Me},NearestFilter:function(){return je},NearestMipMapLinearFilter:function(){return Ye},NearestMipMapNearestFilter:function(){return qe},NearestMipmapLinearFilter:function(){return Ke},NearestMipmapNearestFilter:function(){return Xe},NeverDepth:function(){return be},NeverStencilFunc:function(){return Nn},NoBlending:function(){return J},NoColorSpace:function(){return xn},NoToneMapping:function(){return Ae},NormalAnimationBlendMode:function(){return ln},NormalBlending:function(){return Q},NotEqualDepth:function(){return Te},NotEqualStencilFunc:function(){return On},NumberKeyframeTrack:function(){return cd},Object3D:function(){return Ha},ObjectLoader:function(){return ef},ObjectSpaceNormalMap:function(){return bn},OctahedronBufferGeometry:function(){return Gp},OctahedronGeometry:function(){return Ih},OneFactor:function(){return le},OneMinusDstAlphaFactor:function(){return ve},OneMinusDstColorFactor:function(){return ge},OneMinusSrcAlphaFactor:function(){return fe},OneMinusSrcColorFactor:function(){return he},OrthographicCamera:function(){return Fo},PCFShadowMap:function(){return H},PCFSoftShadowMap:function(){return j},PMREMGenerator:function(){return jo},Path:function(){return zc},PerspectiveCamera:function(){return co},Plane:function(){return bo},PlaneBufferGeometry:function(){return Hp},PlaneGeometry:function(){return Eo},PlaneHelper:function(){return Ip},PointLight:function(){return Gd},PointLightHelper:function(){return lp},Points:function(){return cc},PointsMaterial:function(){return ic},PolarGridHelper:function(){return vp},PolyhedronBufferGeometry:function(){return jp},PolyhedronGeometry:function(){return Hc},PositionalAudio:function(){return Tf},PropertyBinding:function(){return Ff},PropertyMixer:function(){return Cf},QuadraticBezierCurve:function(){return Lc},QuadraticBezierCurve3:function(){return Pc},Quaternion:function(){return Vr},QuaternionKeyframeTrack:function(){return dd},QuaternionLinearInterpolant:function(){return hd},RED_GREEN_RGTC2_Format:function(){return Jt},RED_RGTC1_Format:function(){return Yt},REVISION:function(){return F},RGBADepthPacking:function(){return gn},RGBAFormat:function(){return ft},RGBAIntegerFormat:function(){return kt},RGBA_ASTC_10x10_Format:function(){return jt},RGBA_ASTC_10x5_Format:function(){return Vt},RGBA_ASTC_10x6_Format:function(){return Gt},RGBA_ASTC_10x8_Format:function(){return Ht},RGBA_ASTC_12x10_Format:function(){return Xt},RGBA_ASTC_12x12_Format:function(){return qt},RGBA_ASTC_4x4_Format:function(){return Pt},RGBA_ASTC_5x4_Format:function(){return Dt},RGBA_ASTC_5x5_Format:function(){return Ft},RGBA_ASTC_6x5_Format:function(){return Ot},RGBA_ASTC_6x6_Format:function(){return zt},RGBA_ASTC_8x5_Format:function(){return Ut},RGBA_ASTC_8x6_Format:function(){return Bt},RGBA_ASTC_8x8_Format:function(){return Wt},RGBA_BPTC_Format:function(){return Kt},RGBA_ETC2_EAC_Format:function(){return Lt},RGBA_PVRTC_2BPPV1_Format:function(){return At},RGBA_PVRTC_4BPPV1_Format:function(){return It},RGBA_S3TC_DXT1_Format:function(){return _t},RGBA_S3TC_DXT3_Format:function(){return Et},RGBA_S3TC_DXT5_Format:function(){return Tt},RGB_ETC1_Format:function(){return Rt},RGB_ETC2_Format:function(){return Nt},RGB_PVRTC_2BPPV1_Format:function(){return Ct},RGB_PVRTC_4BPPV1_Format:function(){return Mt},RGB_S3TC_DXT1_Format:function(){return St},RGFormat:function(){return xt},RGIntegerFormat:function(){return wt},RawShaderMaterial:function(){return Wh},Ray:function(){return ya},Raycaster:function(){return Xf},RectAreaLight:function(){return qd},RedFormat:function(){return yt},RedIntegerFormat:function(){return bt},ReinhardToneMapping:function(){return Ne},RepeatWrapping:function(){return Ve},ReplaceStencilOp:function(){return Tn},ReverseSubtractEquation:function(){return ie},RingBufferGeometry:function(){return Xp},RingGeometry:function(){return Ah},SIGNED_RED_GREEN_RGTC2_Format:function(){return Qt},SIGNED_RED_RGTC1_Format:function(){return Zt},SRGBColorSpace:function(){return wn},Scene:function(){return il},ShaderChunk:function(){return To},ShaderLib:function(){return Co},ShaderMaterial:function(){return uo},ShadowMaterial:function(){return Bh},Shape:function(){return Jc},ShapeBufferGeometry:function(){return qp},ShapeGeometry:function(){return Rh},ShapePath:function(){return Lp},ShapeUtils:function(){return Sh},ShortType:function(){return rt},Skeleton:function(){return zl},SkeletonHelper:function(){return sp},SkinnedMesh:function(){return Ll},Source:function(){return Rr},Sphere:function(){return ca},SphereBufferGeometry:function(){return Kp},SphereGeometry:function(){return Nh},Spherical:function(){return Yf},SphericalHarmonics3:function(){return Kd},SplineCurve:function(){return Dc},SpotLight:function(){return zd},SpotLightHelper:function(){return rp},Sprite:function(){return kl},SpriteMaterial:function(){return ll},SrcAlphaFactor:function(){return de},SrcAlphaSaturateFactor:function(){return ye},SrcColorFactor:function(){return ce},StaticCopyUsage:function(){return Xn},StaticDrawUsage:function(){return Bn},StaticReadUsage:function(){return Gn},StereoCamera:function(){return ff},StreamCopyUsage:function(){return Kn},StreamDrawUsage:function(){return Vn},StreamReadUsage:function(){return jn},StringKeyframeTrack:function(){return fd},SubtractEquation:function(){return ae},SubtractiveBlending:function(){return ee},TOUCH:function(){return z},TangentSpaceNormalMap:function(){return yn},TetrahedronBufferGeometry:function(){return Yp},TetrahedronGeometry:function(){return Lh},Texture:function(){return Pr},TextureLoader:function(){return Ad},TorusBufferGeometry:function(){return Zp},TorusGeometry:function(){return Ph},TorusKnotBufferGeometry:function(){return Jp},TorusKnotGeometry:function(){return Dh},Triangle:function(){return ni},TriangleFanDrawMode:function(){return fn},TriangleStripDrawMode:function(){return dn},TrianglesDrawMode:function(){return hn},TubeBufferGeometry:function(){return Qp},TubeGeometry:function(){return Fh},TwoPassDoubleSide:function(){return Z},UVMapping:function(){return Fe},Uint16BufferAttribute:function(){return _i},Uint32BufferAttribute:function(){return Ti},Uint8BufferAttribute:function(){return wi},Uint8ClampedBufferAttribute:function(){return ki},Uniform:function(){return Wf},UniformsGroup:function(){return Gf},UniformsLib:function(){return Mo},UniformsUtils:function(){return so},UnsignedByteType:function(){return tt},UnsignedInt248Type:function(){return ht},UnsignedIntType:function(){return ot},UnsignedShort4444Type:function(){return lt},UnsignedShort5551Type:function(){return ct},UnsignedShortType:function(){return at},VSMShadowMap:function(){return X},Vector2:function(){return fr},Vector3:function(){return Gr},Vector4:function(){return Dr},VectorKeyframeTrack:function(){return pd},VideoTexture:function(){return dc},WebGL1Renderer:function(){return tl},WebGL3DRenderTarget:function(){return Br},WebGLArrayRenderTarget:function(){return zr},WebGLCubeRenderTarget:function(){return vo},WebGLMultipleRenderTargets:function(){return Wr},WebGLRenderTarget:function(){return Fr},WebGLRenderer:function(){return el},WebGLUtils:function(){return ju},WireframeGeometry:function(){return Oh},WrapAroundEnding:function(){return un},ZeroCurvatureEnding:function(){return on},ZeroFactor:function(){return ue},ZeroSlopeEnding:function(){return sn},ZeroStencilOp:function(){return _n},_SRGBAFormat:function(){return Jn},sRGBEncoding:function(){return vn}});var t={};n.r(t),n.d(t,{browserFiles:function(){return k_},browserHTTPRequest:function(){return D_},concatenateArrayBuffers:function(){return Fk},copyModel:function(){return TS},decodeWeights:function(){return Ak},encodeWeights:function(){return Ck},fromMemory:function(){return U_},fromMemorySync:function(){return B_},getLoadHandlers:function(){return Yk},getModelArtifactsForJSON:function(){return Bk},getModelArtifactsForJSONSync:function(){return Uk},getModelArtifactsInfoForJSON:function(){return Vk},getSaveHandlers:function(){return Kk},getWeightSpecs:function(){return Gk},http:function(){return P_},isHTTPScheme:function(){return N_},listModels:function(){return kS},loadWeights:function(){return M_},moveModel:function(){return CS},registerLoadRouter:function(){return qk},registerSaveRouter:function(){return Xk},removeModel:function(){return _S},weightsLoaderFactory:function(){return I_},withSaveHandler:function(){return W_},withSaveHandlerSync:function(){return V_}});var r,a,i=n(791),o=n(250);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function u(){u=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(A){c=function(e,t,n){return e[t]=n}}function h(e,t,n,a){var i=t&&t.prototype instanceof p?t:p,o=Object.create(i.prototype),s=new M(a||[]);return r(o,"_invoke",{value:S(e,n,s)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(A){return{type:"throw",arg:A}}}e.wrap=h;var f={};function p(){}function v(){}function m(){}var g={};c(g,i,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(C([])));b&&b!==t&&n.call(b,i)&&(g=b);var x=m.prototype=p.prototype=Object.create(g);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function a(r,i,o,u){var l=d(e[r],e,i);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==s(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){a("next",e,o,u)}),(function(e){a("throw",e,o,u)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return a("throw",e,o,u)}))}u(l.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){a(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function S(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return I()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=_(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=d(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function _(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var a=d(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,f;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function C(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=m,r(x,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:v,configurable:!0}),v.displayName=c(m,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,l,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},w(k.prototype),c(k.prototype,o,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new k(h(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},w(x),c(x,l,"Generator"),c(x,i,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=C,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function l(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){l(i,r,a,o,s,"next",e)}function s(e){l(i,r,a,o,s,"throw",e)}o(void 0)}))}}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function d(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function f(e,t,n){return f=d()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&h(a,n.prototype),a},f.apply(null,arguments)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function m(e,t){if(e){if("string"===typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function g(e){return function(e){if(Array.isArray(e))return p(e)}(e)||v(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){if(Array.isArray(e))return e}function b(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function x(e,t){return y(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,s=[],u=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(c){l=!0,a=c}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw a}}return s}}(e,t)||m(e,t)||b()}function w(e){var t=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===s(t)?t:String(t)}function k(e,t,n){return(t=w(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,w(r.key),r)}}function M(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function C(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e){var t=d();return function(){var n,r=I(e);if(t){var a=I(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===s(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return A(e)}(this,n)}}function N(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=m(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function L(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function P(e){var t="function"===typeof Map?new Map:void 0;return P=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return f(e,arguments,I(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),h(r,e)},P(e)}function D(){return D="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},D.apply(this,arguments)}var F="152",O={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},z={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},U=0,B=1,W=2,V=3,G=0,H=1,j=2,X=3,q=0,K=1,Y=2,Z=2,J=0,Q=1,$=2,ee=3,te=4,ne=5,re=100,ae=101,ie=102,oe=103,se=104,ue=200,le=201,ce=202,he=203,de=204,fe=205,pe=206,ve=207,me=208,ge=209,ye=210,be=0,xe=1,we=2,ke=3,Se=4,_e=5,Ee=6,Te=7,Me=0,Ce=1,Ie=2,Ae=0,Re=1,Ne=2,Le=3,Pe=4,De=5,Fe=300,Oe=301,ze=302,Ue=303,Be=304,We=306,Ve=1e3,Ge=1001,He=1002,je=1003,Xe=1004,qe=1004,Ke=1005,Ye=1005,Ze=1006,Je=1007,Qe=1007,$e=1008,et=1008,tt=1009,nt=1010,rt=1011,at=1012,it=1013,ot=1014,st=1015,ut=1016,lt=1017,ct=1018,ht=1020,dt=1021,ft=1023,pt=1024,vt=1025,mt=1026,gt=1027,yt=1028,bt=1029,xt=1030,wt=1031,kt=1033,St=33776,_t=33777,Et=33778,Tt=33779,Mt=35840,Ct=35841,It=35842,At=35843,Rt=36196,Nt=37492,Lt=37496,Pt=37808,Dt=37809,Ft=37810,Ot=37811,zt=37812,Ut=37813,Bt=37814,Wt=37815,Vt=37816,Gt=37817,Ht=37818,jt=37819,Xt=37820,qt=37821,Kt=36492,Yt=36283,Zt=36284,Jt=36285,Qt=36286,$t=2200,en=2201,tn=2202,nn=2300,rn=2301,an=2302,on=2400,sn=2401,un=2402,ln=2500,cn=2501,hn=0,dn=1,fn=2,pn=3e3,vn=3001,mn=3200,gn=3201,yn=0,bn=1,xn="",wn="srgb",kn="srgb-linear",Sn="display-p3",_n=0,En=7680,Tn=7681,Mn=7682,Cn=7683,In=34055,An=34056,Rn=5386,Nn=512,Ln=513,Pn=514,Dn=515,Fn=516,On=517,zn=518,Un=519,Bn=35044,Wn=35048,Vn=35040,Gn=35045,Hn=35049,jn=35041,Xn=35046,qn=35050,Kn=35042,Yn="100",Zn="300 es",Jn=1035,Qn=function(){function e(){E(this,e)}return M(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,a=n.length;r<a;r++)n[r].call(this,e);e.target=null}}}}]),e}(),$n=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],er=1234567,tr=Math.PI/180,nr=180/Math.PI;function rr(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return($n[255&e]+$n[e>>8&255]+$n[e>>16&255]+$n[e>>24&255]+"-"+$n[255&t]+$n[t>>8&255]+"-"+$n[t>>16&15|64]+$n[t>>24&255]+"-"+$n[63&n|128]+$n[n>>8&255]+"-"+$n[n>>16&255]+$n[n>>24&255]+$n[255&r]+$n[r>>8&255]+$n[r>>16&255]+$n[r>>24&255]).toLowerCase()}function ar(e,t,n){return Math.max(t,Math.min(n,e))}function ir(e,t){return(e%t+t)%t}function or(e,t,n){return(1-n)*e+n*t}function sr(e){return 0===(e&e-1)&&0!==e}function ur(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function lr(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function cr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function hr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var dr={DEG2RAD:tr,RAD2DEG:nr,generateUUID:rr,clamp:ar,euclideanModulo:ir,mapLinear:function(e,t,n,r,a){return r+(e-t)*(a-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:or,damp:function(e,t,n,r){return or(e,t,1-Math.exp(-n*r))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(ir(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(er=e);var t=er+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*tr},radToDeg:function(e){return e*nr},isPowerOfTwo:sr,ceilPowerOfTwo:ur,floorPowerOfTwo:lr,setQuaternionFromProperEuler:function(e,t,n,r,a){var i=Math.cos,o=Math.sin,s=i(n/2),u=o(n/2),l=i((t+r)/2),c=o((t+r)/2),h=i((t-r)/2),d=o((t-r)/2),f=i((r-t)/2),p=o((r-t)/2);switch(a){case"XYX":e.set(s*c,u*h,u*d,s*l);break;case"YZY":e.set(u*d,s*c,u*h,s*l);break;case"ZXZ":e.set(u*h,u*d,s*c,s*l);break;case"XZX":e.set(s*c,u*p,u*f,s*l);break;case"YXY":e.set(u*f,s*c,u*p,s*l);break;case"ZYZ":e.set(u*p,u*f,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}},normalize:hr,denormalize:cr},fr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;E(this,t),t.prototype.isVector2=!0,this.x=e,this.y=n}return M(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(ar(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),a=this.x-e.x,i=this.y-e.y;return this.x=a*n-i*r+e.x,this.y=a*r+i*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}(),pr=function(){function e(){E(this,e),e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}return M(e,[{key:"set",value:function(e,t,n,r,a,i,o,s,u){var l=this.elements;return l[0]=e,l[1]=r,l[2]=o,l[3]=t,l[4]=a,l[5]=s,l[6]=n,l[7]=i,l[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],d=n[5],f=n[8],p=r[0],v=r[3],m=r[6],g=r[1],y=r[4],b=r[7],x=r[2],w=r[5],k=r[8];return a[0]=i*p+o*g+s*x,a[3]=i*v+o*y+s*w,a[6]=i*m+o*b+s*k,a[1]=u*p+l*g+c*x,a[4]=u*v+l*y+c*w,a[7]=u*m+l*b+c*k,a[2]=h*p+d*g+f*x,a[5]=h*v+d*y+f*w,a[8]=h*m+d*b+f*k,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*i*l-t*o*u-n*a*l+n*o*s+r*a*u-r*i*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=l*i-o*u,h=o*s-l*a,d=u*a-i*s,f=t*c+n*h+r*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);var p=1/f;return e[0]=c*p,e[1]=(r*u-l*n)*p,e[2]=(o*n-r*i)*p,e[3]=h*p,e[4]=(l*t-r*s)*p,e[5]=(r*a-o*t)*p,e[6]=d*p,e[7]=(n*s-u*t)*p,e[8]=(i*t-n*a)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,a,i,o){var s=Math.cos(a),u=Math.sin(a);return this.set(n*s,n*u,-n*(s*i+u*o)+i+e,-r*u,r*s,-r*(-u*i+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){return this.premultiply(vr.makeScale(e,t)),this}},{key:"rotate",value:function(e){return this.premultiply(vr.makeRotation(-e)),this}},{key:"translate",value:function(e,t){return this.premultiply(vr.makeTranslation(e,t)),this}},{key:"makeTranslation",value:function(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}},{key:"makeRotation",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}},{key:"makeScale",value:function(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}(),vr=new pr;function mr(e){for(var t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var gr={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function yr(e,t){return new gr[e](t)}function br(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}var xr={};function wr(e){e in xr||(xr[e]=!0,console.warn(e))}function kr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Sr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var _r=(new pr).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Er=(new pr).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);var Tr,Mr=(k(r={},kn,(function(e){return e})),k(r,wn,(function(e){return e.convertSRGBToLinear()})),k(r,Sn,(function(e){return e.convertSRGBToLinear().applyMatrix3(Er)})),r),Cr=(k(a={},kn,(function(e){return e})),k(a,wn,(function(e){return e.convertLinearToSRGB()})),k(a,Sn,(function(e){return e.applyMatrix3(_r).convertLinearToSRGB()})),a),Ir={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return kn},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;var r=Mr[t],a=Cr[n];if(void 0===r||void 0===a)throw new Error('Unsupported color space conversion, "'.concat(t,'" to "').concat(n,'".'));return a(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Ar=function(){function e(){E(this,e)}return M(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Tr&&(Tr=br("canvas")),Tr.width=e.width,Tr.height=e.height;var n=Tr.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Tr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var t=br("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),a=r.data,i=0;i<a.length;i++)a[i]=255*kr(a[i]/255);return n.putImageData(r,0,0),t}if(e.data){for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*kr(o[s]/255)):o[s]=kr(o[s]);return{data:o,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),Rr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;E(this,e),this.isSource=!0,this.uuid=rr(),this.data=t,this.version=0}return M(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var n={uuid:this.uuid,url:""},r=this.data;if(null!==r){var a;if(Array.isArray(r)){a=[];for(var i=0,o=r.length;i<o;i++)r[i].isDataTexture?a.push(Nr(r[i].image)):a.push(Nr(r[i]))}else a=Nr(r);n.url=a}return t||(e.images[this.uuid]=n),n}}]),e}();function Nr(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Ar.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Lr=0,Pr=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ge,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ge,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ze,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:$e,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ft,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:tt,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n.DEFAULT_ANISOTROPY,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:xn;return E(this,n),(e=t.call(this)).isTexture=!0,Object.defineProperty(A(e),"id",{value:Lr++}),e.uuid=rr(),e.name="",e.source=new Rr(r),e.mipmaps=[],e.mapping=a,e.channel=0,e.wrapS=i,e.wrapT=o,e.magFilter=s,e.minFilter=u,e.anisotropy=h,e.format=l,e.internalFormat=null,e.type=c,e.offset=new fr(0,0),e.repeat=new fr(1,1),e.center=new fr(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new pr,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,"string"===typeof d?e.colorSpace=d:(wr("THREE.Texture: Property .encoding has been replaced by .colorSpace."),e.colorSpace=d===vn?wn:xn),e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e.needsPMREMUpdate=!1,e}return M(n,[{key:"image",get:function(){return this.source.data},set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(this.mapping!==Fe)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ve:e.x=e.x-Math.floor(e.x);break;case Ge:e.x=e.x<0?0:1;break;case He:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Ve:e.y=e.y-Math.floor(e.y);break;case Ge:e.y=e.y<0?0:1;break;case He:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}},{key:"encoding",get:function(){return wr("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===wn?vn:pn},set:function(e){wr("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===vn?wn:xn}}]),n}(Qn);Pr.DEFAULT_IMAGE=null,Pr.DEFAULT_MAPPING=Fe,Pr.DEFAULT_ANISOTROPY=1;var Dr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;E(this,t),t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=a}return M(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,a=this.w,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12]*a,this.y=i[1]*t+i[5]*n+i[9]*r+i[13]*a,this.z=i[2]*t+i[6]*n+i[10]*r+i[14]*a,this.w=i[3]*t+i[7]*n+i[11]*r+i[15]*a,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,a,i=.01,o=.1,s=e.elements,u=s[0],l=s[4],c=s[8],h=s[1],d=s[5],f=s[9],p=s[2],v=s[6],m=s[10];if(Math.abs(l-h)<i&&Math.abs(c-p)<i&&Math.abs(f-v)<i){if(Math.abs(l+h)<o&&Math.abs(c+p)<o&&Math.abs(f+v)<o&&Math.abs(u+d+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(u+1)/2,y=(d+1)/2,b=(m+1)/2,x=(l+h)/4,w=(c+p)/4,k=(f+v)/4;return g>y&&g>b?g<i?(n=0,r=.707106781,a=.707106781):(r=x/(n=Math.sqrt(g)),a=w/n):y>b?y<i?(n=.707106781,r=0,a=.707106781):(n=x/(r=Math.sqrt(y)),a=k/r):b<i?(n=.707106781,r=.707106781,a=0):(n=w/(a=Math.sqrt(b)),r=k/a),this.set(n,r,a,t),this}var S=Math.sqrt((v-f)*(v-f)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(S)<.001&&(S=1),this.x=(v-f)/S,this.y=(c-p)/S,this.z=(h-l)/S,this.w=Math.acos((u+d+m-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}(),Fr=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};E(this,n),(e=t.call(this)).isWebGLRenderTarget=!0,e.width=r,e.height=a,e.depth=1,e.scissor=new Dr(0,0,r,a),e.scissorTest=!1,e.viewport=new Dr(0,0,r,a);var o={width:r,height:a,depth:1};return void 0!==i.encoding&&(wr("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===vn?wn:xn),e.texture=new Pr(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),e.texture.isRenderTargetTexture=!0,e.texture.flipY=!1,e.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,e.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,e.texture.minFilter=void 0!==i.minFilter?i.minFilter:Ze,e.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,e.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,e.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,e.samples=void 0!==i.samples?i.samples:0,e}return M(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;var t=Object.assign({},e.texture.image);return this.texture.source=new Rr(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Qn),Or=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return E(this,n),(e=t.call(this,null)).isDataArrayTexture=!0,e.image={data:r,width:a,height:i,depth:o},e.magFilter=je,e.minFilter=je,e.wrapR=Ge,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return M(n)}(Pr),zr=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return E(this,n),(e=t.call(this,r,a)).isWebGLArrayRenderTarget=!0,e.depth=i,e.texture=new Or(null,r,a,i),e.texture.isRenderTargetTexture=!0,e}return M(n)}(Fr),Ur=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return E(this,n),(e=t.call(this,null)).isData3DTexture=!0,e.image={data:r,width:a,height:i,depth:o},e.magFilter=je,e.minFilter=je,e.wrapR=Ge,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return M(n)}(Pr),Br=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return E(this,n),(e=t.call(this,r,a)).isWebGL3DRenderTarget=!0,e.depth=i,e.texture=new Ur(null,r,a,i),e.texture.isRenderTargetTexture=!0,e}return M(n)}(Fr),Wr=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};E(this,n),(e=t.call(this,r,a,o)).isWebGLMultipleRenderTargets=!0;var s=e.texture;e.texture=[];for(var u=0;u<i;u++)e.texture[u]=s.clone(),e.texture[u].isRenderTargetTexture=!0;return e}return M(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var r=0,a=this.texture.length;r<a;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}},{key:"copy",value:function(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(var t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}]),n}(Fr),Vr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;E(this,t),this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=a}return M(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){var n=e._x,r=e._y,a=e._z,i=e._order,o=Math.cos,s=Math.sin,u=o(n/2),l=o(r/2),c=o(a/2),h=s(n/2),d=s(r/2),f=s(a/2);switch(i){case"XYZ":this._x=h*l*c+u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c-h*d*f;break;case"YXZ":this._x=h*l*c+u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c+h*d*f;break;case"ZXY":this._x=h*l*c-u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c-h*d*f;break;case"ZYX":this._x=h*l*c-u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c+h*d*f;break;case"YZX":this._x=h*l*c+u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c-h*d*f;break;case"XZY":this._x=h*l*c-u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],a=t[8],i=t[1],o=t[5],s=t[9],u=t[2],l=t[6],c=t[10],h=n+o+c;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(l-s)*d,this._y=(a-u)*d,this._z=(i-r)*d}else if(n>o&&n>c){var f=2*Math.sqrt(1+n-o-c);this._w=(l-s)/f,this._x=.25*f,this._y=(r+i)/f,this._z=(a+u)/f}else if(o>c){var p=2*Math.sqrt(1+o-n-c);this._w=(a-u)/p,this._x=(r+i)/p,this._y=.25*p,this._z=(s+l)/p}else{var v=2*Math.sqrt(1+c-n-o);this._w=(i-r)/v,this._x=(a+u)/v,this._y=(s+l)/v,this._z=.25*v}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(ar(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,a=e._z,i=e._w,o=t._x,s=t._y,u=t._z,l=t._w;return this._x=n*l+i*o+r*u-a*s,this._y=r*l+i*s+a*o-n*u,this._z=a*l+i*u+n*s-r*o,this._w=i*l-n*o-r*s-a*u,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,a=this._z,i=this._w,o=i*e._w+n*e._x+r*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=i,this._x=n,this._y=r,this._z=a,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*i+t*this._w,this._x=u*n+t*this._x,this._y=u*r+t*this._y,this._z=u*a+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=i*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=a*h+this._z*d,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(a),n*Math.cos(a),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"toJSON",value:function(){return this.toArray()}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._w;case 8:case"end":return e.stop()}}),e,this)}))}],[{key:"slerpFlat",value:function(e,t,n,r,a,i,o){var s=n[r+0],u=n[r+1],l=n[r+2],c=n[r+3],h=a[i+0],d=a[i+1],f=a[i+2],p=a[i+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=l,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(c!==p||s!==h||u!==d||l!==f){var v=1-o,m=s*h+u*d+l*f+c*p,g=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,m*g);v=Math.sin(v*x)/b,o=Math.sin(o*x)/b}var w=o*g;if(s=s*v+h*w,u=u*v+d*w,l=l*v+f*w,c=c*v+p*w,v===1-o){var k=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=k,u*=k,l*=k,c*=k}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,a,i){var o=n[r],s=n[r+1],u=n[r+2],l=n[r+3],c=a[i],h=a[i+1],d=a[i+2],f=a[i+3];return e[t]=o*f+l*c+s*d-u*h,e[t+1]=s*f+l*h+u*c-o*d,e[t+2]=u*f+l*d+o*h-s*c,e[t+3]=l*f-o*c-s*h-u*d,e}}]),t}(),Gr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;E(this,t),t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}return M(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return this.applyQuaternion(jr.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(jr.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*r,this.y=a[1]*t+a[4]*n+a[7]*r,this.z=a[2]*t+a[5]*n+a[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements,i=1/(a[3]*t+a[7]*n+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*r+a[12])*i,this.y=(a[1]*t+a[5]*n+a[9]*r+a[13])*i,this.z=(a[2]*t+a[6]*n+a[10]*r+a[14])*i,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.x,i=e.y,o=e.z,s=e.w,u=s*t+i*r-o*n,l=s*n+o*t-a*r,c=s*r+a*n-i*t,h=-a*t-i*n-o*r;return this.x=u*s+h*-a+l*-o-c*-i,this.y=l*s+h*-i+c*-a-u*-o,this.z=c*s+h*-o+u*-i-l*-a,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r,this.y=a[1]*t+a[5]*n+a[9]*r,this.z=a[2]*t+a[6]*n+a[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=t.x,o=t.y,s=t.z;return this.x=r*s-a*o,this.y=a*i-n*s,this.z=n*o-r*i,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return Hr.copy(this).projectOnVector(e),this.sub(Hr)}},{key:"reflect",value:function(e){return this.sub(Hr.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(ar(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"setFromColor",value:function(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:Symbol.iterator,value:u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(),Hr=new Gr,jr=new Vr,Xr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr(-1/0,-1/0,-1/0);E(this,e),this.isBox3=!0,this.min=t,this.max=n}return M(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t+=3)this.expandByPoint(Kr.fromArray(e,t));return this}},{key:"setFromBufferAttribute",value:function(e){this.makeEmpty();for(var t=0,n=e.count;t<n;t++)this.expandByPoint(Kr.fromBufferAttribute(e,t));return this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Kr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),Yr.copy(e.boundingBox),Yr.applyMatrix4(e.matrixWorld),this.union(Yr);else{var n=e.geometry;if(void 0!==n)if(t&&void 0!==n.attributes&&void 0!==n.attributes.position)for(var r=n.attributes.position,a=0,i=r.count;a<i;a++)Kr.fromBufferAttribute(r,a).applyMatrix4(e.matrixWorld),this.expandByPoint(Kr);else null===n.boundingBox&&n.computeBoundingBox(),Yr.copy(n.boundingBox),Yr.applyMatrix4(e.matrixWorld),this.union(Yr)}for(var o=e.children,s=0,u=o.length;s<u;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Kr),Kr.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(na),ra.subVectors(this.max,na),Zr.subVectors(e.a,na),Jr.subVectors(e.b,na),Qr.subVectors(e.c,na),$r.subVectors(Jr,Zr),ea.subVectors(Qr,Jr),ta.subVectors(Zr,Qr);var t=[0,-$r.z,$r.y,0,-ea.z,ea.y,0,-ta.z,ta.y,$r.z,0,-$r.x,ea.z,0,-ea.x,ta.z,0,-ta.x,-$r.y,$r.x,0,-ea.y,ea.x,0,-ta.y,ta.x,0];return!!oa(t,Zr,Jr,Qr,ra)&&(!!oa(t=[1,0,0,0,1,0,0,0,1],Zr,Jr,Qr,ra)&&(aa.crossVectors($r,ea),oa(t=[aa.x,aa.y,aa.z],Zr,Jr,Qr,ra)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return this.clampPoint(e,Kr).distanceTo(e)}},{key:"getBoundingSphere",value:function(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Kr).length()),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(qr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),qr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),qr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),qr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),qr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),qr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),qr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),qr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(qr)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),qr=[new Gr,new Gr,new Gr,new Gr,new Gr,new Gr,new Gr,new Gr],Kr=new Gr,Yr=new Xr,Zr=new Gr,Jr=new Gr,Qr=new Gr,$r=new Gr,ea=new Gr,ta=new Gr,na=new Gr,ra=new Gr,aa=new Gr,ia=new Gr;function oa(e,t,n,r,a){for(var i=0,o=e.length-3;i<=o;i+=3){ia.fromArray(e,i);var s=a.x*Math.abs(ia.x)+a.y*Math.abs(ia.y)+a.z*Math.abs(ia.z),u=t.dot(ia),l=n.dot(ia),c=r.dot(ia);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}var sa=new Xr,ua=new Gr,la=new Gr,ca=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;E(this,e),this.center=t,this.radius=n}return M(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):sa.setFromPoints(e).getCenter(n);for(var r=0,a=0,i=e.length;a<i;a++)r=Math.max(r,n.distanceToSquared(e[a]));return this.radius=Math.sqrt(r),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ua.subVectors(e,this.center);var t=ua.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),r=.5*(n-this.radius);this.center.addScaledVector(ua,r/n),this.radius+=r}return this}},{key:"union",value:function(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(la.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ua.copy(e.center).add(la)),this.expandByPoint(ua.copy(e.center).sub(la))),this)}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),ha=new Gr,da=new Gr,fa=new Gr,pa=new Gr,va=new Gr,ma=new Gr,ga=new Gr,ya=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr(0,0,-1);E(this,e),this.origin=t,this.direction=n}return M(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,ha)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=ha.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ha.copy(this.origin).addScaledVector(this.direction,t),ha.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){da.copy(e).add(t).multiplyScalar(.5),fa.copy(t).sub(e).normalize(),pa.copy(this.origin).sub(da);var a,i,o,s,u=.5*e.distanceTo(t),l=-this.direction.dot(fa),c=pa.dot(this.direction),h=-pa.dot(fa),d=pa.lengthSq(),f=Math.abs(1-l*l);if(f>0)if(i=l*c-h,s=u*f,(a=l*h-c)>=0)if(i>=-s)if(i<=s){var p=1/f;o=(a*=p)*(a+l*(i*=p)+2*c)+i*(l*a+i+2*h)+d}else i=u,o=-(a=Math.max(0,-(l*i+c)))*a+i*(i+2*h)+d;else i=-u,o=-(a=Math.max(0,-(l*i+c)))*a+i*(i+2*h)+d;else i<=-s?o=-(a=Math.max(0,-(-l*u+c)))*a+(i=a>0?-u:Math.min(Math.max(-u,-h),u))*(i+2*h)+d:i<=s?(a=0,o=(i=Math.min(Math.max(-u,-h),u))*(i+2*h)+d):o=-(a=Math.max(0,-(l*u+c)))*a+(i=a>0?u:Math.min(Math.max(-u,-h),u))*(i+2*h)+d;else i=l>0?-u:u,o=-(a=Math.max(0,-(l*i+c)))*a+i*(i+2*h)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,a),r&&r.copy(da).addScaledVector(fa,i),o}},{key:"intersectSphere",value:function(e,t){ha.subVectors(e.center,this.origin);var n=ha.dot(this.direction),r=ha.dot(ha)-n*n,a=e.radius*e.radius;if(r>a)return null;var i=Math.sqrt(a-r),o=n-i,s=n+i;return s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,a,i,o,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,r=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,r=(e.min.x-h.x)*u),l>=0?(a=(e.min.y-h.y)*l,i=(e.max.y-h.y)*l):(a=(e.max.y-h.y)*l,i=(e.min.y-h.y)*l),n>i||a>r?null:((a>n||isNaN(n))&&(n=a),(i<r||isNaN(r))&&(r=i),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,ha)}},{key:"intersectTriangle",value:function(e,t,n,r,a){va.subVectors(t,e),ma.subVectors(n,e),ga.crossVectors(va,ma);var i,o=this.direction.dot(ga);if(o>0){if(r)return null;i=1}else{if(!(o<0))return null;i=-1,o=-o}pa.subVectors(this.origin,e);var s=i*this.direction.dot(ma.crossVectors(pa,ma));if(s<0)return null;var u=i*this.direction.dot(va.cross(pa));if(u<0)return null;if(s+u>o)return null;var l=-i*pa.dot(ga);return l<0?null:this.at(l/o,a)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),ba=function(){function e(){E(this,e),e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return M(e,[{key:"set",value:function(e,t,n,r,a,i,o,s,u,l,c,h,d,f,p,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=a,m[5]=i,m[9]=o,m[13]=s,m[2]=u,m[6]=l,m[10]=c,m[14]=h,m[3]=d,m[7]=f,m[11]=p,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/xa.setFromMatrixColumn(e,0).length(),a=1/xa.setFromMatrixColumn(e,1).length(),i=1/xa.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t=this.elements,n=e.x,r=e.y,a=e.z,i=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),l=Math.cos(a),c=Math.sin(a);if("XYZ"===e.order){var h=i*l,d=i*c,f=o*l,p=o*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=d+f*u,t[5]=h-p*u,t[9]=-o*s,t[2]=p-h*u,t[6]=f+d*u,t[10]=i*s}else if("YXZ"===e.order){var v=s*l,m=s*c,g=u*l,y=u*c;t[0]=v+y*o,t[4]=g*o-m,t[8]=i*u,t[1]=i*c,t[5]=i*l,t[9]=-o,t[2]=m*o-g,t[6]=y+v*o,t[10]=i*s}else if("ZXY"===e.order){var b=s*l,x=s*c,w=u*l,k=u*c;t[0]=b-k*o,t[4]=-i*c,t[8]=w+x*o,t[1]=x+w*o,t[5]=i*l,t[9]=k-b*o,t[2]=-i*u,t[6]=o,t[10]=i*s}else if("ZYX"===e.order){var S=i*l,_=i*c,E=o*l,T=o*c;t[0]=s*l,t[4]=E*u-_,t[8]=S*u+T,t[1]=s*c,t[5]=T*u+S,t[9]=_*u-E,t[2]=-u,t[6]=o*s,t[10]=i*s}else if("YZX"===e.order){var M=i*s,C=i*u,I=o*s,A=o*u;t[0]=s*l,t[4]=A-M*c,t[8]=I*c+C,t[1]=c,t[5]=i*l,t[9]=-o*l,t[2]=-u*l,t[6]=C*c+I,t[10]=M-A*c}else if("XZY"===e.order){var R=i*s,N=i*u,L=o*s,P=o*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=R*c+P,t[5]=i*l,t[9]=N*c-L,t[2]=L*c-N,t[6]=o*l,t[10]=P*c+R}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(ka,e,Sa)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return Ta.subVectors(e,t),0===Ta.lengthSq()&&(Ta.z=1),Ta.normalize(),_a.crossVectors(n,Ta),0===_a.lengthSq()&&(1===Math.abs(n.z)?Ta.x+=1e-4:Ta.z+=1e-4,Ta.normalize(),_a.crossVectors(n,Ta)),_a.normalize(),Ea.crossVectors(Ta,_a),r[0]=_a.x,r[4]=Ea.x,r[8]=Ta.x,r[1]=_a.y,r[5]=Ea.y,r[9]=Ta.y,r[2]=_a.z,r[6]=Ea.z,r[10]=Ta.z,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],d=n[13],f=n[2],p=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],x=n[15],w=r[0],k=r[4],S=r[8],_=r[12],E=r[1],T=r[5],M=r[9],C=r[13],I=r[2],A=r[6],R=r[10],N=r[14],L=r[3],P=r[7],D=r[11],F=r[15];return a[0]=i*w+o*E+s*I+u*L,a[4]=i*k+o*T+s*A+u*P,a[8]=i*S+o*M+s*R+u*D,a[12]=i*_+o*C+s*N+u*F,a[1]=l*w+c*E+h*I+d*L,a[5]=l*k+c*T+h*A+d*P,a[9]=l*S+c*M+h*R+d*D,a[13]=l*_+c*C+h*N+d*F,a[2]=f*w+p*E+v*I+m*L,a[6]=f*k+p*T+v*A+m*P,a[10]=f*S+p*M+v*R+m*D,a[14]=f*_+p*C+v*N+m*F,a[3]=g*w+y*E+b*I+x*L,a[7]=g*k+y*T+b*A+x*P,a[11]=g*S+y*M+b*R+x*D,a[15]=g*_+y*C+b*N+x*F,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],a=e[12],i=e[1],o=e[5],s=e[9],u=e[13],l=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+a*s*c-r*u*c-a*o*h+n*u*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*u*h+a*i*h-r*i*d+r*u*l-a*s*l)+e[11]*(+t*u*c-t*o*d-a*i*c+n*i*d+a*o*l-n*u*l)+e[15]*(-r*o*l-t*s*c+t*o*h+r*i*c-n*i*h+n*s*l)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],v=e[14],m=e[15],g=c*v*u-p*h*u+p*s*d-o*v*d-c*s*m+o*h*m,y=f*h*u-l*v*u-f*s*d+i*v*d+l*s*m-i*h*m,b=l*p*u-f*c*u+f*o*d-i*p*d-l*o*m+i*c*m,x=f*c*s-l*p*s-f*o*h+i*p*h+l*o*v-i*c*v,w=t*g+n*y+r*b+a*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var k=1/w;return e[0]=g*k,e[1]=(p*h*a-c*v*a-p*r*d+n*v*d+c*r*m-n*h*m)*k,e[2]=(o*v*a-p*s*a+p*r*u-n*v*u-o*r*m+n*s*m)*k,e[3]=(c*s*a-o*h*a-c*r*u+n*h*u+o*r*d-n*s*d)*k,e[4]=y*k,e[5]=(l*v*a-f*h*a+f*r*d-t*v*d-l*r*m+t*h*m)*k,e[6]=(f*s*a-i*v*a-f*r*u+t*v*u+i*r*m-t*s*m)*k,e[7]=(i*h*a-l*s*a+l*r*u-t*h*u-i*r*d+t*s*d)*k,e[8]=b*k,e[9]=(f*c*a-l*p*a-f*n*d+t*p*d+l*n*m-t*c*m)*k,e[10]=(i*p*a-f*o*a+f*n*u-t*p*u-i*n*m+t*o*m)*k,e[11]=(l*o*a-i*c*a-l*n*u+t*c*u+i*n*d-t*o*d)*k,e[12]=x*k,e[13]=(l*p*r-f*c*r+f*n*h-t*p*h-l*n*v+t*c*v)*k,e[14]=(f*o*r-i*p*r-f*n*s+t*p*s+i*n*v-t*o*v)*k,e[15]=(i*c*r-l*o*r+l*n*s-t*c*s-i*n*h+t*o*h)*k,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,a=e.z;return t[0]*=n,t[4]*=r,t[8]*=a,t[1]*=n,t[5]*=r,t[9]*=a,t[2]*=n,t[6]*=r,t[10]*=a,t[3]*=n,t[7]*=r,t[11]*=a,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),a=1-n,i=e.x,o=e.y,s=e.z,u=a*i,l=a*o;return this.set(u*i+n,u*o-r*s,u*s+r*o,0,u*o+r*s,l*o+n,l*s-r*i,0,u*s-r*o,l*s+r*i,a*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,r,a,i){return this.set(1,n,a,0,e,1,i,0,t,r,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,a=t._x,i=t._y,o=t._z,s=t._w,u=a+a,l=i+i,c=o+o,h=a*u,d=a*l,f=a*c,p=i*l,v=i*c,m=o*c,g=s*u,y=s*l,b=s*c,x=n.x,w=n.y,k=n.z;return r[0]=(1-(p+m))*x,r[1]=(d+b)*x,r[2]=(f-y)*x,r[3]=0,r[4]=(d-b)*w,r[5]=(1-(h+m))*w,r[6]=(v+g)*w,r[7]=0,r[8]=(f+y)*k,r[9]=(v-g)*k,r[10]=(1-(h+p))*k,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,a=xa.set(r[0],r[1],r[2]).length(),i=xa.set(r[4],r[5],r[6]).length(),o=xa.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),e.x=r[12],e.y=r[13],e.z=r[14],wa.copy(this);var s=1/a,u=1/i,l=1/o;return wa.elements[0]*=s,wa.elements[1]*=s,wa.elements[2]*=s,wa.elements[4]*=u,wa.elements[5]*=u,wa.elements[6]*=u,wa.elements[8]*=l,wa.elements[9]*=l,wa.elements[10]*=l,t.setFromRotationMatrix(wa),n.x=a,n.y=i,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,r,a,i){var o=this.elements,s=2*a/(t-e),u=2*a/(n-r),l=(t+e)/(t-e),c=(n+r)/(n-r),h=-(i+a)/(i-a),d=-2*i*a/(i-a);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,a,i){var o=this.elements,s=1/(t-e),u=1/(n-r),l=1/(i-a),c=(t+e)*s,h=(n+r)*u,d=(i+a)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),xa=new Gr,wa=new ba,ka=new Gr(0,0,0),Sa=new Gr(1,1,1),_a=new Gr,Ea=new Gr,Ta=new Gr,Ma=new ba,Ca=new Vr,Ia=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DEFAULT_ORDER;E(this,t),this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=a}return M(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.elements,a=r[0],i=r[4],o=r[8],s=r[1],u=r[5],l=r[9],c=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(ar(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-i,a)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-ar(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-c,a),this._z=0);break;case"ZXY":this._x=Math.asin(ar(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-i,u)):(this._y=0,this._z=Math.atan2(s,a));break;case"ZYX":this._y=Math.asin(-ar(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,a)):(this._x=0,this._z=Math.atan2(-i,u));break;case"YZX":this._z=Math.asin(ar(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-c,a)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-ar(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return Ma.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ma,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return Ca.setFromEuler(this),this.setFromQuaternion(Ca,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._order;case 8:case"end":return e.stop()}}),e,this)}))}]),t}();Ia.DEFAULT_ORDER="XYZ";var Aa=function(){function e(){E(this,e),this.mask=1}return M(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!==(this.mask&(1<<e|0))}}]),e}(),Ra=0,Na=new Gr,La=new Vr,Pa=new ba,Da=new Gr,Fa=new Gr,Oa=new Gr,za=new Vr,Ua=new Gr(1,0,0),Ba=new Gr(0,1,0),Wa=new Gr(0,0,1),Va={type:"added"},Ga={type:"removed"},Ha=function(e){C(n,e);var t=R(n);function n(){var e;E(this,n),(e=t.call(this)).isObject3D=!0,Object.defineProperty(A(e),"id",{value:Ra++}),e.uuid=rr(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DEFAULT_UP.clone();var r=new Gr,a=new Ia,i=new Vr,o=new Gr(1,1,1);return a._onChange((function(){i.setFromEuler(a,!1)})),i._onChange((function(){a.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(A(e),{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:a},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new ba},normalMatrix:{value:new pr}}),e.matrix=new ba,e.matrixWorld=new ba,e.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,e.matrixWorldNeedsUpdate=!1,e.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,e.layers=new Aa,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return M(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return La.setFromAxisAngle(e,t),this.quaternion.multiply(La),this}},{key:"rotateOnWorldAxis",value:function(e,t){return La.setFromAxisAngle(e,t),this.quaternion.premultiply(La),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(Ua,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(Ba,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(Wa,e)}},{key:"translateOnAxis",value:function(e,t){return Na.copy(e).applyQuaternion(this.quaternion),this.position.add(Na.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(Ua,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(Ba,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(Wa,e)}},{key:"localToWorld",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Pa.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?Da.copy(e):Da.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),Fa.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pa.lookAt(Fa,Da,this.up):Pa.lookAt(Da,Fa,this.up),this.quaternion.setFromRotationMatrix(Pa),r&&(Pa.extractRotation(r.matrixWorld),La.setFromRotationMatrix(Pa),this.quaternion.premultiply(La.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Va)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Ga)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Ga)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Pa.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Pa.multiply(e.parent.matrixWorld)),e.applyMatrix4(Pa),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var a=this.children[n].getObjectByProperty(e,t);if(void 0!==a)return a}}},{key:"getObjectsByProperty",value:function(e,t){var n=[];this[e]===t&&n.push(this);for(var r=0,a=this.children.length;r<a;r++){var i=this.children[r].getObjectsByProperty(e,t);i.length>0&&(n=n.concat(i))}return n}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fa,e,Oa),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fa,za,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++){var a=t[n];!0!==a.matrixWorldAutoUpdate&&!0!==e||a.updateMatrixWorld(e)}}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,a=0,i=r.length;a<i;a++){var o=r[a];!0===o.matrixWorldAutoUpdate&&o.updateWorldMatrix(!1,!0)}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function a(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(e.geometries,this.geometry);var i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){var o=i.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++){var l=o[s];a(e.shapes,l)}else a(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(a(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,d=this.material.length;h<d;h++)c.push(a(e.materials,this.material[h]));r.material=c}else r.material=a(e.materials,this.material);if(this.children.length>0){r.children=[];for(var f=0;f<this.children.length;f++)r.children.push(this.children[f].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var p=0;p<this.animations.length;p++){var v=this.animations[p];r.animations.push(a(e.animations,v))}}if(t){var m=_(e.geometries),g=_(e.materials),y=_(e.textures),b=_(e.images),x=_(e.shapes),w=_(e.skeletons),k=_(e.animations),S=_(e.nodes);m.length>0&&(n.geometries=m),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),b.length>0&&(n.images=b),x.length>0&&(n.shapes=x),w.length>0&&(n.skeletons=w),k.length>0&&(n.animations=k),S.length>0&&(n.nodes=S)}return n.object=r,n;function _(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}]),n}(Qn);Ha.DEFAULT_UP=new Gr(0,1,0),Ha.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ha.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var ja=new Gr,Xa=new Gr,qa=new Gr,Ka=new Gr,Ya=new Gr,Za=new Gr,Ja=new Gr,Qa=new Gr,$a=new Gr,ei=new Gr,ti=!1,ni=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Gr;E(this,e),this.a=t,this.b=n,this.c=r}return M(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return ja.subVectors(this.c,this.b),Xa.subVectors(this.a,this.b),.5*ja.cross(Xa).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,a,i){return!1===ti&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ti=!0),e.getInterpolation(t,this.a,this.b,this.c,n,r,a,i)}},{key:"getInterpolation",value:function(t,n,r,a,i){return e.getInterpolation(t,this.a,this.b,this.c,n,r,a,i)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,r,a=this.a,i=this.b,o=this.c;Ya.subVectors(i,a),Za.subVectors(o,a),Qa.subVectors(e,a);var s=Ya.dot(Qa),u=Za.dot(Qa);if(s<=0&&u<=0)return t.copy(a);$a.subVectors(e,i);var l=Ya.dot($a),c=Za.dot($a);if(l>=0&&c<=l)return t.copy(i);var h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return n=s/(s-l),t.copy(a).addScaledVector(Ya,n);ei.subVectors(e,o);var d=Ya.dot(ei),f=Za.dot(ei);if(f>=0&&d<=f)return t.copy(o);var p=d*u-s*f;if(p<=0&&u>=0&&f<=0)return r=u/(u-f),t.copy(a).addScaledVector(Za,r);var v=l*f-d*c;if(v<=0&&c-l>=0&&d-f>=0)return Ja.subVectors(o,i),r=(c-l)/(c-l+(d-f)),t.copy(i).addScaledVector(Ja,r);var m=1/(v+p+h);return n=p*m,r=h*m,t.copy(a).addScaledVector(Ya,n).addScaledVector(Za,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){r.subVectors(n,t),ja.subVectors(e,t),r.cross(ja);var a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,a){ja.subVectors(r,t),Xa.subVectors(n,t),qa.subVectors(e,t);var i=ja.dot(ja),o=ja.dot(Xa),s=ja.dot(qa),u=Xa.dot(Xa),l=Xa.dot(qa),c=i*u-o*o;if(0===c)return a.set(-2,-1,-1);var h=1/c,d=(u*s-o*l)*h,f=(i*l-o*s)*h;return a.set(1-d-f,f,d)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,Ka),Ka.x>=0&&Ka.y>=0&&Ka.x+Ka.y<=1}},{key:"getUV",value:function(e,t,n,r,a,i,o,s){return!1===ti&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ti=!0),this.getInterpolation(e,t,n,r,a,i,o,s)}},{key:"getInterpolation",value:function(e,t,n,r,a,i,o,s){return this.getBarycoord(e,t,n,r,Ka),s.setScalar(0),s.addScaledVector(a,Ka.x),s.addScaledVector(i,Ka.y),s.addScaledVector(o,Ka.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return ja.subVectors(n,t),Xa.subVectors(e,t),ja.cross(Xa).dot(r)<0}}]),e}(),ri=0,ai=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).isMaterial=!0,Object.defineProperty(A(e),"id",{value:ri++}),e.uuid=rr(),e.name="",e.type="Material",e.blending=Q,e.side=q,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.blendSrc=de,e.blendDst=fe,e.blendEquation=re,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=ke,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=Un,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=En,e.stencilZFail=En,e.stencilZPass=En,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.forceSinglePass=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return M(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE.Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."))}else console.warn("THREE.Material: parameter '".concat(t,"' has value of undefined."))}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Q&&(n.blending=this.blending),this.side!==q&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){var a=r(e.textures),i=r(e.images);a.length>0&&(n.textures=a),i.length>0&&(n.images=i)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var a=0;a!==r;++a)n[a]=t[a].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(Qn),ii={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oi={h:0,s:0,l:0},si={h:0,s:0,l:0};function ui(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}var li=function(e){function t(e,n,r){return E(this,t),this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===n&&void 0===r?this.set(e):this.setRGB(e,n,r)}return M(t,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wn;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Ir.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ir.workingColorSpace;return this.r=e,this.g=t,this.b=n,Ir.toWorkingColorSpace(this,r),this}},{key:"setHSL",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ir.workingColorSpace;if(e=ir(e,1),t=ar(t,0,1),n=ar(n,0,1),0===t)this.r=this.g=this.b=n;else{var a=n<=.5?n*(1+t):n+t-n*t,i=2*n-a;this.r=ui(i,a,e+1/3),this.g=ui(i,a,e),this.b=ui(i,a,e-1/3)}return Ir.toWorkingColorSpace(this,r),this}},{key:"setStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wn;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){var a,i=t[1],o=t[2];switch(i){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,n);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,n);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var s=t[1],u=s.length;if(3===u)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(6===u)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wn,n=ii[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=kr(e.r),this.g=kr(e.g),this.b=kr(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=Sr(e.r),this.g=Sr(e.g),this.b=Sr(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wn;return Ir.fromWorkingColorSpace(ci.copy(this),e),65536*Math.round(ar(255*ci.r,0,255))+256*Math.round(ar(255*ci.g,0,255))+Math.round(ar(255*ci.b,0,255))}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wn;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ir.workingColorSpace;Ir.fromWorkingColorSpace(ci.copy(this),t);var n,r,a=ci.r,i=ci.g,o=ci.b,s=Math.max(a,i,o),u=Math.min(a,i,o),l=(u+s)/2;if(u===s)n=0,r=0;else{var c=s-u;switch(r=l<=.5?c/(s+u):c/(2-s-u),s){case a:n=(i-o)/c+(i<o?6:0);break;case i:n=(o-a)/c+2;break;case o:n=(a-i)/c+4}n/=6}return e.h=n,e.s=r,e.l=l,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ir.workingColorSpace;return Ir.fromWorkingColorSpace(ci.copy(this),t),e.r=ci.r,e.g=ci.g,e.b=ci.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wn;Ir.fromWorkingColorSpace(ci.copy(this),e);var t=ci.r,n=ci.g,r=ci.b;return e!==wn?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(r.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(Math.round(255*r),")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(oi),oi.h+=e,oi.s+=t,oi.l+=n,this.setHSL(oi.h,oi.s,oi.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(oi),e.getHSL(si);var n=or(oi.h,si.h,t),r=or(oi.s,si.s,t),a=or(oi.l,si.l,t);return this.setHSL(n,r,a),this}},{key:"setFromVector3",value:function(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}},{key:"applyMatrix3",value:function(e){var t=this.r,n=this.g,r=this.b,a=e.elements;return this.r=a[0]*t+a[3]*n+a[6]*r,this.g=a[1]*t+a[4]*n+a[7]*r,this.b=a[2]*t+a[5]*n+a[8]*r,this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:Symbol.iterator,value:u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.r;case 2:return e.next=4,this.g;case 4:return e.next=6,this.b;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(),ci=new li;li.NAMES=ii;var hi=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshBasicMaterial=!0,r.type="MeshBasicMaterial",r.color=new li(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=Me,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(ai),di=fi();function fi(){for(var e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),a=new Uint32Array(512),i=0;i<256;++i){var o=i-127;o<-27?(r[i]=0,r[256|i]=32768,a[i]=24,a[256|i]=24):o<-14?(r[i]=1024>>-o-14,r[256|i]=1024>>-o-14|32768,a[i]=-o-1,a[256|i]=-o-1):o<=15?(r[i]=o+15<<10,r[256|i]=o+15<<10|32768,a[i]=13,a[256|i]=13):o<128?(r[i]=31744,r[256|i]=64512,a[i]=24,a[256|i]=24):(r[i]=31744,r[256|i]=64512,a[i]=13,a[256|i]=13)}for(var s=new Uint32Array(2048),u=new Uint32Array(64),l=new Uint32Array(64),c=1;c<1024;++c){for(var h=c<<13,d=0;0===(8388608&h);)h<<=1,d-=8388608;h&=-8388609,d+=947912704,s[c]=h|d}for(var f=1024;f<2048;++f)s[f]=939524096+(f-1024<<13);for(var p=1;p<31;++p)u[p]=p<<23;u[31]=1199570944,u[32]=2147483648;for(var v=33;v<63;++v)u[v]=2147483648+(v-32<<23);u[63]=3347054592;for(var m=1;m<64;++m)32!==m&&(l[m]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:a,mantissaTable:s,exponentTable:u,offsetTable:l}}function pi(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=ar(e,-65504,65504),di.floatView[0]=e;var t=di.uint32View[0],n=t>>23&511;return di.baseTable[n]+((8388607&t)>>di.shiftTable[n])}function vi(e){var t=e>>10;return di.uint32View[0]=di.mantissaTable[di.offsetTable[t]+(1023&e)]+di.exponentTable[t],di.floatView[0]}var mi={toHalfFloat:pi,fromHalfFloat:vi},gi=new Gr,yi=new fr,bi=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(E(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=r,this.usage=Bn,this.updateRange={offset:0,count:-1},this.version=0}return M(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,a=this.itemSize;r<a;r++)this.array[e+r]=t.array[n+r];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)yi.fromBufferAttribute(this,t),yi.applyMatrix3(e),this.setXY(t,yi.x,yi.y);else if(3===this.itemSize)for(var r=0,a=this.count;r<a;r++)gi.fromBufferAttribute(this,r),gi.applyMatrix3(e),this.setXYZ(r,gi.x,gi.y,gi.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)gi.fromBufferAttribute(this,t),gi.applyMatrix4(e),this.setXYZ(t,gi.x,gi.y,gi.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)gi.fromBufferAttribute(this,t),gi.applyNormalMatrix(e),this.setXYZ(t,gi.x,gi.y,gi.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)gi.fromBufferAttribute(this,t),gi.transformDirection(e),this.setXYZ(t,gi.x,gi.y,gi.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){var t=this.array[e*this.itemSize];return this.normalized&&(t=cr(t,this.array)),t}},{key:"setX",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){var t=this.array[e*this.itemSize+1];return this.normalized&&(t=cr(t,this.array)),t}},{key:"setY",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){var t=this.array[e*this.itemSize+2];return this.normalized&&(t=cr(t,this.array)),t}},{key:"setZ",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){var t=this.array[e*this.itemSize+3];return this.normalized&&(t=cr(t,this.array)),t}},{key:"setW",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.normalized&&(t=hr(t,this.array),n=hr(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=hr(t,this.array),n=hr(n,this.array),r=hr(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,a){return e*=this.itemSize,this.normalized&&(t=hr(t,this.array),n=hr(n,this.array),r=hr(r,this.array),a=hr(a,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=a,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Bn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}},{key:"copyColorsArray",value:function(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}},{key:"copyVector2sArray",value:function(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}},{key:"copyVector3sArray",value:function(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}},{key:"copyVector4sArray",value:function(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}]),e}(),xi=function(e){C(n,e);var t=R(n);function n(e,r,a){return E(this,n),t.call(this,new Int8Array(e),r,a)}return M(n)}(bi),wi=function(e){C(n,e);var t=R(n);function n(e,r,a){return E(this,n),t.call(this,new Uint8Array(e),r,a)}return M(n)}(bi),ki=function(e){C(n,e);var t=R(n);function n(e,r,a){return E(this,n),t.call(this,new Uint8ClampedArray(e),r,a)}return M(n)}(bi),Si=function(e){C(n,e);var t=R(n);function n(e,r,a){return E(this,n),t.call(this,new Int16Array(e),r,a)}return M(n)}(bi),_i=function(e){C(n,e);var t=R(n);function n(e,r,a){return E(this,n),t.call(this,new Uint16Array(e),r,a)}return M(n)}(bi),Ei=function(e){C(n,e);var t=R(n);function n(e,r,a){return E(this,n),t.call(this,new Int32Array(e),r,a)}return M(n)}(bi),Ti=function(e){C(n,e);var t=R(n);function n(e,r,a){return E(this,n),t.call(this,new Uint32Array(e),r,a)}return M(n)}(bi),Mi=function(e){C(n,e);var t=R(n);function n(e,r,a){var i;return E(this,n),(i=t.call(this,new Uint16Array(e),r,a)).isFloat16BufferAttribute=!0,i}return M(n,[{key:"getX",value:function(e){var t=vi(this.array[e*this.itemSize]);return this.normalized&&(t=cr(t,this.array)),t}},{key:"setX",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize]=pi(t),this}},{key:"getY",value:function(e){var t=vi(this.array[e*this.itemSize+1]);return this.normalized&&(t=cr(t,this.array)),t}},{key:"setY",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize+1]=pi(t),this}},{key:"getZ",value:function(e){var t=vi(this.array[e*this.itemSize+2]);return this.normalized&&(t=cr(t,this.array)),t}},{key:"setZ",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize+2]=pi(t),this}},{key:"getW",value:function(e){var t=vi(this.array[e*this.itemSize+3]);return this.normalized&&(t=cr(t,this.array)),t}},{key:"setW",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize+3]=pi(t),this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.normalized&&(t=hr(t,this.array),n=hr(n,this.array)),this.array[e+0]=pi(t),this.array[e+1]=pi(n),this}},{key:"setXYZ",value:function(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=hr(t,this.array),n=hr(n,this.array),r=hr(r,this.array)),this.array[e+0]=pi(t),this.array[e+1]=pi(n),this.array[e+2]=pi(r),this}},{key:"setXYZW",value:function(e,t,n,r,a){return e*=this.itemSize,this.normalized&&(t=hr(t,this.array),n=hr(n,this.array),r=hr(r,this.array),a=hr(a,this.array)),this.array[e+0]=pi(t),this.array[e+1]=pi(n),this.array[e+2]=pi(r),this.array[e+3]=pi(a),this}}]),n}(bi),Ci=function(e){C(n,e);var t=R(n);function n(e,r,a){return E(this,n),t.call(this,new Float32Array(e),r,a)}return M(n)}(bi),Ii=function(e){C(n,e);var t=R(n);function n(e,r,a){return E(this,n),t.call(this,new Float64Array(e),r,a)}return M(n)}(bi),Ai=0,Ri=new ba,Ni=new Ha,Li=new Gr,Pi=new Xr,Di=new Xr,Fi=new Gr,Oi=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).isBufferGeometry=!0,Object.defineProperty(A(e),"id",{value:Ai++}),e.uuid=rr(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return M(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(mr(e)?Ti:_i)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new pr).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var a=this.attributes.tangent;return void 0!==a&&(a.transformDirection(e),a.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return Ri.makeRotationFromQuaternion(e),this.applyMatrix4(Ri),this}},{key:"rotateX",value:function(e){return Ri.makeRotationX(e),this.applyMatrix4(Ri),this}},{key:"rotateY",value:function(e){return Ri.makeRotationY(e),this.applyMatrix4(Ri),this}},{key:"rotateZ",value:function(e){return Ri.makeRotationZ(e),this.applyMatrix4(Ri),this}},{key:"translate",value:function(e,t,n){return Ri.makeTranslation(e,t,n),this.applyMatrix4(Ri),this}},{key:"scale",value:function(e,t,n){return Ri.makeScale(e,t,n),this.applyMatrix4(Ri),this}},{key:"lookAt",value:function(e){return Ni.lookAt(e),Ni.updateMatrix(),this.applyMatrix4(Ni.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Li).negate(),this.translate(Li.x,Li.y,Li.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Ci(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new Xr);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Gr(-1/0,-1/0,-1/0),new Gr(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var a=t[n];Pi.setFromBufferAttribute(a),this.morphTargetsRelative?(Fi.addVectors(this.boundingBox.min,Pi.min),this.boundingBox.expandByPoint(Fi),Fi.addVectors(this.boundingBox.max,Pi.max),this.boundingBox.expandByPoint(Fi)):(this.boundingBox.expandByPoint(Pi.min),this.boundingBox.expandByPoint(Pi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new ca);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Gr,1/0);if(e){var n=this.boundingSphere.center;if(Pi.setFromBufferAttribute(e),t)for(var r=0,a=t.length;r<a;r++){var i=t[r];Di.setFromBufferAttribute(i),this.morphTargetsRelative?(Fi.addVectors(Pi.min,Di.min),Pi.expandByPoint(Fi),Fi.addVectors(Pi.max,Di.max),Pi.expandByPoint(Fi)):(Pi.expandByPoint(Di.min),Pi.expandByPoint(Di.max))}Pi.getCenter(n);for(var o=0,s=0,u=e.count;s<u;s++)Fi.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(Fi));if(t)for(var l=0,c=t.length;l<c;l++)for(var h=t[l],d=this.morphTargetsRelative,f=0,p=h.count;f<p;f++)Fi.fromBufferAttribute(h,f),d&&(Li.fromBufferAttribute(e,f),Fi.add(Li)),o=Math.max(o,n.distanceToSquared(Fi));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,r=t.position.array,a=t.normal.array,i=t.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new bi(new Float32Array(4*o),4));for(var s=this.getAttribute("tangent").array,u=[],l=[],c=0;c<o;c++)u[c]=new Gr,l[c]=new Gr;var h=new Gr,d=new Gr,f=new Gr,p=new fr,v=new fr,m=new fr,g=new Gr,y=new Gr,b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(var x=0,w=b.length;x<w;++x)for(var k=b[x],S=k.start,_=S,E=S+k.count;_<E;_+=3)F(n[_+0],n[_+1],n[_+2]);for(var T=new Gr,M=new Gr,C=new Gr,I=new Gr,A=0,R=b.length;A<R;++A)for(var N=b[A],L=N.start,P=L,D=L+N.count;P<D;P+=3)O(n[P+0]),O(n[P+1]),O(n[P+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function F(e,t,n){h.fromArray(r,3*e),d.fromArray(r,3*t),f.fromArray(r,3*n),p.fromArray(i,2*e),v.fromArray(i,2*t),m.fromArray(i,2*n),d.sub(h),f.sub(h),v.sub(p),m.sub(p);var a=1/(v.x*m.y-m.x*v.y);isFinite(a)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(f,-v.y).multiplyScalar(a),y.copy(f).multiplyScalar(v.x).addScaledVector(d,-m.x).multiplyScalar(a),u[e].add(g),u[t].add(g),u[n].add(g),l[e].add(y),l[t].add(y),l[n].add(y))}function O(e){C.fromArray(a,3*e),I.copy(C);var t=u[e];T.copy(t),T.sub(C.multiplyScalar(C.dot(t))).normalize(),M.crossVectors(I,t);var n=M.dot(l[e])<0?-1:1;s[4*e]=T.x,s[4*e+1]=T.y,s[4*e+2]=T.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new bi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,a=n.count;r<a;r++)n.setXYZ(r,0,0,0);var i=new Gr,o=new Gr,s=new Gr,u=new Gr,l=new Gr,c=new Gr,h=new Gr,d=new Gr;if(e)for(var f=0,p=e.count;f<p;f+=3){var v=e.getX(f+0),m=e.getX(f+1),g=e.getX(f+2);i.fromBufferAttribute(t,v),o.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),h.subVectors(s,o),d.subVectors(i,o),h.cross(d),u.fromBufferAttribute(n,v),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,g),u.add(h),l.add(h),c.add(h),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var y=0,b=t.count;y<b;y+=3)i.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),h.subVectors(s,o),d.subVectors(i,o),h.cross(d),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)Fi.fromBufferAttribute(e,t),Fi.normalize(),e.setXYZ(t,Fi.x,Fi.y,Fi.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,r=e.itemSize,a=e.normalized,i=new n.constructor(t.length*r),o=0,s=0,u=0,l=t.length;u<l;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*r;for(var c=0;c<r;c++)i[s++]=n[o++]}return new bi(i,r,a)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,r=this.index.array,a=this.attributes;for(var i in a){var o=e(a[i],r);t.setAttribute(i,o)}var s=this.morphAttributes;for(var u in s){for(var l=[],c=s[u],h=0,d=c.length;h<d;h++){var f=e(c[h],r);l.push(f)}t.morphAttributes[u]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,v=0,m=p.length;v<m;v++){var g=p[v];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var a=this.attributes;for(var i in a){var o=a[i];e.data.attributes[i]=o.toJSON(e.data)}var s={},u=!1;for(var l in this.morphAttributes){for(var c=this.morphAttributes[l],h=[],d=0,f=c.length;d<f;d++){var p=c[d];h.push(p.toJSON(e.data))}h.length>0&&(s[l]=h,u=!0)}u&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));var m=this.boundingSphere;return null!==m&&(e.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var a in r){var i=r[a];this.setAttribute(a,i.clone(t))}var o=e.morphAttributes;for(var s in o){for(var u=[],l=o[s],c=0,h=l.length;c<h;c++)u.push(l[c].clone(t));this.morphAttributes[s]=u}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,f=0,p=d.length;f<p;f++){var v=d[f];this.addGroup(v.start,v.count,v.materialIndex)}var m=e.boundingBox;null!==m&&(this.boundingBox=m.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Qn),zi=new ba,Ui=new ya,Bi=new ca,Wi=new Gr,Vi=new Gr,Gi=new Gr,Hi=new Gr,ji=new Gr,Xi=new Gr,qi=new fr,Ki=new fr,Yi=new fr,Zi=new Gr,Ji=new Gr,Qi=new Gr,$i=new Gr,eo=new Gr,to=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oi,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hi;return E(this,n),(e=t.call(this)).isMesh=!0,e.type="Mesh",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return M(n,[{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=n.length;r<a;r++){var i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}},{key:"getVertexPosition",value:function(e,t){var n=this.geometry,r=n.attributes.position,a=n.morphAttributes.position,i=n.morphTargetsRelative;t.fromBufferAttribute(r,e);var o=this.morphTargetInfluences;if(a&&o){Xi.set(0,0,0);for(var s=0,u=a.length;s<u;s++){var l=o[s],c=a[s];0!==l&&(ji.fromBufferAttribute(c,e),i?Xi.addScaledVector(ji,l):Xi.addScaledVector(ji.sub(t),l))}t.add(Xi)}return t}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Bi.copy(n.boundingSphere),Bi.applyMatrix4(a),Ui.copy(e.ray).recast(e.near),!1===Bi.containsPoint(Ui.origin)){if(null===Ui.intersectSphere(Bi,Wi))return;if(Ui.origin.distanceToSquared(Wi)>Math.pow(e.far-e.near,2))return}zi.copy(a).invert(),Ui.copy(e.ray).applyMatrix4(zi),null!==n.boundingBox&&!1===Ui.intersectsBox(n.boundingBox)||this._computeIntersections(e,t)}}},{key:"_computeIntersections",value:function(e,t){var n,r=this.geometry,a=this.material,i=r.index,o=r.attributes.position,s=r.attributes.uv,u=r.attributes.uv1,l=r.attributes.normal,c=r.groups,h=r.drawRange;if(null!==i)if(Array.isArray(a))for(var d=0,f=c.length;d<f;d++)for(var p=c[d],v=a[p.materialIndex],m=Math.max(p.start,h.start),g=Math.min(i.count,Math.min(p.start+p.count,h.start+h.count));m<g;m+=3){var y=i.getX(m),b=i.getX(m+1),x=i.getX(m+2);(n=no(this,v,e,Ui,s,u,l,y,b,x))&&(n.faceIndex=Math.floor(m/3),n.face.materialIndex=p.materialIndex,t.push(n))}else for(var w=Math.max(0,h.start),k=Math.min(i.count,h.start+h.count);w<k;w+=3){var S=i.getX(w),_=i.getX(w+1),E=i.getX(w+2);(n=no(this,a,e,Ui,s,u,l,S,_,E))&&(n.faceIndex=Math.floor(w/3),t.push(n))}else if(void 0!==o)if(Array.isArray(a))for(var T=0,M=c.length;T<M;T++)for(var C=c[T],I=a[C.materialIndex],A=Math.max(C.start,h.start),R=Math.min(o.count,Math.min(C.start+C.count,h.start+h.count));A<R;A+=3){(n=no(this,I,e,Ui,s,u,l,A,A+1,A+2))&&(n.faceIndex=Math.floor(A/3),n.face.materialIndex=C.materialIndex,t.push(n))}else for(var N=Math.max(0,h.start),L=Math.min(o.count,h.start+h.count);N<L;N+=3){(n=no(this,a,e,Ui,s,u,l,N,N+1,N+2))&&(n.faceIndex=Math.floor(N/3),t.push(n))}}}]),n}(Ha);function no(e,t,n,r,a,i,o,s,u,l){e.getVertexPosition(s,Vi),e.getVertexPosition(u,Gi),e.getVertexPosition(l,Hi);var c=function(e,t,n,r,a,i,o,s){if(null===(t.side===K?r.intersectTriangle(o,i,a,!0,s):r.intersectTriangle(a,i,o,t.side===q,s)))return null;eo.copy(s),eo.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(eo);return u<n.near||u>n.far?null:{distance:u,point:eo.clone(),object:e}}(e,t,n,r,Vi,Gi,Hi,$i);if(c){a&&(qi.fromBufferAttribute(a,s),Ki.fromBufferAttribute(a,u),Yi.fromBufferAttribute(a,l),c.uv=ni.getInterpolation($i,Vi,Gi,Hi,qi,Ki,Yi,new fr)),i&&(qi.fromBufferAttribute(i,s),Ki.fromBufferAttribute(i,u),Yi.fromBufferAttribute(i,l),c.uv1=ni.getInterpolation($i,Vi,Gi,Hi,qi,Ki,Yi,new fr),c.uv2=c.uv1),o&&(Zi.fromBufferAttribute(o,s),Ji.fromBufferAttribute(o,u),Qi.fromBufferAttribute(o,l),c.normal=ni.getInterpolation($i,Vi,Gi,Hi,Zi,Ji,Qi,new Gr),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));var h={a:s,b:u,c:l,normal:new Gr,materialIndex:0};ni.getNormal(Vi,Gi,Hi,h.normal),c.face=h}return c}var ro=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;E(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:r,height:a,depth:i,widthSegments:o,heightSegments:s,depthSegments:u};var l=A(e);o=Math.floor(o),s=Math.floor(s),u=Math.floor(u);var c=[],h=[],d=[],f=[],p=0,v=0;function m(e,t,n,r,a,i,o,s,u,m,g){for(var y=i/u,b=o/m,x=i/2,w=o/2,k=s/2,S=u+1,_=m+1,E=0,T=0,M=new Gr,C=0;C<_;C++)for(var I=C*b-w,A=0;A<S;A++){var R=A*y-x;M[e]=R*r,M[t]=I*a,M[n]=k,h.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=s>0?1:-1,d.push(M.x,M.y,M.z),f.push(A/u),f.push(1-C/m),E+=1}for(var N=0;N<m;N++)for(var L=0;L<u;L++){var P=p+L+S*N,D=p+L+S*(N+1),F=p+(L+1)+S*(N+1),O=p+(L+1)+S*N;c.push(P,D,O),c.push(D,F,O),T+=6}l.addGroup(v,T,g),v+=T,p+=E}return m("z","y","x",-1,-1,i,a,r,u,s,0),m("z","y","x",1,-1,i,a,-r,u,s,1),m("x","z","y",1,1,r,i,a,o,u,2),m("x","z","y",1,-1,r,i,-a,o,u,3),m("x","y","z",1,-1,r,a,i,o,s,4),m("x","y","z",-1,-1,r,a,-i,o,s,5),e.setIndex(c),e.setAttribute("position",new Ci(h,3)),e.setAttribute("normal",new Ci(d,3)),e.setAttribute("uv",new Ci(f,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(Oi);function ao(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var a=e[n][r];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?a.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=a.clone():Array.isArray(a)?t[n][r]=a.slice():t[n][r]=a}return t}function io(e){for(var t={},n=0;n<e.length;n++){var r=ao(e[n]);for(var a in r)t[a]=r[a]}return t}function oo(e){return null===e.getRenderTarget()?e.outputColorSpace:kn}var so={clone:ao,merge:io},uo=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isShaderMaterial=!0,r.type="ShaderMaterial",r.defines={},r.uniforms={},r.uniformsGroups=[],r.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",r.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",r.linewidth=1,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.lights=!1,r.clipping=!1,r.forceSinglePass=!0,r.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},r.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},r.index0AttributeName=void 0,r.uniformsNeedUpdate=!1,r.glslVersion=null,void 0!==e&&r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ao(e.uniforms),this.uniformsGroups=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=D(I(n.prototype),"toJSON",this).call(this,e);for(var r in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}]),n}(ai),lo=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).isCamera=!0,e.type="Camera",e.matrixWorldInverse=new ba,e.projectionMatrix=new ba,e.projectionMatrixInverse=new ba,e}return M(n,[{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){D(I(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){D(I(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(Ha),co=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return E(this,n),(e=t.call(this)).isPerspectiveCamera=!0,e.type="PerspectiveCamera",e.fov=r,e.zoom=1,e.near=i,e.far=o,e.focus=10,e.aspect=a,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return M(n,[{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*nr*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*tr*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*nr*Math.atan(Math.tan(.5*tr*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,r,a,i){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*tr*this.fov)/this.zoom,n=2*t,r=this.aspect*n,a=-.5*r,i=this.view;if(null!==this.view&&this.view.enabled){var o=i.fullWidth,s=i.fullHeight;a+=i.offsetX*r/o,t-=i.offsetY*n/s,r*=i.width/o,n*=i.height/s}var u=this.filmOffset;0!==u&&(a+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=D(I(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(lo),ho=-90,fo=function(e){C(n,e);var t=R(n);function n(e,r,a){var i;E(this,n),(i=t.call(this)).type="CubeCamera",i.renderTarget=a;var o=new co(ho,1,e,r);o.layers=i.layers,o.up.set(0,1,0),o.lookAt(1,0,0),i.add(o);var s=new co(ho,1,e,r);s.layers=i.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),i.add(s);var u=new co(ho,1,e,r);u.layers=i.layers,u.up.set(0,0,-1),u.lookAt(0,1,0),i.add(u);var l=new co(ho,1,e,r);l.layers=i.layers,l.up.set(0,0,1),l.lookAt(0,-1,0),i.add(l);var c=new co(ho,1,e,r);c.layers=i.layers,c.up.set(0,1,0),c.lookAt(0,0,1),i.add(c);var h=new co(ho,1,e,r);return h.layers=i.layers,h.up.set(0,1,0),h.lookAt(0,0,-1),i.add(h),i}return M(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=x(this.children,6),a=r[0],i=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=e.getRenderTarget(),h=e.toneMapping,d=e.xr.enabled;e.toneMapping=Ae,e.xr.enabled=!1;var f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,a),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,u),n.texture.generateMipmaps=f,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=h,e.xr.enabled=d,n.texture.needsPMREMUpdate=!0}}]),n}(Ha),po=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s,u,l,c,h){var d;return E(this,n),e=void 0!==e?e:[],r=void 0!==r?r:Oe,(d=t.call(this,e,r,a,i,o,s,u,l,c,h)).isCubeTexture=!0,d.flipY=!1,d}return M(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(Pr),vo=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};E(this,n),(e=t.call(this,r,r,a)).isWebGLCubeRenderTarget=!0;var i={width:r,height:r,depth:1},o=[i,i,i,i,i,i];return void 0!==a.encoding&&(wr("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),a.colorSpace=a.encoding===vn?wn:xn),e.texture=new po(o,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.colorSpace),e.texture.isRenderTargetTexture=!0,e.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,e.texture.minFilter=void 0!==a.minFilter?a.minFilter:Ze,e}return M(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",a="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new ro(5,5,5),o=new uo({name:"CubemapFromEquirect",uniforms:ao(n),vertexShader:r,fragmentShader:a,side:K,blending:J});o.uniforms.tEquirect.value=t;var s=new to(i,o),u=t.minFilter;return t.minFilter===$e&&(t.minFilter=Ze),new fo(1,10,this).update(e,s),t.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,r){for(var a=e.getRenderTarget(),i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(a)}}]),n}(Fr),mo=new Gr,go=new Gr,yo=new pr,bo=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;E(this,e),this.isPlane=!0,this.normal=t,this.constant=n}return M(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=mo.subVectors(n,t).cross(go.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}},{key:"intersectLine",value:function(e,t){var n=e.delta(mo),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:t.copy(e.start).addScaledVector(n,a)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||yo.getNormalMatrix(e),r=this.coplanarPoint(mo).applyMatrix4(e),a=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(a),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),xo=new ca,wo=new Gr,ko=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bo,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bo,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new bo,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new bo,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new bo,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new bo;E(this,e),this.planes=[t,n,r,a,i,o]}return M(e,[{key:"set",value:function(e,t,n,r,a,i){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(a),o[5].copy(i),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],d=n[9],f=n[10],p=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,c-s,p-h,y-v).normalize(),t[1].setComponents(o+r,c+s,p+h,y+v).normalize(),t[2].setComponents(o+a,c+u,p+d,y+m).normalize(),t[3].setComponents(o-a,c-u,p-d,y-m).normalize(),t[4].setComponents(o-i,c-l,p-f,y-g).normalize(),t[5].setComponents(o+i,c+l,p+f,y+g).normalize(),this}},{key:"intersectsObject",value:function(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),xo.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{var t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),xo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(xo)}},{key:"intersectsSprite",value:function(e){return xo.center.set(0,0,0),xo.radius=.7071067811865476,xo.applyMatrix4(e.matrixWorld),this.intersectsSphere(xo)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,a=0;a<6;a++){if(t[a].distanceToPoint(n)<r)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(wo.x=r.normal.x>0?e.max.x:e.min.x,wo.y=r.normal.y>0?e.max.y:e.min.y,wo.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(wo)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function So(){var e=null,t=!1,n=null,r=null;function a(t,i){n(t,i),r=e.requestAnimationFrame(a)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(a),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function _o(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,a){if(t.isGLBufferAttribute){var i=r.get(t);(!i||i.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,r){var a,i=t.array,o=t.usage,s=e.createBuffer();if(e.bindBuffer(r,s),e.bufferData(r,i,o),t.onUploadCallback(),i instanceof Float32Array)a=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=e.HALF_FLOAT}else a=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)a=e.SHORT;else if(i instanceof Uint32Array)a=e.UNSIGNED_INT;else if(i instanceof Int32Array)a=e.INT;else if(i instanceof Int8Array)a=e.BYTE;else if(i instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);a=e.UNSIGNED_BYTE}return{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,a)):o.version<t.version&&(!function(t,r,a){var i=r.array,o=r.updateRange;e.bindBuffer(a,t),-1===o.count?e.bufferSubData(a,0,i):(n?e.bufferSubData(a,o.offset*i.BYTES_PER_ELEMENT,i,o.offset,o.count):e.bufferSubData(a,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1),r.onUploadCallback()}(o.buffer,t,a),o.version=t.version)}}}}var Eo=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;E(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:r,height:a,widthSegments:i,heightSegments:o};for(var s=r/2,u=a/2,l=Math.floor(i),c=Math.floor(o),h=l+1,d=c+1,f=r/l,p=a/c,v=[],m=[],g=[],y=[],b=0;b<d;b++)for(var x=b*p-u,w=0;w<h;w++){var k=w*f-s;m.push(k,-x,0),g.push(0,0,1),y.push(w/l),y.push(1-b/c)}for(var S=0;S<c;S++)for(var _=0;_<l;_++){var T=_+h*S,M=_+h*(S+1),C=_+1+h*(S+1),I=_+1+h*S;v.push(T,M,I),v.push(M,C,I)}return e.setIndex(v),e.setAttribute("position",new Ci(m,3)),e.setAttribute("normal",new Ci(g,3)),e.setAttribute("uv",new Ci(y,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(Oi),To={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_NORMALMAP_TANGENTSPACE\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Mo={common:{diffuse:{value:new li(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new pr},alphaMap:{value:null},alphaMapTransform:{value:new pr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new pr}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new pr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new pr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new pr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new pr},normalScale:{value:new fr(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new pr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new pr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new pr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new pr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new li(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new li(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new pr}},sprite:{diffuse:{value:new li(16777215)},opacity:{value:1},center:{value:new fr(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new pr},alphaMap:{value:null},alphaTest:{value:0}}},Co={basic:{uniforms:io([Mo.common,Mo.specularmap,Mo.envmap,Mo.aomap,Mo.lightmap,Mo.fog]),vertexShader:To.meshbasic_vert,fragmentShader:To.meshbasic_frag},lambert:{uniforms:io([Mo.common,Mo.specularmap,Mo.envmap,Mo.aomap,Mo.lightmap,Mo.emissivemap,Mo.bumpmap,Mo.normalmap,Mo.displacementmap,Mo.fog,Mo.lights,{emissive:{value:new li(0)}}]),vertexShader:To.meshlambert_vert,fragmentShader:To.meshlambert_frag},phong:{uniforms:io([Mo.common,Mo.specularmap,Mo.envmap,Mo.aomap,Mo.lightmap,Mo.emissivemap,Mo.bumpmap,Mo.normalmap,Mo.displacementmap,Mo.fog,Mo.lights,{emissive:{value:new li(0)},specular:{value:new li(1118481)},shininess:{value:30}}]),vertexShader:To.meshphong_vert,fragmentShader:To.meshphong_frag},standard:{uniforms:io([Mo.common,Mo.envmap,Mo.aomap,Mo.lightmap,Mo.emissivemap,Mo.bumpmap,Mo.normalmap,Mo.displacementmap,Mo.roughnessmap,Mo.metalnessmap,Mo.fog,Mo.lights,{emissive:{value:new li(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:To.meshphysical_vert,fragmentShader:To.meshphysical_frag},toon:{uniforms:io([Mo.common,Mo.aomap,Mo.lightmap,Mo.emissivemap,Mo.bumpmap,Mo.normalmap,Mo.displacementmap,Mo.gradientmap,Mo.fog,Mo.lights,{emissive:{value:new li(0)}}]),vertexShader:To.meshtoon_vert,fragmentShader:To.meshtoon_frag},matcap:{uniforms:io([Mo.common,Mo.bumpmap,Mo.normalmap,Mo.displacementmap,Mo.fog,{matcap:{value:null}}]),vertexShader:To.meshmatcap_vert,fragmentShader:To.meshmatcap_frag},points:{uniforms:io([Mo.points,Mo.fog]),vertexShader:To.points_vert,fragmentShader:To.points_frag},dashed:{uniforms:io([Mo.common,Mo.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:To.linedashed_vert,fragmentShader:To.linedashed_frag},depth:{uniforms:io([Mo.common,Mo.displacementmap]),vertexShader:To.depth_vert,fragmentShader:To.depth_frag},normal:{uniforms:io([Mo.common,Mo.bumpmap,Mo.normalmap,Mo.displacementmap,{opacity:{value:1}}]),vertexShader:To.meshnormal_vert,fragmentShader:To.meshnormal_frag},sprite:{uniforms:io([Mo.sprite,Mo.fog]),vertexShader:To.sprite_vert,fragmentShader:To.sprite_frag},background:{uniforms:{uvTransform:{value:new pr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:To.background_vert,fragmentShader:To.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:To.backgroundCube_vert,fragmentShader:To.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:To.cube_vert,fragmentShader:To.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:To.equirect_vert,fragmentShader:To.equirect_frag},distanceRGBA:{uniforms:io([Mo.common,Mo.displacementmap,{referencePosition:{value:new Gr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:To.distanceRGBA_vert,fragmentShader:To.distanceRGBA_frag},shadow:{uniforms:io([Mo.lights,Mo.fog,{color:{value:new li(0)},opacity:{value:1}}]),vertexShader:To.shadow_vert,fragmentShader:To.shadow_frag}};Co.physical={uniforms:io([Co.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new pr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new pr},clearcoatNormalScale:{value:new fr(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new pr},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new pr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new pr},sheen:{value:0},sheenColor:{value:new li(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new pr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new pr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new pr},transmissionSamplerSize:{value:new fr},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new pr},attenuationDistance:{value:0},attenuationColor:{value:new li(0)},specularColor:{value:new li(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new pr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new pr}}]),vertexShader:To.meshphysical_vert,fragmentShader:To.meshphysical_frag};var Io={r:0,b:0,g:0};function Ao(e,t,n,r,a,i,o){var s,u,l=new li(0),c=!0===i?0:1,h=null,d=0,f=null;function p(t,n){t.getRGB(Io,oo(e)),r.buffers.color.setClear(Io.r,Io.g,Io.b,n,o)}return{getClearColor:function(){return l},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;l.set(e),p(l,c=t)},getClearAlpha:function(){return c},setClearAlpha:function(e){p(l,c=e)},render:function(i,v){var m=!1,g=!0===v.isScene?v.background:null;switch(g&&g.isTexture&&(g=(v.backgroundBlurriness>0?n:t).get(g)),null===g?p(l,c):g&&g.isColor&&(p(g,1),m=!0),e.xr.getEnvironmentBlendMode()){case"opaque":m=!0;break;case"additive":r.buffers.color.setClear(0,0,0,1,o),m=!0;break;case"alpha-blend":r.buffers.color.setClear(0,0,0,0,o),m=!0}(e.autoClear||m)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===We)?(void 0===u&&((u=new to(new ro(1,1,1),new uo({name:"BackgroundCubeMaterial",uniforms:ao(Co.backgroundCube.uniforms),vertexShader:Co.backgroundCube.vertexShader,fragmentShader:Co.backgroundCube.fragmentShader,side:K,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(u)),u.material.uniforms.envMap.value=g,u.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,u.material.toneMapped=g.colorSpace!==wn,h===g&&d===g.version&&f===e.toneMapping||(u.material.needsUpdate=!0,h=g,d=g.version,f=e.toneMapping),u.layers.enableAll(),i.unshift(u,u.geometry,u.material,0,0,null)):g&&g.isTexture&&(void 0===s&&((s=new to(new Eo(2,2),new uo({name:"BackgroundMaterial",uniforms:ao(Co.background.uniforms),vertexShader:Co.background.vertexShader,fragmentShader:Co.background.fragmentShader,side:q,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(s)),s.material.uniforms.t2D.value=g,s.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,s.material.toneMapped=g.colorSpace!==wn,!0===g.matrixAutoUpdate&&g.updateMatrix(),s.material.uniforms.uvTransform.value.copy(g.matrix),h===g&&d===g.version&&f===e.toneMapping||(s.material.needsUpdate=!0,h=g,d=g.version,f=e.toneMapping),s.layers.enableAll(),i.unshift(s,s.geometry,s.material,0,0,null))}}}function Ro(e,t,n,r){var a=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==i,s={},u=f(null),l=u,c=!1;function h(t){return r.isWebGL2?e.bindVertexArray(t):i.bindVertexArrayOES(t)}function d(t){return r.isWebGL2?e.deleteVertexArray(t):i.deleteVertexArrayOES(t)}function f(e){for(var t=[],n=[],r=[],i=0;i<a;i++)t[i]=0,n[i]=0,r[i]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){for(var e=l.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function v(e){m(e,0)}function m(n,a){var i=l.newAttributes,o=l.enabledAttributes,s=l.attributeDivisors;(i[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==a)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,a),s[n]=a)}function g(){for(var t=l.newAttributes,n=l.enabledAttributes,r=0,a=n.length;r<a;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function y(t,n,a,i,o,s){!0!==r.isWebGL2||a!==e.INT&&a!==e.UNSIGNED_INT?e.vertexAttribPointer(t,n,a,i,o,s):e.vertexAttribIPointer(t,n,a,o,s)}function b(){x(),c=!0,l!==u&&h((l=u).object)}function x(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(a,u,d,b,x){var w=!1;if(o){var k=function(t,n,a){var o=!0===a.wireframe,u=s[t.id];void 0===u&&(u={},s[t.id]=u);var l=u[n.id];void 0===l&&(l={},u[n.id]=l);var c=l[o];void 0===c&&(c=f(r.isWebGL2?e.createVertexArray():i.createVertexArrayOES()),l[o]=c);return c}(b,d,u);l!==k&&h((l=k).object),w=function(e,t,n,r){var a=l.attributes,i=t.attributes,o=0,s=n.getAttributes();for(var u in s){if(s[u].location>=0){var c=a[u],h=i[u];if(void 0===h&&("instanceMatrix"===u&&e.instanceMatrix&&(h=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(h=e.instanceColor)),void 0===c)return!0;if(c.attribute!==h)return!0;if(h&&c.data!==h.data)return!0;o++}}return l.attributesNum!==o||l.index!==r}(a,b,d,x),w&&function(e,t,n,r){var a={},i=t.attributes,o=0,s=n.getAttributes();for(var u in s){if(s[u].location>=0){var c=i[u];void 0===c&&("instanceMatrix"===u&&e.instanceMatrix&&(c=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(c=e.instanceColor));var h={};h.attribute=c,c&&c.data&&(h.data=c.data),a[u]=h,o++}}l.attributes=a,l.attributesNum=o,l.index=r}(a,b,d,x)}else{var S=!0===u.wireframe;l.geometry===b.id&&l.program===d.id&&l.wireframe===S||(l.geometry=b.id,l.program=d.id,l.wireframe=S,w=!0)}null!==x&&n.update(x,e.ELEMENT_ARRAY_BUFFER),(w||c)&&(c=!1,function(a,i,o,s){if(!1===r.isWebGL2&&(a.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();var u=s.attributes,l=o.getAttributes(),c=i.defaultAttributeValues;for(var h in l){var d=l[h];if(d.location>=0){var f=u[h];if(void 0===f&&("instanceMatrix"===h&&a.instanceMatrix&&(f=a.instanceMatrix),"instanceColor"===h&&a.instanceColor&&(f=a.instanceColor)),void 0!==f){var b=f.normalized,x=f.itemSize,w=n.get(f);if(void 0===w)continue;var k=w.buffer,S=w.type,_=w.bytesPerElement;if(f.isInterleavedBufferAttribute){var E=f.data,T=E.stride,M=f.offset;if(E.isInstancedInterleavedBuffer){for(var C=0;C<d.locationSize;C++)m(d.location+C,E.meshPerAttribute);!0!==a.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=E.meshPerAttribute*E.count)}else for(var I=0;I<d.locationSize;I++)v(d.location+I);e.bindBuffer(e.ARRAY_BUFFER,k);for(var A=0;A<d.locationSize;A++)y(d.location+A,x/d.locationSize,S,b,T*_,(M+x/d.locationSize*A)*_)}else{if(f.isInstancedBufferAttribute){for(var R=0;R<d.locationSize;R++)m(d.location+R,f.meshPerAttribute);!0!==a.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=f.meshPerAttribute*f.count)}else for(var N=0;N<d.locationSize;N++)v(d.location+N);e.bindBuffer(e.ARRAY_BUFFER,k);for(var L=0;L<d.locationSize;L++)y(d.location+L,x/d.locationSize,S,b,x*_,x/d.locationSize*L*_)}}else if(void 0!==c){var P=c[h];if(void 0!==P)switch(P.length){case 2:e.vertexAttrib2fv(d.location,P);break;case 3:e.vertexAttrib3fv(d.location,P);break;case 4:e.vertexAttrib4fv(d.location,P);break;default:e.vertexAttrib1fv(d.location,P)}}}}g()}(a,u,d,b),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(x).buffer))},reset:b,resetDefaultState:x,dispose:function(){for(var e in b(),s){var t=s[e];for(var n in t){var r=t[n];for(var a in r)d(r[a].object),delete r[a];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var a in r)d(r[a].object),delete r[a];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var a in r)d(r[a].object),delete r[a];delete n[e.id]}}},initAttributes:p,enableAttribute:v,disableUnusedAttributes:g}}function No(e,t,n,r){var a,i=r.isWebGL2;this.setMode=function(e){a=e},this.render=function(t,r){e.drawArrays(a,t,r),n.update(r,a,1)},this.renderInstances=function(r,o,s){if(0!==s){var u,l;if(i)u=e,l="drawArraysInstanced";else if(l="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](a,r,o,s),n.update(o,a,s)}}}function Lo(e,t,n){var r;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var i="undefined"!==typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name,o=void 0!==n.precision?n.precision:"highp",s=a(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=i||t.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),v=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),m=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=h>0,b=i||t.has("OES_texture_float");return{isWebGL2:i,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:a,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:i?e.getParameter(e.MAX_SAMPLES):0}}function Po(e){var t=this,n=null,r=0,a=!1,i=!1,o=new bo,s=new pr,u={value:null,needsUpdate:!1};function l(e,n,r,a){var i=null!==e?e.length:0,l=null;if(0!==i){if(l=u.value,!0!==a||null===l){var c=r+4*i,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===l||l.length<c)&&(l=new Float32Array(c));for(var d=0,f=r;d!==i;++d,f+=4)o.copy(e[d]).applyMatrix4(h,s),o.normal.toArray(l,f),l[f+3]=o.constant}u.value=l,u.needsUpdate=!0}return t.numPlanes=i,t.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){var n=0!==e.length||t||0!==r||a;return a=t,r=e.length,n},this.beginShadows=function(){i=!0,l(null)},this.endShadows=function(){i=!1},this.setGlobalState=function(e,t){n=l(e,t,0)},this.setState=function(o,s,c){var h=o.clippingPlanes,d=o.clipIntersection,f=o.clipShadows,p=e.get(o);if(!a||null===h||0===h.length||i&&!f)i?l(null):function(){u.value!==n&&(u.value=n,u.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{var v=i?0:r,m=4*v,g=p.clippingState||null;u.value=g,g=l(h,s,m,c);for(var y=0;y!==m;++y)g[y]=n[y];p.clippingState=g,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=v}}}function Do(e){var t=new WeakMap;function n(e,t){return t===Ue?e.mapping=Oe:t===Be&&(e.mapping=ze),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture&&!1===a.isRenderTargetTexture){var i=a.mapping;if(i===Ue||i===Be){if(t.has(a))return n(t.get(a).texture,a.mapping);var o=a.image;if(o&&o.height>0){var s=new vo(o.height/2);return s.fromEquirectangularTexture(e,a),t.set(a,s),a.addEventListener("dispose",r),n(s.texture,a.mapping)}return null}}return a},dispose:function(){t=new WeakMap}}}var Fo=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return E(this,n),(e=t.call(this)).isOrthographicCamera=!0,e.type="OrthographicCamera",e.zoom=1,e.view=null,e.left=r,e.right=a,e.top=i,e.bottom=o,e.near=s,e.far=u,e.updateProjectionMatrix(),e}return M(n,[{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,r,a,i){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,a=n-e,i=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i=(a+=u*this.view.offsetX)+u*this.view.width,s=(o-=l*this.view.offsetY)-l*this.view.height}this.projectionMatrix.makeOrthographic(a,i,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=D(I(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(lo),Oo=[.125,.215,.35,.446,.526,.582],zo=20,Uo=new Fo,Bo=new li,Wo=null,Vo=(1+Math.sqrt(5))/2,Go=1/Vo,Ho=[new Gr(1,1,1),new Gr(-1,1,1),new Gr(1,1,-1),new Gr(-1,1,-1),new Gr(0,Vo,Go),new Gr(0,Vo,-Go),new Gr(Go,0,Vo),new Gr(-Go,0,Vo),new Gr(Vo,Go,0),new Gr(-Vo,Go,0)],jo=function(){function e(t){E(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return M(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Wo=this._renderer.getRenderTarget(),this._setSize(256);var a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,n,r,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=Yo(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=Ko(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(Wo),e.scissorTest=!1,qo(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){e.mapping===Oe||e.mapping===ze?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Wo=this._renderer.getRenderTarget();var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Ze,minFilter:Ze,generateMipmaps:!1,type:ut,format:ft,colorSpace:kn,depthBuffer:!1},r=Xo(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Xo(e,t,n);var a=this._lodMax,i=function(e){for(var t=[],n=[],r=[],a=e,i=e-4+1+Oo.length,o=0;o<i;o++){var s=Math.pow(2,a);n.push(s);var u=1/s;o>e-4?u=Oo[o-e+4-1]:0===o&&(u=0),r.push(u);for(var l=1/(s-2),c=-l,h=1+l,d=[c,c,h,c,h,h,c,c,h,h,c,h],f=6,p=6,v=3,m=2,g=1,y=new Float32Array(v*p*f),b=new Float32Array(m*p*f),x=new Float32Array(g*p*f),w=0;w<f;w++){var k=w%3*2/3-1,S=w>2?0:-1,_=[k,S,0,k+2/3,S,0,k+2/3,S+1,0,k,S,0,k+2/3,S+1,0,k,S+1,0];y.set(_,v*p*w),b.set(d,m*p*w);var E=[w,w,w,w,w,w];x.set(E,g*p*w)}var T=new Oi;T.setAttribute("position",new bi(y,v)),T.setAttribute("uv",new bi(b,m)),T.setAttribute("faceIndex",new bi(x,g)),t.push(T),a>4&&a--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(a);this._sizeLods=i.sizeLods,this._lodPlanes=i.lodPlanes,this._sigmas=i.sigmas,this._blurMaterial=function(e,t,n){var r=new Float32Array(zo),a=new Gr(0,1,0),i=new uo({name:"SphericalGaussianBlur",defines:{n:zo,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:J,depthTest:!1,depthWrite:!1});return i}(a,e,t)}return r}},{key:"_compileMaterial",value:function(e){var t=new to(this._lodPlanes[0],e);this._renderer.compile(t,Uo)}},{key:"_sceneToCubeUV",value:function(e,t,n,r){var a=new co(90,1,t,n),i=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,l=s.toneMapping;s.getClearColor(Bo),s.toneMapping=Ae,s.autoClear=!1;var c=new hi({name:"PMREM.Background",side:K,depthWrite:!1,depthTest:!1}),h=new to(new ro,c),d=!1,f=e.background;f?f.isColor&&(c.color.copy(f),e.background=null,d=!0):(c.color.copy(Bo),d=!0);for(var p=0;p<6;p++){var v=p%3;0===v?(a.up.set(0,i[p],0),a.lookAt(o[p],0,0)):1===v?(a.up.set(0,0,i[p]),a.lookAt(0,o[p],0)):(a.up.set(0,i[p],0),a.lookAt(0,0,o[p]));var m=this._cubeSize;qo(r,v*m,p>2?m:0,m,m),s.setRenderTarget(r),d&&s.render(h,a),s.render(e,a)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=l,s.autoClear=u,e.background=f}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,r=e.mapping===Oe||e.mapping===ze;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Yo()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ko());var a=r?this._cubemapMaterial:this._equirectMaterial,i=new to(this._lodPlanes[0],a);a.uniforms.envMap.value=e;var o=this._cubeSize;qo(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(i,Uo)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var r=1;r<this._lodPlanes.length;r++){var a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),i=Ho[(r-1)%Ho.length];this._blur(e,r-1,r,a,i)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,r,a){var i=this._pingPongRenderTarget;this._halfBlur(e,i,t,n,r,"latitudinal",a),this._halfBlur(i,e,n,n,r,"longitudinal",a)}},{key:"_halfBlur",value:function(e,t,n,r,a,i,o){var s=this._renderer,u=this._blurMaterial;"latitudinal"!==i&&"longitudinal"!==i&&console.error("blur direction must be either latitudinal or longitudinal!");var l=new to(this._lodPlanes[r],u),c=u.uniforms,h=this._sizeLods[n]-1,d=isFinite(a)?Math.PI/(2*h):2*Math.PI/39,f=a/d,p=isFinite(a)?1+Math.floor(3*f):zo;p>zo&&console.warn("sigmaRadians, ".concat(a,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(zo));for(var v=[],m=0,g=0;g<zo;++g){var y=g/f,b=Math.exp(-y*y/2);v.push(b),0===g?m+=b:g<p&&(m+=2*b)}for(var x=0;x<v.length;x++)v[x]=v[x]/m;c.envMap.value=e.texture,c.samples.value=p,c.weights.value=v,c.latitudinal.value="latitudinal"===i,o&&(c.poleAxis.value=o);var w=this._lodMax;c.dTheta.value=d,c.mipInt.value=w-n;var k=this._sizeLods[r];qo(t,3*k*(r>w-4?r-w+4:0),4*(this._cubeSize-k),3*k,2*k),s.setRenderTarget(t),s.render(l,Uo)}}]),e}();function Xo(e,t,n){var r=new Fr(e,t,n);return r.texture.mapping=We,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function qo(e,t,n,r,a){e.viewport.set(t,n,r,a),e.scissor.set(t,n,r,a)}function Ko(){return new uo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:J,depthTest:!1,depthWrite:!1})}function Yo(){return new uo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:J,depthTest:!1,depthWrite:!1})}function Zo(e){var t=new WeakMap,n=null;function r(e){var n=e.target;n.removeEventListener("dispose",r);var a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture){var i=a.mapping,o=i===Ue||i===Be,s=i===Oe||i===ze;if(o||s){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;var u=t.get(a);return null===n&&(n=new jo(e)),u=o?n.fromEquirectangular(a,u):n.fromCubemap(a,u),t.set(a,u),u.texture}if(t.has(a))return t.get(a).texture;var l=a.image;if(o&&l&&l.height>0||s&&l&&function(e){for(var t=0,n=6,r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(l)){null===n&&(n=new jo(e));var c=o?n.fromEquirectangular(a):n.fromCubemap(a);return t.set(a,c),a.addEventListener("dispose",r),c.texture}return null}}return a},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Jo(e){var t={};function n(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Qo(e,t,n,r){var a={},i=new WeakMap;function o(e){var s=e.target;for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);s.removeEventListener("dispose",o),delete a[s.id];var l=i.get(s);l&&(t.remove(l),i.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,a=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var u=0,l=s.length;u<l;u+=3){var c=s[u+0],h=s[u+1],d=s[u+2];n.push(c,h,h,d,d,c)}}else{var f=a.array;o=a.version;for(var p=0,v=f.length/3-1;p<v;p+=3){var m=p+0,g=p+1,y=p+2;n.push(m,g,g,y,y,m)}}var b=new(mr(n)?Ti:_i)(n,1);b.version=o;var x=i.get(e);x&&t.remove(x),i.set(e,b)}return{get:function(e,t){return!0===a[t.id]||(t.addEventListener("dispose",o),a[t.id]=!0,n.memory.geometries++),t},update:function(n){var r=n.attributes;for(var a in r)t.update(r[a],e.ARRAY_BUFFER);var i=n.morphAttributes;for(var o in i)for(var s=i[o],u=0,l=s.length;u<l;u++)t.update(s[u],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return i.get(e)}}}function $o(e,t,n,r){var a,i,o,s=r.isWebGL2;this.setMode=function(e){a=e},this.setIndex=function(e){i=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(a,r,i,t*o),n.update(r,a,1)},this.renderInstances=function(r,u,l){if(0!==l){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](a,u,i,r*o,l),n.update(u,a,l)}}}function es(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,a){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=a*(n/3);break;case e.LINES:t.lines+=a*(n/2);break;case e.LINE_STRIP:t.lines+=a*(n-1);break;case e.LINE_LOOP:t.lines+=a*n;break;case e.POINTS:t.points+=a*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function ts(e,t){return e[0]-t[0]}function ns(e,t){return Math.abs(t[1])-Math.abs(e[1])}function rs(e,t,n){for(var r={},a=new Float32Array(8),i=new WeakMap,o=new Dr,s=[],u=0;u<8;u++)s[u]=[u,0];return{update:function(u,l,c){var h=u.morphTargetInfluences;if(!0===t.isWebGL2){var d=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,f=void 0!==d?d.length:0,p=i.get(l);if(void 0===p||p.count!==f){void 0!==p&&p.texture.dispose();var v=void 0!==l.morphAttributes.position,m=void 0!==l.morphAttributes.normal,g=void 0!==l.morphAttributes.color,y=l.morphAttributes.position||[],b=l.morphAttributes.normal||[],x=l.morphAttributes.color||[],w=0;!0===v&&(w=1),!0===m&&(w=2),!0===g&&(w=3);var k=l.attributes.position.count*w,S=1;k>t.maxTextureSize&&(S=Math.ceil(k/t.maxTextureSize),k=t.maxTextureSize);var _=new Float32Array(k*S*4*f),E=new Or(_,k,S,f);E.type=st,E.needsUpdate=!0;for(var T=4*w,M=0;M<f;M++)for(var C=y[M],I=b[M],A=x[M],R=k*S*4*M,N=0;N<C.count;N++){var L=N*T;!0===v&&(o.fromBufferAttribute(C,N),_[R+L+0]=o.x,_[R+L+1]=o.y,_[R+L+2]=o.z,_[R+L+3]=0),!0===m&&(o.fromBufferAttribute(I,N),_[R+L+4]=o.x,_[R+L+5]=o.y,_[R+L+6]=o.z,_[R+L+7]=0),!0===g&&(o.fromBufferAttribute(A,N),_[R+L+8]=o.x,_[R+L+9]=o.y,_[R+L+10]=o.z,_[R+L+11]=4===A.itemSize?o.w:1)}p={count:f,texture:E,size:new fr(k,S)},i.set(l,p),l.addEventListener("dispose",(function e(){E.dispose(),i.delete(l),l.removeEventListener("dispose",e)}))}for(var P=0,D=0;D<h.length;D++)P+=h[D];var F=l.morphTargetsRelative?1:1-P;c.getUniforms().setValue(e,"morphTargetBaseInfluence",F),c.getUniforms().setValue(e,"morphTargetInfluences",h),c.getUniforms().setValue(e,"morphTargetsTexture",p.texture,n),c.getUniforms().setValue(e,"morphTargetsTextureSize",p.size)}else{var O=void 0===h?0:h.length,z=r[l.id];if(void 0===z||z.length!==O){z=[];for(var U=0;U<O;U++)z[U]=[U,0];r[l.id]=z}for(var B=0;B<O;B++){var W=z[B];W[0]=B,W[1]=h[B]}z.sort(ns);for(var V=0;V<8;V++)V<O&&z[V][1]?(s[V][0]=z[V][0],s[V][1]=z[V][1]):(s[V][0]=Number.MAX_SAFE_INTEGER,s[V][1]=0);s.sort(ts);for(var G=l.morphAttributes.position,H=l.morphAttributes.normal,j=0,X=0;X<8;X++){var q=s[X],K=q[0],Y=q[1];K!==Number.MAX_SAFE_INTEGER&&Y?(G&&l.getAttribute("morphTarget"+X)!==G[K]&&l.setAttribute("morphTarget"+X,G[K]),H&&l.getAttribute("morphNormal"+X)!==H[K]&&l.setAttribute("morphNormal"+X,H[K]),a[X]=Y,j+=Y):(G&&!0===l.hasAttribute("morphTarget"+X)&&l.deleteAttribute("morphTarget"+X),H&&!0===l.hasAttribute("morphNormal"+X)&&l.deleteAttribute("morphNormal"+X),a[X]=0)}var Z=l.morphTargetsRelative?1:1-j;c.getUniforms().setValue(e,"morphTargetBaseInfluence",Z),c.getUniforms().setValue(e,"morphTargetInfluences",a)}}}}function as(e,t,n,r){var a=new WeakMap;function i(e){var t=e.target;t.removeEventListener("dispose",i),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){var s=r.render.frame,u=o.geometry,l=t.get(o,u);return a.get(l)!==s&&(t.update(l),a.set(l,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",i)&&o.addEventListener("dispose",i),n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER)),l},dispose:function(){a=new WeakMap}}}var is=new Pr,os=new Or,ss=new Ur,us=new po,ls=[],cs=[],hs=new Float32Array(16),ds=new Float32Array(9),fs=new Float32Array(4);function ps(e,t,n){var r=e[0];if(r<=0||r>0)return e;var a=t*n,i=ls[a];if(void 0===i&&(i=new Float32Array(a),ls[a]=i),0!==t){r.toArray(i,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(i,s)}return i}function vs(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function ms(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function gs(e,t){var n=cs[t];void 0===n&&(n=new Int32Array(t),cs[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function ys(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function bs(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(vs(n,t))return;e.uniform2fv(this.addr,t),ms(n,t)}}function xs(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(vs(n,t))return;e.uniform3fv(this.addr,t),ms(n,t)}}function ws(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(vs(n,t))return;e.uniform4fv(this.addr,t),ms(n,t)}}function ks(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(vs(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ms(n,t)}else{if(vs(n,r))return;fs.set(r),e.uniformMatrix2fv(this.addr,!1,fs),ms(n,r)}}function Ss(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(vs(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ms(n,t)}else{if(vs(n,r))return;ds.set(r),e.uniformMatrix3fv(this.addr,!1,ds),ms(n,r)}}function _s(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(vs(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ms(n,t)}else{if(vs(n,r))return;hs.set(r),e.uniformMatrix4fv(this.addr,!1,hs),ms(n,r)}}function Es(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ts(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(vs(n,t))return;e.uniform2iv(this.addr,t),ms(n,t)}}function Ms(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(vs(n,t))return;e.uniform3iv(this.addr,t),ms(n,t)}}function Cs(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(vs(n,t))return;e.uniform4iv(this.addr,t),ms(n,t)}}function Is(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function As(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(vs(n,t))return;e.uniform2uiv(this.addr,t),ms(n,t)}}function Rs(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(vs(n,t))return;e.uniform3uiv(this.addr,t),ms(n,t)}}function Ns(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(vs(n,t))return;e.uniform4uiv(this.addr,t),ms(n,t)}}function Ls(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2D(t||is,a)}function Ps(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture3D(t||ss,a)}function Ds(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTextureCube(t||us,a)}function Fs(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2DArray(t||os,a)}function Os(e,t){e.uniform1fv(this.addr,t)}function zs(e,t){var n=ps(t,this.size,2);e.uniform2fv(this.addr,n)}function Us(e,t){var n=ps(t,this.size,3);e.uniform3fv(this.addr,n)}function Bs(e,t){var n=ps(t,this.size,4);e.uniform4fv(this.addr,n)}function Ws(e,t){var n=ps(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Vs(e,t){var n=ps(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Gs(e,t){var n=ps(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Hs(e,t){e.uniform1iv(this.addr,t)}function js(e,t){e.uniform2iv(this.addr,t)}function Xs(e,t){e.uniform3iv(this.addr,t)}function qs(e,t){e.uniform4iv(this.addr,t)}function Ks(e,t){e.uniform1uiv(this.addr,t)}function Ys(e,t){e.uniform2uiv(this.addr,t)}function Zs(e,t){e.uniform3uiv(this.addr,t)}function Js(e,t){e.uniform4uiv(this.addr,t)}function Qs(e,t,n){var r=this.cache,a=t.length,i=gs(n,a);vs(r,i)||(e.uniform1iv(this.addr,i),ms(r,i));for(var o=0;o!==a;++o)n.setTexture2D(t[o]||is,i[o])}function $s(e,t,n){var r=this.cache,a=t.length,i=gs(n,a);vs(r,i)||(e.uniform1iv(this.addr,i),ms(r,i));for(var o=0;o!==a;++o)n.setTexture3D(t[o]||ss,i[o])}function eu(e,t,n){var r=this.cache,a=t.length,i=gs(n,a);vs(r,i)||(e.uniform1iv(this.addr,i),ms(r,i));for(var o=0;o!==a;++o)n.setTextureCube(t[o]||us,i[o])}function tu(e,t,n){var r=this.cache,a=t.length,i=gs(n,a);vs(r,i)||(e.uniform1iv(this.addr,i),ms(r,i));for(var o=0;o!==a;++o)n.setTexture2DArray(t[o]||os,i[o])}var nu=M((function e(t,n,r){E(this,e),this.id=t,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ys;case 35664:return bs;case 35665:return xs;case 35666:return ws;case 35674:return ks;case 35675:return Ss;case 35676:return _s;case 5124:case 35670:return Es;case 35667:case 35671:return Ts;case 35668:case 35672:return Ms;case 35669:case 35673:return Cs;case 5125:return Is;case 36294:return As;case 36295:return Rs;case 36296:return Ns;case 35678:case 36198:case 36298:case 36306:case 35682:return Ls;case 35679:case 36299:case 36307:return Ps;case 35680:case 36300:case 36308:case 36293:return Ds;case 36289:case 36303:case 36311:case 36292:return Fs}}(n.type)})),ru=M((function e(t,n,r){E(this,e),this.id=t,this.addr=r,this.cache=[],this.size=n.size,this.setValue=function(e){switch(e){case 5126:return Os;case 35664:return zs;case 35665:return Us;case 35666:return Bs;case 35674:return Ws;case 35675:return Vs;case 35676:return Gs;case 5124:case 35670:return Hs;case 35667:case 35671:return js;case 35668:case 35672:return Xs;case 35669:case 35673:return qs;case 5125:return Ks;case 36294:return Ys;case 36295:return Zs;case 36296:return Js;case 35678:case 36198:case 36298:case 36306:case 35682:return Qs;case 35679:case 36299:case 36307:return $s;case 35680:case 36300:case 36308:case 36293:return eu;case 36289:case 36303:case 36311:case 36292:return tu}}(n.type)})),au=function(){function e(t){E(this,e),this.id=t,this.seq=[],this.map={}}return M(e,[{key:"setValue",value:function(e,t,n){for(var r=this.seq,a=0,i=r.length;a!==i;++a){var o=r[a];o.setValue(e,t[o.id],n)}}}]),e}(),iu=/(\w+)(\])?(\[|\.)?/g;function ou(e,t){e.seq.push(t),e.map[t.id]=t}function su(e,t,n){var r=e.name,a=r.length;for(iu.lastIndex=0;;){var i=iu.exec(r),o=iu.lastIndex,s=i[1],u="]"===i[2],l=i[3];if(u&&(s|=0),void 0===l||"["===l&&o+2===a){ou(n,void 0===l?new nu(s,e,t):new ru(s,e,t));break}var c=n.map[s];void 0===c&&ou(n,c=new au(s)),n=c}}var uu=function(){function e(t,n){E(this,e),this.seq=[],this.map={};for(var r=t.getProgramParameter(n,t.ACTIVE_UNIFORMS),a=0;a<r;++a){var i=t.getActiveUniform(n,a);su(i,t.getUniformLocation(n,i.name),this)}}return M(e,[{key:"setValue",value:function(e,t,n,r){var a=this.map[t];void 0!==a&&a.setValue(e,n,r)}},{key:"setOptional",value:function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)}}],[{key:"upload",value:function(e,t,n,r){for(var a=0,i=t.length;a!==i;++a){var o=t[a],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}}},{key:"seqWithValue",value:function(e,t){for(var n=[],r=0,a=e.length;r!==a;++r){var i=e[r];i.id in t&&n.push(i)}return n}}]),e}();function lu(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}var cu=0;function hu(e,t,n){var r=e.getShaderParameter(t,e.COMPILE_STATUS),a=e.getShaderInfoLog(t).trim();if(r&&""===a)return"";var i=/ERROR: 0:(\d+)/.exec(a);if(i){var o=parseInt(i[1]);return n.toUpperCase()+"\n\n"+a+"\n\n"+function(e,t){for(var n=e.split("\n"),r=[],a=Math.max(t-6,0),i=Math.min(t+6,n.length),o=a;o<i;o++){var s=o+1;r.push("".concat(s===t?">":" "," ").concat(s,": ").concat(n[o]))}return r.join("\n")}(e.getShaderSource(t),o)}return a}function du(e,t){var n=function(e){switch(e){case kn:return["Linear","( value )"];case wn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function fu(e,t){var n;switch(t){case Re:n="Linear";break;case Ne:n="Reinhard";break;case Le:n="OptimizedCineon";break;case Pe:n="ACESFilmic";break;case De:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function pu(e){return""!==e}function vu(e,t){var n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function mu(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var gu=/^[ \t]*#include +<([\w\d./]+)>/gm;function yu(e){return e.replace(gu,bu)}function bu(e,t){var n=To[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return yu(n)}var xu=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function wu(e){return e.replace(xu,ku)}function ku(e,t,n,r){for(var a="",i=parseInt(t);i<parseInt(n);i++)a+=r.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return a}function Su(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function _u(e,t,n,r){var a,i,o=e.getContext(),s=n.defines,u=n.vertexShader,l=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===H?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===j?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===X&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Oe:case ze:t="ENVMAP_TYPE_CUBE";break;case We:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===ze&&(t="ENVMAP_MODE_REFRACTION");return t}(n),f=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Me:t="ENVMAP_BLENDING_MULTIPLY";break;case Ce:t="ENVMAP_BLENDING_MIX";break;case Ie:t="ENVMAP_BLENDING_ADD"}return t}(n),p=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(pu).join("\n")}(n),m=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),g=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((a=[m].filter(pu).join("\n")).length>0&&(a+="\n"),(i=[v,m].filter(pu).join("\n")).length>0&&(i+="\n")):(a=[Su(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(pu).join("\n"),i=[v,Su(n),"#define SHADER_NAME "+n.shaderName,m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Ae?"#define TONE_MAPPING":"",n.toneMapping!==Ae?To.tonemapping_pars_fragment:"",n.toneMapping!==Ae?fu("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",To.encodings_pars_fragment,du("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(pu).join("\n")),u=mu(u=vu(u=yu(u),n),n),l=mu(l=vu(l=yu(l),n),n),u=wu(u),l=wu(l),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",a=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+a,i=["#define varying in",n.glslVersion===Zn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Zn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+i);var b,x,w=y+a+u,k=y+i+l,S=lu(o,o.VERTEX_SHADER,w),_=lu(o,o.FRAGMENT_SHADER,k);if(o.attachShader(g,S),o.attachShader(g,_),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var E=o.getProgramInfoLog(g).trim(),T=o.getShaderInfoLog(S).trim(),M=o.getShaderInfoLog(_).trim(),C=!0,I=!0;if(!1===o.getProgramParameter(g,o.LINK_STATUS))if(C=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(o,g,S,_);else{var A=hu(o,S,"vertex"),R=hu(o,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,o.VALIDATE_STATUS)+"\n\nProgram Info Log: "+E+"\n"+A+"\n"+R)}else""!==E?console.warn("THREE.WebGLProgram: Program Info Log:",E):""!==T&&""!==M||(I=!1);I&&(this.diagnostics={runnable:C,programLog:E,vertexShader:{log:T,prefix:a},fragmentShader:{log:M,prefix:i}})}return o.deleteShader(S),o.deleteShader(_),this.getUniforms=function(){return void 0===b&&(b=new uu(o,g)),b},this.getAttributes=function(){return void 0===x&&(x=function(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<r;a++){var i=e.getActiveAttrib(t,a),o=i.name,s=1;i.type===e.FLOAT_MAT2&&(s=2),i.type===e.FLOAT_MAT3&&(s=3),i.type===e.FLOAT_MAT4&&(s=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),x},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=cu++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=S,this.fragmentShader=_,this}var Eu=0,Tu=function(){function e(){E(this,e),this.shaderCache=new Map,this.materialCache=new Map}return M(e,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),a=this._getShaderStage(n),i=this._getShaderCacheForMaterial(e);return!1===i.has(r)&&(i.add(r),r.usedTimes++),!1===i.has(a)&&(i.add(a),a.usedTimes++),this}},{key:"remove",value:function(e){var t,n=N(this.materialCache.get(e));try{for(n.s();!(t=n.n()).done;){var r=t.value;r.usedTimes--,0===r.usedTimes&&this.shaderCache.delete(r.code)}}catch(a){n.e(a)}finally{n.f()}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache,n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache,n=t.get(e);return void 0===n&&(n=new Mu(e),t.set(e,n)),n}}]),e}(),Mu=M((function e(t){E(this,e),this.id=Eu++,this.code=t,this.usedTimes=0}));function Cu(e,t,n,r,a,i,o){var s=new Aa,u=new Tu,l=[],c=a.isWebGL2,h=a.logarithmicDepthBuffer,d=a.vertexTextures,f=a.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(e){return 1===e?"uv1":2===e?"uv2":3===e?"uv3":"uv"}return{getParameters:function(i,s,l,m,g){var y=m.fog,b=g.geometry,x=i.isMeshStandardMaterial?m.environment:null,w=(i.isMeshStandardMaterial?n:t).get(i.envMap||x),k=w&&w.mapping===We?w.image.height:null,S=p[i.type];null!==i.precision&&(f=a.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",f,"instead.");var _,E,T,M,C=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,I=void 0!==C?C.length:0,A=0;if(void 0!==b.morphAttributes.position&&(A=1),void 0!==b.morphAttributes.normal&&(A=2),void 0!==b.morphAttributes.color&&(A=3),S){var R=Co[S];_=R.vertexShader,E=R.fragmentShader}else _=i.vertexShader,E=i.fragmentShader,u.update(i),T=u.getVertexShaderID(i),M=u.getFragmentShaderID(i);var N=e.getRenderTarget(),L=!0===g.isInstancedMesh,P=!!i.map,D=!!i.matcap,F=!!w,O=!!i.aoMap,z=!!i.lightMap,U=!!i.bumpMap,B=!!i.normalMap,W=!!i.displacementMap,V=!!i.emissiveMap,G=!!i.metalnessMap,H=!!i.roughnessMap,j=i.clearcoat>0,X=i.iridescence>0,q=i.sheen>0,Z=i.transmission>0,J=j&&!!i.clearcoatMap,$=j&&!!i.clearcoatNormalMap,ee=j&&!!i.clearcoatRoughnessMap,te=X&&!!i.iridescenceMap,ne=X&&!!i.iridescenceThicknessMap,re=q&&!!i.sheenColorMap,ae=q&&!!i.sheenRoughnessMap,ie=!!i.specularMap,oe=!!i.specularColorMap,se=!!i.specularIntensityMap,ue=Z&&!!i.transmissionMap,le=Z&&!!i.thicknessMap,ce=!!i.gradientMap,he=!!i.alphaMap,de=i.alphaTest>0,fe=!!i.extensions,pe=!!b.attributes.uv1,ve=!!b.attributes.uv2,me=!!b.attributes.uv3;return{isWebGL2:c,shaderID:S,shaderName:i.type,vertexShader:_,fragmentShader:E,defines:i.defines,customVertexShaderID:T,customFragmentShaderID:M,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:f,instancing:L,instancingColor:L&&null!==g.instanceColor,supportsVertexTextures:d,outputColorSpace:null===N?e.outputColorSpace:!0===N.isXRRenderTarget?N.texture.colorSpace:kn,map:P,matcap:D,envMap:F,envMapMode:F&&w.mapping,envMapCubeUVHeight:k,aoMap:O,lightMap:z,bumpMap:U,normalMap:B,displacementMap:d&&W,emissiveMap:V,normalMapObjectSpace:B&&i.normalMapType===bn,normalMapTangentSpace:B&&i.normalMapType===yn,metalnessMap:G,roughnessMap:H,clearcoat:j,clearcoatMap:J,clearcoatNormalMap:$,clearcoatRoughnessMap:ee,iridescence:X,iridescenceMap:te,iridescenceThicknessMap:ne,sheen:q,sheenColorMap:re,sheenRoughnessMap:ae,specularMap:ie,specularColorMap:oe,specularIntensityMap:se,transmission:Z,transmissionMap:ue,thicknessMap:le,gradientMap:ce,opaque:!1===i.transparent&&i.blending===Q,alphaMap:he,alphaTest:de,combine:i.combine,mapUv:P&&v(i.map.channel),aoMapUv:O&&v(i.aoMap.channel),lightMapUv:z&&v(i.lightMap.channel),bumpMapUv:U&&v(i.bumpMap.channel),normalMapUv:B&&v(i.normalMap.channel),displacementMapUv:W&&v(i.displacementMap.channel),emissiveMapUv:V&&v(i.emissiveMap.channel),metalnessMapUv:G&&v(i.metalnessMap.channel),roughnessMapUv:H&&v(i.roughnessMap.channel),clearcoatMapUv:J&&v(i.clearcoatMap.channel),clearcoatNormalMapUv:$&&v(i.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&v(i.clearcoatRoughnessMap.channel),iridescenceMapUv:te&&v(i.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&v(i.iridescenceThicknessMap.channel),sheenColorMapUv:re&&v(i.sheenColorMap.channel),sheenRoughnessMapUv:ae&&v(i.sheenRoughnessMap.channel),specularMapUv:ie&&v(i.specularMap.channel),specularColorMapUv:oe&&v(i.specularColorMap.channel),specularIntensityMapUv:se&&v(i.specularIntensityMap.channel),transmissionMapUv:ue&&v(i.transmissionMap.channel),thicknessMapUv:le&&v(i.thicknessMap.channel),alphaMapUv:he&&v(i.alphaMap.channel),vertexTangents:B&&!!b.attributes.tangent,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUv1s:pe,vertexUv2s:ve,vertexUv3s:me,pointsUvs:!0===g.isPoints&&!!b.attributes.uv&&(P||he),fog:!!y,useFog:!0===i.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===i.flatShading,sizeAttenuation:!0===i.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:I,morphTextureStride:A,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:Ae,useLegacyLights:e.useLegacyLights,premultipliedAlpha:i.premultipliedAlpha,doubleSided:i.side===Y,flipSided:i.side===K,useDepthPacking:i.depthPacking>=0,depthPacking:i.depthPacking||0,index0AttributeName:i.index0AttributeName,extensionDerivatives:fe&&!0===i.extensions.derivatives,extensionFragDepth:fe&&!0===i.extensions.fragDepth,extensionDrawBuffers:fe&&!0===i.extensions.drawBuffers,extensionShaderTextureLOD:fe&&!0===i.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.matcap&&s.enable(4);t.envMap&&s.enable(5);t.normalMapObjectSpace&&s.enable(6);t.normalMapTangentSpace&&s.enable(7);t.clearcoat&&s.enable(8);t.iridescence&&s.enable(9);t.alphaTest&&s.enable(10);t.vertexColors&&s.enable(11);t.vertexAlphas&&s.enable(12);t.vertexUv1s&&s.enable(13);t.vertexUv2s&&s.enable(14);t.vertexUv3s&&s.enable(15);t.vertexTangents&&s.enable(16);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.useLegacyLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.transmission&&s.enable(15);t.sheen&&s.enable(16);t.opaque&&s.enable(17);t.pointsUvs&&s.enable(18);e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var r=Co[n];t=so.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,a=0,o=l.length;a<o;a++){var s=l[a];if(s.cacheKey===n){++(r=s).usedTimes;break}}return void 0===r&&(r=new _u(e,n,t,i),l.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){var t=l.indexOf(e);l[t]=l[l.length-1],l.pop(),e.destroy()}},releaseShaderCache:function(e){u.remove(e)},programs:l,dispose:function(){u.dispose()}}}function Iu(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Au(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ru(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Nu(){var e=[],t=0,n=[],r=[],a=[];function i(n,r,a,i,o,s){var u=e[t];return void 0===u?(u={id:n.id,object:n,geometry:r,material:a,groupOrder:i,renderOrder:n.renderOrder,z:o,group:s},e[t]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=a,u.groupOrder=i,u.renderOrder=n.renderOrder,u.z=o,u.group=s),t++,u}return{opaque:n,transmissive:r,transparent:a,init:function(){t=0,n.length=0,r.length=0,a.length=0},push:function(e,t,o,s,u,l){var c=i(e,t,o,s,u,l);o.transmission>0?r.push(c):!0===o.transparent?a.push(c):n.push(c)},unshift:function(e,t,o,s,u,l){var c=i(e,t,o,s,u,l);o.transmission>0?r.unshift(c):!0===o.transparent?a.unshift(c):n.unshift(c)},finish:function(){for(var n=t,r=e.length;n<r;n++){var a=e[n];if(null===a.id)break;a.id=null,a.object=null,a.geometry=null,a.material=null,a.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Au),r.length>1&&r.sort(t||Ru),a.length>1&&a.sort(t||Ru)}}}function Lu(){var e=new WeakMap;return{get:function(t,n){var r,a=e.get(t);return void 0===a?(r=new Nu,e.set(t,[r])):n>=a.length?(r=new Nu,a.push(r)):r=a[n],r},dispose:function(){e=new WeakMap}}}function Pu(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Gr,color:new li};break;case"SpotLight":n={position:new Gr,direction:new Gr,color:new li,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Gr,color:new li,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Gr,skyColor:new li,groundColor:new li};break;case"RectAreaLight":n={color:new li,position:new Gr,halfWidth:new Gr,halfHeight:new Gr}}return e[t.id]=n,n}}}var Du=0;function Fu(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Ou(e,t){for(var n=new Pu,r=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new fr};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new fr,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0},i=0;i<9;i++)a.probe.push(new Gr);var o=new Gr,s=new ba,u=new ba;return{setup:function(i,o){for(var s=0,u=0,l=0,c=0;c<9;c++)a.probe[c].set(0,0,0);var h=0,d=0,f=0,p=0,v=0,m=0,g=0,y=0,b=0,x=0;i.sort(Fu);for(var w=!0===o?Math.PI:1,k=0,S=i.length;k<S;k++){var _=i[k],E=_.color,T=_.intensity,M=_.distance,C=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)s+=E.r*T*w,u+=E.g*T*w,l+=E.b*T*w;else if(_.isLightProbe)for(var I=0;I<9;I++)a.probe[I].addScaledVector(_.sh.coefficients[I],T);else if(_.isDirectionalLight){var A=n.get(_);if(A.color.copy(_.color).multiplyScalar(_.intensity*w),_.castShadow){var R=_.shadow,N=r.get(_);N.shadowBias=R.bias,N.shadowNormalBias=R.normalBias,N.shadowRadius=R.radius,N.shadowMapSize=R.mapSize,a.directionalShadow[h]=N,a.directionalShadowMap[h]=C,a.directionalShadowMatrix[h]=_.shadow.matrix,m++}a.directional[h]=A,h++}else if(_.isSpotLight){var L=n.get(_);L.position.setFromMatrixPosition(_.matrixWorld),L.color.copy(E).multiplyScalar(T*w),L.distance=M,L.coneCos=Math.cos(_.angle),L.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),L.decay=_.decay,a.spot[f]=L;var P=_.shadow;if(_.map&&(a.spotLightMap[b]=_.map,b++,P.updateMatrices(_),_.castShadow&&x++),a.spotLightMatrix[f]=P.matrix,_.castShadow){var D=r.get(_);D.shadowBias=P.bias,D.shadowNormalBias=P.normalBias,D.shadowRadius=P.radius,D.shadowMapSize=P.mapSize,a.spotShadow[f]=D,a.spotShadowMap[f]=C,y++}f++}else if(_.isRectAreaLight){var F=n.get(_);F.color.copy(E).multiplyScalar(T),F.halfWidth.set(.5*_.width,0,0),F.halfHeight.set(0,.5*_.height,0),a.rectArea[p]=F,p++}else if(_.isPointLight){var O=n.get(_);if(O.color.copy(_.color).multiplyScalar(_.intensity*w),O.distance=_.distance,O.decay=_.decay,_.castShadow){var z=_.shadow,U=r.get(_);U.shadowBias=z.bias,U.shadowNormalBias=z.normalBias,U.shadowRadius=z.radius,U.shadowMapSize=z.mapSize,U.shadowCameraNear=z.camera.near,U.shadowCameraFar=z.camera.far,a.pointShadow[d]=U,a.pointShadowMap[d]=C,a.pointShadowMatrix[d]=_.shadow.matrix,g++}a.point[d]=O,d++}else if(_.isHemisphereLight){var B=n.get(_);B.skyColor.copy(_.color).multiplyScalar(T*w),B.groundColor.copy(_.groundColor).multiplyScalar(T*w),a.hemi[v]=B,v++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(a.rectAreaLTC1=Mo.LTC_FLOAT_1,a.rectAreaLTC2=Mo.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(a.rectAreaLTC1=Mo.LTC_HALF_1,a.rectAreaLTC2=Mo.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=s,a.ambient[1]=u,a.ambient[2]=l;var W=a.hash;W.directionalLength===h&&W.pointLength===d&&W.spotLength===f&&W.rectAreaLength===p&&W.hemiLength===v&&W.numDirectionalShadows===m&&W.numPointShadows===g&&W.numSpotShadows===y&&W.numSpotMaps===b||(a.directional.length=h,a.spot.length=f,a.rectArea.length=p,a.point.length=d,a.hemi.length=v,a.directionalShadow.length=m,a.directionalShadowMap.length=m,a.pointShadow.length=g,a.pointShadowMap.length=g,a.spotShadow.length=y,a.spotShadowMap.length=y,a.directionalShadowMatrix.length=m,a.pointShadowMatrix.length=g,a.spotLightMatrix.length=y+b-x,a.spotLightMap.length=b,a.numSpotLightShadowsWithMaps=x,W.directionalLength=h,W.pointLength=d,W.spotLength=f,W.rectAreaLength=p,W.hemiLength=v,W.numDirectionalShadows=m,W.numPointShadows=g,W.numSpotShadows=y,W.numSpotMaps=b,a.version=Du++)},setupView:function(e,t){for(var n=0,r=0,i=0,l=0,c=0,h=t.matrixWorldInverse,d=0,f=e.length;d<f;d++){var p=e[d];if(p.isDirectionalLight){var v=a.directional[n];v.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),n++}else if(p.isSpotLight){var m=a.spot[i];m.position.setFromMatrixPosition(p.matrixWorld),m.position.applyMatrix4(h),m.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),i++}else if(p.isRectAreaLight){var g=a.rectArea[l];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),u.identity(),s.copy(p.matrixWorld),s.premultiply(h),u.extractRotation(s),g.halfWidth.set(.5*p.width,0,0),g.halfHeight.set(0,.5*p.height,0),g.halfWidth.applyMatrix4(u),g.halfHeight.applyMatrix4(u),l++}else if(p.isPointLight){var y=a.point[r];y.position.setFromMatrixPosition(p.matrixWorld),y.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){var b=a.hemi[c];b.direction.setFromMatrixPosition(p.matrixWorld),b.direction.transformDirection(h),c++}}},state:a}}function zu(e,t){var n=new Ou(e,t),r=[],a=[];return{init:function(){r.length=0,a.length=0},state:{lightsArray:r,shadowsArray:a,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){a.push(e)}}}function Uu(e,t){var n=new WeakMap;return{get:function(r){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=n.get(r);return void 0===o?(a=new zu(e,t),n.set(r,[a])):i>=o.length?(a=new zu(e,t),o.push(a)):a=o[i],a},dispose:function(){n=new WeakMap}}}var Bu=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshDepthMaterial=!0,r.type="MeshDepthMaterial",r.depthPacking=mn,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(ai),Wu=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshDistanceMaterial=!0,r.type="MeshDistanceMaterial",r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(ai);function Vu(e,t,n){var r,a=new ko,i=new fr,o=new fr,s=new Dr,u=new Bu({depthPacking:gn}),l=new Wu,c={},h=n.maxTextureSize,d=(k(r={},q,K),k(r,K,q),k(r,Y,Y),r),f=new uo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new fr},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=f.clone();p.defines.HORIZONTAL_PASS=1;var v=new Oi;v.setAttribute("position",new bi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var m=new to(v,f),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=H;var y=this.type;function b(n,r){var a=t.update(m);f.defines.VSM_SAMPLES!==n.blurSamples&&(f.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Fr(i.x,i.y)),f.uniforms.shadow_pass.value=n.map.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,f,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,p,m,null)}function x(t,n,r,a){var i=null,o=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)i=o;else if(i=!0===r.isPointLight?l:u,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){var s=i.uuid,h=n.uuid,f=c[s];void 0===f&&(f={},c[s]=f);var p=f[h];void 0===p&&(p=i.clone(),f[h]=p),i=p}(i.visible=n.visible,i.wireframe=n.wireframe,i.side=a===X?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],i.alphaMap=n.alphaMap,i.alphaTest=n.alphaTest,i.map=n.map,i.clipShadows=n.clipShadows,i.clippingPlanes=n.clippingPlanes,i.clipIntersection=n.clipIntersection,i.displacementMap=n.displacementMap,i.displacementScale=n.displacementScale,i.displacementBias=n.displacementBias,i.wireframeLinewidth=n.wireframeLinewidth,i.linewidth=n.linewidth,!0===r.isPointLight&&!0===i.isMeshDistanceMaterial)&&(e.properties.get(i).light=r);return i}function w(n,r,i,o,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===X)&&(!n.frustumCulled||a.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);var u=t.update(n),l=n.material;if(Array.isArray(l))for(var c=u.groups,h=0,d=c.length;h<d;h++){var f=c[h],p=l[f.materialIndex];if(p&&p.visible){var v=x(n,p,o,s);e.renderBufferDirect(i,null,u,v,n,f)}}else if(l.visible){var m=x(n,l,o,s);e.renderBufferDirect(i,null,u,m,n,null)}}for(var g=n.children,y=0,b=g.length;y<b;y++)w(g[y],r,i,o,s)}}this.render=function(t,n,r){if(!1!==g.enabled&&(!1!==g.autoUpdate||!1!==g.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),l=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),d=e.state;d.setBlending(J),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var f=y!==X&&this.type===X,p=y===X&&this.type!==X,v=0,m=t.length;v<m;v++){var x=t[v],k=x.shadow;if(void 0!==k){if(!1!==k.autoUpdate||!1!==k.needsUpdate){i.copy(k.mapSize);var S=k.getFrameExtents();if(i.multiply(S),o.copy(k.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(o.x=Math.floor(h/S.x),i.x=o.x*S.x,k.mapSize.x=o.x),i.y>h&&(o.y=Math.floor(h/S.y),i.y=o.y*S.y,k.mapSize.y=o.y)),null===k.map||!0===f||!0===p){var _=this.type!==X?{minFilter:je,magFilter:je}:{};null!==k.map&&k.map.dispose(),k.map=new Fr(i.x,i.y,_),k.map.texture.name=x.name+".shadowMap",k.camera.updateProjectionMatrix()}e.setRenderTarget(k.map),e.clear();for(var E=k.getViewportCount(),T=0;T<E;T++){var M=k.getViewport(T);s.set(o.x*M.x,o.y*M.y,o.x*M.z,o.y*M.w),d.viewport(s),k.updateMatrices(x,T),a=k.getFrustum(),w(n,r,k.camera,x,this.type)}!0!==k.isPointLightShadow&&this.type===X&&b(k,r),k.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",x,"has no shadow.")}y=this.type,g.needsUpdate=!1,e.setRenderTarget(u,l,c)}}}function Gu(e,t,n){var r,a,i=n.isWebGL2;var o=new function(){var t=!1,n=new Dr,r=null,a=new Dr(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,i,o,s){!0===s&&(t*=o,r*=o,i*=o),n.set(t,r,i,o),!1===a.equals(n)&&(e.clearColor(t,r,i,o),a.copy(n))},reset:function(){t=!1,r=null,a.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,r=null,a=null;return{setTest:function(t){t?X(e.DEPTH_TEST):q(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case be:e.depthFunc(e.NEVER);break;case xe:e.depthFunc(e.ALWAYS);break;case we:e.depthFunc(e.LESS);break;case ke:e.depthFunc(e.LEQUAL);break;case Se:e.depthFunc(e.EQUAL);break;case _e:e.depthFunc(e.GEQUAL);break;case Ee:e.depthFunc(e.GREATER);break;case Te:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){a!==t&&(e.clearDepth(t),a=t)},reset:function(){t=!1,n=null,r=null,a=null}}},u=new function(){var t=!1,n=null,r=null,a=null,i=null,o=null,s=null,u=null,l=null;return{setTest:function(n){t||(n?X(e.STENCIL_TEST):q(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&a===n&&i===o||(e.stencilFunc(t,n,o),r=t,a=n,i=o)},setOp:function(t,n,r){o===t&&s===n&&u===r||(e.stencilOp(t,n,r),o=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,r=null,a=null,i=null,o=null,s=null,u=null,l=null}}},l=new WeakMap,c=new WeakMap,h={},d={},f=new WeakMap,p=[],v=null,m=!1,g=null,y=null,b=null,x=null,w=null,S=null,_=null,E=!1,T=null,M=null,C=null,I=null,A=null,R=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),N=!1,L=0,P=e.getParameter(e.VERSION);-1!==P.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(P)[1]),N=L>=1):-1!==P.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),N=L>=2);var D=null,F={},O=e.getParameter(e.SCISSOR_BOX),z=e.getParameter(e.VIEWPORT),V=(new Dr).fromArray(O),G=(new Dr).fromArray(z);function H(t,n,r,a){var o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var u=0;u<r;u++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+u,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(n,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}var j={};function X(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function q(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}j[e.TEXTURE_2D]=H(e.TEXTURE_2D,e.TEXTURE_2D,1),j[e.TEXTURE_CUBE_MAP]=H(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(j[e.TEXTURE_2D_ARRAY]=H(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),j[e.TEXTURE_3D]=H(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),o.setClear(0,0,0,1),s.setClear(1),u.setClear(0),X(e.DEPTH_TEST),s.setFunc(ke),Ae(!1),Re(B),X(e.CULL_FACE),Ie(J);var Z=(k(r={},re,e.FUNC_ADD),k(r,ae,e.FUNC_SUBTRACT),k(r,ie,e.FUNC_REVERSE_SUBTRACT),r);if(i)Z[oe]=e.MIN,Z[se]=e.MAX;else{var Me=t.get("EXT_blend_minmax");null!==Me&&(Z[oe]=Me.MIN_EXT,Z[se]=Me.MAX_EXT)}var Ce=(k(a={},ue,e.ZERO),k(a,le,e.ONE),k(a,ce,e.SRC_COLOR),k(a,de,e.SRC_ALPHA),k(a,ye,e.SRC_ALPHA_SATURATE),k(a,me,e.DST_COLOR),k(a,pe,e.DST_ALPHA),k(a,he,e.ONE_MINUS_SRC_COLOR),k(a,fe,e.ONE_MINUS_SRC_ALPHA),k(a,ge,e.ONE_MINUS_DST_COLOR),k(a,ve,e.ONE_MINUS_DST_ALPHA),a);function Ie(t,n,r,a,i,o,s,u){if(t!==J){if(!1===m&&(X(e.BLEND),m=!0),t===ne)i=i||n,o=o||r,s=s||a,n===y&&i===w||(e.blendEquationSeparate(Z[n],Z[i]),y=n,w=i),r===b&&a===x&&o===S&&s===_||(e.blendFuncSeparate(Ce[r],Ce[a],Ce[o],Ce[s]),b=r,x=a,S=o,_=s),g=t,E=!1;else if(t!==g||u!==E){if(y===re&&w===re||(e.blendEquation(e.FUNC_ADD),y=re,w=re),u)switch(t){case Q:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case $:e.blendFunc(e.ONE,e.ONE);break;case ee:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case te:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case Q:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case $:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case ee:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case te:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}b=null,x=null,S=null,_=null,g=t,E=u}}else!0===m&&(q(e.BLEND),m=!1)}function Ae(t){T!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),T=t)}function Re(t){t!==U?(X(e.CULL_FACE),t!==M&&(t===B?e.cullFace(e.BACK):t===W?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):q(e.CULL_FACE),M=t}function Ne(t,n,r){t?(X(e.POLYGON_OFFSET_FILL),I===n&&A===r||(e.polygonOffset(n,r),I=n,A=r)):q(e.POLYGON_OFFSET_FILL)}return{buffers:{color:o,depth:s,stencil:u},enable:X,disable:q,bindFramebuffer:function(t,n){return d[t]!==n&&(e.bindFramebuffer(t,n),d[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(d[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(d[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(r,a){var i=p,o=!1;if(r)if(void 0===(i=f.get(a))&&(i=[],f.set(a,i)),r.isWebGLMultipleRenderTargets){var s=r.texture;if(i.length!==s.length||i[0]!==e.COLOR_ATTACHMENT0){for(var u=0,l=s.length;u<l;u++)i[u]=e.COLOR_ATTACHMENT0+u;i.length=s.length,o=!0}}else i[0]!==e.COLOR_ATTACHMENT0&&(i[0]=e.COLOR_ATTACHMENT0,o=!0);else i[0]!==e.BACK&&(i[0]=e.BACK,o=!0);o&&(n.isWebGL2?e.drawBuffers(i):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(i))},useProgram:function(t){return v!==t&&(e.useProgram(t),v=t,!0)},setBlending:Ie,setMaterial:function(t,n){t.side===Y?q(e.CULL_FACE):X(e.CULL_FACE);var r=t.side===K;n&&(r=!r),Ae(r),t.blending===Q&&!1===t.transparent?Ie(J):Ie(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),o.setMask(t.colorWrite);var a=t.stencilWrite;u.setTest(a),a&&(u.setMask(t.stencilWriteMask),u.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),u.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Ne(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?X(e.SAMPLE_ALPHA_TO_COVERAGE):q(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Ae,setCullFace:Re,setLineWidth:function(t){t!==C&&(N&&e.lineWidth(t),C=t)},setPolygonOffset:Ne,setScissorTest:function(t){t?X(e.SCISSOR_TEST):q(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+R-1),D!==t&&(e.activeTexture(t),D=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===D?e.TEXTURE0+R-1:D);var a=F[r];void 0===a&&(a={type:void 0,texture:void 0},F[r]=a),a.type===t&&a.texture===n||(D!==r&&(e.activeTexture(r),D=r),e.bindTexture(t,n||j[t]),a.type=t,a.texture=n)},unbindTexture:function(){var t=F[D];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){var r=c.get(n);void 0===r&&(r=new WeakMap,c.set(n,r));var a=r.get(t);void 0===a&&(a=e.getUniformBlockIndex(n,t.name),r.set(t,a))},uniformBlockBinding:function(t,n){var r=c.get(n).get(t);l.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),l.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===V.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),V.copy(t))},viewport:function(t){!1===G.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),G.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},D=null,F={},d={},f=new WeakMap,p=[],v=null,m=!1,g=null,y=null,b=null,x=null,w=null,S=null,_=null,E=!1,T=null,M=null,C=null,I=null,A=null,V.set(0,0,e.canvas.width,e.canvas.height),G.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),u.reset()}}}function Hu(e,t,n,r,a,i,o){var s,u,l,c=a.isWebGL2,h=a.maxTextures,d=a.maxCubemapSize,f=a.maxTextureSize,p=a.maxSamples,v=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,m="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,y=new WeakMap,b=!1;try{b="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(j){}function x(e,t){return b?new OffscreenCanvas(e,t):br("canvas")}function w(e,t,n,r){var a=1;if((e.width>r||e.height>r)&&(a=r/Math.max(e.width,e.height)),a<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var i=t?lr:Math.floor,o=i(a*e.width),s=i(a*e.height);void 0===l&&(l=x(o,s));var u=n?x(o,s):l;return u.width=o,u.height=s,u.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function S(e){return sr(e.width)&&sr(e.height)}function _(e,t){return e.generateMipmaps&&t&&e.minFilter!==je&&e.minFilter!==Ze}function E(t){e.generateMipmap(t)}function T(n,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===c)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var s=r;return r===e.RED&&(a===e.FLOAT&&(s=e.R32F),a===e.HALF_FLOAT&&(s=e.R16F),a===e.UNSIGNED_BYTE&&(s=e.R8)),r===e.RG&&(a===e.FLOAT&&(s=e.RG32F),a===e.HALF_FLOAT&&(s=e.RG16F),a===e.UNSIGNED_BYTE&&(s=e.RG8)),r===e.RGBA&&(a===e.FLOAT&&(s=e.RGBA32F),a===e.HALF_FLOAT&&(s=e.RGBA16F),a===e.UNSIGNED_BYTE&&(s=i===wn&&!1===o?e.SRGB8_ALPHA8:e.RGBA8),a===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),a===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)),s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||t.get("EXT_color_buffer_float"),s}function M(e,t,n){return!0===_(e,n)||e.isFramebufferTexture&&e.minFilter!==je&&e.minFilter!==Ze?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function C(t){return t===je||t===Xe||t===Ke?e.NEAREST:e.LINEAR}function I(e){var t=e.target;t.removeEventListener("dispose",I),function(e){var t=r.get(e);if(void 0===t.__webglInit)return;var n=e.source,a=y.get(n);if(a){var i=a[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&R(e),0===Object.keys(a).length&&y.delete(n)}r.remove(e)}(t),t.isVideoTexture&&g.delete(t)}function A(t){var n=t.target;n.removeEventListener("dispose",A),function(t){var n=t.texture,a=r.get(t),i=r.get(n);void 0!==i.__webglTexture&&(e.deleteTexture(i.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(a.__webglFramebuffer[s]),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer[s]);else{if(e.deleteFramebuffer(a.__webglFramebuffer),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer),a.__webglMultisampledFramebuffer&&e.deleteFramebuffer(a.__webglMultisampledFramebuffer),a.__webglColorRenderbuffer)for(var u=0;u<a.__webglColorRenderbuffer.length;u++)a.__webglColorRenderbuffer[u]&&e.deleteRenderbuffer(a.__webglColorRenderbuffer[u]);a.__webglDepthRenderbuffer&&e.deleteRenderbuffer(a.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(var l=0,c=n.length;l<c;l++){var h=r.get(n[l]);h.__webglTexture&&(e.deleteTexture(h.__webglTexture),o.memory.textures--),r.remove(n[l])}r.remove(n),r.remove(t)}(n)}function R(t){var n=r.get(t);e.deleteTexture(n.__webglTexture);var a=t.source;delete y.get(a)[n.__cacheKey],o.memory.textures--}var N=0;function L(t,a){var i=r.get(t);if(t.isVideoTexture&&function(e){var t=o.render.frame;g.get(e)!==t&&(g.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&i.__version!==t.version){var s=t.image;if(null===s)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==s.complete)return void z(i,t,a);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,i.__webglTexture,e.TEXTURE0+a)}var P=(k(s={},Ve,e.REPEAT),k(s,Ge,e.CLAMP_TO_EDGE),k(s,He,e.MIRRORED_REPEAT),s),D=(k(u={},je,e.NEAREST),k(u,Xe,e.NEAREST_MIPMAP_NEAREST),k(u,Ke,e.NEAREST_MIPMAP_LINEAR),k(u,Ze,e.LINEAR),k(u,Je,e.LINEAR_MIPMAP_NEAREST),k(u,$e,e.LINEAR_MIPMAP_LINEAR),u);function F(n,i,o){if(o?(e.texParameteri(n,e.TEXTURE_WRAP_S,P[i.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,P[i.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,P[i.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,D[i.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,D[i.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),i.wrapS===Ge&&i.wrapT===Ge||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,C(i.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,C(i.minFilter)),i.minFilter!==je&&i.minFilter!==Ze&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(i.magFilter===je)return;if(i.minFilter!==Ke&&i.minFilter!==$e)return;if(i.type===st&&!1===t.has("OES_texture_float_linear"))return;if(!1===c&&i.type===ut&&!1===t.has("OES_texture_half_float_linear"))return;(i.anisotropy>1||r.get(i).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,a.getMaxAnisotropy())),r.get(i).__currentAnisotropy=i.anisotropy)}}function O(t,n){var r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",I));var a=n.source,i=y.get(a);void 0===i&&(i={},y.set(a,i));var s=function(e){var t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===i[s]&&(i[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),i[s].usedTimes++;var u=i[t.__cacheKey];void 0!==u&&(i[t.__cacheKey].usedTimes--,0===u.usedTimes&&R(n)),t.__cacheKey=s,t.__webglTexture=i[s].texture}return r}function z(t,a,o){var s=e.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(s=e.TEXTURE_2D_ARRAY),a.isData3DTexture&&(s=e.TEXTURE_3D);var u=O(t,a),l=a.source;n.bindTexture(s,t.__webglTexture,e.TEXTURE0+o);var h=r.get(l);if(l.version!==h.__version||!0===u){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);var d,p=function(e){return!c&&(e.wrapS!==Ge||e.wrapT!==Ge||e.minFilter!==je&&e.minFilter!==Ze)}(a)&&!1===S(a.image),v=w(a.image,p,!1,f),m=S(v=H(a,v))||c,g=i.convert(a.format,a.colorSpace),y=i.convert(a.type),b=T(a.internalFormat,g,y,a.colorSpace);F(s,a,m);var x=a.mipmaps,k=c&&!0!==a.isVideoTexture,C=void 0===h.__version||!0===u,I=M(a,v,m);if(a.isDepthTexture)b=e.DEPTH_COMPONENT,c?b=a.type===st?e.DEPTH_COMPONENT32F:a.type===ot?e.DEPTH_COMPONENT24:a.type===ht?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:a.type===st&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),a.format===mt&&b===e.DEPTH_COMPONENT&&a.type!==at&&a.type!==ot&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),a.type=ot,y=i.convert(a.type)),a.format===gt&&b===e.DEPTH_COMPONENT&&(b=e.DEPTH_STENCIL,a.type!==ht&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),a.type=ht,y=i.convert(a.type))),C&&(k?n.texStorage2D(e.TEXTURE_2D,1,b,v.width,v.height):n.texImage2D(e.TEXTURE_2D,0,b,v.width,v.height,0,g,y,null));else if(a.isDataTexture)if(x.length>0&&m){k&&C&&n.texStorage2D(e.TEXTURE_2D,I,b,x[0].width,x[0].height);for(var A=0,R=x.length;A<R;A++)d=x[A],k?n.texSubImage2D(e.TEXTURE_2D,A,0,0,d.width,d.height,g,y,d.data):n.texImage2D(e.TEXTURE_2D,A,b,d.width,d.height,0,g,y,d.data);a.generateMipmaps=!1}else k?(C&&n.texStorage2D(e.TEXTURE_2D,I,b,v.width,v.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,v.width,v.height,g,y,v.data)):n.texImage2D(e.TEXTURE_2D,0,b,v.width,v.height,0,g,y,v.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){k&&C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,b,x[0].width,x[0].height,v.depth);for(var N=0,L=x.length;N<L;N++)d=x[N],a.format!==ft?null!==g?k?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,N,0,0,0,d.width,d.height,v.depth,g,d.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,N,b,d.width,d.height,v.depth,0,d.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):k?n.texSubImage3D(e.TEXTURE_2D_ARRAY,N,0,0,0,d.width,d.height,v.depth,g,y,d.data):n.texImage3D(e.TEXTURE_2D_ARRAY,N,b,d.width,d.height,v.depth,0,g,y,d.data)}else{k&&C&&n.texStorage2D(e.TEXTURE_2D,I,b,x[0].width,x[0].height);for(var P=0,D=x.length;P<D;P++)d=x[P],a.format!==ft?null!==g?k?n.compressedTexSubImage2D(e.TEXTURE_2D,P,0,0,d.width,d.height,g,d.data):n.compressedTexImage2D(e.TEXTURE_2D,P,b,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):k?n.texSubImage2D(e.TEXTURE_2D,P,0,0,d.width,d.height,g,y,d.data):n.texImage2D(e.TEXTURE_2D,P,b,d.width,d.height,0,g,y,d.data)}else if(a.isDataArrayTexture)k?(C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,b,v.width,v.height,v.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,v.width,v.height,v.depth,g,y,v.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,b,v.width,v.height,v.depth,0,g,y,v.data);else if(a.isData3DTexture)k?(C&&n.texStorage3D(e.TEXTURE_3D,I,b,v.width,v.height,v.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,v.width,v.height,v.depth,g,y,v.data)):n.texImage3D(e.TEXTURE_3D,0,b,v.width,v.height,v.depth,0,g,y,v.data);else if(a.isFramebufferTexture){if(C)if(k)n.texStorage2D(e.TEXTURE_2D,I,b,v.width,v.height);else for(var z=v.width,U=v.height,B=0;B<I;B++)n.texImage2D(e.TEXTURE_2D,B,b,z,U,0,g,y,null),z>>=1,U>>=1}else if(x.length>0&&m){k&&C&&n.texStorage2D(e.TEXTURE_2D,I,b,x[0].width,x[0].height);for(var W=0,V=x.length;W<V;W++)d=x[W],k?n.texSubImage2D(e.TEXTURE_2D,W,0,0,g,y,d):n.texImage2D(e.TEXTURE_2D,W,b,g,y,d);a.generateMipmaps=!1}else k?(C&&n.texStorage2D(e.TEXTURE_2D,I,b,v.width,v.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,g,y,v)):n.texImage2D(e.TEXTURE_2D,0,b,g,y,v);_(a,m)&&E(s),h.__version=l.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}function U(t,a,o,s,u){var l=i.convert(o.format,o.colorSpace),c=i.convert(o.type),h=T(o.internalFormat,l,c,o.colorSpace);r.get(a).__hasExternalTextures||(u===e.TEXTURE_3D||u===e.TEXTURE_2D_ARRAY?n.texImage3D(u,0,h,a.width,a.height,a.depth,0,l,c,null):n.texImage2D(u,0,h,a.width,a.height,0,l,c,null)),n.bindFramebuffer(e.FRAMEBUFFER,t),G(a)?v.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,u,r.get(o).__webglTexture,0,V(a)):(u===e.TEXTURE_2D||u>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,s,u,r.get(o).__webglTexture,0),n.bindFramebuffer(e.FRAMEBUFFER,null)}function B(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){var a=e.DEPTH_COMPONENT16;if(r||G(n)){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===st?a=e.DEPTH_COMPONENT32F:o.type===ot&&(a=e.DEPTH_COMPONENT24));var s=V(n);G(n)?v.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,s,a,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,s,a,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,a,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){var u=V(n);r&&!1===G(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,e.DEPTH24_STENCIL8,n.width,n.height):G(n)?v.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else for(var l=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture],c=0;c<l.length;c++){var h=l[c],d=i.convert(h.format,h.colorSpace),f=i.convert(h.type),p=T(h.internalFormat,d,f,h.colorSpace),m=V(n);r&&!1===G(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,m,p,n.width,n.height):G(n)?v.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,m,p,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,p,n.width,n.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function W(t){var a=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!a.__autoAllocateDepthBuffer){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,a){if(a&&a.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!a.depthTexture||!a.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(a.depthTexture).__webglTexture&&a.depthTexture.image.width===a.width&&a.depthTexture.image.height===a.height||(a.depthTexture.image.width=a.width,a.depthTexture.image.height=a.height,a.depthTexture.needsUpdate=!0),L(a.depthTexture,0);var i=r.get(a.depthTexture).__webglTexture,o=V(a);if(a.depthTexture.format===mt)G(a)?v.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0);else{if(a.depthTexture.format!==gt)throw new Error("Unknown depthTexture format");G(a)?v.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,i,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,i,0)}}(a.__webglFramebuffer,t)}else if(i){a.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer[o]),a.__webglDepthbuffer[o]=e.createRenderbuffer(),B(a.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer),a.__webglDepthbuffer=e.createRenderbuffer(),B(a.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function V(e){return Math.min(p,e.samples)}function G(e){var n=r.get(e);return c&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function H(e,n){var r=e.colorSpace,a=e.format,i=e.type;return!0===e.isCompressedTexture||e.format===Jn||r!==kn&&r!==xn&&(r===wn?!1===c?!0===t.has("EXT_sRGB")&&a===ft?(e.format=Jn,e.minFilter=Ze,e.generateMipmaps=!1):n=Ar.sRGBToLinear(n):a===ft&&i===tt||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),n}this.allocateTextureUnit=function(){var e=N;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),N+=1,e},this.resetTextureUnits=function(){N=0},this.setTexture2D=L,this.setTexture2DArray=function(t,a){var i=r.get(t);t.version>0&&i.__version!==t.version?z(i,t,a):n.bindTexture(e.TEXTURE_2D_ARRAY,i.__webglTexture,e.TEXTURE0+a)},this.setTexture3D=function(t,a){var i=r.get(t);t.version>0&&i.__version!==t.version?z(i,t,a):n.bindTexture(e.TEXTURE_3D,i.__webglTexture,e.TEXTURE0+a)},this.setTextureCube=function(t,a){var o=r.get(t);t.version>0&&o.__version!==t.version?function(t,a,o){if(6!==a.image.length)return;var s=O(t,a),u=a.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);var l=r.get(u);if(u.version!==l.__version||!0===s){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);for(var h=a.isCompressedTexture||a.image[0].isCompressedTexture,f=a.image[0]&&a.image[0].isDataTexture,p=[],v=0;v<6;v++)p[v]=h||f?f?a.image[v].image:a.image[v]:w(a.image[v],!1,!0,d),p[v]=H(a,p[v]);var m,g=p[0],y=S(g)||c,b=i.convert(a.format,a.colorSpace),x=i.convert(a.type),k=T(a.internalFormat,b,x,a.colorSpace),C=c&&!0!==a.isVideoTexture,I=void 0===l.__version||!0===s,A=M(a,g,y);if(F(e.TEXTURE_CUBE_MAP,a,y),h){C&&I&&n.texStorage2D(e.TEXTURE_CUBE_MAP,A,k,g.width,g.height);for(var R=0;R<6;R++){m=p[R].mipmaps;for(var N=0;N<m.length;N++){var L=m[N];a.format!==ft?null!==b?C?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,N,0,0,L.width,L.height,b,L.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,N,k,L.width,L.height,0,L.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,N,0,0,L.width,L.height,b,x,L.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,N,k,L.width,L.height,0,b,x,L.data)}}}else{m=a.mipmaps,C&&I&&(m.length>0&&A++,n.texStorage2D(e.TEXTURE_CUBE_MAP,A,k,p[0].width,p[0].height));for(var P=0;P<6;P++)if(f){C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,0,0,p[P].width,p[P].height,b,x,p[P].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,k,p[P].width,p[P].height,0,b,x,p[P].data);for(var D=0;D<m.length;D++){var z=m[D].image[P].image;C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,D+1,0,0,z.width,z.height,b,x,z.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,D+1,k,z.width,z.height,0,b,x,z.data)}}else{C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,0,0,b,x,p[P]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,k,b,x,p[P]);for(var U=0;U<m.length;U++){var B=m[U];C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,U+1,0,0,b,x,B.image[P]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,U+1,k,b,x,B.image[P])}}}_(a,y)&&E(e.TEXTURE_CUBE_MAP),l.__version=u.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}(o,t,a):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+a)},this.rebindTextures=function(t,n,a){var i=r.get(t);void 0!==n&&U(i.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),void 0!==a&&W(t)},this.setupRenderTarget=function(t){var s=t.texture,u=r.get(t),l=r.get(s);t.addEventListener("dispose",A),!0!==t.isWebGLMultipleRenderTargets&&(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=s.version,o.memory.textures++);var h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,f=S(t)||c;if(h){u.__webglFramebuffer=[];for(var p=0;p<6;p++)u.__webglFramebuffer[p]=e.createFramebuffer()}else{if(u.__webglFramebuffer=e.createFramebuffer(),d)if(a.drawBuffers)for(var v=t.texture,m=0,g=v.length;m<g;m++){var y=r.get(v[m]);void 0===y.__webglTexture&&(y.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(c&&t.samples>0&&!1===G(t)){var b=d?s:[s];u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer);for(var x=0;x<b.length;x++){var w=b[x];u.__webglColorRenderbuffer[x]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,u.__webglColorRenderbuffer[x]);var k=i.convert(w.format,w.colorSpace),M=i.convert(w.type),C=T(w.internalFormat,k,M,w.colorSpace,!0===t.isXRRenderTarget),I=V(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,I,C,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+x,e.RENDERBUFFER,u.__webglColorRenderbuffer[x])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),B(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(h){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),F(e.TEXTURE_CUBE_MAP,s,f);for(var R=0;R<6;R++)U(u.__webglFramebuffer[R],t,s,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+R);_(s,f)&&E(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){for(var N=t.texture,L=0,P=N.length;L<P;L++){var D=N[L],O=r.get(D);n.bindTexture(e.TEXTURE_2D,O.__webglTexture),F(e.TEXTURE_2D,D,f),U(u.__webglFramebuffer,t,D,e.COLOR_ATTACHMENT0+L,e.TEXTURE_2D),_(D,f)&&E(e.TEXTURE_2D)}n.unbindTexture()}else{var z=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(c?z=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(z,l.__webglTexture),F(z,s,f),U(u.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0,z),_(s,f)&&E(z),n.unbindTexture()}t.depthBuffer&&W(t)},this.updateRenderTargetMipmap=function(t){for(var a=S(t)||c,i=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=0,s=i.length;o<s;o++){var u=i[o];if(_(u,a)){var l=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,h=r.get(u).__webglTexture;n.bindTexture(l,h),E(l),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(c&&t.samples>0&&!1===G(t)){var a=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],i=t.width,o=t.height,s=e.COLOR_BUFFER_BIT,u=[],l=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,h=r.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(var f=0;f<a.length;f++)n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+f,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+f,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(var p=0;p<a.length;p++){u.push(e.COLOR_ATTACHMENT0+p),t.depthBuffer&&u.push(l);var v=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===v&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),d&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,h.__webglColorRenderbuffer[p]),!0===v&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[l]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[l])),d){var g=r.get(a[p]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,g,0)}e.blitFramebuffer(0,0,i,o,0,0,i,o,s,e.NEAREST),m&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,u)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(var y=0;y<a.length;y++){n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+y,e.RENDERBUFFER,h.__webglColorRenderbuffer[y]);var b=r.get(a[y]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+y,e.TEXTURE_2D,b,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=W,this.setupFrameBufferTexture=U,this.useMultisampledRTT=G}function ju(e,t,n){var r=n.isWebGL2;return{convert:function(n){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xn;if(n===tt)return e.UNSIGNED_BYTE;if(n===lt)return e.UNSIGNED_SHORT_4_4_4_4;if(n===ct)return e.UNSIGNED_SHORT_5_5_5_1;if(n===nt)return e.BYTE;if(n===rt)return e.SHORT;if(n===at)return e.UNSIGNED_SHORT;if(n===it)return e.INT;if(n===ot)return e.UNSIGNED_INT;if(n===st)return e.FLOAT;if(n===ut)return r?e.HALF_FLOAT:null!==(a=t.get("OES_texture_half_float"))?a.HALF_FLOAT_OES:null;if(n===dt)return e.ALPHA;if(n===ft)return e.RGBA;if(n===pt)return e.LUMINANCE;if(n===vt)return e.LUMINANCE_ALPHA;if(n===mt)return e.DEPTH_COMPONENT;if(n===gt)return e.DEPTH_STENCIL;if(n===Jn)return null!==(a=t.get("EXT_sRGB"))?a.SRGB_ALPHA_EXT:null;if(n===yt)return e.RED;if(n===bt)return e.RED_INTEGER;if(n===xt)return e.RG;if(n===wt)return e.RG_INTEGER;if(n===kt)return e.RGBA_INTEGER;if(n===St||n===_t||n===Et||n===Tt)if(i===wn){if(null===(a=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===St)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===_t)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Et)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Tt)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(a=t.get("WEBGL_compressed_texture_s3tc")))return null;if(n===St)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===_t)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Et)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Tt)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Mt||n===Ct||n===It||n===At){if(null===(a=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===Mt)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ct)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===It)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===At)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Rt)return null!==(a=t.get("WEBGL_compressed_texture_etc1"))?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===Nt||n===Lt){if(null===(a=t.get("WEBGL_compressed_texture_etc")))return null;if(n===Nt)return i===wn?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(n===Lt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(n===Pt||n===Dt||n===Ft||n===Ot||n===zt||n===Ut||n===Bt||n===Wt||n===Vt||n===Gt||n===Ht||n===jt||n===Xt||n===qt){if(null===(a=t.get("WEBGL_compressed_texture_astc")))return null;if(n===Pt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Dt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Ft)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ot)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===zt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Ut)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Bt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Wt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Vt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Gt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Ht)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===jt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Xt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===qt)return i===wn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Kt){if(null===(a=t.get("EXT_texture_compression_bptc")))return null;if(n===Kt)return i===wn?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(n===Yt||n===Zt||n===Jt||n===Qt){if(null===(a=t.get("EXT_texture_compression_rgtc")))return null;if(n===Kt)return a.COMPRESSED_RED_RGTC1_EXT;if(n===Zt)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Jt)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Qt)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===ht?r?e.UNSIGNED_INT_24_8:null!==(a=t.get("WEBGL_depth_texture"))?a.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[n]?e[n]:null}}}var Xu=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return E(this,n),(e=t.call(this)).isArrayCamera=!0,e.cameras=r,e}return M(n)}(co),qu=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).isGroup=!0,e.type="Group",e}return M(n)}(Ha),Ku={type:"move"},Yu=function(){function e(){E(this,e),this._targetRay=null,this._grip=null,this._hand=null}return M(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new qu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new qu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Gr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Gr),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new qu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Gr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Gr),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"connect",value:function(e){if(e&&e.hand){var t=this._hand;if(t){var n,r=N(e.hand.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;this._getHandJoint(t,a)}}catch(i){r.e(i)}finally{r.f()}}}return this.dispatchEvent({type:"connected",data:e}),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var r=null,a=null,i=null,o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(u&&e.hand){i=!0;var l,c=N(e.hand.values());try{for(c.s();!(l=c.n()).done;){var h=l.value,d=t.getJointPose(h,n),f=this._getHandJoint(u,h);null!==d&&(f.matrix.fromArray(d.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,f.jointRadius=d.radius),f.visible=null!==d}}catch(g){c.e(g)}finally{c.f()}var p=u.joints["index-finger-tip"],v=u.joints["thumb-tip"],m=p.position.distanceTo(v.position);u.inputState.pinching&&m>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&m<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(a=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(a.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,a.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(a.linearVelocity)):s.hasLinearVelocity=!1,a.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(a.angularVelocity)):s.hasAngularVelocity=!1);null!==o&&(null===(r=t.getPose(e.targetRaySpace,n))&&null!==a&&(r=a),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ku)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==a),null!==u&&(u.visible=null!==i),this}},{key:"_getHandJoint",value:function(e,t){if(void 0===e.joints[t.jointName]){var n=new qu;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}]),e}(),Zu=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s,u,l,c,h){var d;if(E(this,n),(h=void 0!==h?h:mt)!==mt&&h!==gt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===a&&h===mt&&(a=ot),void 0===a&&h===gt&&(a=ht),(d=t.call(this,null,i,o,s,u,l,h,a,c)).isDepthTexture=!0,d.image={width:e,height:r},d.magFilter=void 0!==u?u:je,d.minFilter=void 0!==l?l:je,d.flipY=!1,d.generateMipmaps=!1,d}return M(n)}(Pr),Ju=function(e){C(n,e);var t=R(n);function n(e,r){var a;E(this,n);var i=A(a=t.call(this)),o=null,s=1,l=null,h="local-floor",d=1,f=null,p=null,v=null,m=null,g=null,y=null,b=r.getContextAttributes(),x=null,w=null,k=[],S=[],_=new Set,T=new Map,M=new co;M.layers.enable(1),M.viewport=new Dr;var C=new co;C.layers.enable(2),C.viewport=new Dr;var I=[M,C],R=new Xu;R.layers.enable(1),R.layers.enable(2);var L=null,P=null;function D(e){var t=S.indexOf(e.inputSource);if(-1!==t){var n=k[t];void 0!==n&&(n.update(e.inputSource,e.frame,f||l),n.dispatchEvent({type:e.type,data:e.inputSource}))}}function F(){o.removeEventListener("select",D),o.removeEventListener("selectstart",D),o.removeEventListener("selectend",D),o.removeEventListener("squeeze",D),o.removeEventListener("squeezestart",D),o.removeEventListener("squeezeend",D),o.removeEventListener("end",F),o.removeEventListener("inputsourceschange",O);for(var t=0;t<k.length;t++){var n=S[t];null!==n&&(S[t]=null,k[t].disconnect(n))}L=null,P=null,e.setRenderTarget(x),g=null,m=null,v=null,o=null,w=null,V.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function O(e){for(var t=0;t<e.removed.length;t++){var n=e.removed[t],r=S.indexOf(n);r>=0&&(S[r]=null,k[r].disconnect(n))}for(var a=0;a<e.added.length;a++){var i=e.added[a],o=S.indexOf(i);if(-1===o){for(var s=0;s<k.length;s++){if(s>=S.length){S.push(i),o=s;break}if(null===S[s]){S[s]=i,o=s;break}}if(-1===o)break}var u=k[o];u&&u.connect(i)}}a.cameraAutoUpdate=!0,a.enabled=!1,a.isPresenting=!1,a.getController=function(e){var t=k[e];return void 0===t&&(t=new Yu,k[e]=t),t.getTargetRaySpace()},a.getControllerGrip=function(e){var t=k[e];return void 0===t&&(t=new Yu,k[e]=t),t.getGripSpace()},a.getHand=function(e){var t=k[e];return void 0===t&&(t=new Yu,k[e]=t),t.getHandSpace()},a.setFramebufferScaleFactor=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},a.setReferenceSpaceType=function(e){h=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},a.getReferenceSpace=function(){return f||l},a.setReferenceSpace=function(e){f=e},a.getBaseLayer=function(){return null!==m?m:g},a.getBinding=function(){return v},a.getFrame=function(){return y},a.getSession=function(){return o},a.setSession=function(){var t=c(u().mark((function t(n){var a,c,p,y,k;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(o=n)){t.next=25;break}if(x=e.getRenderTarget(),o.addEventListener("select",D),o.addEventListener("selectstart",D),o.addEventListener("selectend",D),o.addEventListener("squeeze",D),o.addEventListener("squeezestart",D),o.addEventListener("squeezeend",D),o.addEventListener("end",F),o.addEventListener("inputsourceschange",O),!0===b.xrCompatible){t.next=14;break}return t.next=14,r.makeXRCompatible();case 14:return void 0===o.renderState.layers||!1===e.capabilities.isWebGL2?(a={antialias:void 0!==o.renderState.layers||b.antialias,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:s},g=new XRWebGLLayer(o,r,a),o.updateRenderState({baseLayer:g}),w=new Fr(g.framebufferWidth,g.framebufferHeight,{format:ft,type:tt,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil})):(c=null,p=null,y=null,b.depth&&(y=b.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,c=b.stencil?gt:mt,p=b.stencil?ht:ot),k={colorFormat:r.RGBA8,depthFormat:y,scaleFactor:s},v=new XRWebGLBinding(o,r),m=v.createProjectionLayer(k),o.updateRenderState({layers:[m]}),w=new Fr(m.textureWidth,m.textureHeight,{format:ft,type:tt,depthTexture:new Zu(m.textureWidth,m.textureHeight,p,void 0,void 0,void 0,void 0,void 0,void 0,c),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0}),e.properties.get(w).__ignoreDepthValues=m.ignoreDepthValues),w.isXRRenderTarget=!0,this.setFoveation(d),f=null,t.next=20,o.requestReferenceSpace(h);case 20:l=t.sent,V.setContext(o),V.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"});case 25:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),a.getEnvironmentBlendMode=function(){if(null!==o)return o.environmentBlendMode};var z=new Gr,U=new Gr;function B(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}a.updateCamera=function(e){if(null!==o){R.near=C.near=M.near=e.near,R.far=C.far=M.far=e.far,L===R.near&&P===R.far||(o.updateRenderState({depthNear:R.near,depthFar:R.far}),L=R.near,P=R.far);var t=e.parent,n=R.cameras;B(R,t);for(var r=0;r<n.length;r++)B(n[r],t);2===n.length?function(e,t,n){z.setFromMatrixPosition(t.matrixWorld),U.setFromMatrixPosition(n.matrixWorld);var r=z.distanceTo(U),a=t.projectionMatrix.elements,i=n.projectionMatrix.elements,o=a[14]/(a[10]-1),s=a[14]/(a[10]+1),u=(a[9]+1)/a[5],l=(a[9]-1)/a[5],c=(a[8]-1)/a[0],h=(i[8]+1)/i[0],d=o*c,f=o*h,p=r/(-c+h),v=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(v),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var m=o+p,g=s+p,y=d-v,b=f+(r-v),x=u*s/g*m,w=l*s/g*m;e.projectionMatrix.makePerspective(y,b,x,w,m,g),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(R,M,C):R.projectionMatrix.copy(M.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0);for(var r=e.children,a=0,i=r.length;a<i;a++)r[a].updateMatrixWorld(!0);e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*nr*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,R,t)}},a.getCamera=function(){return R},a.getFoveation=function(){if(null!==m||null!==g)return d},a.setFoveation=function(e){d=e,null!==m&&(m.fixedFoveation=e),null!==g&&void 0!==g.fixedFoveation&&(g.fixedFoveation=e)},a.getPlanes=function(){return _};var W=null;var V=new So;return V.setAnimationLoop((function(t,n){if(p=n.getViewerPose(f||l),y=n,null!==p){var r=p.views;null!==g&&(e.setRenderTargetFramebuffer(w,g.framebuffer),e.setRenderTarget(w));var a=!1;r.length!==R.cameras.length&&(R.cameras.length=0,a=!0);for(var o=0;o<r.length;o++){var s=r[o],u=null;if(null!==g)u=g.getViewport(s);else{var c=v.getViewSubImage(m,s);u=c.viewport,0===o&&(e.setRenderTargetTextures(w,c.colorTexture,m.ignoreDepthValues?void 0:c.depthStencilTexture),e.setRenderTarget(w))}var h=I[o];void 0===h&&((h=new co).layers.enable(o),h.viewport=new Dr,I[o]=h),h.matrix.fromArray(s.transform.matrix),h.matrix.decompose(h.position,h.quaternion,h.scale),h.projectionMatrix.fromArray(s.projectionMatrix),h.projectionMatrixInverse.copy(h.projectionMatrix).invert(),h.viewport.set(u.x,u.y,u.width,u.height),0===o&&(R.matrix.copy(h.matrix),R.matrix.decompose(R.position,R.quaternion,R.scale)),!0===a&&R.cameras.push(h)}}for(var d=0;d<k.length;d++){var b=S[d],x=k[d];null!==b&&void 0!==x&&x.update(b,n,f||l)}if(W&&W(t,n),n.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:n.detectedPlanes});var E,M=null,C=N(_);try{for(C.s();!(E=C.n()).done;){var A=E.value;n.detectedPlanes.has(A)||(null===M&&(M=[]),M.push(A))}}catch(B){C.e(B)}finally{C.f()}if(null!==M){var L,P=N(M);try{for(P.s();!(L=P.n()).done;){var D=L.value;_.delete(D),T.delete(D),i.dispatchEvent({type:"planeremoved",data:D})}}catch(B){P.e(B)}finally{P.f()}}var F,O=N(n.detectedPlanes);try{for(O.s();!(F=O.n()).done;){var z=F.value;if(_.has(z)){var U=T.get(z);z.lastChangedTime>U&&(T.set(z,z.lastChangedTime),i.dispatchEvent({type:"planechanged",data:z}))}else _.add(z),T.set(z,n.lastChangedTime),i.dispatchEvent({type:"planeadded",data:z})}}catch(B){O.e(B)}finally{O.f()}}y=null})),a.setAnimationLoop=function(e){W=e},a.dispose=function(){},a}return M(n)}(Qn);function Qu(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(r,a){r.opacity.value=a.opacity,a.color&&r.diffuse.value.copy(a.color),a.emissive&&r.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity),a.map&&(r.map.value=a.map,n(a.map,r.mapTransform)),a.alphaMap&&(r.alphaMap.value=a.alphaMap,n(a.alphaMap,r.alphaMapTransform)),a.bumpMap&&(r.bumpMap.value=a.bumpMap,n(a.bumpMap,r.bumpMapTransform),r.bumpScale.value=a.bumpScale,a.side===K&&(r.bumpScale.value*=-1)),a.normalMap&&(r.normalMap.value=a.normalMap,n(a.normalMap,r.normalMapTransform),r.normalScale.value.copy(a.normalScale),a.side===K&&r.normalScale.value.negate()),a.displacementMap&&(r.displacementMap.value=a.displacementMap,n(a.displacementMap,r.displacementMapTransform),r.displacementScale.value=a.displacementScale,r.displacementBias.value=a.displacementBias),a.emissiveMap&&(r.emissiveMap.value=a.emissiveMap,n(a.emissiveMap,r.emissiveMapTransform)),a.specularMap&&(r.specularMap.value=a.specularMap,n(a.specularMap,r.specularMapTransform)),a.alphaTest>0&&(r.alphaTest.value=a.alphaTest);var i=t.get(a).envMap;if(i&&(r.envMap.value=i,r.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,r.reflectivity.value=a.reflectivity,r.ior.value=a.ior,r.refractionRatio.value=a.refractionRatio),a.lightMap){r.lightMap.value=a.lightMap;var o=!0===e.useLegacyLights?Math.PI:1;r.lightMapIntensity.value=a.lightMapIntensity*o,n(a.lightMap,r.lightMapTransform)}a.aoMap&&(r.aoMap.value=a.aoMap,r.aoMapIntensity.value=a.aoMapIntensity,n(a.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,oo(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,a,i,o,s){a.isMeshBasicMaterial||a.isMeshLambertMaterial?r(e,a):a.isMeshToonMaterial?(r(e,a),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,a)):a.isMeshPhongMaterial?(r(e,a),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,a)):a.isMeshStandardMaterial?(r(e,a),function(e,r){e.metalness.value=r.metalness,r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap,n(r.metalnessMap,e.metalnessMapTransform));e.roughness.value=r.roughness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap,n(r.roughnessMap,e.roughnessMapTransform));var a=t.get(r).envMap;a&&(e.envMapIntensity.value=r.envMapIntensity)}(e,a),a.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===K&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,a,s)):a.isMeshMatcapMaterial?(r(e,a),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,a)):a.isMeshDepthMaterial?r(e,a):a.isMeshDistanceMaterial?(r(e,a),function(e,n){var r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,a)):a.isMeshNormalMaterial?r(e,a):a.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,a),a.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,a)):a.isPointsMaterial?function(e,t,r,a){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*a,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,a,i,o):a.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,a):a.isShadowMaterial?(e.color.value.copy(a.color),e.opacity.value=a.opacity):a.isShaderMaterial&&(a.uniformsNeedUpdate=!1)}}}function $u(e,t,n,r){var a={},i={},o=[],s=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function u(e,t,n){var r=e.value;if(void 0===n[t]){if("number"===typeof r)n[t]=r;else{for(var a=Array.isArray(r)?r:[r],i=[],o=0;o<a.length;o++)i.push(a[o].clone());n[t]=i}return!0}if("number"===typeof r){if(n[t]!==r)return n[t]=r,!0}else for(var s=Array.isArray(n[t])?n[t]:[n[t]],u=Array.isArray(r)?r:[r],l=0;l<s.length;l++){var c=s[l];if(!1===c.equals(u[l]))return c.copy(u[l]),!0}return!1}function l(e){var t={boundary:0,storage:0};return"number"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){var n=t.target;n.removeEventListener("dispose",c);var r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(a[n.id]),delete a[n.id],delete i[n.id]}return{bind:function(e,t){var n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){var d=a[n.id];void 0===d&&(!function(e){for(var t=e.uniforms,n=0,r=16,a=0,i=0,o=t.length;i<o;i++){for(var s=t[i],u={boundary:0,storage:0},c=Array.isArray(s.value)?s.value:[s.value],h=0,d=c.length;h<d;h++){var f=l(c[h]);u.boundary+=f.boundary,u.storage+=f.storage}if(s.__data=new Float32Array(u.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=n,i>0)0!==(a=n%r)&&r-a-u.boundary<0&&(n+=r-a,s.__offset=n);n+=u.storage}(a=n%r)>0&&(n+=r-a);e.__size=n,e.__cache={}}(n),d=function(t){var n=function(){for(var e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;var r=e.createBuffer(),a=t.__size,i=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,a,i),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),a[n.id]=d,n.addEventListener("dispose",c));var f=h.program;r.updateUBOMapping(n,f);var p=t.render.frame;i[n.id]!==p&&(!function(t){var n=a[t.id],r=t.uniforms,i=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(var o=0,s=r.length;o<s;o++){var c=r[o];if(!0===u(c,o,i)){for(var h=c.__offset,d=Array.isArray(c.value)?c.value:[c.value],f=0,p=0;p<d.length;p++){var v=d[p],m=l(v);"number"===typeof v?(c.__data[0]=v,e.bufferSubData(e.UNIFORM_BUFFER,h+f,c.__data)):v.isMatrix3?(c.__data[0]=v.elements[0],c.__data[1]=v.elements[1],c.__data[2]=v.elements[2],c.__data[3]=v.elements[0],c.__data[4]=v.elements[3],c.__data[5]=v.elements[4],c.__data[6]=v.elements[5],c.__data[7]=v.elements[0],c.__data[8]=v.elements[6],c.__data[9]=v.elements[7],c.__data[10]=v.elements[8],c.__data[11]=v.elements[0]):(v.toArray(c.__data,f),f+=m.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,h,c.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),i[n.id]=p)},dispose:function(){for(var t in a)e.deleteBuffer(a[t]);o=[],a={},i={}}}}var el=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E(this,e);var n,r=t.canvas,a=void 0===r?function(){var e=br("canvas");return e.style.display="block",e}():r,i=t.context,o=void 0===i?null:i,s=t.depth,u=void 0===s||s,l=t.stencil,c=void 0===l||l,h=t.alpha,d=void 0!==h&&h,f=t.antialias,p=void 0!==f&&f,v=t.premultipliedAlpha,m=void 0===v||v,g=t.preserveDrawingBuffer,y=void 0!==g&&g,b=t.powerPreference,x=void 0===b?"default":b,w=t.failIfMajorPerformanceCaveat,k=void 0!==w&&w;this.isWebGLRenderer=!0,n=null!==o?o.getContextAttributes().alpha:d;var S=null,_=null,T=[],M=[];this.domElement=a,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=wn,this.useLegacyLights=!0,this.toneMapping=Ae,this.toneMappingExposure=1;var C=this,I=!1,A=0,R=0,N=null,L=-1,P=null,D=new Dr,O=new Dr,z=null,U=a.width,B=a.height,W=1,V=null,G=null,H=new Dr(0,0,U,B),j=new Dr(0,0,U,B),X=!1,Z=new ko,J=!1,Q=!1,$=null,ee=new ba,te=new Gr,ne={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function re(){return null===N?W:1}var ae,ie,oe,se,ue,le,ce,he,de,fe,pe,ve,me,ge,ye,be,xe,we,ke,Se,_e,Ee,Te,Me,Ce=o;function Ie(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=a.getContext(r,t);if(null!==i)return i}return null}try{var Re={alpha:!0,depth:u,stencil:c,antialias:p,premultipliedAlpha:m,preserveDrawingBuffer:y,powerPreference:x,failIfMajorPerformanceCaveat:k};if("setAttribute"in a&&a.setAttribute("data-engine","three.js r".concat(F)),a.addEventListener("webglcontextlost",De,!1),a.addEventListener("webglcontextrestored",Fe,!1),a.addEventListener("webglcontextcreationerror",Oe,!1),null===Ce){var Ne=["webgl2","webgl","experimental-webgl"];if(!0===C.isWebGL1Renderer&&Ne.shift(),null===(Ce=Ie(Ne,Re)))throw Ie(Ne)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Ce.getShaderPrecisionFormat&&(Ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ye){throw console.error("THREE.WebGLRenderer: "+Ye.message),Ye}function Le(){ae=new Jo(Ce),ie=new Lo(Ce,ae,t),ae.init(ie),Ee=new ju(Ce,ae,ie),oe=new Gu(Ce,ae,ie),se=new es(Ce),ue=new Iu,le=new Hu(Ce,ae,oe,ue,ie,Ee,se),ce=new Do(C),he=new Zo(C),de=new _o(Ce,ie),Te=new Ro(Ce,ae,de,ie),fe=new Qo(Ce,de,se,Te),pe=new as(Ce,fe,de,se),ke=new rs(Ce,ie,le),be=new Po(ue),ve=new Cu(C,ce,he,ae,ie,Te,be),me=new Qu(C,ue),ge=new Lu,ye=new Uu(ae,ie),we=new Ao(C,ce,he,oe,pe,n,m),xe=new Vu(C,pe,ie),Me=new $u(Ce,se,ie,oe),Se=new No(Ce,ae,se,ie),_e=new $o(Ce,ae,se,ie),se.programs=ve.programs,C.capabilities=ie,C.extensions=ae,C.properties=ue,C.renderLists=ge,C.shadowMap=xe,C.state=oe,C.info=se}Le();var Pe=new Ju(C,Ce);function De(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function Fe(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1;var e=se.autoReset,t=xe.enabled,n=xe.autoUpdate,r=xe.needsUpdate,a=xe.type;Le(),se.autoReset=e,xe.enabled=t,xe.autoUpdate=n,xe.needsUpdate=r,xe.type=a}function Oe(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function ze(e){var t=e.target;t.removeEventListener("dispose",ze),function(e){(function(e){var t=ue.get(e).programs;void 0!==t&&(t.forEach((function(e){ve.releaseProgram(e)})),e.isShaderMaterial&&ve.releaseShaderCache(e))})(e),ue.remove(e)}(t)}this.xr=Pe,this.getContext=function(){return Ce},this.getContextAttributes=function(){return Ce.getContextAttributes()},this.forceContextLoss=function(){var e=ae.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=ae.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(e){void 0!==e&&(W=e,this.setSize(U,B,!1))},this.getSize=function(e){return e.set(U,B)},this.setSize=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Pe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(U=e,B=t,a.width=Math.floor(e*W),a.height=Math.floor(t*W),!0===n&&(a.style.width=e+"px",a.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(U*W,B*W).floor()},this.setDrawingBufferSize=function(e,t,n){U=e,B=t,W=n,a.width=Math.floor(e*n),a.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(D)},this.getViewport=function(e){return e.copy(H)},this.setViewport=function(e,t,n,r){e.isVector4?H.set(e.x,e.y,e.z,e.w):H.set(e,t,n,r),oe.viewport(D.copy(H).multiplyScalar(W).floor())},this.getScissor=function(e){return e.copy(j)},this.setScissor=function(e,t,n,r){e.isVector4?j.set(e.x,e.y,e.z,e.w):j.set(e,t,n,r),oe.scissor(O.copy(j).multiplyScalar(W).floor())},this.getScissorTest=function(){return X},this.setScissorTest=function(e){oe.setScissorTest(X=e)},this.setOpaqueSort=function(e){V=e},this.setTransparentSort=function(e){G=e},this.getClearColor=function(e){return e.copy(we.getClearColor())},this.setClearColor=function(){we.setClearColor.apply(we,arguments)},this.getClearAlpha=function(){return we.getClearAlpha()},this.setClearAlpha=function(){we.setClearAlpha.apply(we,arguments)},this.clear=function(){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(n|=Ce.COLOR_BUFFER_BIT),e&&(n|=Ce.DEPTH_BUFFER_BIT),t&&(n|=Ce.STENCIL_BUFFER_BIT),Ce.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){a.removeEventListener("webglcontextlost",De,!1),a.removeEventListener("webglcontextrestored",Fe,!1),a.removeEventListener("webglcontextcreationerror",Oe,!1),ge.dispose(),ye.dispose(),ue.dispose(),ce.dispose(),he.dispose(),pe.dispose(),Te.dispose(),Me.dispose(),ve.dispose(),Pe.dispose(),Pe.removeEventListener("sessionstart",Be),Pe.removeEventListener("sessionend",We),$&&($.dispose(),$=null),Ve.stop()},this.renderBufferDirect=function(e,t,n,r,a,i){null===t&&(t=ne);var o=a.isMesh&&a.matrixWorld.determinant()<0,s=function(e,t,n,r,a){!0!==t.isScene&&(t=ne);le.resetTextureUnits();var i=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===N?C.outputColorSpace:!0===N.isXRRenderTarget?N.texture.colorSpace:kn,u=(r.isMeshStandardMaterial?he:ce).get(r.envMap||o),l=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!r.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,f=!!n.morphAttributes.color,p=r.toneMapped?C.toneMapping:Ae,v=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,m=void 0!==v?v.length:0,g=ue.get(r),y=_.state.lights;if(!0===J&&(!0===Q||e!==P)){var b=e===P&&r.id===L;be.setState(r,e,b)}var x=!1;r.version===g.__version?g.needsLights&&g.lightsStateVersion!==y.state.version||g.outputColorSpace!==s||a.isInstancedMesh&&!1===g.instancing?x=!0:a.isInstancedMesh||!0!==g.instancing?a.isSkinnedMesh&&!1===g.skinning?x=!0:a.isSkinnedMesh||!0!==g.skinning?g.envMap!==u||!0===r.fog&&g.fog!==i?x=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===be.numPlanes&&g.numIntersection===be.numIntersection?(g.vertexAlphas!==l||g.vertexTangents!==c||g.morphTargets!==h||g.morphNormals!==d||g.morphColors!==f||g.toneMapping!==p||!0===ie.isWebGL2&&g.morphTargetsCount!==m)&&(x=!0):x=!0:x=!0:x=!0:(x=!0,g.__version=r.version);var w=g.currentProgram;!0===x&&(w=qe(r,t,a));var k=!1,S=!1,E=!1,T=w.getUniforms(),M=g.uniforms;oe.useProgram(w.program)&&(k=!0,S=!0,E=!0);r.id!==L&&(L=r.id,S=!0);if(k||P!==e){if(T.setValue(Ce,"projectionMatrix",e.projectionMatrix),ie.logarithmicDepthBuffer&&T.setValue(Ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),P!==e&&(P=e,S=!0,E=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var I=T.map.cameraPosition;void 0!==I&&I.setValue(Ce,te.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&T.setValue(Ce,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||a.isSkinnedMesh)&&T.setValue(Ce,"viewMatrix",e.matrixWorldInverse)}if(a.isSkinnedMesh){T.setOptional(Ce,a,"bindMatrix"),T.setOptional(Ce,a,"bindMatrixInverse");var A=a.skeleton;A&&(ie.floatVertexTextures?(null===A.boneTexture&&A.computeBoneTexture(),T.setValue(Ce,"boneTexture",A.boneTexture,le),T.setValue(Ce,"boneTextureSize",A.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}var R=n.morphAttributes;(void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===ie.isWebGL2)&&ke.update(a,n,w);(S||g.receiveShadow!==a.receiveShadow)&&(g.receiveShadow=a.receiveShadow,T.setValue(Ce,"receiveShadow",a.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(M.envMap.value=u,M.flipEnvMap.value=u.isCubeTexture&&!1===u.isRenderTargetTexture?-1:1);S&&(T.setValue(Ce,"toneMappingExposure",C.toneMappingExposure),g.needsLights&&(F=E,(D=M).ambientLightColor.needsUpdate=F,D.lightProbe.needsUpdate=F,D.directionalLights.needsUpdate=F,D.directionalLightShadows.needsUpdate=F,D.pointLights.needsUpdate=F,D.pointLightShadows.needsUpdate=F,D.spotLights.needsUpdate=F,D.spotLightShadows.needsUpdate=F,D.rectAreaLights.needsUpdate=F,D.hemisphereLights.needsUpdate=F),i&&!0===r.fog&&me.refreshFogUniforms(M,i),me.refreshMaterialUniforms(M,r,W,B,$),uu.upload(Ce,g.uniformsList,M,le));var D,F;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(uu.upload(Ce,g.uniformsList,M,le),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&T.setValue(Ce,"center",a.center);if(T.setValue(Ce,"modelViewMatrix",a.modelViewMatrix),T.setValue(Ce,"normalMatrix",a.normalMatrix),T.setValue(Ce,"modelMatrix",a.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial)for(var O=r.uniformsGroups,z=0,U=O.length;z<U;z++)if(ie.isWebGL2){var V=O[z];Me.update(V,w),Me.bind(V,w)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.");return w}(e,t,n,r,a);oe.setMaterial(r,o);var u=n.index,l=1;!0===r.wireframe&&(u=fe.getWireframeAttribute(n),l=2);var c=n.drawRange,h=n.attributes.position,d=c.start*l,f=(c.start+c.count)*l;null!==i&&(d=Math.max(d,i.start*l),f=Math.min(f,(i.start+i.count)*l)),null!==u?(d=Math.max(d,0),f=Math.min(f,u.count)):void 0!==h&&null!==h&&(d=Math.max(d,0),f=Math.min(f,h.count));var p=f-d;if(!(p<0||p===1/0)){var v;Te.setup(a,r,s,n,u);var m=Se;if(null!==u&&(v=de.get(u),(m=_e).setIndex(v)),a.isMesh)!0===r.wireframe?(oe.setLineWidth(r.wireframeLinewidth*re()),m.setMode(Ce.LINES)):m.setMode(Ce.TRIANGLES);else if(a.isLine){var g=r.linewidth;void 0===g&&(g=1),oe.setLineWidth(g*re()),a.isLineSegments?m.setMode(Ce.LINES):a.isLineLoop?m.setMode(Ce.LINE_LOOP):m.setMode(Ce.LINE_STRIP)}else a.isPoints?m.setMode(Ce.POINTS):a.isSprite&&m.setMode(Ce.TRIANGLES);if(a.isInstancedMesh)m.renderInstances(d,p,a.count);else if(n.isInstancedBufferGeometry){var y=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,b=Math.min(n.instanceCount,y);m.renderInstances(d,p,b)}else m.render(d,p)}},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===Y&&!1===e.forceSinglePass?(e.side=K,e.needsUpdate=!0,qe(e,t,n),e.side=q,e.needsUpdate=!0,qe(e,t,n),e.side=Y):qe(e,t,n)}(_=ye.get(e)).init(),M.push(_),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(_.pushLight(e),e.castShadow&&_.pushShadow(e))})),_.setupLights(C.useLegacyLights),e.traverse((function(t){var r=t.material;if(r)if(Array.isArray(r))for(var a=0;a<r.length;a++){n(r[a],e,t)}else n(r,e,t)})),M.pop(),_=null};var Ue=null;function Be(){Ve.stop()}function We(){Ve.start()}var Ve=new So;function Ge(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)_.pushLight(e),e.castShadow&&_.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||Z.intersectsSprite(e)){r&&te.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ee);var a=pe.update(e),i=e.material;i.visible&&S.push(e,a,i,n,te.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||Z.intersectsObject(e))){e.isSkinnedMesh&&e.skeleton.frame!==se.render.frame&&(e.skeleton.update(),e.skeleton.frame=se.render.frame);var o=pe.update(e),s=e.material;if(r&&(null===o.boundingSphere&&o.computeBoundingSphere(),te.copy(o.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(ee)),Array.isArray(s))for(var u=o.groups,l=0,c=u.length;l<c;l++){var h=u[l],d=s[h.materialIndex];d&&d.visible&&S.push(e,o,d,n,te.z,h)}else s.visible&&S.push(e,o,s,n,te.z,null)}for(var f=e.children,p=0,v=f.length;p<v;p++)Ge(f[p],t,n,r)}}function He(e,t,n,r){var a=e.opaque,i=e.transmissive,o=e.transparent;_.setupLightsView(n),!0===J&&be.setGlobalState(C.clippingPlanes,n),i.length>0&&function(e,t,n,r){if(null===$){var a=ie.isWebGL2;$=new Fr(1024,1024,{generateMipmaps:!0,type:ae.has("EXT_color_buffer_half_float")?ut:tt,minFilter:$e,samples:a&&!0===p?4:0})}var i=C.getRenderTarget();C.setRenderTarget($),C.clear();var o=C.toneMapping;C.toneMapping=Ae,je(e,n,r),le.updateMultisampleRenderTarget($),le.updateRenderTargetMipmap($);for(var s=!1,u=0,l=t.length;u<l;u++){var c=t[u],h=c.object,d=c.geometry,f=c.material,v=c.group;if(f.side===Y&&h.layers.test(r.layers)){var m=f.side;f.side=K,f.needsUpdate=!0,Xe(h,n,r,d,f,v),f.side=m,f.needsUpdate=!0,s=!0}}!0===s&&(le.updateMultisampleRenderTarget($),le.updateRenderTargetMipmap($));C.setRenderTarget(i),C.toneMapping=o}(a,i,t,n),r&&oe.viewport(D.copy(r)),a.length>0&&je(a,t,n),i.length>0&&je(i,t,n),o.length>0&&je(o,t,n),oe.buffers.depth.setTest(!0),oe.buffers.depth.setMask(!0),oe.buffers.color.setMask(!0),oe.setPolygonOffset(!1)}function je(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,a=0,i=e.length;a<i;a++){var o=e[a],s=o.object,u=o.geometry,l=null===r?o.material:r,c=o.group;s.layers.test(n.layers)&&Xe(s,t,n,u,l,c)}}function Xe(e,t,n,r,a,i){e.onBeforeRender(C,t,n,r,a,i),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),a.onBeforeRender(C,t,n,r,e,i),!0===a.transparent&&a.side===Y&&!1===a.forceSinglePass?(a.side=K,a.needsUpdate=!0,C.renderBufferDirect(n,t,r,a,e,i),a.side=q,a.needsUpdate=!0,C.renderBufferDirect(n,t,r,a,e,i),a.side=Y):C.renderBufferDirect(n,t,r,a,e,i),e.onAfterRender(C,t,n,r,a,i)}function qe(e,t,n){!0!==t.isScene&&(t=ne);var r=ue.get(e),a=_.state.lights,i=_.state.shadowsArray,o=a.state.version,s=ve.getParameters(e,a.state,i,t,n),u=ve.getProgramCacheKey(s),l=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?he:ce).get(e.envMap||r.environment),void 0===l&&(e.addEventListener("dispose",ze),l=new Map,r.programs=l);var c=l.get(u);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===o)return Ke(e,s),c}else s.uniforms=ve.getUniforms(e),e.onBuild(n,s,C),e.onBeforeCompile(s,C),c=ve.acquireProgram(s,u),l.set(u,c),r.uniforms=s.uniforms;var h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=be.uniform),Ke(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=a.state.ambient,h.lightProbe.value=a.state.probe,h.directionalLights.value=a.state.directional,h.directionalLightShadows.value=a.state.directionalShadow,h.spotLights.value=a.state.spot,h.spotLightShadows.value=a.state.spotShadow,h.rectAreaLights.value=a.state.rectArea,h.ltc_1.value=a.state.rectAreaLTC1,h.ltc_2.value=a.state.rectAreaLTC2,h.pointLights.value=a.state.point,h.pointLightShadows.value=a.state.pointShadow,h.hemisphereLights.value=a.state.hemi,h.directionalShadowMap.value=a.state.directionalShadowMap,h.directionalShadowMatrix.value=a.state.directionalShadowMatrix,h.spotShadowMap.value=a.state.spotShadowMap,h.spotLightMatrix.value=a.state.spotLightMatrix,h.spotLightMap.value=a.state.spotLightMap,h.pointShadowMap.value=a.state.pointShadowMap,h.pointShadowMatrix.value=a.state.pointShadowMatrix);var d=c.getUniforms(),f=uu.seqWithValue(d.seq,h);return r.currentProgram=c,r.uniformsList=f,c}function Ke(e,t){var n=ue.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ve.setAnimationLoop((function(e){Ue&&Ue(e)})),"undefined"!==typeof self&&Ve.setContext(self),this.setAnimationLoop=function(e){Ue=e,Pe.setAnimationLoop(e),null===e?Ve.stop():Ve.start()},Pe.addEventListener("sessionstart",Be),Pe.addEventListener("sessionend",We),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==I){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Pe.enabled&&!0===Pe.isPresenting&&(!0===Pe.cameraAutoUpdate&&Pe.updateCamera(t),t=Pe.getCamera()),!0===e.isScene&&e.onBeforeRender(C,e,t,N),(_=ye.get(e,M.length)).init(),M.push(_),ee.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Z.setFromProjectionMatrix(ee),Q=this.localClippingEnabled,J=be.init(this.clippingPlanes,Q),(S=ge.get(e,T.length)).init(),T.push(S),Ge(e,t,0,C.sortObjects),S.finish(),!0===C.sortObjects&&S.sort(V,G),!0===J&&be.beginShadows();var n=_.state.shadowsArray;if(xe.render(n,e,t),!0===J&&be.endShadows(),!0===this.info.autoReset&&this.info.reset(),we.render(S,e),_.setupLights(C.useLegacyLights),t.isArrayCamera)for(var r=t.cameras,a=0,i=r.length;a<i;a++){var o=r[a];He(S,e,o,o.viewport)}else He(S,e,t);null!==N&&(le.updateMultisampleRenderTarget(N),le.updateRenderTargetMipmap(N)),!0===e.isScene&&e.onAfterRender(C,e,t),Te.resetDefaultState(),L=-1,P=null,M.pop(),_=M.length>0?M[M.length-1]:null,T.pop(),S=T.length>0?T[T.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return R},this.getRenderTarget=function(){return N},this.setRenderTargetTextures=function(e,t,n){ue.get(e.texture).__webglTexture=t,ue.get(e.depthTexture).__webglTexture=n;var r=ue.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===ae.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){var n=ue.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;N=e,A=t,R=n;var r=!0,a=null,i=!1,o=!1;if(e){var s=ue.get(e);void 0!==s.__useDefaultFramebuffer?(oe.bindFramebuffer(Ce.FRAMEBUFFER,null),r=!1):void 0===s.__webglFramebuffer?le.setupRenderTarget(e):s.__hasExternalTextures&&le.rebindTextures(e,ue.get(e.texture).__webglTexture,ue.get(e.depthTexture).__webglTexture);var u=e.texture;(u.isData3DTexture||u.isDataArrayTexture||u.isCompressedArrayTexture)&&(o=!0);var l=ue.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=l[t],i=!0):a=ie.isWebGL2&&e.samples>0&&!1===le.useMultisampledRTT(e)?ue.get(e).__webglMultisampledFramebuffer:l,D.copy(e.viewport),O.copy(e.scissor),z=e.scissorTest}else D.copy(H).multiplyScalar(W).floor(),O.copy(j).multiplyScalar(W).floor(),z=X;if(oe.bindFramebuffer(Ce.FRAMEBUFFER,a)&&ie.drawBuffers&&r&&oe.drawBuffers(e,a),oe.viewport(D),oe.scissor(O),oe.setScissorTest(z),i){var c=ue.get(e.texture);Ce.framebufferTexture2D(Ce.FRAMEBUFFER,Ce.COLOR_ATTACHMENT0,Ce.TEXTURE_CUBE_MAP_POSITIVE_X+t,c.__webglTexture,n)}else if(o){var h=ue.get(e.texture),d=t||0;Ce.framebufferTextureLayer(Ce.FRAMEBUFFER,Ce.COLOR_ATTACHMENT0,h.__webglTexture,n||0,d)}L=-1},this.readRenderTargetPixels=function(e,t,n,r,a,i,o){if(e&&e.isWebGLRenderTarget){var s=ue.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){oe.bindFramebuffer(Ce.FRAMEBUFFER,s);try{var u=e.texture,l=u.format,c=u.type;if(l!==ft&&Ee.convert(l)!==Ce.getParameter(Ce.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=c===ut&&(ae.has("EXT_color_buffer_half_float")||ie.isWebGL2&&ae.has("EXT_color_buffer_float"));if(c!==tt&&Ee.convert(c)!==Ce.getParameter(Ce.IMPLEMENTATION_COLOR_READ_TYPE)&&(c!==st||!(ie.isWebGL2||ae.has("OES_texture_float")||ae.has("WEBGL_color_buffer_float")))&&!h)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-a&&Ce.readPixels(t,n,r,a,Ee.convert(l),Ee.convert(c),i)}finally{var d=null!==N?ue.get(N).__webglFramebuffer:null;oe.bindFramebuffer(Ce.FRAMEBUFFER,d)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.pow(2,-n),a=Math.floor(t.image.width*r),i=Math.floor(t.image.height*r);le.setTexture2D(t,0),Ce.copyTexSubImage2D(Ce.TEXTURE_2D,n,0,0,e.x,e.y,a,i),oe.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=t.image.width,i=t.image.height,o=Ee.convert(n.format),s=Ee.convert(n.type);le.setTexture2D(n,0),Ce.pixelStorei(Ce.UNPACK_FLIP_Y_WEBGL,n.flipY),Ce.pixelStorei(Ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Ce.pixelStorei(Ce.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?Ce.texSubImage2D(Ce.TEXTURE_2D,r,e.x,e.y,a,i,o,s,t.image.data):t.isCompressedTexture?Ce.compressedTexSubImage2D(Ce.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):Ce.texSubImage2D(Ce.TEXTURE_2D,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&Ce.generateMipmap(Ce.TEXTURE_2D),oe.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(C.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var i,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,u=e.max.z-e.min.z+1,l=Ee.convert(r.format),c=Ee.convert(r.type);if(r.isData3DTexture)le.setTexture3D(r,0),i=Ce.TEXTURE_3D;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");le.setTexture2DArray(r,0),i=Ce.TEXTURE_2D_ARRAY}Ce.pixelStorei(Ce.UNPACK_FLIP_Y_WEBGL,r.flipY),Ce.pixelStorei(Ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),Ce.pixelStorei(Ce.UNPACK_ALIGNMENT,r.unpackAlignment);var h=Ce.getParameter(Ce.UNPACK_ROW_LENGTH),d=Ce.getParameter(Ce.UNPACK_IMAGE_HEIGHT),f=Ce.getParameter(Ce.UNPACK_SKIP_PIXELS),p=Ce.getParameter(Ce.UNPACK_SKIP_ROWS),v=Ce.getParameter(Ce.UNPACK_SKIP_IMAGES),m=n.isCompressedTexture?n.mipmaps[0]:n.image;Ce.pixelStorei(Ce.UNPACK_ROW_LENGTH,m.width),Ce.pixelStorei(Ce.UNPACK_IMAGE_HEIGHT,m.height),Ce.pixelStorei(Ce.UNPACK_SKIP_PIXELS,e.min.x),Ce.pixelStorei(Ce.UNPACK_SKIP_ROWS,e.min.y),Ce.pixelStorei(Ce.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?Ce.texSubImage3D(i,a,t.x,t.y,t.z,o,s,u,l,c,m.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ce.compressedTexSubImage3D(i,a,t.x,t.y,t.z,o,s,u,l,m.data)):Ce.texSubImage3D(i,a,t.x,t.y,t.z,o,s,u,l,c,m),Ce.pixelStorei(Ce.UNPACK_ROW_LENGTH,h),Ce.pixelStorei(Ce.UNPACK_IMAGE_HEIGHT,d),Ce.pixelStorei(Ce.UNPACK_SKIP_PIXELS,f),Ce.pixelStorei(Ce.UNPACK_SKIP_ROWS,p),Ce.pixelStorei(Ce.UNPACK_SKIP_IMAGES,v),0===a&&r.generateMipmaps&&Ce.generateMipmap(i),oe.unbindTexture()}},this.initTexture=function(e){e.isCubeTexture?le.setTextureCube(e,0):e.isData3DTexture?le.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?le.setTexture2DArray(e,0):le.setTexture2D(e,0),oe.unbindTexture()},this.resetState=function(){A=0,R=0,N=null,oe.reset(),Te.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}return M(e,[{key:"physicallyCorrectLights",get:function(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights},set:function(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}},{key:"outputEncoding",get:function(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===wn?vn:pn},set:function(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===vn?wn:kn}}]),e}(),tl=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n)}(el);tl.prototype.isWebGL1Renderer=!0;var nl,rl=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;E(this,e),this.isFogExp2=!0,this.name="",this.color=new li(t),this.density=n}return M(e,[{key:"clone",value:function(){return new e(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]),e}(),al=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;E(this,e),this.isFog=!0,this.name="",this.color=new li(t),this.near=n,this.far=r}return M(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),e}(),il=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).isScene=!0,e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.backgroundBlurriness=0,e.backgroundIntensity=1,e.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:A(e)})),e}return M(n,[{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=D(I(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}},{key:"autoUpdate",get:function(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate},set:function(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}]),n}(Ha),ol=function(){function e(t,n){E(this,e),this.isInterleavedBuffer=!0,this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=Bn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=rr()}return M(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,a=this.stride;r<a;r++)this.array[e+r]=t.array[n+r];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=rr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=rr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}(),sl=new Gr,ul=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];E(this,e),this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=n,this.offset=r,this.normalized=a}return M(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)sl.fromBufferAttribute(this,t),sl.applyMatrix4(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)sl.fromBufferAttribute(this,t),sl.applyNormalMatrix(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)sl.fromBufferAttribute(this,t),sl.transformDirection(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this}},{key:"setX",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.normalized&&(t=hr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){var t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=cr(t,this.array)),t}},{key:"getY",value:function(e){var t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=cr(t,this.array)),t}},{key:"getZ",value:function(e){var t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=cr(t,this.array)),t}},{key:"getW",value:function(e){var t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=cr(t,this.array)),t}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=hr(t,this.array),n=hr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=hr(t,this.array),n=hr(n,this.array),r=hr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=hr(t,this.array),n=hr(n,this.array),r=hr(r,this.array),a=hr(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=a,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");for(var n=[],r=0;r<this.count;r++)for(var a=r*this.data.stride+this.offset,i=0;i<this.itemSize;i++)n.push(this.data.array[a+i]);return new bi(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,a=0;a<this.itemSize;a++)t.push(this.data.array[r+a]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}(),ll=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isSpriteMaterial=!0,r.type="SpriteMaterial",r.color=new li(16777215),r.map=null,r.alphaMap=null,r.rotation=0,r.sizeAttenuation=!0,r.transparent=!0,r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}(ai),cl=new Gr,hl=new Gr,dl=new Gr,fl=new fr,pl=new fr,vl=new ba,ml=new Gr,gl=new Gr,yl=new Gr,bl=new fr,xl=new fr,wl=new fr,kl=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this)).isSprite=!0,r.type="Sprite",void 0===nl){nl=new Oi;var a=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new ol(a,5);nl.setIndex([0,1,2,0,2,3]),nl.setAttribute("position",new ul(i,3,0,!1)),nl.setAttribute("uv",new ul(i,2,3,!1))}return r.geometry=nl,r.material=void 0!==e?e:new ll,r.center=new fr(.5,.5),r}return M(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),hl.setFromMatrixScale(this.matrixWorld),vl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),dl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&hl.multiplyScalar(-dl.z);var n,r,a=this.material.rotation;0!==a&&(r=Math.cos(a),n=Math.sin(a));var i=this.center;Sl(ml.set(-.5,-.5,0),dl,i,hl,n,r),Sl(gl.set(.5,-.5,0),dl,i,hl,n,r),Sl(yl.set(.5,.5,0),dl,i,hl,n,r),bl.set(0,0),xl.set(1,0),wl.set(1,1);var o=e.ray.intersectTriangle(ml,gl,yl,!1,cl);if(null!==o||(Sl(gl.set(-.5,.5,0),dl,i,hl,n,r),xl.set(0,1),null!==(o=e.ray.intersectTriangle(ml,yl,gl,!1,cl)))){var s=e.ray.origin.distanceTo(cl);s<e.near||s>e.far||t.push({distance:s,point:cl.clone(),uv:ni.getInterpolation(cl,ml,gl,yl,bl,xl,wl,new fr),face:null,object:this})}}},{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n}(Ha);function Sl(e,t,n,r,a,i){fl.subVectors(e,n).addScalar(.5).multiply(r),void 0!==a?(pl.x=i*fl.x-a*fl.y,pl.y=a*fl.x+i*fl.y):pl.copy(fl),e.copy(t),e.x+=pl.x,e.y+=pl.y,e.applyMatrix4(vl)}var _l=new Gr,El=new Gr,Tl=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this))._currentLevel=0,e.type="LOD",Object.defineProperties(A(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),e.autoUpdate=!0,e}return M(n,[{key:"copy",value:function(e){D(I(n.prototype),"copy",this).call(this,e,!1);for(var t=e.levels,r=0,a=t.length;r<a;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance,i.hysteresis)}return this.autoUpdate=e.autoUpdate,this}},{key:"addLevel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.abs(t);var r,a=this.levels;for(r=0;r<a.length&&!(t<a[r].distance);r++);return a.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}},{key:"getCurrentLevel",value:function(){return this._currentLevel}},{key:"getObjectForDistance",value:function(e){var t=this.levels;if(t.length>0){var n,r;for(n=1,r=t.length;n<r;n++){var a=t[n].distance;if(t[n].object.visible&&(a-=a*t[n].hysteresis),e<a)break}return t[n-1].object}return null}},{key:"raycast",value:function(e,t){if(this.levels.length>0){_l.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(_l);this.getObjectForDistance(n).raycast(e,t)}}},{key:"update",value:function(e){var t=this.levels;if(t.length>1){_l.setFromMatrixPosition(e.matrixWorld),El.setFromMatrixPosition(this.matrixWorld);var n,r,a=_l.distanceTo(El)/e.zoom;for(t[0].object.visible=!0,n=1,r=t.length;n<r;n++){var i=t[n].distance;if(t[n].object.visible&&(i-=i*t[n].hysteresis),!(a>=i))break;t[n-1].object.visible=!1,t[n].object.visible=!0}for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}},{key:"toJSON",value:function(e){var t=D(I(n.prototype),"toJSON",this).call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var r=this.levels,a=0,i=r.length;a<i;a++){var o=r[a];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}]),n}(Ha),Ml=new Gr,Cl=new Dr,Il=new Dr,Al=new Gr,Rl=new ba,Nl=new Gr,Ll=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this,e,r)).isSkinnedMesh=!0,a.type="SkinnedMesh",a.bindMode="attached",a.bindMatrix=new ba,a.bindMatrixInverse=new ba,a.boundingBox=null,a.boundingSphere=null,a}return M(n,[{key:"computeBoundingBox",value:function(){var e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Xr),this.boundingBox.makeEmpty();for(var t=e.getAttribute("position"),n=0;n<t.count;n++)Nl.fromBufferAttribute(t,n),this.applyBoneTransform(n,Nl),this.boundingBox.expandByPoint(Nl)}},{key:"computeBoundingSphere",value:function(){var e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new ca),this.boundingSphere.makeEmpty();for(var t=e.getAttribute("position"),n=0;n<t.count;n++)Nl.fromBufferAttribute(t,n),this.applyBoneTransform(n,Nl),this.boundingSphere.expandByPoint(Nl)}},{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"getVertexPosition",value:function(e,t){return D(I(n.prototype),"getVertexPosition",this).call(this,e,t),this.applyBoneTransform(e,t),t}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new Dr,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);var a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){D(I(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"applyBoneTransform",value:function(e,t){var n=this.skeleton,r=this.geometry;Cl.fromBufferAttribute(r.attributes.skinIndex,e),Il.fromBufferAttribute(r.attributes.skinWeight,e),Ml.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var a=0;a<4;a++){var i=Il.getComponent(a);if(0!==i){var o=Cl.getComponent(a);Rl.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(Al.copy(Ml).applyMatrix4(Rl),i)}}return t.applyMatrix4(this.bindMatrixInverse)}},{key:"boneTransform",value:function(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}]),n}(to),Pl=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).isBone=!0,e.type="Bone",e}return M(n)}(Ha),Dl=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:je,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:je,f=arguments.length>10?arguments[10]:void 0,p=arguments.length>11?arguments[11]:void 0;return E(this,n),(e=t.call(this,null,u,l,c,h,d,o,s,f,p)).isDataTexture=!0,e.image={data:r,width:a,height:i},e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return M(n)}(Pr),Fl=new ba,Ol=new ba,zl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];E(this,e),this.uuid=rr(),this.bones=t.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}return M(e,[{key:"init",value:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new ba)}}},{key:"calculateInverses",value:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new ba;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}},{key:"pose",value:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var r=0,a=this.bones.length;r<a;r++){var i=this.bones[r];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}},{key:"update",value:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,a=0,i=e.length;a<i;a++){var o=e[a]?e[a].matrixWorld:Ol;Fl.multiplyMatrices(o,t[a]),Fl.toArray(n,16*a)}null!==r&&(r.needsUpdate=!0)}},{key:"clone",value:function(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function(){var e=Math.sqrt(4*this.bones.length);e=ur(e),e=Math.max(e,4);var t=new Float32Array(e*e*4);t.set(this.boneMatrices);var n=new Dl(t,e,e,ft,st);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}},{key:"getBoneByName",value:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}},{key:"dispose",value:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}},{key:"fromJSON",value:function(e,t){this.uuid=e.uuid;for(var n=0,r=e.bones.length;n<r;n++){var a=e.bones[n],i=t[a];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),i=new Pl),this.bones.push(i),this.boneInverses.push((new ba).fromArray(e.boneInverses[n]))}return this.init(),this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,r=0,a=t.length;r<a;r++){var i=t[r];e.bones.push(i.uuid);var o=n[r];e.boneInverses.push(o.toArray())}return e}}]),e}(),Ul=function(e){C(n,e);var t=R(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return E(this,n),(i=t.call(this,e,r,a)).isInstancedBufferAttribute=!0,i.meshPerAttribute=o,i}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(bi),Bl=new ba,Wl=new ba,Vl=[],Gl=new Xr,Hl=new ba,jl=new to,Xl=new ca,ql=function(e){C(n,e);var t=R(n);function n(e,r,a){var i;E(this,n),(i=t.call(this,e,r)).isInstancedMesh=!0,i.instanceMatrix=new Ul(new Float32Array(16*a),16),i.instanceColor=null,i.count=a,i.boundingBox=null,i.boundingSphere=null;for(var o=0;o<a;o++)i.setMatrixAt(o,Hl);return i}return M(n,[{key:"computeBoundingBox",value:function(){var e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Xr),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(var n=0;n<t;n++)this.getMatrixAt(n,Bl),Gl.copy(e.boundingBox).applyMatrix4(Bl),this.boundingBox.union(Gl)}},{key:"computeBoundingSphere",value:function(){var e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new ca),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(var n=0;n<t;n++)this.getMatrixAt(n,Bl),Xl.copy(e.boundingSphere).applyMatrix4(Bl),this.boundingSphere.union(Xl)}},{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,r=this.count;if(jl.geometry=this.geometry,jl.material=this.material,void 0!==jl.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Xl.copy(this.boundingSphere),Xl.applyMatrix4(n),!1!==e.ray.intersectsSphere(Xl)))for(var a=0;a<r;a++){this.getMatrixAt(a,Bl),Wl.multiplyMatrices(n,Bl),jl.matrixWorld=Wl,jl.raycast(e,Vl);for(var i=0,o=Vl.length;i<o;i++){var s=Vl[i];s.instanceId=a,s.object=this,t.push(s)}Vl.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new Ul(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(to),Kl=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isLineBasicMaterial=!0,r.type="LineBasicMaterial",r.color=new li(16777215),r.map=null,r.linewidth=1,r.linecap="round",r.linejoin="round",r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}]),n}(ai),Yl=new Gr,Zl=new Gr,Jl=new ba,Ql=new ya,$l=new ca,ec=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oi,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kl;return E(this,n),(e=t.call(this)).isLine=!0,e.type="Line",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return M(n,[{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,a=t.count;r<a;r++)Yl.fromBufferAttribute(t,r-1),Zl.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=Yl.distanceTo(Zl);e.setAttribute("lineDistance",new Ci(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,a=e.params.Line.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),$l.copy(n.boundingSphere),$l.applyMatrix4(r),$l.radius+=a,!1!==e.ray.intersectsSphere($l)){Jl.copy(r).invert(),Ql.copy(e.ray).applyMatrix4(Jl);var o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=new Gr,l=new Gr,c=new Gr,h=new Gr,d=this.isLineSegments?2:1,f=n.index,p=n.attributes.position;if(null!==f)for(var v=Math.max(0,i.start),m=Math.min(f.count,i.start+i.count)-1;v<m;v+=d){var g=f.getX(v),y=f.getX(v+1);if(u.fromBufferAttribute(p,g),l.fromBufferAttribute(p,y),!(Ql.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var x=Math.max(0,i.start),w=Math.min(p.count,i.start+i.count)-1;x<w;x+=d){if(u.fromBufferAttribute(p,x),l.fromBufferAttribute(p,x+1),!(Ql.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var k=e.ray.origin.distanceTo(h);k<e.near||k>e.far||t.push({distance:k,point:c.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=n.length;r<a;r++){var i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}}]),n}(Ha),tc=new Gr,nc=new Gr,rc=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this,e,r)).isLineSegments=!0,a.type="LineSegments",a}return M(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[],r=0,a=t.count;r<a;r+=2)tc.fromBufferAttribute(t,r),nc.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+tc.distanceTo(nc);e.setAttribute("lineDistance",new Ci(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}]),n}(ec),ac=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this,e,r)).isLineLoop=!0,a.type="LineLoop",a}return M(n)}(ec),ic=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isPointsMaterial=!0,r.type="PointsMaterial",r.color=new li(16777215),r.map=null,r.alphaMap=null,r.size=1,r.sizeAttenuation=!0,r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}(ai),oc=new ba,sc=new ya,uc=new ca,lc=new Gr,cc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oi,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ic;return E(this,n),(e=t.call(this)).isPoints=!0,e.type="Points",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return M(n,[{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,a=e.params.Points.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),uc.copy(n.boundingSphere),uc.applyMatrix4(r),uc.radius+=a,!1!==e.ray.intersectsSphere(uc)){oc.copy(r).invert(),sc.copy(e.ray).applyMatrix4(oc);var o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=n.index,l=n.attributes.position;if(null!==u)for(var c=Math.max(0,i.start),h=Math.min(u.count,i.start+i.count);c<h;c++){var d=u.getX(c);lc.fromBufferAttribute(l,d),hc(lc,d,s,r,e,t,this)}else for(var f=Math.max(0,i.start),p=Math.min(l.count,i.start+i.count);f<p;f++)lc.fromBufferAttribute(l,f),hc(lc,f,s,r,e,t,this)}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=n.length;r<a;r++){var i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}}]),n}(Ha);function hc(e,t,n,r,a,i,o){var s=sc.distanceSqToPoint(e);if(s<n){var u=new Gr;sc.closestPointToPoint(e,u),u.applyMatrix4(r);var l=a.ray.origin.distanceTo(u);if(l<a.near||l>a.far)return;i.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:t,face:null,object:o})}}var dc=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s,u,l,c){var h;E(this,n),(h=t.call(this,e,r,a,i,o,s,u,l,c)).isVideoTexture=!0,h.minFilter=void 0!==s?s:Ze,h.magFilter=void 0!==o?o:Ze,h.generateMipmaps=!1;var d=A(h);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){d.needsUpdate=!0,e.requestVideoFrameCallback(t)})),h}return M(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(Pr),fc=function(e){C(n,e);var t=R(n);function n(e,r,a){var i;return E(this,n),(i=t.call(this,{width:e,height:r})).isFramebufferTexture=!0,i.format=a,i.magFilter=je,i.minFilter=je,i.generateMipmaps=!1,i.needsUpdate=!0,i}return M(n)}(Pr),pc=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s,u,l,c,h,d,f){var p;return E(this,n),(p=t.call(this,null,s,u,l,c,h,i,o,d,f)).isCompressedTexture=!0,p.image={width:r,height:a},p.mipmaps=e,p.flipY=!1,p.generateMipmaps=!1,p}return M(n)}(Pr),vc=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s){var u;return E(this,n),(u=t.call(this,e,r,a,o,s)).isCompressedArrayTexture=!0,u.image.depth=i,u.wrapR=Ge,u}return M(n)}(pc),mc=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s,u,l,c){var h;return E(this,n),(h=t.call(this,e,r,a,i,o,s,u,l,c)).isCanvasTexture=!0,h.needsUpdate=!0,h}return M(n)}(Pr),gc=function(){function e(){E(this,e),this.type="Curve",this.arcLengthDivisions=200}return M(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),a=0;n.push(0);for(var i=1;i<=e;i++)a+=(t=this.getPoint(i/e)).distanceTo(r),n.push(a),r=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,r=this.getLengths(),a=0,i=r.length;n=t||e*r[i-1];for(var o,s=0,u=i-1;s<=u;)if((o=r[a=Math.floor(s+(u-s)/2)]-n)<0)s=a+1;else{if(!(o>0)){u=a;break}u=a-1}if(r[a=u]===n)return a/(i-1);var l=r[a];return(a+(n-l)/(r[a+1]-l))/(i-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,r=e-n,a=e+n;r<0&&(r=0),a>1&&(a=1);var i=this.getPoint(r),o=this.getPoint(a),s=t||(i.isVector2?new fr:new Gr);return s.copy(o).sub(i).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new Gr,r=[],a=[],i=[],o=new Gr,s=new ba,u=0;u<=e;u++){var l=u/e;r[u]=this.getTangentAt(l,new Gr)}a[0]=new Gr,i[0]=new Gr;var c=Number.MAX_VALUE,h=Math.abs(r[0].x),d=Math.abs(r[0].y),f=Math.abs(r[0].z);h<=c&&(c=h,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),f<=c&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),a[0].crossVectors(r[0],o),i[0].crossVectors(r[0],a[0]);for(var p=1;p<=e;p++){if(a[p]=a[p-1].clone(),i[p]=i[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();var v=Math.acos(ar(r[p-1].dot(r[p]),-1,1));a[p].applyMatrix4(s.makeRotationAxis(o,v))}i[p].crossVectors(r[p],a[p])}if(!0===t){var m=Math.acos(ar(a[0].dot(a[e]),-1,1));m/=e,r[0].dot(o.crossVectors(a[0],a[e]))>0&&(m=-m);for(var g=1;g<=e;g++)a[g].applyMatrix4(s.makeRotationAxis(r[g],m*g)),i[g].crossVectors(r[g],a[g])}return{tangents:r,normals:a,binormals:i}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),yc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return E(this,n),(e=t.call(this)).isEllipseCurve=!0,e.type="EllipseCurve",e.aX=r,e.aY=a,e.xRadius=i,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=u,e.aClockwise=l,e.aRotation=c,e}return M(n,[{key:"getPoint",value:function(e,t){for(var n=t||new fr,r=2*Math.PI,a=this.aEndAngle-this.aStartAngle,i=Math.abs(a)<Number.EPSILON;a<0;)a+=r;for(;a>r;)a-=r;a<Number.EPSILON&&(a=i?0:r),!0!==this.aClockwise||i||(a===r?a=-r:a-=r);var o=this.aStartAngle+e*a,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=u-this.aY;s=h*l-d*c+this.aX,u=h*c+d*l+this.aY}return n.set(s,u)}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return D(I(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(gc),bc=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s){var u;return E(this,n),(u=t.call(this,e,r,a,a,i,o,s)).isArcCurve=!0,u.type="ArcCurve",u}return M(n)}(yc);function xc(){var e=0,t=0,n=0,r=0;function a(a,i,o,s){e=a,t=o,n=-3*a+3*i-2*o-s,r=2*a-2*i+o+s}return{initCatmullRom:function(e,t,n,r,i){a(t,n,i*(n-e),i*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,i,o,s){var u=(t-e)/i-(n-e)/(i+o)+(n-t)/o,l=(n-t)/o-(r-t)/(o+s)+(r-n)/s;a(t,n,u*=o,l*=o)},calc:function(a){var i=a*a;return e+t*a+n*i+r*(i*a)}}}var wc=new Gr,kc=new xc,Sc=new xc,_c=new xc,Ec=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return E(this,n),(e=t.call(this)).isCatmullRomCurve3=!0,e.type="CatmullRomCurve3",e.points=r,e.closed=a,e.curveType=i,e.tension=o,e}return M(n,[{key:"getPoint",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr,a=this.points,i=a.length,o=(i-(this.closed?0:1))*e,s=Math.floor(o),u=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/i)+1)*i:0===u&&s===i-1&&(s=i-2,u=1),this.closed||s>0?t=a[(s-1)%i]:(wc.subVectors(a[0],a[1]).add(a[0]),t=wc);var l=a[s%i],c=a[(s+1)%i];if(this.closed||s+2<i?n=a[(s+2)%i]:(wc.subVectors(a[i-1],a[i-2]).add(a[i-1]),n=wc),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(l),h),f=Math.pow(l.distanceToSquared(c),h),p=Math.pow(c.distanceToSquared(n),h);f<1e-4&&(f=1),d<1e-4&&(d=f),p<1e-4&&(p=f),kc.initNonuniformCatmullRom(t.x,l.x,c.x,n.x,d,f,p),Sc.initNonuniformCatmullRom(t.y,l.y,c.y,n.y,d,f,p),_c.initNonuniformCatmullRom(t.z,l.z,c.z,n.z,d,f,p)}else"catmullrom"===this.curveType&&(kc.initCatmullRom(t.x,l.x,c.x,n.x,this.tension),Sc.initCatmullRom(t.y,l.y,c.y,n.y,this.tension),_c.initCatmullRom(t.z,l.z,c.z,n.z,this.tension));return r.set(kc.calc(u),Sc.calc(u),_c.calc(u)),r}},{key:"copy",value:function(e){D(I(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push(a.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var a=this.points[t];e.points.push(a.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){D(I(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push((new Gr).fromArray(a))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(gc);function Tc(e,t,n,r,a){var i=.5*(r-t),o=.5*(a-n),s=e*e;return(2*n-2*r+i+o)*(e*s)+(-3*n+3*r-2*i-o)*s+i*e+n}function Mc(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Cc(e,t,n,r,a){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,a)}var Ic=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fr,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new fr,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new fr;return E(this,n),(e=t.call(this)).isCubicBezierCurve=!0,e.type="CubicBezierCurve",e.v0=r,e.v1=a,e.v2=i,e.v3=o,e}return M(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fr,n=this.v0,r=this.v1,a=this.v2,i=this.v3;return t.set(Cc(e,n.x,r.x,a.x,i.x),Cc(e,n.y,r.y,a.y,i.y)),t}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return D(I(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(gc),Ac=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Gr,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Gr;return E(this,n),(e=t.call(this)).isCubicBezierCurve3=!0,e.type="CubicBezierCurve3",e.v0=r,e.v1=a,e.v2=i,e.v3=o,e}return M(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr,n=this.v0,r=this.v1,a=this.v2,i=this.v3;return t.set(Cc(e,n.x,r.x,a.x,i.x),Cc(e,n.y,r.y,a.y,i.y),Cc(e,n.z,r.z,a.z,i.z)),t}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return D(I(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(gc),Rc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fr,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fr;return E(this,n),(e=t.call(this)).isLineCurve=!0,e.type="LineCurve",e.v1=r,e.v2=a,e}return M(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fr;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fr).subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(e,t){return this.getTangent(e,t)}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return D(I(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(gc),Nc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr;return E(this,n),(e=t.call(this)).isLineCurve3=!0,e.type="LineCurve3",e.v1=r,e.v2=a,e}return M(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr).subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(e,t){return this.getTangent(e,t)}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return D(I(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(gc),Lc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fr,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new fr;return E(this,n),(e=t.call(this)).isQuadraticBezierCurve=!0,e.type="QuadraticBezierCurve",e.v0=r,e.v1=a,e.v2=i,e}return M(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fr,n=this.v0,r=this.v1,a=this.v2;return t.set(Mc(e,n.x,r.x,a.x),Mc(e,n.y,r.y,a.y)),t}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return D(I(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(gc),Pc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Gr;return E(this,n),(e=t.call(this)).isQuadraticBezierCurve3=!0,e.type="QuadraticBezierCurve3",e.v0=r,e.v1=a,e.v2=i,e}return M(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr,n=this.v0,r=this.v1,a=this.v2;return t.set(Mc(e,n.x,r.x,a.x),Mc(e,n.y,r.y,a.y),Mc(e,n.z,r.z,a.z)),t}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return D(I(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(gc),Dc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return E(this,n),(e=t.call(this)).isSplineCurve=!0,e.type="SplineCurve",e.points=r,e}return M(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fr,n=this.points,r=(n.length-1)*e,a=Math.floor(r),i=r-a,o=n[0===a?a:a-1],s=n[a],u=n[a>n.length-2?n.length-1:a+1],l=n[a>n.length-3?n.length-1:a+2];return t.set(Tc(i,o.x,s.x,u.x,l.x),Tc(i,o.y,s.y,u.y,l.y)),t}},{key:"copy",value:function(e){D(I(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push(a.clone())}return this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var a=this.points[t];e.points.push(a.toArray())}return e}},{key:"fromJSON",value:function(e){D(I(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push((new fr).fromArray(a))}return this}}]),n}(gc),Fc=Object.freeze({__proto__:null,ArcCurve:bc,CatmullRomCurve3:Ec,CubicBezierCurve:Ic,CubicBezierCurve3:Ac,EllipseCurve:yc,LineCurve:Rc,LineCurve3:Nc,QuadraticBezierCurve:Lc,QuadraticBezierCurve3:Pc,SplineCurve:Dc}),Oc=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return M(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Rc(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),r=this.getCurveLengths(),a=0;a<r.length;){if(r[a]>=n){var i=r[a]-n,o=this.curves[a],s=o.getLength(),u=0===s?0:1-i/s;return o.getPointAt(u,t)}a++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,a=this.curves;r<a.length;r++)for(var i=a[r],o=i.isEllipseCurve?2*t:i.isLineCurve||i.isLineCurve3?1:i.isSplineCurve?t*i.points.length:t,s=i.getPoints(o),u=0;u<s.length;u++){var l=s[u];e&&e.equals(l)||(n.push(l),e=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){D(I(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var a=e.curves[t];this.curves.push(a.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var a=this.curves[t];e.curves.push(a.toJSON())}return e}},{key:"fromJSON",value:function(e){D(I(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var a=e.curves[t];this.curves.push((new Fc[a.type]).fromJSON(a))}return this}}]),n}(gc),zc=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).type="Path",r.currentPoint=new fr,e&&r.setFromPoints(e),r}return M(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new Rc(this.currentPoint.clone(),new fr(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){var a=new Lc(this.currentPoint.clone(),new fr(e,t),new fr(n,r));return this.curves.push(a),this.currentPoint.set(n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,a,i){var o=new Ic(this.currentPoint.clone(),new fr(e,t),new fr(n,r),new fr(a,i));return this.curves.push(o),this.currentPoint.set(a,i),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new Dc(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,r,a,i){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,a,i),this}},{key:"absarc",value:function(e,t,n,r,a,i){return this.absellipse(e,t,n,n,r,a,i),this}},{key:"ellipse",value:function(e,t,n,r,a,i,o,s){var u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+u,t+l,n,r,a,i,o,s),this}},{key:"absellipse",value:function(e,t,n,r,a,i,o,s){var u=new yc(e,t,n,r,a,i,o,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);return this.currentPoint.copy(c),this}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return D(I(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(Oc),Uc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new fr(0,-.5),new fr(.5,0),new fr(0,.5)],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;E(this,n),(e=t.call(this)).type="LatheGeometry",e.parameters={points:r,segments:a,phiStart:i,phiLength:o},a=Math.floor(a),o=ar(o,0,2*Math.PI);for(var s=[],u=[],l=[],c=[],h=[],d=1/a,f=new Gr,p=new fr,v=new Gr,m=new Gr,g=new Gr,y=0,b=0,x=0;x<=r.length-1;x++)switch(x){case 0:y=r[x+1].x-r[x].x,b=r[x+1].y-r[x].y,v.x=1*b,v.y=-y,v.z=0*b,g.copy(v),v.normalize(),c.push(v.x,v.y,v.z);break;case r.length-1:c.push(g.x,g.y,g.z);break;default:y=r[x+1].x-r[x].x,b=r[x+1].y-r[x].y,v.x=1*b,v.y=-y,v.z=0*b,m.copy(v),v.x+=g.x,v.y+=g.y,v.z+=g.z,v.normalize(),c.push(v.x,v.y,v.z),g.copy(m)}for(var w=0;w<=a;w++)for(var k=i+w*d*o,S=Math.sin(k),_=Math.cos(k),T=0;T<=r.length-1;T++){f.x=r[T].x*S,f.y=r[T].y,f.z=r[T].x*_,u.push(f.x,f.y,f.z),p.x=w/a,p.y=T/(r.length-1),l.push(p.x,p.y);var M=c[3*T+0]*S,C=c[3*T+1],I=c[3*T+0]*_;h.push(M,C,I)}for(var A=0;A<a;A++)for(var R=0;R<r.length-1;R++){var N=R+A*r.length,L=N,P=N+r.length,D=N+r.length+1,F=N+1;s.push(L,P,F),s.push(D,F,P)}return e.setIndex(s),e.setAttribute("position",new Ci(u,3)),e.setAttribute("uv",new Ci(l,2)),e.setAttribute("normal",new Ci(h,3)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.points,e.segments,e.phiStart,e.phiLength)}}]),n}(Oi),Bc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;E(this,n);var s=new zc;return s.absarc(0,-a/2,r,1.5*Math.PI,0),s.absarc(0,a/2,r,0,.5*Math.PI),(e=t.call(this,s.getPoints(i),o)).type="CapsuleGeometry",e.parameters={radius:r,height:a,capSegments:i,radialSegments:o},e}return M(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.length,e.capSegments,e.radialSegments)}}]),n}(Uc),Wc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;E(this,n),(e=t.call(this)).type="CircleGeometry",e.parameters={radius:r,segments:a,thetaStart:i,thetaLength:o},a=Math.max(3,a);var s=[],u=[],l=[],c=[],h=new Gr,d=new fr;u.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(var f=0,p=3;f<=a;f++,p+=3){var v=i+f/a*o;h.x=r*Math.cos(v),h.y=r*Math.sin(v),u.push(h.x,h.y,h.z),l.push(0,0,1),d.x=(u[p]/r+1)/2,d.y=(u[p+1]/r+1)/2,c.push(d.x,d.y)}for(var m=1;m<=a;m++)s.push(m,m+1,0);return e.setIndex(s),e.setAttribute("position",new Ci(u,3)),e.setAttribute("normal",new Ci(l,3)),e.setAttribute("uv",new Ci(c,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radius,e.segments,e.thetaStart,e.thetaLength)}}]),n}(Oi),Vc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;E(this,n),(e=t.call(this)).type="CylinderGeometry",e.parameters={radiusTop:r,radiusBottom:a,height:i,radialSegments:o,heightSegments:s,openEnded:u,thetaStart:l,thetaLength:c};var h=A(e);o=Math.floor(o),s=Math.floor(s);var d=[],f=[],p=[],v=[],m=0,g=[],y=i/2,b=0;function x(e){for(var t=m,n=new fr,i=new Gr,s=0,u=!0===e?r:a,g=!0===e?1:-1,x=1;x<=o;x++)f.push(0,y*g,0),p.push(0,g,0),v.push(.5,.5),m++;for(var w=m,k=0;k<=o;k++){var S=k/o*c+l,_=Math.cos(S),E=Math.sin(S);i.x=u*E,i.y=y*g,i.z=u*_,f.push(i.x,i.y,i.z),p.push(0,g,0),n.x=.5*_+.5,n.y=.5*E*g+.5,v.push(n.x,n.y),m++}for(var T=0;T<o;T++){var M=t+T,C=w+T;!0===e?d.push(C,C+1,M):d.push(C+1,C,M),s+=3}h.addGroup(b,s,!0===e?1:2),b+=s}return function(){for(var e=new Gr,t=new Gr,n=0,u=(a-r)/i,x=0;x<=s;x++){for(var w=[],k=x/s,S=k*(a-r)+r,_=0;_<=o;_++){var E=_/o,T=E*c+l,M=Math.sin(T),C=Math.cos(T);t.x=S*M,t.y=-k*i+y,t.z=S*C,f.push(t.x,t.y,t.z),e.set(M,u,C).normalize(),p.push(e.x,e.y,e.z),v.push(E,1-k),w.push(m++)}g.push(w)}for(var I=0;I<o;I++)for(var A=0;A<s;A++){var R=g[A][I],N=g[A+1][I],L=g[A+1][I+1],P=g[A][I+1];d.push(R,N,P),d.push(N,L,P),n+=6}h.addGroup(b,n,0),b+=n}(),!1===u&&(r>0&&x(!0),a>0&&x(!1)),e.setIndex(d),e.setAttribute("position",new Ci(f,3)),e.setAttribute("normal",new Ci(p,3)),e.setAttribute("uv",new Ci(v,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(Oi),Gc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return E(this,n),(e=t.call(this,0,r,a,i,o,s,u,l)).type="ConeGeometry",e.parameters={radius:r,height:a,radialSegments:i,heightSegments:o,openEnded:s,thetaStart:u,thetaLength:l},e}return M(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(Vc),Hc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;E(this,n),(e=t.call(this)).type="PolyhedronGeometry",e.parameters={vertices:r,indices:a,radius:i,detail:o};var s=[],u=[];function l(e,t,n,r){for(var a=r+1,i=[],o=0;o<=a;o++){i[o]=[];for(var s=e.clone().lerp(n,o/a),u=t.clone().lerp(n,o/a),l=a-o,h=0;h<=l;h++)i[o][h]=0===h&&o===a?s:s.clone().lerp(u,h/l)}for(var d=0;d<a;d++)for(var f=0;f<2*(a-d)-1;f++){var p=Math.floor(f/2);f%2===0?(c(i[d][p+1]),c(i[d+1][p]),c(i[d][p])):(c(i[d][p+1]),c(i[d+1][p+1]),c(i[d+1][p]))}}function c(e){s.push(e.x,e.y,e.z)}function h(e,t){var n=3*e;t.x=r[n+0],t.y=r[n+1],t.z=r[n+2]}function d(e,t,n,r){r<0&&1===e.x&&(u[t]=e.x-1),0===n.x&&0===n.z&&(u[t]=r/2/Math.PI+.5)}function f(e){return Math.atan2(e.z,-e.x)}return function(e){for(var t=new Gr,n=new Gr,r=new Gr,i=0;i<a.length;i+=3)h(a[i+0],t),h(a[i+1],n),h(a[i+2],r),l(t,n,r,e)}(o),function(e){for(var t=new Gr,n=0;n<s.length;n+=3)t.x=s[n+0],t.y=s[n+1],t.z=s[n+2],t.normalize().multiplyScalar(e),s[n+0]=t.x,s[n+1]=t.y,s[n+2]=t.z}(i),function(){for(var e=new Gr,t=0;t<s.length;t+=3){e.x=s[t+0],e.y=s[t+1],e.z=s[t+2];var n=f(e)/2/Math.PI+.5,r=(a=e,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);u.push(n,1-r)}var a;(function(){for(var e=new Gr,t=new Gr,n=new Gr,r=new Gr,a=new fr,i=new fr,o=new fr,l=0,c=0;l<s.length;l+=9,c+=6){e.set(s[l+0],s[l+1],s[l+2]),t.set(s[l+3],s[l+4],s[l+5]),n.set(s[l+6],s[l+7],s[l+8]),a.set(u[c+0],u[c+1]),i.set(u[c+2],u[c+3]),o.set(u[c+4],u[c+5]),r.copy(e).add(t).add(n).divideScalar(3);var h=f(r);d(a,c+0,e,h),d(i,c+2,t,h),d(o,c+4,n,h)}})(),function(){for(var e=0;e<u.length;e+=6){var t=u[e+0],n=u[e+2],r=u[e+4],a=Math.max(t,n,r),i=Math.min(t,n,r);a>.9&&i<.1&&(t<.2&&(u[e+0]+=1),n<.2&&(u[e+2]+=1),r<.2&&(u[e+4]+=1))}}()}(),e.setAttribute("position",new Ci(s,3)),e.setAttribute("normal",new Ci(s.slice(),3)),e.setAttribute("uv",new Ci(u,2)),0===o?e.computeVertexNormals():e.normalizeNormals(),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.vertices,e.indices,e.radius,e.details)}}]),n}(Oi),jc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;E(this,n);var i=(1+Math.sqrt(5))/2,o=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o];return(e=t.call(this,s,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],r,a)).type="DodecahedronGeometry",e.parameters={radius:r,detail:a},e}return M(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Hc),Xc=new Gr,qc=new Gr,Kc=new Gr,Yc=new ni,Zc=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(E(this,n),(e=t.call(this)).type="EdgesGeometry",e.parameters={geometry:r,thresholdAngle:a},null!==r){for(var i=Math.pow(10,4),o=Math.cos(tr*a),s=r.getIndex(),u=r.getAttribute("position"),l=s?s.count:u.count,c=[0,0,0],h=["a","b","c"],d=new Array(3),f={},p=[],v=0;v<l;v+=3){s?(c[0]=s.getX(v),c[1]=s.getX(v+1),c[2]=s.getX(v+2)):(c[0]=v,c[1]=v+1,c[2]=v+2);var m=Yc.a,g=Yc.b,y=Yc.c;if(m.fromBufferAttribute(u,c[0]),g.fromBufferAttribute(u,c[1]),y.fromBufferAttribute(u,c[2]),Yc.getNormal(Kc),d[0]="".concat(Math.round(m.x*i),",").concat(Math.round(m.y*i),",").concat(Math.round(m.z*i)),d[1]="".concat(Math.round(g.x*i),",").concat(Math.round(g.y*i),",").concat(Math.round(g.z*i)),d[2]="".concat(Math.round(y.x*i),",").concat(Math.round(y.y*i),",").concat(Math.round(y.z*i)),d[0]!==d[1]&&d[1]!==d[2]&&d[2]!==d[0])for(var b=0;b<3;b++){var x=(b+1)%3,w=d[b],k=d[x],S=Yc[h[b]],_=Yc[h[x]],T="".concat(w,"_").concat(k),M="".concat(k,"_").concat(w);M in f&&f[M]?(Kc.dot(f[M].normal)<=o&&(p.push(S.x,S.y,S.z),p.push(_.x,_.y,_.z)),f[M]=null):T in f||(f[T]={index0:c[b],index1:c[x],normal:Kc.clone()})}}for(var C in f)if(f[C]){var I=f[C],A=I.index0,R=I.index1;Xc.fromBufferAttribute(u,A),qc.fromBufferAttribute(u,R),p.push(Xc.x,Xc.y,Xc.z),p.push(qc.x,qc.y,qc.z)}e.setAttribute("position",new Ci(p,3))}return e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}]),n}(Oi),Jc=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).uuid=rr(),r.type="Shape",r.holes=[],r}return M(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){D(I(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var a=e.holes[t];this.holes.push(a.clone())}return this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var a=this.holes[t];e.holes.push(a.toJSON())}return e}},{key:"fromJSON",value:function(e){D(I(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var a=e.holes[t];this.holes.push((new zc).fromJSON(a))}return this}}]),n}(zc),Qc=function(e,t){var n,r,a,i,o,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=t&&t.length,h=c?t[0]*l:e.length,d=$c(e,0,h,l,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(e,t,n,r){var a,i,o,s=[];for(a=0,i=t.length;a<i;a++)(o=$c(e,t[a]*r,a<i-1?t[a+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(ch(o));for(s.sort(oh),a=0;a<s.length;a++)n=sh(s[a],n);return n}(e,t,d,l)),e.length>80*l){n=a=e[0],r=i=e[1];for(var p=l;p<h;p+=l)(o=e[p])<n&&(n=o),(s=e[p+1])<r&&(r=s),o>a&&(a=o),s>i&&(i=s);u=0!==(u=Math.max(a-n,i-r))?32767/u:0}return th(d,f,l,n,r,u,0),f};function $c(e,t,n,r,a){var i,o;if(a===function(e,t,n,r){for(var a=0,i=t,o=n-r;i<n;i+=r)a+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return a}(e,t,n,r)>0)for(i=t;i<n;i+=r)o=xh(i,e[i],e[i+1],o);else for(i=n-r;i>=t;i-=r)o=xh(i,e[i],e[i+1],o);return o&&ph(o,o.next)&&(wh(o),o=o.next),o}function eh(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!ph(r,r.next)&&0!==fh(r.prev,r,r.next))r=r.next;else{if(wh(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function th(e,t,n,r,a,i,o){if(e){!o&&i&&function(e,t,n,r){var a=e;do{0===a.z&&(a.z=lh(a.x,a.y,t,n,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function(e){var t,n,r,a,i,o,s,u,l=1;do{for(n=e,e=null,i=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(a=n,n=n.nextZ,s--):(a=r,r=r.nextZ,u--),i?i.nextZ=a:e=a,a.prevZ=i,i=a;n=r}i.nextZ=null,l*=2}while(o>1)}(a)}(e,r,a,i);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,i?rh(e,r,a,i):nh(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(u.i/n|0),wh(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?th(e=ah(eh(e),t,n),t,n,r,a,i,2):2===o&&ih(e,t,n,r,a,i):th(eh(e),t,n,r,a,i,1);break}}}function nh(e){var t=e.prev,n=e,r=e.next;if(fh(t,n,r)>=0)return!1;for(var a=t.x,i=n.x,o=r.x,s=t.y,u=n.y,l=r.y,c=a<i?a<o?a:o:i<o?i:o,h=s<u?s<l?s:l:u<l?u:l,d=a>i?a>o?a:o:i>o?i:o,f=s>u?s>l?s:l:u>l?u:l,p=r.next;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=h&&p.y<=f&&hh(a,s,i,u,o,l,p.x,p.y)&&fh(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function rh(e,t,n,r){var a=e.prev,i=e,o=e.next;if(fh(a,i,o)>=0)return!1;for(var s=a.x,u=i.x,l=o.x,c=a.y,h=i.y,d=o.y,f=s<u?s<l?s:l:u<l?u:l,p=c<h?c<d?c:d:h<d?h:d,v=s>u?s>l?s:l:u>l?u:l,m=c>h?c>d?c:d:h>d?h:d,g=lh(f,p,t,n,r),y=lh(v,m,t,n,r),b=e.prevZ,x=e.nextZ;b&&b.z>=g&&x&&x.z<=y;){if(b.x>=f&&b.x<=v&&b.y>=p&&b.y<=m&&b!==a&&b!==o&&hh(s,c,u,h,l,d,b.x,b.y)&&fh(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=f&&x.x<=v&&x.y>=p&&x.y<=m&&x!==a&&x!==o&&hh(s,c,u,h,l,d,x.x,x.y)&&fh(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=g;){if(b.x>=f&&b.x<=v&&b.y>=p&&b.y<=m&&b!==a&&b!==o&&hh(s,c,u,h,l,d,b.x,b.y)&&fh(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=f&&x.x<=v&&x.y>=p&&x.y<=m&&x!==a&&x!==o&&hh(s,c,u,h,l,d,x.x,x.y)&&fh(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function ah(e,t,n){var r=e;do{var a=r.prev,i=r.next.next;!ph(a,i)&&vh(a,r,r.next,i)&&yh(a,i)&&yh(i,a)&&(t.push(a.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),wh(r),wh(r.next),r=e=i),r=r.next}while(r!==e);return eh(r)}function ih(e,t,n,r,a,i){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&dh(o,s)){var u=bh(o,s);return o=eh(o,o.next),u=eh(u,u.next),th(o,t,n,r,a,i,0),void th(u,t,n,r,a,i,0)}s=s.next}o=o.next}while(o!==e)}function oh(e,t){return e.x-t.x}function sh(e,t){var n=function(e,t){var n,r=t,a=-1/0,i=e.x,o=e.y;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var u,l=n,c=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&hh(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),yh(r,e)&&(u<d||u===d&&(r.x>n.x||r.x===n.x&&uh(n,r)))&&(n=r,d=u)),r=r.next}while(r!==l);return n}(e,t);if(!n)return t;var r=bh(n,e);return eh(r,r.next),eh(n,n.next)}function uh(e,t){return fh(e.prev,e,t.prev)<0&&fh(t.next,e,e.next)<0}function lh(e,t,n,r,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ch(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function hh(e,t,n,r,a,i,o,s){return(a-o)*(t-s)>=(e-o)*(i-s)&&(e-o)*(r-s)>=(n-o)*(t-s)&&(n-o)*(i-s)>=(a-o)*(r-s)}function dh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&vh(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(yh(e,t)&&yh(t,e)&&function(e,t){var n=e,r=!1,a=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!==n.next.y>i&&n.next.y!==n.y&&a<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(fh(e.prev,e,t.prev)||fh(e,t.prev,t))||ph(e,t)&&fh(e.prev,e,e.next)>0&&fh(t.prev,t,t.next)>0)}function fh(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ph(e,t){return e.x===t.x&&e.y===t.y}function vh(e,t,n,r){var a=gh(fh(e,t,n)),i=gh(fh(e,t,r)),o=gh(fh(n,r,e)),s=gh(fh(n,r,t));return a!==i&&o!==s||(!(0!==a||!mh(e,n,t))||(!(0!==i||!mh(e,r,t))||(!(0!==o||!mh(n,e,r))||!(0!==s||!mh(n,t,r)))))}function mh(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function gh(e){return e>0?1:e<0?-1:0}function yh(e,t){return fh(e.prev,e,e.next)<0?fh(e,t,e.next)>=0&&fh(e,e.prev,t)>=0:fh(e,t,e.prev)<0||fh(e,e.next,t)<0}function bh(e,t){var n=new kh(e.i,e.x,e.y),r=new kh(t.i,t.x,t.y),a=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=a,a.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function xh(e,t,n,r){var a=new kh(e,t,n);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function wh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function kh(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Sh=function(){function e(){E(this,e)}return M(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,r=t-1,a=0;a<t;r=a++)n+=e[r].x*e[a].y-e[a].x*e[r].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],r=[],a=[];_h(e),Eh(n,e);var i=e.length;t.forEach(_h);for(var o=0;o<t.length;o++)r.push(i),i+=t[o].length,Eh(n,t[o]);for(var s=Qc(n,r),u=0;u<s.length;u+=3)a.push(s.slice(u,u+3));return a}}]),e}();function _h(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Eh(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var Th=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jc([new fr(.5,.5),new fr(-.5,.5),new fr(-.5,-.5),new fr(.5,-.5)]),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};E(this,n),(e=t.call(this)).type="ExtrudeGeometry",e.parameters={shapes:r,options:a},r=Array.isArray(r)?r:[r];for(var i=A(e),o=[],s=[],u=0,l=r.length;u<l;u++){c(r[u])}function c(e){var t,n,r,u,l,c=[],h=void 0!==a.curveSegments?a.curveSegments:12,d=void 0!==a.steps?a.steps:1,f=void 0!==a.depth?a.depth:1,p=void 0===a.bevelEnabled||a.bevelEnabled,v=void 0!==a.bevelThickness?a.bevelThickness:.2,m=void 0!==a.bevelSize?a.bevelSize:v-.1,g=void 0!==a.bevelOffset?a.bevelOffset:0,y=void 0!==a.bevelSegments?a.bevelSegments:3,b=a.extrudePath,x=void 0!==a.UVGenerator?a.UVGenerator:Mh,w=!1;b&&(t=b.getSpacedPoints(d),w=!0,p=!1,n=b.computeFrenetFrames(d,!1),r=new Gr,u=new Gr,l=new Gr),p||(y=0,v=0,m=0,g=0);var k=e.extractPoints(h),S=k.shape,_=k.holes;if(!Sh.isClockWise(S)){S=S.reverse();for(var E=0,T=_.length;E<T;E++){var M=_[E];Sh.isClockWise(M)&&(_[E]=M.reverse())}}for(var C=Sh.triangulateShape(S,_),I=S,A=0,R=_.length;A<R;A++){var N=_[A];S=S.concat(N)}function L(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}var P=S.length,D=C.length;function F(e,t,n){var r,a,i,o=e.x-t.x,s=e.y-t.y,u=n.x-e.x,l=n.y-e.y,c=o*o+s*s,h=o*l-s*u;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),f=Math.sqrt(u*u+l*l),p=t.x-s/d,v=t.y+o/d,m=((n.x-l/f-p)*l-(n.y+u/f-v)*u)/(o*l-s*u),g=(r=p+o*m-e.x)*r+(a=v+s*m-e.y)*a;if(g<=2)return new fr(r,a);i=Math.sqrt(g/2)}else{var y=!1;o>Number.EPSILON?u>Number.EPSILON&&(y=!0):o<-Number.EPSILON?u<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(l)&&(y=!0),y?(r=-s,a=o,i=Math.sqrt(c)):(r=o,a=s,i=Math.sqrt(c/2))}return new fr(r/i,a/i)}for(var O=[],z=0,U=I.length,B=U-1,W=z+1;z<U;z++,B++,W++)B===U&&(B=0),W===U&&(W=0),O[z]=F(I[z],I[B],I[W]);for(var V,G=[],H=O.concat(),j=0,X=_.length;j<X;j++){var q=_[j];V=[];for(var K=0,Y=q.length,Z=Y-1,J=K+1;K<Y;K++,Z++,J++)Z===Y&&(Z=0),J===Y&&(J=0),V[K]=F(q[K],q[Z],q[J]);G.push(V),H=H.concat(V)}for(var Q=0;Q<y;Q++){for(var $=Q/y,ee=v*Math.cos($*Math.PI/2),te=m*Math.sin($*Math.PI/2)+g,ne=0,re=I.length;ne<re;ne++){var ae=L(I[ne],O[ne],te);Re(ae.x,ae.y,-ee)}for(var ie=0,oe=_.length;ie<oe;ie++){var se=_[ie];V=G[ie];for(var ue=0,le=se.length;ue<le;ue++){var ce=L(se[ue],V[ue],te);Re(ce.x,ce.y,-ee)}}}for(var he=m+g,de=0;de<P;de++){var fe=p?L(S[de],H[de],he):S[de];w?(u.copy(n.normals[0]).multiplyScalar(fe.x),r.copy(n.binormals[0]).multiplyScalar(fe.y),l.copy(t[0]).add(u).add(r),Re(l.x,l.y,l.z)):Re(fe.x,fe.y,0)}for(var pe=1;pe<=d;pe++)for(var ve=0;ve<P;ve++){var me=p?L(S[ve],H[ve],he):S[ve];w?(u.copy(n.normals[pe]).multiplyScalar(me.x),r.copy(n.binormals[pe]).multiplyScalar(me.y),l.copy(t[pe]).add(u).add(r),Re(l.x,l.y,l.z)):Re(me.x,me.y,f/d*pe)}for(var ge=y-1;ge>=0;ge--){for(var ye=ge/y,be=v*Math.cos(ye*Math.PI/2),xe=m*Math.sin(ye*Math.PI/2)+g,we=0,ke=I.length;we<ke;we++){var Se=L(I[we],O[we],xe);Re(Se.x,Se.y,f+be)}for(var _e=0,Ee=_.length;_e<Ee;_e++){var Te=_[_e];V=G[_e];for(var Me=0,Ce=Te.length;Me<Ce;Me++){var Ie=L(Te[Me],V[Me],xe);w?Re(Ie.x,Ie.y+t[d-1].y,t[d-1].x+be):Re(Ie.x,Ie.y,f+be)}}}function Ae(e,t){for(var n=e.length;--n>=0;){var r=n,a=n-1;a<0&&(a=e.length-1);for(var i=0,o=d+2*y;i<o;i++){var s=P*i,u=P*(i+1);Le(t+r+s,t+a+s,t+a+u,t+r+u)}}}function Re(e,t,n){c.push(e),c.push(t),c.push(n)}function Ne(e,t,n){Pe(e),Pe(t),Pe(n);var r=o.length/3,a=x.generateTopUV(i,o,r-3,r-2,r-1);De(a[0]),De(a[1]),De(a[2])}function Le(e,t,n,r){Pe(e),Pe(t),Pe(r),Pe(t),Pe(n),Pe(r);var a=o.length/3,s=x.generateSideWallUV(i,o,a-6,a-3,a-2,a-1);De(s[0]),De(s[1]),De(s[3]),De(s[1]),De(s[2]),De(s[3])}function Pe(e){o.push(c[3*e+0]),o.push(c[3*e+1]),o.push(c[3*e+2])}function De(e){s.push(e.x),s.push(e.y)}!function(){var e=o.length/3;if(p){for(var t=0,n=P*t,r=0;r<D;r++){var a=C[r];Ne(a[2]+n,a[1]+n,a[0]+n)}n=P*(t=d+2*y);for(var s=0;s<D;s++){var u=C[s];Ne(u[0]+n,u[1]+n,u[2]+n)}}else{for(var l=0;l<D;l++){var c=C[l];Ne(c[2],c[1],c[0])}for(var h=0;h<D;h++){var f=C[h];Ne(f[0]+P*d,f[1]+P*d,f[2]+P*d)}}i.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;Ae(I,t),t+=I.length;for(var n=0,r=_.length;n<r;n++){var a=_[n];Ae(a,t),t+=a.length}i.addGroup(e,o.length/3-e,1)}()}return e.setAttribute("position",new Ci(o,3)),e.setAttribute("uv",new Ci(s,2)),e.computeVertexNormals(),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,a=e.length;r<a;r++){var i=e[r];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],a=0,i=e.shapes.length;a<i;a++){var o=t[e.shapes[a]];r.push(o)}var s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new Fc[s.type]).fromJSON(s)),new n(r,e.options)}}]),n}(Oi),Mh={generateTopUV:function(e,t,n,r,a){var i=t[3*n],o=t[3*n+1],s=t[3*r],u=t[3*r+1],l=t[3*a],c=t[3*a+1];return[new fr(i,o),new fr(s,u),new fr(l,c)]},generateSideWallUV:function(e,t,n,r,a,i){var o=t[3*n],s=t[3*n+1],u=t[3*n+2],l=t[3*r],c=t[3*r+1],h=t[3*r+2],d=t[3*a],f=t[3*a+1],p=t[3*a+2],v=t[3*i],m=t[3*i+1],g=t[3*i+2];return Math.abs(s-c)<Math.abs(o-l)?[new fr(o,1-u),new fr(l,1-h),new fr(d,1-p),new fr(v,1-g)]:[new fr(s,1-u),new fr(c,1-h),new fr(f,1-p),new fr(m,1-g)]}};var Ch=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;E(this,n);var i=(1+Math.sqrt(5))/2,o=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];return(e=t.call(this,o,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,a)).type="IcosahedronGeometry",e.parameters={radius:r,detail:a},e}return M(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Hc),Ih=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;E(this,n);return(e=t.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],r,a)).type="OctahedronGeometry",e.parameters={radius:r,detail:a},e}return M(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Hc),Ah=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;E(this,n),(e=t.call(this)).type="RingGeometry",e.parameters={innerRadius:r,outerRadius:a,thetaSegments:i,phiSegments:o,thetaStart:s,thetaLength:u},i=Math.max(3,i);for(var l=[],c=[],h=[],d=[],f=r,p=(a-r)/(o=Math.max(1,o)),v=new Gr,m=new fr,g=0;g<=o;g++){for(var y=0;y<=i;y++){var b=s+y/i*u;v.x=f*Math.cos(b),v.y=f*Math.sin(b),c.push(v.x,v.y,v.z),h.push(0,0,1),m.x=(v.x/a+1)/2,m.y=(v.y/a+1)/2,d.push(m.x,m.y)}f+=p}for(var x=0;x<o;x++)for(var w=x*(i+1),k=0;k<i;k++){var S=k+w,_=S,T=S+i+1,M=S+i+2,C=S+1;l.push(_,T,C),l.push(T,M,C)}return e.setIndex(l),e.setAttribute("position",new Ci(c,3)),e.setAttribute("normal",new Ci(h,3)),e.setAttribute("uv",new Ci(d,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}]),n}(Oi),Rh=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jc([new fr(0,.5),new fr(-.5,-.5),new fr(.5,-.5)]),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;E(this,n),(e=t.call(this)).type="ShapeGeometry",e.parameters={shapes:r,curveSegments:a};var i=[],o=[],s=[],u=[],l=0,c=0;if(!1===Array.isArray(r))d(r);else for(var h=0;h<r.length;h++)d(r[h]),e.addGroup(l,c,h),l+=c,c=0;function d(e){var t=o.length/3,n=e.extractPoints(a),r=n.shape,l=n.holes;!1===Sh.isClockWise(r)&&(r=r.reverse());for(var h=0,d=l.length;h<d;h++){var f=l[h];!0===Sh.isClockWise(f)&&(l[h]=f.reverse())}for(var p=Sh.triangulateShape(r,l),v=0,m=l.length;v<m;v++){var g=l[v];r=r.concat(g)}for(var y=0,b=r.length;y<b;y++){var x=r[y];o.push(x.x,x.y,0),s.push(0,0,1),u.push(x.x,x.y)}for(var w=0,k=p.length;w<k;w++){var S=p[w],_=S[0]+t,E=S[1]+t,T=S[2]+t;i.push(_,E,T),c+=3}}return e.setIndex(i),e.setAttribute("position",new Ci(o,3)),e.setAttribute("normal",new Ci(s,3)),e.setAttribute("uv",new Ci(u,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var a=e[n];t.shapes.push(a.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],a=0,i=e.shapes.length;a<i;a++){var o=t[e.shapes[a]];r.push(o)}return new n(r,e.curveSegments)}}]),n}(Oi);var Nh=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;E(this,n),(e=t.call(this)).type="SphereGeometry",e.parameters={radius:r,widthSegments:a,heightSegments:i,phiStart:o,phiLength:s,thetaStart:u,thetaLength:l},a=Math.max(3,Math.floor(a)),i=Math.max(2,Math.floor(i));for(var c=Math.min(u+l,Math.PI),h=0,d=[],f=new Gr,p=new Gr,v=[],m=[],g=[],y=[],b=0;b<=i;b++){var x=[],w=b/i,k=0;0===b&&0===u?k=.5/a:b===i&&c===Math.PI&&(k=-.5/a);for(var S=0;S<=a;S++){var _=S/a;f.x=-r*Math.cos(o+_*s)*Math.sin(u+w*l),f.y=r*Math.cos(u+w*l),f.z=r*Math.sin(o+_*s)*Math.sin(u+w*l),m.push(f.x,f.y,f.z),p.copy(f).normalize(),g.push(p.x,p.y,p.z),y.push(_+k,1-w),x.push(h++)}d.push(x)}for(var T=0;T<i;T++)for(var M=0;M<a;M++){var C=d[T][M+1],I=d[T][M],A=d[T+1][M],R=d[T+1][M+1];(0!==T||u>0)&&v.push(C,I,R),(T!==i-1||c<Math.PI)&&v.push(I,A,R)}return e.setIndex(v),e.setAttribute("position",new Ci(m,3)),e.setAttribute("normal",new Ci(g,3)),e.setAttribute("uv",new Ci(y,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),n}(Oi),Lh=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;E(this,n);return(e=t.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],r,a)).type="TetrahedronGeometry",e.parameters={radius:r,detail:a},e}return M(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Hc),Ph=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;E(this,n),(e=t.call(this)).type="TorusGeometry",e.parameters={radius:r,tube:a,radialSegments:i,tubularSegments:o,arc:s},i=Math.floor(i),o=Math.floor(o);for(var u=[],l=[],c=[],h=[],d=new Gr,f=new Gr,p=new Gr,v=0;v<=i;v++)for(var m=0;m<=o;m++){var g=m/o*s,y=v/i*Math.PI*2;f.x=(r+a*Math.cos(y))*Math.cos(g),f.y=(r+a*Math.cos(y))*Math.sin(g),f.z=a*Math.sin(y),l.push(f.x,f.y,f.z),d.x=r*Math.cos(g),d.y=r*Math.sin(g),p.subVectors(f,d).normalize(),c.push(p.x,p.y,p.z),h.push(m/o),h.push(v/i)}for(var b=1;b<=i;b++)for(var x=1;x<=o;x++){var w=(o+1)*b+x-1,k=(o+1)*(b-1)+x-1,S=(o+1)*(b-1)+x,_=(o+1)*b+x;u.push(w,k,_),u.push(k,S,_)}return e.setIndex(u),e.setAttribute("position",new Ci(l,3)),e.setAttribute("normal",new Ci(c,3)),e.setAttribute("uv",new Ci(h,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}]),n}(Oi),Dh=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;E(this,n),(e=t.call(this)).type="TorusKnotGeometry",e.parameters={radius:r,tube:a,tubularSegments:i,radialSegments:o,p:s,q:u},i=Math.floor(i),o=Math.floor(o);for(var l=[],c=[],h=[],d=[],f=new Gr,p=new Gr,v=new Gr,m=new Gr,g=new Gr,y=new Gr,b=new Gr,x=0;x<=i;++x){var w=x/i*s*Math.PI*2;L(w,s,u,r,v),L(w+.01,s,u,r,m),y.subVectors(m,v),b.addVectors(m,v),g.crossVectors(y,b),b.crossVectors(g,y),g.normalize(),b.normalize();for(var k=0;k<=o;++k){var S=k/o*Math.PI*2,_=-a*Math.cos(S),T=a*Math.sin(S);f.x=v.x+(_*b.x+T*g.x),f.y=v.y+(_*b.y+T*g.y),f.z=v.z+(_*b.z+T*g.z),c.push(f.x,f.y,f.z),p.subVectors(f,v).normalize(),h.push(p.x,p.y,p.z),d.push(x/i),d.push(k/o)}}for(var M=1;M<=i;M++)for(var C=1;C<=o;C++){var I=(o+1)*(M-1)+(C-1),A=(o+1)*M+(C-1),R=(o+1)*M+C,N=(o+1)*(M-1)+C;l.push(I,A,N),l.push(A,R,N)}function L(e,t,n,r,a){var i=Math.cos(e),o=Math.sin(e),s=n/t*e,u=Math.cos(s);a.x=r*(2+u)*.5*i,a.y=r*(2+u)*o*.5,a.z=r*Math.sin(s)*.5}return e.setIndex(l),e.setAttribute("position",new Ci(c,3)),e.setAttribute("normal",new Ci(h,3)),e.setAttribute("uv",new Ci(d,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}]),n}(Oi),Fh=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pc(new Gr(-1,-1,0),new Gr(-1,1,0),new Gr(1,1,0)),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];E(this,n),(e=t.call(this)).type="TubeGeometry",e.parameters={path:r,tubularSegments:a,radius:i,radialSegments:o,closed:s};var u=r.computeFrenetFrames(a,s);e.tangents=u.tangents,e.normals=u.normals,e.binormals=u.binormals;var l=new Gr,c=new Gr,h=new fr,d=new Gr,f=[],p=[],v=[],m=[];function g(e){d=r.getPointAt(e/a,d);for(var t=u.normals[e],n=u.binormals[e],s=0;s<=o;s++){var h=s/o*Math.PI*2,v=Math.sin(h),m=-Math.cos(h);c.x=m*t.x+v*n.x,c.y=m*t.y+v*n.y,c.z=m*t.z+v*n.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=d.x+i*c.x,l.y=d.y+i*c.y,l.z=d.z+i*c.z,f.push(l.x,l.y,l.z)}}return function(){for(var e=0;e<a;e++)g(e);g(!1===s?a:0),function(){for(var e=0;e<=a;e++)for(var t=0;t<=o;t++)h.x=e/a,h.y=t/o,v.push(h.x,h.y)}(),function(){for(var e=1;e<=a;e++)for(var t=1;t<=o;t++){var n=(o+1)*(e-1)+(t-1),r=(o+1)*e+(t-1),i=(o+1)*e+t,s=(o+1)*(e-1)+t;m.push(n,r,s),m.push(r,i,s)}}()}(),e.setIndex(m),e.setAttribute("position",new Ci(f,3)),e.setAttribute("normal",new Ci(p,3)),e.setAttribute("uv",new Ci(v,2)),e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.path=this.parameters.path.toJSON(),e}}],[{key:"fromJSON",value:function(e){return new n((new Fc[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}]),n}(Oi),Oh=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(E(this,n),(e=t.call(this)).type="WireframeGeometry",e.parameters={geometry:r},null!==r){var a=[],i=new Set,o=new Gr,s=new Gr;if(null!==r.index){var u=r.attributes.position,l=r.index,c=r.groups;0===c.length&&(c=[{start:0,count:l.count,materialIndex:0}]);for(var h=0,d=c.length;h<d;++h)for(var f=c[h],p=f.start,v=p,m=p+f.count;v<m;v+=3)for(var g=0;g<3;g++){var y=l.getX(v+g),b=l.getX(v+(g+1)%3);o.fromBufferAttribute(u,y),s.fromBufferAttribute(u,b),!0===zh(o,s,i)&&(a.push(o.x,o.y,o.z),a.push(s.x,s.y,s.z))}}else for(var x=r.attributes.position,w=0,k=x.count/3;w<k;w++)for(var S=0;S<3;S++){var _=3*w+S,T=3*w+(S+1)%3;o.fromBufferAttribute(x,_),s.fromBufferAttribute(x,T),!0===zh(o,s,i)&&(a.push(o.x,o.y,o.z),a.push(s.x,s.y,s.z))}e.setAttribute("position",new Ci(a,3))}return e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}]),n}(Oi);function zh(e,t,n){var r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),a="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);return!0!==n.has(r)&&!0!==n.has(a)&&(n.add(r),n.add(a),!0)}var Uh=Object.freeze({__proto__:null,BoxGeometry:ro,CapsuleGeometry:Bc,CircleGeometry:Wc,ConeGeometry:Gc,CylinderGeometry:Vc,DodecahedronGeometry:jc,EdgesGeometry:Zc,ExtrudeGeometry:Th,IcosahedronGeometry:Ch,LatheGeometry:Uc,OctahedronGeometry:Ih,PlaneGeometry:Eo,PolyhedronGeometry:Hc,RingGeometry:Ah,ShapeGeometry:Rh,SphereGeometry:Nh,TetrahedronGeometry:Lh,TorusGeometry:Ph,TorusKnotGeometry:Dh,TubeGeometry:Fh,WireframeGeometry:Oh}),Bh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isShadowMaterial=!0,r.type="ShadowMaterial",r.color=new li(0),r.transparent=!0,r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.fog=e.fog,this}}]),n}(ai),Wh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).isRawShaderMaterial=!0,r.type="RawShaderMaterial",r}return M(n)}(uo),Vh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshStandardMaterial=!0,r.defines={STANDARD:""},r.type="MeshStandardMaterial",r.color=new li(16777215),r.roughness=1,r.metalness=0,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new li(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=yn,r.normalScale=new fr(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.roughnessMap=null,r.metalnessMap=null,r.alphaMap=null,r.envMap=null,r.envMapIntensity=1,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.flatShading=!1,r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(ai),Gh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshPhysicalMaterial=!0,r.defines={STANDARD:"",PHYSICAL:""},r.type="MeshPhysicalMaterial",r.clearcoatMap=null,r.clearcoatRoughness=0,r.clearcoatRoughnessMap=null,r.clearcoatNormalScale=new fr(1,1),r.clearcoatNormalMap=null,r.ior=1.5,Object.defineProperty(A(r),"reflectivity",{get:function(){return ar(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),r.iridescenceMap=null,r.iridescenceIOR=1.3,r.iridescenceThicknessRange=[100,400],r.iridescenceThicknessMap=null,r.sheenColor=new li(0),r.sheenColorMap=null,r.sheenRoughness=1,r.sheenRoughnessMap=null,r.transmissionMap=null,r.thickness=0,r.thicknessMap=null,r.attenuationDistance=1/0,r.attenuationColor=new li(1,1,1),r.specularIntensity=1,r.specularIntensityMap=null,r.specularColor=new li(1,1,1),r.specularColorMap=null,r._sheen=0,r._clearcoat=0,r._iridescence=0,r._transmission=0,r.setValues(e),r}return M(n,[{key:"sheen",get:function(){return this._sheen},set:function(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}},{key:"iridescence",get:function(){return this._iridescence},set:function(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}},{key:"transmission",get:function(){return this._transmission},set:function(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=g(e.iridescenceThicknessRange),this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}]),n}(Vh),Hh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshPhongMaterial=!0,r.type="MeshPhongMaterial",r.color=new li(16777215),r.specular=new li(1118481),r.shininess=30,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new li(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=yn,r.normalScale=new fr(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=Me,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.flatShading=!1,r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(ai),jh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshToonMaterial=!0,r.defines={TOON:""},r.type="MeshToonMaterial",r.color=new li(16777215),r.map=null,r.gradientMap=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new li(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=yn,r.normalScale=new fr(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.alphaMap=null,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(ai),Xh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshNormalMaterial=!0,r.type="MeshNormalMaterial",r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=yn,r.normalScale=new fr(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.flatShading=!1,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}]),n}(ai),qh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshLambertMaterial=!0,r.type="MeshLambertMaterial",r.color=new li(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new li(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=yn,r.normalScale=new fr(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=Me,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.flatShading=!1,r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(ai),Kh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isMeshMatcapMaterial=!0,r.defines={MATCAP:""},r.type="MeshMatcapMaterial",r.color=new li(16777215),r.matcap=null,r.map=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=yn,r.normalScale=new fr(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.alphaMap=null,r.flatShading=!1,r.fog=!0,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(ai),Yh=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).isLineDashedMaterial=!0,r.type="LineDashedMaterial",r.scale=1,r.dashSize=3,r.gapSize=1,r.setValues(e),r}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}]),n}(Kl);function Zh(e,t,n){return Qh(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function Jh(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Qh(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function $h(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n}function ed(e,t,n){for(var r=e.length,a=new e.constructor(r),i=0,o=0;o!==r;++i)for(var s=n[i]*t,u=0;u!==t;++u)a[o++]=e[s+u];return a}function td(e,t,n,r){for(var a=1,i=e[0];void 0!==i&&void 0===i[r];)i=e[a++];if(void 0!==i){var o=i[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=i[r])&&(t.push(i.time),n.push.apply(n,o)),i=e[a++]}while(void 0!==i);else if(void 0!==o.toArray)do{void 0!==(o=i[r])&&(t.push(i.time),o.toArray(n,n.length)),i=e[a++]}while(void 0!==i);else do{void 0!==(o=i[r])&&(t.push(i.time),n.push(o)),i=e[a++]}while(void 0!==i)}}var nd={arraySlice:Zh,convertArray:Jh,isTypedArray:Qh,getKeyframeOrder:$h,sortedArray:ed,flattenJSON:td,subclip:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,i=e.clone();i.name=t;for(var o=[],s=0;s<i.tracks.length;++s){for(var u=i.tracks[s],l=u.getValueSize(),c=[],h=[],d=0;d<u.times.length;++d){var f=u.times[d]*a;if(!(f<n||f>=r)){c.push(u.times[d]);for(var p=0;p<l;++p)h.push(u.values[d*l+p])}}0!==c.length&&(u.times=Jh(c,u.times.constructor),u.values=Jh(h,u.values.constructor),o.push(u))}i.tracks=o;for(var v=1/0,m=0;m<i.tracks.length;++m)v>i.tracks[m].times[0]&&(v=i.tracks[m].times[0]);for(var g=0;g<i.tracks.length;++g)i.tracks[g].shift(-1*v);return i.resetDuration(),i},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);for(var a=n.tracks.length,i=t/r,o=function(){var t=n.tracks[s],r=t.ValueTypeName;if("bool"===r||"string"===r)return"continue";var a=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===r}));if(void 0===a)return"continue";var o=0,u=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=u/3);var l=0,c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);var h,d=t.times.length-1;if(i<=t.times[0]){var f=o,p=u-o;h=Zh(t.values,f,p)}else if(i>=t.times[d]){var v=d*u+o,m=v+u-o;h=Zh(t.values,v,m)}else{var g=t.createInterpolant(),y=o,b=u-o;g.evaluate(i),h=Zh(g.resultBuffer,y,b)}"quaternion"===r&&(new Vr).fromArray(h).normalize().conjugate().toArray(h);for(var x=a.times.length,w=0;w<x;++w){var k=w*c+l;if("quaternion"===r)Vr.multiplyQuaternionsFlat(a.values,k,h,0,a.values,k);else for(var S=c-2*l,_=0;_<S;++_)a.values[k+_]-=h[_]}},s=0;s<a;++s)o();return e.blendMode=cn,e}},rd=function(){function e(t,n,r,a){E(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==a?a:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}return M(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],a=t[n-1];e:{t:{var i;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<a)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(a=r,e<(r=t[++n]))break t}i=t.length;break n}if(e>=a)break e;var s=t[1];e<s&&(n=2,a=s);for(var u=n-2;;){if(void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(n===u)break;if(r=a,e>=(a=t[--n-1]))break t}i=n,n=0}for(;n<i;){var l=n+i>>>1;e<t[l]?i=l:n=l+1}if(r=t[n],void 0===(a=t[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,a,r)}return this.interpolate_(n,a,e,r)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r,i=0;i!==r;++i)t[i]=n[a+i];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}(),ad=function(e){C(n,e);var t=R(n);function n(e,r,a,i){var o;return E(this,n),(o=t.call(this,e,r,a,i))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:on,endingEnd:on},o}return M(n,[{key:"intervalChanged_",value:function(e,t,n){var r=this.parameterPositions,a=e-2,i=e+1,o=r[a],s=r[i];if(void 0===o)switch(this.getSettings_().endingStart){case sn:a=e,o=2*t-n;break;case un:o=t+r[a=r.length-2]-r[a+1];break;default:a=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case sn:i=e,s=2*n-t;break;case un:i=1,s=n+r[1]-r[0];break;default:i=e-1,s=t}var u=.5*(n-t),l=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=a*l,this._offsetNext=i*l}},{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(r-t),p=f*f,v=p*f,m=-h*v+2*h*p-h*f,g=(1+h)*v+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*v+(1.5+d)*p+.5*f,b=d*v-d*p,x=0;x!==o;++x)a[x]=m*i[l+x]+g*i[u+x]+y*i[s+x]+b*i[c+x];return a}}]),n}(rd),id=function(e){C(n,e);var t=R(n);function n(e,r,a,i){return E(this,n),t.call(this,e,r,a,i)}return M(n,[{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=(n-t)/(r-t),c=1-l,h=0;h!==o;++h)a[h]=i[u+h]*c+i[s+h]*l;return a}}]),n}(rd),od=function(e){C(n,e);var t=R(n);function n(e,r,a,i){return E(this,n),t.call(this,e,r,a,i)}return M(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(rd),sd=function(){function e(t,n,r,a){if(E(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Jh(n,this.TimeBufferType),this.values=Jh(r,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}return M(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new od(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new id(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new ad(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case nn:t=this.InterpolantFactoryMethodDiscrete;break;case rn:t=this.InterpolantFactoryMethodLinear;break;case an:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return nn;case this.InterpolantFactoryMethodLinear:return rn;case this.InterpolantFactoryMethodSmooth:return an}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,r=n.length,a=0,i=r-1;a!==r&&n[a]<e;)++a;for(;-1!==i&&n[i]>t;)--i;if(++i,0!==a||i!==r){a>=i&&(a=(i=Math.max(i,1))-1);var o=this.getValueSize();this.times=Zh(n,a,i),this.values=Zh(this.values,a*o,i*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,a=n.length;0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var i=null,o=0;o!==a;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==i&&i>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,i),e=!1;break}i=s}if(void 0!==r&&Qh(r))for(var u=0,l=r.length;u!==l;++u){var c=r[u];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,c),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=Zh(this.times),t=Zh(this.values),n=this.getValueSize(),r=this.getInterpolation()===an,a=e.length-1,i=1,o=1;o<a;++o){var s=!1,u=e[o];if(u!==e[o+1]&&(1!==o||u!==e[0]))if(r)s=!0;else for(var l=o*n,c=l-n,h=l+n,d=0;d!==n;++d){var f=t[l+d];if(f!==t[c+d]||f!==t[h+d]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];for(var p=o*n,v=i*n,m=0;m!==n;++m)t[v+m]=t[p+m]}++i}}if(a>0){e[i]=e[a];for(var g=a*n,y=i*n,b=0;b!==n;++b)t[y+b]=t[g+b];++i}return i!==e.length?(this.times=Zh(e,0,i),this.values=Zh(t,0,i*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=Zh(this.times,0),t=Zh(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Jh(e.times,Array),values:Jh(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}]),e}();sd.prototype.TimeBufferType=Float32Array,sd.prototype.ValueBufferType=Float32Array,sd.prototype.DefaultInterpolation=rn;var ud=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n)}(sd);ud.prototype.ValueTypeName="bool",ud.prototype.ValueBufferType=Array,ud.prototype.DefaultInterpolation=nn,ud.prototype.InterpolantFactoryMethodLinear=void 0,ud.prototype.InterpolantFactoryMethodSmooth=void 0;var ld=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n)}(sd);ld.prototype.ValueTypeName="color";var cd=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n)}(sd);cd.prototype.ValueTypeName="number";var hd=function(e){C(n,e);var t=R(n);function n(e,r,a,i){return E(this,n),t.call(this,e,r,a,i)}return M(n,[{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t),u=e*o,l=u+o;u!==l;u+=4)Vr.slerpFlat(a,0,i,u-o,i,u,s);return a}}]),n}(rd),dd=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new hd(this.times,this.values,this.getValueSize(),e)}}]),n}(sd);dd.prototype.ValueTypeName="quaternion",dd.prototype.DefaultInterpolation=rn,dd.prototype.InterpolantFactoryMethodSmooth=void 0;var fd=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n)}(sd);fd.prototype.ValueTypeName="string",fd.prototype.ValueBufferType=Array,fd.prototype.DefaultInterpolation=nn,fd.prototype.InterpolantFactoryMethodLinear=void 0,fd.prototype.InterpolantFactoryMethodSmooth=void 0;var pd=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n)}(sd);pd.prototype.ValueTypeName="vector";var vd=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ln;E(this,e),this.name=t,this.tracks=r,this.duration=n,this.blendMode=a,this.uuid=rr(),this.duration<0&&this.resetDuration()}return M(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),a=0,i=n.length;a!==i;++a)t.push(md(n[a]).scale(r));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},a=0,i=n.length;a!==i;++a)t.push(sd.toJSON(n[a]));return r}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,r){for(var a=t.length,i=[],o=0;o<a;o++){var s=[],u=[];s.push((o+a-1)%a,o,(o+1)%a),u.push(0,1,0);var l=$h(s);s=ed(s,1,l),u=ed(u,1,l),r||0!==s[0]||(s.push(a),u.push(u[0])),i.push(new cd(".morphTargetInfluences["+t[o].name+"]",s,u).scale(1/n))}return new this(e,-1,i)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var a=0;a<n.length;a++)if(n[a].name===t)return n[a];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var r={},a=/^([\w-]*?)([\d]+)$/,i=0,o=e.length;i<o;i++){var s=e[i],u=s.name.match(a);if(u&&u.length>1){var l=u[1],c=r[l];c||(r[l]=c=[]),c.push(s)}}var h=[];for(var d in r)h.push(this.CreateFromMorphTargetSequence(d,r[d],t,n));return h}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,a){if(0!==n.length){var i=[],o=[];td(n,i,o,r),0!==i.length&&a.push(new e(t,i,o))}},r=[],a=e.name||"default",i=e.fps||30,o=e.blendMode,s=e.length||-1,u=e.hierarchy||[],l=0;l<u.length;l++){var c=u[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},d=void 0;for(d=0;d<c.length;d++)if(c[d].morphTargets)for(var f=0;f<c[d].morphTargets.length;f++)h[c[d].morphTargets[f]]=-1;for(var p in h){for(var v=[],m=[],g=0;g!==c[d].morphTargets.length;++g){var y=c[d];v.push(y.time),m.push(y.morphTarget===p?1:0)}r.push(new cd(".morphTargetInfluence["+p+"]",v,m))}s=h.length*i}else{var b=".bones["+t[l].name+"]";n(pd,b+".position",c,"pos",r),n(dd,b+".quaternion",c,"rot",r),n(pd,b+".scale",c,"scl",r)}}return 0===r.length?null:new this(a,s,r,o)}}]),e}();function md(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return cd;case"vector":case"vector2":case"vector3":case"vector4":return pd;case"color":return ld;case"quaternion":return dd;case"bool":case"boolean":return ud;case"string":return fd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];td(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var gd,yd={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},bd=M((function e(t,n,r){E(this,e);var a=this,i=!1,o=0,s=0,u=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=r,this.itemStart=function(e){s++,!1===i&&void 0!==a.onStart&&a.onStart(e,o,s),i=!0},this.itemEnd=function(e){o++,void 0!==a.onProgress&&a.onProgress(e,o,s),o===s&&(i=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(e){void 0!==a.onError&&a.onError(e)},this.resolveURL=function(e){return u?u(e):e},this.setURLModifier=function(e){return u=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var r=l[t],a=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return a}return null}})),xd=new bd,wd=function(){function e(t){E(this,e),this.manager=void 0!==t?t:xd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return M(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(r,a){n.load(e,r,t,a)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),kd={},Sd=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this,e)).response=r,a}return M(n)}(P(Error)),_d=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){var a=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=yd.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;if(void 0===kd[e]){kd[e]=[],kd[e].push({onLoad:t,onProgress:n,onError:r});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,u=this.responseType;fetch(o).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;var n=kd[e],r=t.body.getReader(),a=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),i=a?parseInt(a):0,o=0!==i,s=0,u=new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var a=r.done,u=r.value;if(a)e.close();else{s+=u.byteLength;for(var l=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:i}),c=0,h=n.length;c<h;c++){var d=n[c];d.onProgress&&d.onProgress(l)}e.enqueue(u),t()}}))}()}});return new Response(u)}throw new Sd('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)})).then((function(e){switch(u){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,s)}));case"json":return e.json();default:if(void 0===s)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((function(e){return r.decode(e)}))}})).then((function(t){yd.add(e,t);var n=kd[e];delete kd[e];for(var r=0,a=n.length;r<a;r++){var i=n[r];i.onLoad&&i.onLoad(t)}})).catch((function(t){var n=kd[e];if(void 0===n)throw a.manager.itemError(e),t;delete kd[e];for(var r=0,i=n.length;r<i;r++){var o=n[r];o.onError&&o.onError(t)}a.manager.itemError(e)})).finally((function(){a.manager.itemEnd(e)})),this.manager.itemStart(e)}else kd[e].push({onLoad:t,onProgress:n,onError:r})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(wd),Ed=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new _d(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(n){try{t(a.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=vd.parse(e[n]);t.push(r)}return t}}]),n}(wd),Td=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){var a=this,i=[],o=new pc,s=new _d(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(a.withCredentials);var u=0;function l(l){s.load(e[l],(function(e){var n=a.parse(e,!0);i[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(u+=1)&&(1===n.mipmapCount&&(o.minFilter=Ze),o.image=i,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,r)}if(Array.isArray(e))for(var c=0,h=e.length;c<h;++c)l(c);else s.load(e,(function(e){var n=a.parse(e,!0);if(n.isCubemap){for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){i[s]={mipmaps:[]};for(var u=0;u<n.mipmapCount;u++)i[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+u]),i[s].format=n.format,i[s].width=n.width,i[s].height=n.height}o.image=i}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=Ze),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,r);return o}}]),n}(wd),Md=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,i=yd.get(e);if(void 0!==i)return a.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;var o=br("img");function s(){l(),yd.add(e,this),t&&t(this),a.manager.itemEnd(e)}function u(t){l(),r&&r(t),a.manager.itemError(e),a.manager.itemEnd(e)}function l(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),a.manager.itemStart(e),o.src=e,o}}]),n}(wd),Cd=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){var a=new po,i=new Md(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);var o=0;function s(n){i.load(e[n],(function(e){a.images[n]=e,6===++o&&(a.needsUpdate=!0,t&&t(a))}),void 0,r)}for(var u=0;u<e.length;++u)s(u);return a}}]),n}(wd),Id=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new Dl,o=new _d(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(a.withCredentials),o.load(e,(function(e){var n=a.parse(e);n&&(void 0!==n.image?i.image=n.image:void 0!==n.data&&(i.image.width=n.width,i.image.height=n.height,i.image.data=n.data),i.wrapS=void 0!==n.wrapS?n.wrapS:Ge,i.wrapT=void 0!==n.wrapT?n.wrapT:Ge,i.magFilter=void 0!==n.magFilter?n.magFilter:Ze,i.minFilter=void 0!==n.minFilter?n.minFilter:Ze,i.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?i.colorSpace=n.colorSpace:void 0!==n.encoding&&(i.encoding=n.encoding),void 0!==n.flipY&&(i.flipY=n.flipY),void 0!==n.format&&(i.format=n.format),void 0!==n.type&&(i.type=n.type),void 0!==n.mipmaps&&(i.mipmaps=n.mipmaps,i.minFilter=$e),1===n.mipmapCount&&(i.minFilter=Ze),void 0!==n.generateMipmaps&&(i.generateMipmaps=n.generateMipmaps),i.needsUpdate=!0,t&&t(i,n))}),n,r),i}}]),n}(wd),Ad=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){var a=new Pr,i=new Md(this.manager);return i.setCrossOrigin(this.crossOrigin),i.setPath(this.path),i.load(e,(function(e){a.image=e,a.needsUpdate=!0,void 0!==t&&t(a)}),n,r),a}}]),n}(wd),Rd=function(e){C(n,e);var t=R(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return E(this,n),(r=t.call(this)).isLight=!0,r.type="Light",r.color=new li(e),r.intensity=a,r}return M(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=D(I(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(Ha),Nd=function(e){C(n,e);var t=R(n);function n(e,r,a){var i;return E(this,n),(i=t.call(this,e,a)).isHemisphereLight=!0,i.type="HemisphereLight",i.position.copy(Ha.DEFAULT_UP),i.updateMatrix(),i.groundColor=new li(r),i}return M(n,[{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.groundColor.copy(e.groundColor),this}}]),n}(Rd),Ld=new ba,Pd=new Gr,Dd=new Gr,Fd=function(){function e(t){E(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new fr(512,512),this.map=null,this.mapPass=null,this.matrix=new ba,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ko,this._frameExtents=new fr(1,1),this._viewportCount=1,this._viewports=[new Dr(0,0,1,1)]}return M(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;Pd.setFromMatrixPosition(e.matrixWorld),t.position.copy(Pd),Dd.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Dd),t.updateMatrixWorld(),Ld.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ld),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Ld)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),Od=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this,new co(50,1,.5,500))).isSpotLightShadow=!0,e.focus=1,e}return M(n,[{key:"updateMatrices",value:function(e){var t=this.camera,r=2*nr*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&a===t.aspect&&i===t.far||(t.fov=r,t.aspect=a,t.far=i,t.updateProjectionMatrix()),D(I(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(Fd),zd=function(e){C(n,e);var t=R(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;return E(this,n),(a=t.call(this,e,r)).isSpotLight=!0,a.type="SpotLight",a.position.copy(Ha.DEFAULT_UP),a.updateMatrix(),a.target=new Ha,a.distance=i,a.angle=o,a.penumbra=s,a.decay=u,a.map=null,a.shadow=new Od,a}return M(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Rd),Ud=new ba,Bd=new Gr,Wd=new Gr,Vd=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this,new co(90,1,.5,500))).isPointLightShadow=!0,e._frameExtents=new fr(4,2),e._viewportCount=6,e._viewports=[new Dr(2,1,1,1),new Dr(0,1,1,1),new Dr(3,1,1,1),new Dr(1,1,1,1),new Dr(3,0,1,1),new Dr(1,0,1,1)],e._cubeDirections=[new Gr(1,0,0),new Gr(-1,0,0),new Gr(0,0,1),new Gr(0,0,-1),new Gr(0,1,0),new Gr(0,-1,0)],e._cubeUps=[new Gr(0,1,0),new Gr(0,1,0),new Gr(0,1,0),new Gr(0,1,0),new Gr(0,0,1),new Gr(0,0,-1)],e}return M(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,a=e.distance||n.far;a!==n.far&&(n.far=a,n.updateProjectionMatrix()),Bd.setFromMatrixPosition(e.matrixWorld),n.position.copy(Bd),Wd.copy(n.position),Wd.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Wd),n.updateMatrixWorld(),r.makeTranslation(-Bd.x,-Bd.y,-Bd.z),Ud.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ud)}}]),n}(Fd),Gd=function(e){C(n,e);var t=R(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return E(this,n),(a=t.call(this,e,r)).isPointLight=!0,a.type="PointLight",a.distance=i,a.decay=o,a.shadow=new Vd,a}return M(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(Rd),Hd=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this,new Fo(-5,5,5,-5,.5,500))).isDirectionalLightShadow=!0,e}return M(n)}(Fd),jd=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this,e,r)).isDirectionalLight=!0,a.type="DirectionalLight",a.position.copy(Ha.DEFAULT_UP),a.updateMatrix(),a.target=new Ha,a.shadow=new Hd,a}return M(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Rd),Xd=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this,e,r)).isAmbientLight=!0,a.type="AmbientLight",a}return M(n)}(Rd),qd=function(e){C(n,e);var t=R(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return E(this,n),(a=t.call(this,e,r)).isRectAreaLight=!0,a.type="RectAreaLight",a.width=i,a.height=o,a}return M(n,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(e){this.intensity=e/(this.width*this.height*Math.PI)}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=D(I(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(Rd),Kd=function(){function e(){E(this,e),this.isSphericalHarmonics3=!0,this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Gr)}return M(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.282095),t.addScaledVector(i[1],.488603*r),t.addScaledVector(i[2],.488603*a),t.addScaledVector(i[3],.488603*n),t.addScaledVector(i[4],n*r*1.092548),t.addScaledVector(i[5],r*a*1.092548),t.addScaledVector(i[6],.315392*(3*a*a-1)),t.addScaledVector(i[7],n*a*1.092548),t.addScaledVector(i[8],.546274*(n*n-r*r)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.886227),t.addScaledVector(i[1],1.023328*r),t.addScaledVector(i[2],1.023328*a),t.addScaledVector(i[3],1.023328*n),t.addScaledVector(i[4],.858086*n*r),t.addScaledVector(i[5],.858086*r*a),t.addScaledVector(i[6],.743125*a*a-.247708),t.addScaledVector(i[7],.858086*n*a),t.addScaledVector(i[8],.429043*(n*n-r*r)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,r=e.y,a=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*a,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*n*a,t[8]=.546274*(n*n-r*r)}}]),e}(),Yd=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kd,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return E(this,n),(e=t.call(this,void 0,a)).isLightProbe=!0,e.sh=r,e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.sh.copy(e.sh),this}},{key:"fromJSON",value:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}},{key:"toJSON",value:function(e){var t=D(I(n.prototype),"toJSON",this).call(this,e);return t.object.sh=this.sh.toArray(),t}}]),n}(Rd),Zd=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).textures={},r}return M(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new _d(a.manager);i.setPath(a.path),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,(function(n){try{t(a.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var a=n.createMaterialFromType(e.type);if(void 0!==e.uuid&&(a.uuid=e.uuid),void 0!==e.name&&(a.name=e.name),void 0!==e.color&&void 0!==a.color&&a.color.setHex(e.color),void 0!==e.roughness&&(a.roughness=e.roughness),void 0!==e.metalness&&(a.metalness=e.metalness),void 0!==e.sheen&&(a.sheen=e.sheen),void 0!==e.sheenColor&&(a.sheenColor=(new li).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(a.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==a.emissive&&a.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==a.specular&&a.specular.setHex(e.specular),void 0!==e.specularIntensity&&(a.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==a.specularColor&&a.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(a.shininess=e.shininess),void 0!==e.clearcoat&&(a.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(a.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(a.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(a.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(a.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(a.transmission=e.transmission),void 0!==e.thickness&&(a.thickness=e.thickness),void 0!==e.attenuationDistance&&(a.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==a.attenuationColor&&a.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(a.fog=e.fog),void 0!==e.flatShading&&(a.flatShading=e.flatShading),void 0!==e.blending&&(a.blending=e.blending),void 0!==e.combine&&(a.combine=e.combine),void 0!==e.side&&(a.side=e.side),void 0!==e.shadowSide&&(a.shadowSide=e.shadowSide),void 0!==e.opacity&&(a.opacity=e.opacity),void 0!==e.transparent&&(a.transparent=e.transparent),void 0!==e.alphaTest&&(a.alphaTest=e.alphaTest),void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(a.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(a.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(a.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(a.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(a.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(a.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(a.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(a.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(a.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(a.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(a.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(a.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(a.rotation=e.rotation),1!==e.linewidth&&(a.linewidth=e.linewidth),void 0!==e.dashSize&&(a.dashSize=e.dashSize),void 0!==e.gapSize&&(a.gapSize=e.gapSize),void 0!==e.scale&&(a.scale=e.scale),void 0!==e.polygonOffset&&(a.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(a.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(a.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(a.dithering=e.dithering),void 0!==e.alphaToCoverage&&(a.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(a.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(a.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.toneMapped&&(a.toneMapped=e.toneMapped),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?a.vertexColors=e.vertexColors>0:a.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var i in e.uniforms){var o=e.uniforms[i];switch(a.uniforms[i]={},o.type){case"t":a.uniforms[i].value=r(o.value);break;case"c":a.uniforms[i].value=(new li).setHex(o.value);break;case"v2":a.uniforms[i].value=(new fr).fromArray(o.value);break;case"v3":a.uniforms[i].value=(new Gr).fromArray(o.value);break;case"v4":a.uniforms[i].value=(new Dr).fromArray(o.value);break;case"m3":a.uniforms[i].value=(new pr).fromArray(o.value);break;case"m4":a.uniforms[i].value=(new ba).fromArray(o.value);break;default:a.uniforms[i].value=o.value}}if(void 0!==e.defines&&(a.defines=e.defines),void 0!==e.vertexShader&&(a.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(a.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(a.glslVersion=e.glslVersion),void 0!==e.extensions)for(var s in e.extensions)a.extensions[s]=e.extensions[s];if(void 0!==e.lights&&(a.lights=e.lights),void 0!==e.clipping&&(a.clipping=e.clipping),void 0!==e.size&&(a.size=e.size),void 0!==e.sizeAttenuation&&(a.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(a.map=r(e.map)),void 0!==e.matcap&&(a.matcap=r(e.matcap)),void 0!==e.alphaMap&&(a.alphaMap=r(e.alphaMap)),void 0!==e.bumpMap&&(a.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(a.bumpScale=e.bumpScale),void 0!==e.normalMap&&(a.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(a.normalMapType=e.normalMapType),void 0!==e.normalScale){var u=e.normalScale;!1===Array.isArray(u)&&(u=[u,u]),a.normalScale=(new fr).fromArray(u)}return void 0!==e.displacementMap&&(a.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(a.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(a.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(a.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(a.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(a.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(a.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(a.specularMap=r(e.specularMap)),void 0!==e.specularIntensityMap&&(a.specularIntensityMap=r(e.specularIntensityMap)),void 0!==e.specularColorMap&&(a.specularColorMap=r(e.specularColorMap)),void 0!==e.envMap&&(a.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(a.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(a.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(a.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(a.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(a.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(a.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(a.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(a.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatMap&&(a.clearcoatMap=r(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(a.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(a.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(a.clearcoatNormalScale=(new fr).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(a.iridescenceMap=r(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(a.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(a.transmissionMap=r(e.transmissionMap)),void 0!==e.thicknessMap&&(a.thicknessMap=r(e.thicknessMap)),void 0!==e.sheenColorMap&&(a.sheenColorMap=r(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(a.sheenRoughnessMap=r(e.sheenRoughnessMap)),a}},{key:"setTextures",value:function(e){return this.textures=e,this}}],[{key:"createMaterialFromType",value:function(e){return new{ShadowMaterial:Bh,SpriteMaterial:ll,RawShaderMaterial:Wh,ShaderMaterial:uo,PointsMaterial:ic,MeshPhysicalMaterial:Gh,MeshStandardMaterial:Vh,MeshPhongMaterial:Hh,MeshToonMaterial:jh,MeshNormalMaterial:Xh,MeshLambertMaterial:qh,MeshDepthMaterial:Bu,MeshDistanceMaterial:Wu,MeshBasicMaterial:hi,MeshMatcapMaterial:Kh,LineDashedMaterial:Yh,LineBasicMaterial:Kl,Material:ai}[e]}}]),n}(wd),Jd=function(){function e(){E(this,e)}return M(e,null,[{key:"decodeText",value:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(a){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}},{key:"resolveURL",value:function(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}]),e}(),Qd=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).isInstancedBufferGeometry=!0,e.type="InstancedBufferGeometry",e.instanceCount=1/0,e}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"toJSON",value:function(){var e=D(I(n.prototype),"toJSON",this).call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(Oi),$d=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new _d(a.manager);i.setPath(a.path),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,(function(n){try{t(a.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t={},n={};function r(e,r){if(void 0!==t[r])return t[r];var a=e.interleavedBuffers[r],i=function(e,t){if(void 0!==n[t])return n[t];var r=e.arrayBuffers,a=r[t],i=new Uint32Array(a).buffer;return n[t]=i,i}(e,a.buffer),o=yr(a.type,i),s=new ol(o,a.stride);return s.uuid=a.uuid,t[r]=s,s}var a=e.isInstancedBufferGeometry?new Qd:new Oi,i=e.data.index;if(void 0!==i){var o=yr(i.type,i.array);a.setIndex(new bi(o,1))}var s=e.data.attributes;for(var u in s){var l=s[u],c=void 0;if(l.isInterleavedBufferAttribute){var h=r(e.data,l.data);c=new ul(h,l.itemSize,l.offset,l.normalized)}else{var d=yr(l.type,l.array);c=new(l.isInstancedBufferAttribute?Ul:bi)(d,l.itemSize,l.normalized)}void 0!==l.name&&(c.name=l.name),void 0!==l.usage&&c.setUsage(l.usage),void 0!==l.updateRange&&(c.updateRange.offset=l.updateRange.offset,c.updateRange.count=l.updateRange.count),a.setAttribute(u,c)}var f=e.data.morphAttributes;if(f)for(var p in f){for(var v=f[p],m=[],g=0,y=v.length;g<y;g++){var b=v[g],x=void 0;if(b.isInterleavedBufferAttribute){var w=r(e.data,b.data);x=new ul(w,b.itemSize,b.offset,b.normalized)}else{var k=yr(b.type,b.array);x=new bi(k,b.itemSize,b.normalized)}void 0!==b.name&&(x.name=b.name),m.push(x)}a.morphAttributes[p]=m}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);var S=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==S)for(var _=0,E=S.length;_!==E;++_){var T=S[_];a.addGroup(T.start,T.count,T.materialIndex)}var M=e.data.boundingSphere;if(void 0!==M){var C=new Gr;void 0!==M.center&&C.fromArray(M.center),a.boundingSphere=new ca(C,M.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}]),n}(wd),ef=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){var a=this,i=""===this.path?Jd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;var o=new _d(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){var i=null;try{i=JSON.parse(n)}catch(s){return void 0!==r&&r(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}var o=i.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);a.parse(i,t)}),n,r)}},{key:"loadAsync",value:function(){var e=c(u().mark((function e(t,n){var r,a,i,o,s,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a=""===this.path?Jd.extractUrlBase(t):this.path,this.resourcePath=this.resourcePath||a,(i=new _d(this.manager)).setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),e.next=9,i.loadAsync(t,n);case 9:if(o=e.sent,s=JSON.parse(o),void 0!==(l=s.metadata)&&void 0!==l.type&&"geometry"!==l.type.toLowerCase()){e.next=14;break}throw new Error("THREE.ObjectLoader: Can't load "+t);case 14:return e.next=16,r.parseAsync(s);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"parse",value:function(e,t){var n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,(function(){void 0!==t&&t(u)})),o=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,o),u=this.parseObject(e.object,a,s,o,n),l=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,l),void 0!==t){var c=!1;for(var h in i)if(i[h].data instanceof HTMLImageElement){c=!0;break}!1===c&&t(u)}return u}},{key:"parseAsync",value:function(){var e=c(u().mark((function e(t){var n,r,a,i,o,s,l,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),a=this.parseGeometries(t.geometries,r),e.next=5,this.parseImagesAsync(t.images);case 5:return i=e.sent,o=this.parseTextures(t.textures,i),s=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,a,s,o,n),c=this.parseSkeletons(t.skeletons,l),this.bindSkeletons(l,c),e.abrupt("return",l);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseShapes",value:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var a=(new Jc).fromJSON(e[n]);t[a.uuid]=a}return t}},{key:"parseSkeletons",value:function(e,t){var n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(var a=0,i=e.length;a<i;a++){var o=(new zl).fromJSON(e[a],r);n[o.uuid]=o}return n}},{key:"parseGeometries",value:function(e,t){var n={};if(void 0!==e)for(var r=new $d,a=0,i=e.length;a<i;a++){var o=void 0,s=e[a];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;default:s.type in Uh?o=Uh[s.type].fromJSON(s,t):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(s.type,'"'))}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}return n}},{key:"parseMaterials",value:function(e,t){var n={},r={};if(void 0!==e){var a=new Zd;a.setTextures(t);for(var i=0,o=e.length;i<o;i++){var s=e[i];void 0===n[s.uuid]&&(n[s.uuid]=a.parse(s)),r[s.uuid]=n[s.uuid]}}return r}},{key:"parseAnimations",value:function(e){var t={};if(void 0!==e)for(var n=0;n<e.length;n++){var r=e[n],a=vd.parse(r);t[a.uuid]=a}return t}},{key:"parseImages",value:function(e,t){var n,r=this,a={};function i(e){if("string"===typeof e){var t=e;return function(e){return r.manager.itemStart(e),n.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:r.resourcePath+t)}return e.data?{data:yr(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){var o=new bd(t);(n=new Md(o)).setCrossOrigin(this.crossOrigin);for(var s=0,u=e.length;s<u;s++){var l=e[s],c=l.url;if(Array.isArray(c)){for(var h=[],d=0,f=c.length;d<f;d++){var p=i(c[d]);null!==p&&(p instanceof HTMLImageElement?h.push(p):h.push(new Dl(p.data,p.width,p.height)))}a[l.uuid]=new Rr(h)}else{var v=i(l.url);a[l.uuid]=new Rr(v)}}}return a}},{key:"parseImagesAsync",value:function(){var e=c(u().mark((function e(t){var n,r,a,i,o,s,l,h,d,f,p,v,m,g,y;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(){return o=c(u().mark((function e(t){var r,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=8;break}return i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r=t)?r:n.resourcePath+r,e.next=5,a.loadAsync(i);case 5:return e.abrupt("return",e.sent);case 8:if(!t.data){e.next=12;break}return e.abrupt("return",{data:yr(t.type,t.data),width:t.width,height:t.height});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)},i=function(e){return o.apply(this,arguments)},n=this,r={},!(void 0!==t&&t.length>0)){e.next=33;break}(a=new Md(this.manager)).setCrossOrigin(this.crossOrigin),s=0,l=t.length;case 8:if(!(s<l)){e.next=33;break}if(h=t[s],d=h.url,!Array.isArray(d)){e.next=26;break}f=[],p=0,v=d.length;case 14:if(!(p<v)){e.next=23;break}return m=d[p],e.next=18,i(m);case 18:null!==(g=e.sent)&&(g instanceof HTMLImageElement?f.push(g):f.push(new Dl(g.data,g.width,g.height)));case 20:p++,e.next=14;break;case 23:r[h.uuid]=new Rr(f),e.next=30;break;case 26:return e.next=28,i(h.url);case 28:y=e.sent,r[h.uuid]=new Rr(y);case 30:s++,e.next=8;break;case 33:return e.abrupt("return",r);case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseTextures",value:function(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var a=0,i=e.length;a<i;a++){var o=e[a];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var s=t[o.image],u=s.data,l=void 0;Array.isArray(u)?(l=new po,6===u.length&&(l.needsUpdate=!0)):(l=u&&u.data?new Dl:new Pr,u&&(l.needsUpdate=!0)),l.source=s,l.uuid=o.uuid,void 0!==o.name&&(l.name=o.name),void 0!==o.mapping&&(l.mapping=n(o.mapping,tf)),void 0!==o.channel&&(l.channel=o.channel),void 0!==o.offset&&l.offset.fromArray(o.offset),void 0!==o.repeat&&l.repeat.fromArray(o.repeat),void 0!==o.center&&l.center.fromArray(o.center),void 0!==o.rotation&&(l.rotation=o.rotation),void 0!==o.wrap&&(l.wrapS=n(o.wrap[0],nf),l.wrapT=n(o.wrap[1],nf)),void 0!==o.format&&(l.format=o.format),void 0!==o.internalFormat&&(l.internalFormat=o.internalFormat),void 0!==o.type&&(l.type=o.type),void 0!==o.colorSpace&&(l.colorSpace=o.colorSpace),void 0!==o.encoding&&(l.encoding=o.encoding),void 0!==o.minFilter&&(l.minFilter=n(o.minFilter,rf)),void 0!==o.magFilter&&(l.magFilter=n(o.magFilter,rf)),void 0!==o.anisotropy&&(l.anisotropy=o.anisotropy),void 0!==o.flipY&&(l.flipY=o.flipY),void 0!==o.generateMipmaps&&(l.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(l.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(l.unpackAlignment=o.unpackAlignment),void 0!==o.userData&&(l.userData=o.userData),r[o.uuid]=l}return r}},{key:"parseObject",value:function(e,t,n,r,a){var i,o,s;function u(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,a=e.length;r<a;r++){var i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function c(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":i=new il,void 0!==e.background&&(Number.isInteger(e.background)?i.background=new li(e.background):i.background=c(e.background)),void 0!==e.environment&&(i.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new al(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new rl(e.fog.color,e.fog.density))),void 0!==e.backgroundBlurriness&&(i.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(i.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":i=new co(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Fo(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new Xd(e.color,e.intensity);break;case"DirectionalLight":i=new jd(e.color,e.intensity);break;case"PointLight":i=new Gd(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new qd(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new zd(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new Nd(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new Yd).fromJSON(e);break;case"SkinnedMesh":o=u(e.geometry),s=l(e.material),i=new Ll(o,s),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":o=u(e.geometry),s=l(e.material),i=new to(o,s);break;case"InstancedMesh":o=u(e.geometry),s=l(e.material);var h=e.count,d=e.instanceMatrix,f=e.instanceColor;(i=new ql(o,s,h)).instanceMatrix=new Ul(new Float32Array(d.array),16),void 0!==f&&(i.instanceColor=new Ul(new Float32Array(f.array),f.itemSize));break;case"LOD":i=new Tl;break;case"Line":i=new ec(u(e.geometry),l(e.material));break;case"LineLoop":i=new ac(u(e.geometry),l(e.material));break;case"LineSegments":i=new rc(u(e.geometry),l(e.material));break;case"PointCloud":case"Points":i=new cc(u(e.geometry),l(e.material));break;case"Sprite":i=new kl(l(e.material));break;case"Group":i=new qu;break;case"Bone":i=new Pl;break;default:i=new Ha}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.up&&i.up.fromArray(e.up),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children)for(var p=e.children,v=0;v<p.length;v++)i.add(this.parseObject(p[v],t,n,r,a));if(void 0!==e.animations)for(var m=e.animations,g=0;g<m.length;g++){var y=m[g];i.animations.push(a[y])}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);for(var b=e.levels,x=0;x<b.length;x++){var w=b[x],k=i.getObjectByProperty("uuid",w.object);void 0!==k&&i.addLevel(k,w.distance,w.hysteresis)}}return i}},{key:"bindSkeletons",value:function(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){var n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}}]),n}(wd),tf={UVMapping:Fe,CubeReflectionMapping:Oe,CubeRefractionMapping:ze,EquirectangularReflectionMapping:Ue,EquirectangularRefractionMapping:Be,CubeUVReflectionMapping:We},nf={RepeatWrapping:Ve,ClampToEdgeWrapping:Ge,MirroredRepeatWrapping:He},rf={NearestFilter:je,NearestMipmapNearestFilter:Xe,NearestMipmapLinearFilter:Ke,LinearFilter:Ze,LinearMipmapNearestFilter:Je,LinearMipmapLinearFilter:$e},af=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),r.options={premultiplyAlpha:"none"},r}return M(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,i=yd.get(e);if(void 0!==i)return a.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(a.options,{colorSpaceConversion:"none"}))})).then((function(n){yd.add(e,n),t&&t(n),a.manager.itemEnd(e)})).catch((function(t){r&&r(t),a.manager.itemError(e),a.manager.itemEnd(e)})),a.manager.itemStart(e)}}]),n}(wd),of=function(){function e(){E(this,e)}return M(e,null,[{key:"getContext",value:function(){return void 0===gd&&(gd=new(window.AudioContext||window.webkitAudioContext)),gd}},{key:"setContext",value:function(e){gd=e}}]),e}(),sf=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new _d(this.manager);function o(t){r?r(t):console.error(t),a.manager.itemError(e)}i.setResponseType("arraybuffer"),i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(e){try{var n=e.slice(0);of.getContext().decodeAudioData(n,(function(e){t(e)}),o)}catch(r){o(r)}}),n,r)}}]),n}(wd),uf=function(e){C(n,e);var t=R(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;E(this,n),(a=t.call(this,void 0,i)).isHemisphereLightProbe=!0;var o=(new li).set(e),s=(new li).set(r),u=new Gr(o.r,o.g,o.b),l=new Gr(s.r,s.g,s.b),c=Math.sqrt(Math.PI),h=c*Math.sqrt(.75);return a.sh.coefficients[0].copy(u).add(l).multiplyScalar(c),a.sh.coefficients[1].copy(u).sub(l).multiplyScalar(h),a}return M(n)}(Yd),lf=function(e){C(n,e);var t=R(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;E(this,n),(r=t.call(this,void 0,a)).isAmbientLightProbe=!0;var i=(new li).set(e);return r.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI)),r}return M(n)}(Yd),cf=new ba,hf=new ba,df=new ba,ff=function(){function e(){E(this,e),this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new co,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new co,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}return M(e,[{key:"update",value:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,df.copy(e.projectionMatrix);var n,r,a=t.eyeSep/2,i=a*t.near/t.focus,o=t.near*Math.tan(tr*t.fov*.5)/t.zoom;hf.elements[12]=-a,cf.elements[12]=a,n=-o*t.aspect+i,r=o*t.aspect+i,df.elements[0]=2*t.near/(r-n),df.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(df),n=-o*t.aspect-i,r=o*t.aspect-i,df.elements[0]=2*t.near/(r-n),df.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(df)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(hf),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(cf)}}]),e}(),pf=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];E(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return M(e,[{key:"start",value:function(){this.startTime=vf(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=vf();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function vf(){return("undefined"===typeof performance?Date:performance).now()}var mf=new Gr,gf=new Vr,yf=new Gr,bf=new Gr,xf=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).type="AudioListener",e.context=of.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new pf,e}return M(n,[{key:"getInput",value:function(){return this.gain}},{key:"removeFilter",value:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}},{key:"getFilter",value:function(){return this.filter}},{key:"setFilter",value:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}},{key:"getMasterVolume",value:function(){return this.gain.gain.value}},{key:"setMasterVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},{key:"updateMatrixWorld",value:function(e){D(I(n.prototype),"updateMatrixWorld",this).call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(mf,gf,yf),bf.set(0,0,-1).applyQuaternion(gf),t.positionX){var a=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(mf.x,a),t.positionY.linearRampToValueAtTime(mf.y,a),t.positionZ.linearRampToValueAtTime(mf.z,a),t.forwardX.linearRampToValueAtTime(bf.x,a),t.forwardY.linearRampToValueAtTime(bf.y,a),t.forwardZ.linearRampToValueAtTime(bf.z,a),t.upX.linearRampToValueAtTime(r.x,a),t.upY.linearRampToValueAtTime(r.y,a),t.upZ.linearRampToValueAtTime(r.z,a)}else t.setPosition(mf.x,mf.y,mf.z),t.setOrientation(bf.x,bf.y,bf.z,r.x,r.y,r.z)}}]),n}(Ha),wf=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).type="Audio",r.listener=e,r.context=e.context,r.gain=r.context.createGain(),r.gain.connect(e.getInput()),r.autoplay=!1,r.buffer=null,r.detune=0,r.loop=!1,r.loopStart=0,r.loopEnd=0,r.offset=0,r.duration=void 0,r.playbackRate=1,r.isPlaying=!1,r.hasPlaybackControl=!0,r.source=null,r.sourceType="empty",r._startedAt=0,r._progress=0,r._connected=!1,r.filters=[],r}return M(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(Ha),kf=new Gr,Sf=new Vr,_f=new Gr,Ef=new Gr,Tf=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).panner=r.context.createPanner(),r.panner.panningModel="HRTF",r.panner.connect(r.gain),r}return M(n,[{key:"disconnect",value:function(){D(I(n.prototype),"disconnect",this).call(this),this.panner.disconnect(this.gain)}},{key:"getOutput",value:function(){return this.panner}},{key:"getRefDistance",value:function(){return this.panner.refDistance}},{key:"setRefDistance",value:function(e){return this.panner.refDistance=e,this}},{key:"getRolloffFactor",value:function(){return this.panner.rolloffFactor}},{key:"setRolloffFactor",value:function(e){return this.panner.rolloffFactor=e,this}},{key:"getDistanceModel",value:function(){return this.panner.distanceModel}},{key:"setDistanceModel",value:function(e){return this.panner.distanceModel=e,this}},{key:"getMaxDistance",value:function(){return this.panner.maxDistance}},{key:"setMaxDistance",value:function(e){return this.panner.maxDistance=e,this}},{key:"setDirectionalCone",value:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}},{key:"updateMatrixWorld",value:function(e){if(D(I(n.prototype),"updateMatrixWorld",this).call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(kf,Sf,_f),Ef.set(0,0,1).applyQuaternion(Sf);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(kf.x,r),t.positionY.linearRampToValueAtTime(kf.y,r),t.positionZ.linearRampToValueAtTime(kf.z,r),t.orientationX.linearRampToValueAtTime(Ef.x,r),t.orientationY.linearRampToValueAtTime(Ef.y,r),t.orientationZ.linearRampToValueAtTime(Ef.z,r)}else t.setPosition(kf.x,kf.y,kf.z),t.setOrientation(Ef.x,Ef.y,Ef.z)}}}]),n}(wf),Mf=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;E(this,e),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}return M(e,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}]),e}(),Cf=function(){function e(t,n,r){var a,i,o;switch(E(this,e),this.binding=t,this.valueSize=r,n){case"quaternion":a=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":a=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:a=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return M(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,r=this.valueSize,a=e*r+r,i=this.cumulativeWeight;if(0===i){for(var o=0;o!==r;++o)n[a+o]=n[o];i=t}else{var s=t/(i+=t);this._mixBufferRegion(n,a,0,s,r)}this.cumulativeWeight=i}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,a=this.cumulativeWeight,i=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){var s=t*this._origIndex;this._mixBufferRegion(n,r,s,1-a,t)}i>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(var u=t,l=t+t;u!==l;++u)if(n[u]!==n[u+t]){o.setValue(n,r);break}}},{key:"saveOriginalState",value:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(var a=n,i=r;a!==i;++a)t[a]=t[r+a%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,r,a){if(r>=.5)for(var i=0;i!==a;++i)e[t+i]=e[n+i]}},{key:"_slerp",value:function(e,t,n,r){Vr.slerpFlat(e,t,e,t,e,n,r)}},{key:"_slerpAdditive",value:function(e,t,n,r,a){var i=this._workIndex*a;Vr.multiplyQuaternionsFlat(e,i,e,t,e,n),Vr.slerpFlat(e,t,e,t,e,i,r)}},{key:"_lerp",value:function(e,t,n,r,a){for(var i=1-r,o=0;o!==a;++o){var s=t+o;e[s]=e[s]*i+e[n+o]*r}}},{key:"_lerpAdditive",value:function(e,t,n,r,a){for(var i=0;i!==a;++i){var o=t+i;e[o]=e[o]+e[n+i]*r}}}]),e}(),If="\\[\\]\\.:\\/",Af=new RegExp("["+If+"]","g"),Rf="[^"+If+"]",Nf="[^"+If.replace("\\.","")+"]",Lf=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Rf)+/(WCOD+)?/.source.replace("WCOD",Nf)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Rf)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Rf)+"$"),Pf=["material","materials","bones","map"],Df=function(){function e(t,n,r){E(this,e);var a=r||Ff.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,a)}return M(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,a=n.length;r!==a;++r)n[r].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),Ff=function(){function e(t,n,r){E(this,e),this.path=n,this.parsedPath=r||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return M(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)e[t++]=n[r]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,r=n.objectName,a=n.propertyName,i=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=n.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var u=t[a];if(void 0!==u){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===a){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}c=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=i}else void 0!==u.fromArray&&void 0!==u.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(c=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=a;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+a+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,r){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,r):new e(t,n,r)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(Af,"")}},{key:"parseTrackName",value:function(e){var t=Lf.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var a=n.nodeName.substring(r+1);-1!==Pf.indexOf(a)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=a)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var a=n[r];if(a.name===t||a.uuid===t)return a;var i=e(a.children);if(i)return i}return null}(e.children);if(r)return r}return null}}]),e}();Ff.Composite=Df,Ff.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ff.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ff.prototype.GetterByBindingType=[Ff.prototype._getValue_direct,Ff.prototype._getValue_array,Ff.prototype._getValue_arrayElement,Ff.prototype._getValue_toArray],Ff.prototype.SetterByBindingTypeAndVersioning=[[Ff.prototype._setValue_direct,Ff.prototype._setValue_direct_setNeedsUpdate,Ff.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ff.prototype._setValue_array,Ff.prototype._setValue_array_setNeedsUpdate,Ff.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ff.prototype._setValue_arrayElement,Ff.prototype._setValue_arrayElement_setNeedsUpdate,Ff.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ff.prototype._setValue_fromArray,Ff.prototype._setValue_fromArray_setNeedsUpdate,Ff.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Of=function(){function e(){E(this,e),this.isAnimationObjectGroup=!0,this.uuid=rr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var n=0,r=arguments.length;n!==r;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}}return M(e,[{key:"add",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,a=this._bindings,i=a.length,o=void 0,s=e.length,u=this.nCachedObjects_,l=0,c=arguments.length;l!==c;++l){var h=arguments[l],d=h.uuid,f=t[d];if(void 0===f){f=s++,t[d]=f,e.push(h);for(var p=0,v=i;p!==v;++p)a[p].push(new Ff(h,n[p],r[p]))}else if(f<u){o=e[f];var m=--u,g=e[m];t[g.uuid]=f,e[f]=g,t[d]=m,e[m]=h;for(var y=0,b=i;y!==b;++y){var x=a[y],w=x[m],k=x[f];x[f]=w,void 0===k&&(k=new Ff(h,n[y],r[y])),x[m]=k}}else e[f]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}},{key:"remove",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,a=this.nCachedObjects_,i=0,o=arguments.length;i!==o;++i){var s=arguments[i],u=s.uuid,l=t[u];if(void 0!==l&&l>=a){var c=a++,h=e[c];t[h.uuid]=l,e[l]=h,t[u]=c,e[c]=s;for(var d=0,f=r;d!==f;++d){var p=n[d],v=p[c],m=p[l];p[l]=v,p[c]=m}}}this.nCachedObjects_=a}},{key:"uncache",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,a=this.nCachedObjects_,i=e.length,o=0,s=arguments.length;o!==s;++o){var u=arguments[o].uuid,l=t[u];if(void 0!==l)if(delete t[u],l<a){var c=--a,h=e[c],d=--i,f=e[d];t[h.uuid]=l,e[l]=h,t[f.uuid]=c,e[c]=f,e.pop();for(var p=0,v=r;p!==v;++p){var m=n[p],g=m[c],y=m[d];m[l]=g,m[c]=y,m.pop()}}else{var b=--i,x=e[b];b>0&&(t[x.uuid]=l),e[l]=x,e.pop();for(var w=0,k=r;w!==k;++w){var S=n[w];S[l]=S[b],S.pop()}}}this.nCachedObjects_=a}},{key:"subscribe_",value:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],a=this._bindings;if(void 0!==r)return a[r];var i=this._paths,o=this._parsedPaths,s=this._objects,u=s.length,l=this.nCachedObjects_,c=new Array(u);r=a.length,n[e]=r,i.push(e),o.push(t),a.push(c);for(var h=l,d=s.length;h!==d;++h){var f=s[h];c[h]=new Ff(f,e,t)}return c}},{key:"unsubscribe_",value:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,a=this._parsedPaths,i=this._bindings,o=i.length-1,s=i[o];t[e[o]]=n,i[n]=s,i.pop(),a[n]=a[o],a.pop(),r[n]=r[o],r.pop()}}}]),e}(),zf=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;E(this,e),this._mixer=t,this._clip=n,this._localRoot=r,this.blendMode=a;for(var i=n.tracks,o=i.length,s=new Array(o),u={endingStart:on,endingEnd:on},l=0;l!==o;++l){var c=i[l].createInterpolant(null);s[l]=c,c.settings=u}this._interpolantSettings=u,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=en,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return M(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,a=e._clip.duration,i=a/r,o=r/a;e.warp(1,i,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var r=this._mixer,a=r.time,i=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=a,s[1]=a+n,u[0]=e/i,u[1]=t/i,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,r){if(this.enabled){var a=this._startTime;if(null!==a){var i=(e-a)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var u=this._interpolants,l=this._propertyBindings;if(this.blendMode===cn)for(var c=0,h=u.length;c!==h;++c)u[c].evaluate(o),l[c].accumulateAdditive(s);else for(var d=0,f=u.length;d!==f;++d)u[d].evaluate(o),l[d].accumulate(r,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,r=this.time+e,a=this._loopCount,i=n===tn;if(0===e)return-1===a?r:i&&1===(1&a)?t-r:r;if(n===$t){-1===a&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===a&&(e>=0?(a=0,this._setEndings(!0,0===this.repetitions,i)):this._setEndings(0===this.repetitions,!0,i)),r>=t||r<0){var o=Math.floor(r/t);r-=t*o,a+=Math.abs(o);var s=this.repetitions-a;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var u=e<0;this._setEndings(u,!u,i)}else this._setEndings(!1,!1,i);this._loopCount=a,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(i&&1===(1&a))return t-r}return r}},{key:"_setEndings",value:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=sn,r.endingEnd=sn):(r.endingStart=e?this.zeroSlopeAtStart?sn:on:un,r.endingEnd=t?this.zeroSlopeAtEnd?sn:on:un)}},{key:"_scheduleFading",value:function(e,t,n){var r=this._mixer,a=r.time,i=this._weightInterpolant;null===i&&(i=r._lendControlInterpolant(),this._weightInterpolant=i);var o=i.parameterPositions,s=i.sampleValues;return o[0]=a,s[0]=t,o[1]=a+e,s[1]=n,this}}]),e}(),Uf=new Float32Array(1),Bf=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this))._root=e,r._initMemoryManager(),r._accuIndex=0,r.time=0,r.timeScale=1,r}return M(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,a=r.length,i=e._propertyBindings,o=e._interpolants,s=n.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(l={},u[s]=l);for(var c=0;c!==a;++c){var h=r[c],d=h.name,f=l[d];if(void 0!==f)++f.referenceCount,i[c]=f;else{if(void 0!==(f=i[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(f=new Cf(Ff.create(n,d,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),i[c]=f}o[c].resultBuffer=f.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var a=e._propertyBindings,i=0,o=a.length;i!==o;++i){var s=a[i];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var a=t[n];0===--a.useCount&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var r=this._actions,a=this._actionsByClip,i=a[t];if(void 0===i)i={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=i;else{var o=i.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),i.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var a=e._clip.uuid,i=this._actionsByClip,o=i[a],s=o.knownActions,u=s[s.length-1],l=e._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete i[a],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var a=t[n];0===--a.referenceCount&&this._removeInactiveBinding(a)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_addInactiveBinding",value:function(e,t,n){var r=this._bindingsByRootAndName,a=this._bindings,i=r[t];void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=a.length,a.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,a=n.path,i=this._bindingsByRootAndName,o=i[r],s=t[t.length-1],u=e._cacheIndex;s._cacheIndex=u,t[u]=s,t.pop(),delete o[a],0===Object.keys(o).length&&delete i[r]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new id(new Float32Array(2),new Float32Array(2),1,Uf)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,a=t[r];e.__cacheIndex=r,t[r]=e,a.__cacheIndex=n,t[n]=a}},{key:"clipAction",value:function(e,t,n){var r=t||this._root,a=r.uuid,i="string"===typeof e?vd.findByName(r,e):e,o=null!==i?i.uuid:e,s=this._actionsByClip[o],u=null;if(void 0===n&&(n=null!==i?i.blendMode:ln),void 0!==s){var l=s.actionByRoot[a];if(void 0!==l&&l.blendMode===n)return l;u=s.knownActions[0],null===i&&(i=u._clip)}if(null===i)return null;var c=new zf(this,i,t,n);return this._bindAction(c,u),this._addInactiveAction(c,o,a),c}},{key:"existingAction",value:function(e,t){var n=t||this._root,r=n.uuid,a="string"===typeof e?vd.findByName(n,e):e,i=a?a.uuid:e,o=this._actionsByClip[i];return void 0!==o&&o.actionByRoot[r]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,a=Math.sign(e),i=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(r,e,a,i)}for(var s=this._bindings,u=this._nActiveBindings,l=0;l!==u;++l)s[l].apply(i);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,a=r[n];if(void 0!==a){for(var i=a.knownActions,o=0,s=i.length;o!==s;++o){var u=i[o];this._deactivateAction(u);var l=u._cacheIndex,c=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,c._cacheIndex=l,t[l]=c,t.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var a=n[r].actionByRoot[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var i=this._bindingsByRootAndName[t];if(void 0!==i)for(var o in i){var s=i[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n}(Qn),Wf=function(){function e(t){E(this,e),this.value=t}return M(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}]),e}(),Vf=0,Gf=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).isUniformsGroup=!0,Object.defineProperty(A(e),"id",{value:Vf++}),e.name="",e.usage=Bn,e.uniforms=[],e}return M(n,[{key:"add",value:function(e){return this.uniforms.push(e),this}},{key:"remove",value:function(e){var t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}},{key:"setName",value:function(e){return this.name=e,this}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"dispose",value:function(){return this.dispatchEvent({type:"dispose"}),this}},{key:"copy",value:function(e){this.name=e.name,this.usage=e.usage;var t=e.uniforms;this.uniforms.length=0;for(var n=0,r=t.length;n<r;n++)this.uniforms.push(t[n].clone());return this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(Qn),Hf=function(e){C(n,e);var t=R(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return E(this,n),(a=t.call(this,e,r)).isInstancedInterleavedBuffer=!0,a.meshPerAttribute=i,a}return M(n,[{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"clone",value:function(e){var t=D(I(n.prototype),"clone",this).call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t}},{key:"toJSON",value:function(e){var t=D(I(n.prototype),"toJSON",this).call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}]),n}(ol),jf=function(){function e(t,n,r,a,i){E(this,e),this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=n,this.itemSize=r,this.elementSize=a,this.count=i,this.version=0}return M(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setBuffer",value:function(e){return this.buffer=e,this}},{key:"setType",value:function(e,t){return this.type=e,this.elementSize=t,this}},{key:"setItemSize",value:function(e){return this.itemSize=e,this}},{key:"setCount",value:function(e){return this.count=e,this}}]),e}(),Xf=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;E(this,e),this.ray=new ya(t,n),this.near=r,this.far=a,this.camera=null,this.layers=new Aa,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return M(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Kf(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(qf),t}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=0,a=e.length;r<a;r++)Kf(e[r],this,n,t);return n.sort(qf),n}}]),e}();function qf(e,t){return e.distance-t.distance}function Kf(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r)for(var a=e.children,i=0,o=a.length;i<o;i++)Kf(a[i],t,n,!0)}var Yf=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return E(this,e),this.radius=t,this.phi=n,this.theta=r,this}return M(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ar(t/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Zf=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return E(this,e),this.radius=t,this.theta=n,this.y=r,this}return M(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Jf=new fr,Qf=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fr(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fr(-1/0,-1/0);E(this,e),this.isBox2=!0,this.min=t,this.max=n}return M(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Jf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return this.clampPoint(e,Jf).distanceTo(e)}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),$f=new Gr,ep=new Gr,tp=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr;E(this,e),this.start=t,this.end=n}return M(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){$f.subVectors(e,this.start),ep.subVectors(this.end,this.start);var n=ep.dot(ep),r=ep.dot($f)/n;return t&&(r=ar(r,0,1)),r}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),np=new Gr,rp=function(e){C(n,e);var t=R(n);function n(e,r){var a;E(this,n),(a=t.call(this)).light=e,a.matrix=e.matrixWorld,a.matrixAutoUpdate=!1,a.color=r,a.type="SpotLightHelper";for(var i=new Oi,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],s=0,u=1;s<32;s++,u++){var l=s/32*Math.PI*2,c=u/32*Math.PI*2;o.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Ci(o,3));var h=new Kl({fog:!1,toneMapped:!1});return a.cone=new rc(i,h),a.add(a.cone),a.update(),a}return M(n,[{key:"dispose",value:function(){this.cone.geometry.dispose(),this.cone.material.dispose()}},{key:"update",value:function(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),np.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(np),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}]),n}(Ha),ap=new Gr,ip=new ba,op=new ba,sp=function(e){C(n,e);var t=R(n);function n(e){var r;E(this,n);for(var a=up(e),i=new Oi,o=[],s=[],u=new li(0,0,1),l=new li(0,1,0),c=0;c<a.length;c++){var h=a[c];h.parent&&h.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(u.r,u.g,u.b),s.push(l.r,l.g,l.b))}i.setAttribute("position",new Ci(o,3)),i.setAttribute("color",new Ci(s,3));var d=new Kl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(r=t.call(this,i,d)).isSkeletonHelper=!0,r.type="SkeletonHelper",r.root=e,r.bones=a,r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r}return M(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,r=this.geometry,a=r.getAttribute("position");op.copy(this.root.matrixWorld).invert();for(var i=0,o=0;i<t.length;i++){var s=t[i];s.parent&&s.parent.isBone&&(ip.multiplyMatrices(op,s.matrixWorld),ap.setFromMatrixPosition(ip),a.setXYZ(o,ap.x,ap.y,ap.z),ip.multiplyMatrices(op,s.parent.matrixWorld),ap.setFromMatrixPosition(ip),a.setXYZ(o+1,ap.x,ap.y,ap.z),o+=2)}r.getAttribute("position").needsUpdate=!0,D(I(n.prototype),"updateMatrixWorld",this).call(this,e)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(rc);function up(e){var t=[];!0===e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,up(e.children[n]));return t}var lp=function(e){C(n,e);var t=R(n);function n(e,r,a){var i;E(this,n);var o=new Nh(r,4,2),s=new hi({wireframe:!0,fog:!1,toneMapped:!1});return(i=t.call(this,o,s)).light=e,i.color=a,i.type="PointLightHelper",i.matrix=i.light.matrixWorld,i.matrixAutoUpdate=!1,i.update(),i}return M(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"update",value:function(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}]),n}(to),cp=new Gr,hp=new li,dp=new li,fp=function(e){C(n,e);var t=R(n);function n(e,r,a){var i;E(this,n),(i=t.call(this)).light=e,i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=a,i.type="HemisphereLightHelper";var o=new Ih(r);o.rotateY(.5*Math.PI),i.material=new hi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===i.color&&(i.material.vertexColors=!0);var s=o.getAttribute("position"),u=new Float32Array(3*s.count);return o.setAttribute("color",new bi(u,3)),i.add(new to(o,i.material)),i.update(),i}return M(n,[{key:"dispose",value:function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}},{key:"update",value:function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");hp.copy(this.light.color),dp.copy(this.light.groundColor);for(var n=0,r=t.count;n<r;n++){var a=n<r/2?hp:dp;t.setXYZ(n,a.r,a.g,a.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(cp.setFromMatrixPosition(this.light.matrixWorld).negate())}}]),n}(Ha),pp=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;E(this,n),i=new li(i),o=new li(o);for(var s=a/2,u=r/a,l=r/2,c=[],h=[],d=0,f=0,p=-l;d<=a;d++,p+=u){c.push(-l,0,p,l,0,p),c.push(p,0,-l,p,0,l);var v=d===s?i:o;v.toArray(h,f),f+=3,v.toArray(h,f),f+=3,v.toArray(h,f),f+=3,v.toArray(h,f),f+=3}var m=new Oi;m.setAttribute("position",new Ci(c,3)),m.setAttribute("color",new Ci(h,3));var g=new Kl({vertexColors:!0,toneMapped:!1});return(e=t.call(this,m,g)).type="GridHelper",e}return M(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(rc),vp=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;E(this,n),s=new li(s),u=new li(u);var l=[],c=[];if(a>1)for(var h=0;h<a;h++){var d=h/a*(2*Math.PI),f=Math.sin(d)*r,p=Math.cos(d)*r;l.push(0,0,0),l.push(f,0,p);var v=1&h?s:u;c.push(v.r,v.g,v.b),c.push(v.r,v.g,v.b)}for(var m=0;m<i;m++)for(var g=1&m?s:u,y=r-r/i*m,b=0;b<o;b++){var x=b/o*(2*Math.PI),w=Math.sin(x)*y,k=Math.cos(x)*y;l.push(w,0,k),c.push(g.r,g.g,g.b),x=(b+1)/o*(2*Math.PI),w=Math.sin(x)*y,k=Math.cos(x)*y,l.push(w,0,k),c.push(g.r,g.g,g.b)}var S=new Oi;S.setAttribute("position",new Ci(l,3)),S.setAttribute("color",new Ci(c,3));var _=new Kl({vertexColors:!0,toneMapped:!1});return(e=t.call(this,S,_)).type="PolarGridHelper",e}return M(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(rc),mp=new Gr,gp=new Gr,yp=new Gr,bp=function(e){C(n,e);var t=R(n);function n(e,r,a){var i;E(this,n),(i=t.call(this)).light=e,i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=a,i.type="DirectionalLightHelper",void 0===r&&(r=1);var o=new Oi;o.setAttribute("position",new Ci([-r,r,0,r,r,0,r,-r,0,-r,-r,0,-r,r,0],3));var s=new Kl({fog:!1,toneMapped:!1});return i.lightPlane=new ec(o,s),i.add(i.lightPlane),(o=new Oi).setAttribute("position",new Ci([0,0,0,0,0,1],3)),i.targetLine=new ec(o,s),i.add(i.targetLine),i.update(),i}return M(n,[{key:"dispose",value:function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}},{key:"update",value:function(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),mp.setFromMatrixPosition(this.light.matrixWorld),gp.setFromMatrixPosition(this.light.target.matrixWorld),yp.subVectors(gp,mp),this.lightPlane.lookAt(gp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(gp),this.targetLine.scale.z=yp.length()}}]),n}(Ha),xp=new Gr,wp=new lo,kp=function(e){C(n,e);var t=R(n);function n(e){var r;E(this,n);var a=new Oi,i=new Kl({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],s=[],u={};function l(e,t){c(e),c(t)}function c(e){o.push(0,0,0),s.push(0,0,0),void 0===u[e]&&(u[e]=[]),u[e].push(o.length/3-1)}l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4"),a.setAttribute("position",new Ci(o,3)),a.setAttribute("color",new Ci(s,3)),(r=t.call(this,a,i)).type="CameraHelper",r.camera=e,r.camera.updateProjectionMatrix&&r.camera.updateProjectionMatrix(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.pointMap=u,r.update();var h=new li(16755200),d=new li(16711680),f=new li(43775),p=new li(16777215),v=new li(3355443);return r.setColors(h,d,f,p,v),r}return M(n,[{key:"setColors",value:function(e,t,n,r,a){var i=this.geometry.getAttribute("color");i.setXYZ(0,e.r,e.g,e.b),i.setXYZ(1,e.r,e.g,e.b),i.setXYZ(2,e.r,e.g,e.b),i.setXYZ(3,e.r,e.g,e.b),i.setXYZ(4,e.r,e.g,e.b),i.setXYZ(5,e.r,e.g,e.b),i.setXYZ(6,e.r,e.g,e.b),i.setXYZ(7,e.r,e.g,e.b),i.setXYZ(8,e.r,e.g,e.b),i.setXYZ(9,e.r,e.g,e.b),i.setXYZ(10,e.r,e.g,e.b),i.setXYZ(11,e.r,e.g,e.b),i.setXYZ(12,e.r,e.g,e.b),i.setXYZ(13,e.r,e.g,e.b),i.setXYZ(14,e.r,e.g,e.b),i.setXYZ(15,e.r,e.g,e.b),i.setXYZ(16,e.r,e.g,e.b),i.setXYZ(17,e.r,e.g,e.b),i.setXYZ(18,e.r,e.g,e.b),i.setXYZ(19,e.r,e.g,e.b),i.setXYZ(20,e.r,e.g,e.b),i.setXYZ(21,e.r,e.g,e.b),i.setXYZ(22,e.r,e.g,e.b),i.setXYZ(23,e.r,e.g,e.b),i.setXYZ(24,t.r,t.g,t.b),i.setXYZ(25,t.r,t.g,t.b),i.setXYZ(26,t.r,t.g,t.b),i.setXYZ(27,t.r,t.g,t.b),i.setXYZ(28,t.r,t.g,t.b),i.setXYZ(29,t.r,t.g,t.b),i.setXYZ(30,t.r,t.g,t.b),i.setXYZ(31,t.r,t.g,t.b),i.setXYZ(32,n.r,n.g,n.b),i.setXYZ(33,n.r,n.g,n.b),i.setXYZ(34,n.r,n.g,n.b),i.setXYZ(35,n.r,n.g,n.b),i.setXYZ(36,n.r,n.g,n.b),i.setXYZ(37,n.r,n.g,n.b),i.setXYZ(38,r.r,r.g,r.b),i.setXYZ(39,r.r,r.g,r.b),i.setXYZ(40,a.r,a.g,a.b),i.setXYZ(41,a.r,a.g,a.b),i.setXYZ(42,a.r,a.g,a.b),i.setXYZ(43,a.r,a.g,a.b),i.setXYZ(44,a.r,a.g,a.b),i.setXYZ(45,a.r,a.g,a.b),i.setXYZ(46,a.r,a.g,a.b),i.setXYZ(47,a.r,a.g,a.b),i.setXYZ(48,a.r,a.g,a.b),i.setXYZ(49,a.r,a.g,a.b),i.needsUpdate=!0}},{key:"update",value:function(){var e=this.geometry,t=this.pointMap;wp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Sp("c",t,e,wp,0,0,-1),Sp("t",t,e,wp,0,0,1),Sp("n1",t,e,wp,-1,-1,-1),Sp("n2",t,e,wp,1,-1,-1),Sp("n3",t,e,wp,-1,1,-1),Sp("n4",t,e,wp,1,1,-1),Sp("f1",t,e,wp,-1,-1,1),Sp("f2",t,e,wp,1,-1,1),Sp("f3",t,e,wp,-1,1,1),Sp("f4",t,e,wp,1,1,1),Sp("u1",t,e,wp,.7,1.1,-1),Sp("u2",t,e,wp,-.7,1.1,-1),Sp("u3",t,e,wp,0,2,-1),Sp("cf1",t,e,wp,-1,0,1),Sp("cf2",t,e,wp,1,0,1),Sp("cf3",t,e,wp,0,-1,1),Sp("cf4",t,e,wp,0,1,1),Sp("cn1",t,e,wp,-1,0,-1),Sp("cn2",t,e,wp,1,0,-1),Sp("cn3",t,e,wp,0,-1,-1),Sp("cn4",t,e,wp,0,1,-1),e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(rc);function Sp(e,t,n,r,a,i,o){xp.set(a,i,o).unproject(r);var s=t[e];if(void 0!==s)for(var u=n.getAttribute("position"),l=0,c=s.length;l<c;l++)u.setXYZ(s[l],xp.x,xp.y,xp.z)}var _p,Ep,Tp=new Xr,Mp=function(e){C(n,e);var t=R(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;E(this,n);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),s=new Oi;return s.setIndex(new bi(i,1)),s.setAttribute("position",new bi(o,3)),(r=t.call(this,s,new Kl({color:a,toneMapped:!1}))).object=e,r.type="BoxHelper",r.matrixAutoUpdate=!1,r.update(),r}return M(n,[{key:"update",value:function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Tp.setFromObject(this.object),!Tp.isEmpty()){var t=Tp.min,n=Tp.max,r=this.geometry.attributes.position,a=r.array;a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=t.x,a[4]=n.y,a[5]=n.z,a[6]=t.x,a[7]=t.y,a[8]=n.z,a[9]=n.x,a[10]=t.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=t.z,a[15]=t.x,a[16]=n.y,a[17]=t.z,a[18]=t.x,a[19]=t.y,a[20]=t.z,a[21]=n.x,a[22]=t.y,a[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}},{key:"setFromObject",value:function(e){return this.object=e,this.update(),this}},{key:"copy",value:function(e,t){return D(I(n.prototype),"copy",this).call(this,e,t),this.object=e.object,this}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(rc),Cp=function(e){C(n,e);var t=R(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;E(this,n);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Oi;return o.setIndex(new bi(i,1)),o.setAttribute("position",new Ci([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(r=t.call(this,o,new Kl({color:a,toneMapped:!1}))).box=e,r.type="Box3Helper",r.geometry.computeBoundingSphere(),r}return M(n,[{key:"updateMatrixWorld",value:function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),D(I(n.prototype),"updateMatrixWorld",this).call(this,e))}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(rc),Ip=function(e){C(n,e);var t=R(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960;E(this,n);var o=i,s=new Oi;s.setAttribute("position",new Ci([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),s.computeBoundingSphere(),(r=t.call(this,s,new Kl({color:o,toneMapped:!1}))).type="PlaneHelper",r.plane=e,r.size=a;var u=new Oi;return u.setAttribute("position",new Ci([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),u.computeBoundingSphere(),r.add(new to(u,new hi({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),r}return M(n,[{key:"updateMatrixWorld",value:function(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),D(I(n.prototype),"updateMatrixWorld",this).call(this,e)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}]),n}(ec),Ap=new Gr,Rp=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gr(0,0,1),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gr(0,0,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*i,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*s;return E(this,n),(e=t.call(this)).type="ArrowHelper",void 0===_p&&((_p=new Oi).setAttribute("position",new Ci([0,0,0,0,1,0],3)),(Ep=new Vc(0,.5,1,5,1)).translate(0,-.5,0)),e.position.copy(a),e.line=new ec(_p,new Kl({color:o,toneMapped:!1})),e.line.matrixAutoUpdate=!1,e.add(e.line),e.cone=new to(Ep,new hi({color:o,toneMapped:!1})),e.cone.matrixAutoUpdate=!1,e.add(e.cone),e.setDirection(r),e.setLength(i,s,u),e}return M(n,[{key:"setDirection",value:function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Ap.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Ap,t)}}},{key:"setLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}},{key:"setColor",value:function(e){this.line.material.color.set(e),this.cone.material.color.set(e)}},{key:"copy",value:function(e){return D(I(n.prototype),"copy",this).call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}},{key:"dispose",value:function(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}]),n}(Ha),Np=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;E(this,n);var a=[0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],i=new Oi;i.setAttribute("position",new Ci(a,3)),i.setAttribute("color",new Ci([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var o=new Kl({vertexColors:!0,toneMapped:!1});return(e=t.call(this,i,o)).type="AxesHelper",e}return M(n,[{key:"setColors",value:function(e,t,n){var r=new li,a=this.geometry.attributes.color.array;return r.set(e),r.toArray(a,0),r.toArray(a,3),r.set(t),r.toArray(a,6),r.toArray(a,9),r.set(n),r.toArray(a,12),r.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(rc),Lp=function(){function e(){E(this,e),this.type="ShapePath",this.color=new li,this.subPaths=[],this.currentPath=null}return M(e,[{key:"moveTo",value:function(e,t){return this.currentPath=new zc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}},{key:"lineTo",value:function(e,t){return this.currentPath.lineTo(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,a,i){return this.currentPath.bezierCurveTo(e,t,n,r,a,i),this}},{key:"splineThru",value:function(e){return this.currentPath.splineThru(e),this}},{key:"toShapes",value:function(e){function t(e,t){for(var n=t.length,r=!1,a=n-1,i=0;i<n;a=i++){var o=t[a],s=t[i],u=s.x-o.x,l=s.y-o.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(o=t[i],u=-u,s=t[a],l=-l),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=l*(e.x-o.x)-u*(e.y-o.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var n,r,a,i=Sh.isClockWise,o=this.subPaths;if(0===o.length)return[];var s=[];if(1===o.length)return r=o[0],(a=new Jc).curves=r.curves,s.push(a),s;var u=!i(o[0].getPoints());u=e?!u:u;var l,c,h=[],d=[],f=[],p=0;d[p]=void 0,f[p]=[];for(var v=0,m=o.length;v<m;v++)n=i(l=(r=o[v]).getPoints()),(n=e?!n:n)?(!u&&d[p]&&p++,d[p]={s:new Jc,p:l},d[p].s.curves=r.curves,u&&p++,f[p]=[]):f[p].push({h:r,p:l[0]});if(!d[0])return function(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n],i=new Jc;i.curves=a.curves,t.push(i)}return t}(o);if(d.length>1){for(var g=!1,y=0,b=0,x=d.length;b<x;b++)h[b]=[];for(var w=0,k=d.length;w<k;w++)for(var S=f[w],_=0;_<S.length;_++){for(var E=S[_],T=!0,M=0;M<d.length;M++)t(E.p,d[M].p)&&(w!==M&&y++,T?(T=!1,h[M].push(E)):g=!0);T&&h[w].push(E)}y>0&&!1===g&&(f=h)}for(var C=0,I=d.length;C<I;C++){a=d[C].s,s.push(a);for(var A=0,R=(c=f[C]).length;A<R;A++)a.holes.push(c[A].h)}return s}}]),e}(),Pp=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s){return E(this,n),console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),t.call(this,e,r,a,i,o,s)}return M(n)}(ro),Dp=function(e){C(n,e);var t=R(n);function n(e,r,a,i){return E(this,n),console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),t.call(this,e,r,a,i)}return M(n)}(Bc),Fp=function(e){C(n,e);var t=R(n);function n(e,r,a,i){return E(this,n),console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),t.call(this,e,r,a,i)}return M(n)}(Wc),Op=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s,u){return E(this,n),console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),t.call(this,e,r,a,i,o,s,u)}return M(n)}(Gc),zp=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s,u,l){return E(this,n),console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),t.call(this,e,r,a,i,o,s,u,l)}return M(n)}(Vc),Up=function(e){C(n,e);var t=R(n);function n(e,r){return E(this,n),console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),t.call(this,e,r)}return M(n)}(jc),Bp=function(e){C(n,e);var t=R(n);function n(e,r){return E(this,n),console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),t.call(this,e,r)}return M(n)}(Th),Wp=function(e){C(n,e);var t=R(n);function n(e,r){return E(this,n),console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),t.call(this,e,r)}return M(n)}(Ch),Vp=function(e){C(n,e);var t=R(n);function n(e,r,a,i){return E(this,n),console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),t.call(this,e,r,a,i)}return M(n)}(Uc),Gp=function(e){C(n,e);var t=R(n);function n(e,r){return E(this,n),console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),t.call(this,e,r)}return M(n)}(Ih),Hp=function(e){C(n,e);var t=R(n);function n(e,r,a,i){return E(this,n),console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),t.call(this,e,r,a,i)}return M(n)}(Eo),jp=function(e){C(n,e);var t=R(n);function n(e,r,a,i){return E(this,n),console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),t.call(this,e,r,a,i)}return M(n)}(Hc),Xp=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s){return E(this,n),console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),t.call(this,e,r,a,i,o,s)}return M(n)}(Ah),qp=function(e){C(n,e);var t=R(n);function n(e,r){return E(this,n),console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),t.call(this,e,r)}return M(n)}(Rh),Kp=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s,u){return E(this,n),console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),t.call(this,e,r,a,i,o,s,u)}return M(n)}(Nh),Yp=function(e){C(n,e);var t=R(n);function n(e,r){return E(this,n),console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),t.call(this,e,r)}return M(n)}(Lh),Zp=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o){return E(this,n),console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),t.call(this,e,r,a,i,o)}return M(n)}(Ph),Jp=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o,s){return E(this,n),console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),t.call(this,e,r,a,i,o,s)}return M(n)}(Dh),Qp=function(e){C(n,e);var t=R(n);function n(e,r,a,i,o){return E(this,n),console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),t.call(this,e,r,a,i,o)}return M(n)}(Fh);"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:F}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=F);var $p=n(585);function ev(e){var t,n=new Set,r=function(e,r){var a="function"===typeof e?e(t):e;if(a!==t){var i=t;t=r?a:Object.assign({},t,a),n.forEach((function(e){return e(t,i)}))}},a=function(){return t},i={setState:r,getState:a,subscribe:function(e,r,i){return r||i?function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");var o=r(t);function s(){var n=r(t);if(!i(o,n)){var a=o;e(o=n,a)}}return n.add(s),function(){return n.delete(s)}}(e,r,i):(n.add(e),function(){return n.delete(e)})},destroy:function(){return n.clear()}};return t=e(r,a,i),i}var tv="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;function nv(e){var t="function"===typeof e?ev(e):e,n=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is,a=x((0,i.useReducer)((function(e){return e+1}),0),2)[1],o=t.getState(),s=(0,i.useRef)(o),u=(0,i.useRef)(n),l=(0,i.useRef)(r),c=(0,i.useRef)(!1),h=(0,i.useRef)();void 0===h.current&&(h.current=n(o));var d=!1;(s.current!==o||u.current!==n||l.current!==r||c.current)&&(e=n(o),d=!r(h.current,e)),tv((function(){d&&(h.current=e),s.current=o,u.current=n,l.current=r,c.current=!1}));var f=(0,i.useRef)(o);tv((function(){var e=function(){try{var e=t.getState(),n=u.current(e);l.current(h.current,n)||(s.current=e,h.current=n,a())}catch(r){c.current=!0,a()}},n=t.subscribe(e);return t.getState()!==f.current&&e(),n}),[]);var p=d?e:h.current;return(0,i.useDebugValue)(p),p};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");var e=[n,t];return{next:function(){var t=e.length<=0;return{value:e.shift(),done:t}}}},n}var rv=n(258),av=n.n(rv),iv=n(545);function ov(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e===t)return!0;if(!e||!t)return!1;var r=e.length;if(t.length!==r)return!1;for(var a=0;a<r;a++)if(!n(e[a],t[a]))return!1;return!0}var sv=[];function uv(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=0,i=sv;a<i.length;a++){var o=i[a];if(ov(t,o.keys,o.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return o.response;if(!n)throw o.promise}}var s={keys:t,equal:r.equal,promise:e.apply(void 0,g(t)).then((function(e){return s.response=e})).then((function(){r.lifespan&&r.lifespan>0&&setTimeout((function(){var e=sv.indexOf(s);-1!==e&&sv.splice(e,1)}),r.lifespan)})).catch((function(e){return s.error=e}))};if(sv.push(s),!n)throw s.promise}var lv,cv,hv=["args","attach"],dv=["args","children"],fv=["args","children"],pv=["children","key","ref"],vv=["children","key","ref"],mv=["params"],gv={};var yv=function(e){return"colorSpace"in e||"outputColorSpace"in e},bv=function(){var e;return null!=(e=gv.ColorManagement)?e:null},xv=function(e){return e&&e.isOrthographicCamera},wv="undefined"!==typeof window&&(null!=(lv=window.document)&&lv.createElement||"ReactNative"===(null==(cv=window.navigator)?void 0:cv.product))?i.useLayoutEffect:i.useEffect;function kv(e){var t=i.useRef(e);return wv((function(){t.current=e}),[e]),t}function Sv(e){var t=e.set;return wv((function(){return t(new Promise((function(){return null}))),function(){return t(!1)}}),[t]),null}var _v=function(e){C(n,e);var t=R(n);function n(){var e;E(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={error:!1},e}return M(n,[{key:"componentDidCatch",value:function(e){this.props.set(e)}},{key:"render",value:function(){return this.state.error?null:this.props.children}}]),n}(i.Component);_v.getDerivedStateFromError=function(){return{error:!0}};var Ev="__default",Tv=new Map,Mv=function(e){return e&&!!e.memoized&&!!e.changes};function Cv(e){var t,n="undefined"!==typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}var Iv=function(e){var t;return null==(t=e.__r3f)?void 0:t.root.getState()},Av={obj:function(e){return e===Object(e)&&!Av.arr(e)&&"function"!==typeof e},fun:function(e){return"function"===typeof e},str:function(e){return"string"===typeof e},num:function(e){return"number"===typeof e},boo:function(e){return"boolean"===typeof e},und:function(e){return void 0===e},arr:function(e){return Array.isArray(e)},equ:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.arrays,a=void 0===r?"shallow":r,i=n.objects,o=void 0===i?"reference":i,s=n.strict,u=void 0===s||s;if(typeof e!==typeof t||!!e!==!!t)return!1;if(Av.str(e)||Av.num(e))return e===t;var l=Av.obj(e);if(l&&"reference"===o)return e===t;var c,h=Av.arr(e);if(h&&"reference"===a)return e===t;if((h||l)&&e===t)return!0;for(c in e)if(!(c in t))return!1;if(l&&"shallow"===a&&"shallow"===o){for(c in u?t:e)if(!Av.equ(e[c],t[c],{strict:u,objects:"reference"}))return!1}else for(c in u?t:e)if(e[c]!==t[c])return!1;if(Av.und(c)){if(h&&0===e.length&&0===t.length)return!0;if(l&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function Rv(e){var t={nodes:{},materials:{}};return e&&e.traverse((function(e){e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}function Nv(e,t){var n=e;return(null!=t&&t.primitive||!n.__r3f)&&(n.__r3f=_({type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},t)),e}function Lv(e,t){var n=e;if(t.includes("-")){var r=t.split("-"),a=r.pop();return n=r.reduce((function(e,t){return e[t]}),e),{target:n,key:a}}return{target:n,key:t}}var Pv=/-\d+$/;function Dv(e,t,n){if(Av.str(n)){if(Pv.test(n)){var r=Lv(e,n.replace(Pv,"")),a=r.target,i=r.key;Array.isArray(a[i])||(a[i]=[])}var o=Lv(e,n),s=o.target,u=o.key;t.__r3f.previousAttach=s[u],s[u]=t}else t.__r3f.previousAttach=n(e,t)}function Fv(e,t,n){var r,a;if(Av.str(n)){var i=Lv(e,n),o=i.target,s=i.key,u=t.__r3f.previousAttach;void 0===u?delete o[s]:o[s]=u}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(a=t.__r3f)||delete a.previousAttach}function Ov(e,t){t.children,t.key,t.ref;var n,r=L(t,pv),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(a.children,a.key,a.ref,L(a,vv)),o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=null!=(n=null==e?void 0:e.__r3f)?n:{},u=Object.entries(r),l=[];if(o)for(var c=Object.keys(i),h=0;h<c.length;h++)r.hasOwnProperty(c[h])||u.unshift([c[h],Ev+"remove"]);u.forEach((function(t){var n,a=x(t,2),o=a[0],s=a[1];if((null==(n=e.__r3f)||!n.primitive||"object"!==o)&&!Av.equ(s,i[o])){if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(o))return l.push([o,s,!0,[]]);var u=[];for(var c in o.includes("-")&&(u=o.split("-")),l.push([o,s,!1,u]),r){var h=r[c];c.startsWith("".concat(o,"-"))&&l.push([c,h,!1,c.split("-")])}}}));var d=_({},r);return s.memoizedProps&&s.memoizedProps.args&&(d.args=s.memoizedProps.args),s.memoizedProps&&s.memoizedProps.attach&&(d.attach=s.memoizedProps.attach),{memoized:d,changes:l}}function zv(e,t){var n,r,a,i,o=null!=(n=e.__r3f)?n:{},s=o.root,u=null!=(r=null==s||null==s.getState?void 0:s.getState())?r:{},l=Mv(t)?t:Ov(e,t),c=l.memoized,h=l.changes,d=o.eventCount;e.__r3f&&(e.__r3f.memoizedProps=c);for(var f=0;f<h.length;f++){var p=x(h[f],4),w=p[0],k=p[1],S=p[2],_=p[3];if(yv(e)){var E="srgb",T="srgb-linear";"encoding"===w?(w="colorSpace",k=3001===k?E:T):"outputEncoding"===w&&(w="outputColorSpace",k=3001===k?E:T)}var M=e,C=M[w];if(_.length&&(C=_.reduce((function(e,t){return e[t]}),e),!C||!C.set)){var I=_.reverse(),A=y(i=I)||v(i)||m(i)||b(),R=A[0];M=A.slice(1).reverse().reduce((function(e,t){return e[t]}),e),w=R}if(k===Ev+"remove")if(M.constructor){var N=Tv.get(M.constructor);N||(N=new M.constructor,Tv.set(M.constructor,N)),k=N[w]}else k=0;if(S)k?o.handlers[w]=k:delete o.handlers[w],o.eventCount=Object.keys(o.handlers).length;else if(C&&C.set&&(C.copy||C instanceof Aa)){var L;if(Array.isArray(k))C.fromArray?C.fromArray(k):(L=C).set.apply(L,g(k));else if(C.copy&&k&&k.constructor&&C.constructor===k.constructor)C.copy(k);else if(void 0!==k){var P=C instanceof li;!P&&C.setScalar?C.setScalar(k):C instanceof Aa&&k instanceof Aa?C.mask=k.mask:C.set(k),bv()||u.linear||!P||C.convertSRGBToLinear()}}else if(M[w]=k,M[w]instanceof Pr&&M[w].format===ft&&M[w].type===tt){var D=M[w];yv(D)&&yv(u.gl)?D.colorSpace=u.gl.outputColorSpace:D.encoding=u.gl.outputEncoding}Uv(e)}if(o.parent&&u.internal&&e.raycast&&d!==o.eventCount){var F=u.internal.interaction.indexOf(e);F>-1&&u.internal.interaction.splice(F,1),o.eventCount&&u.internal.interaction.push(e)}return!(1===h.length&&"onUpdate"===h[0][0])&&h.length&&null!=(a=e.__r3f)&&a.parent&&Bv(e),e}function Uv(e){var t,n,r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function Bv(e){null==e.onUpdate||e.onUpdate(e)}function Wv(e,t){e.manual||(xv(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Vv(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Gv(e,t,n,r){var a=n.get(t);a&&(n.delete(t),0===n.size&&(e.delete(r),a.target.releasePointerCapture(r)))}function Hv(e){function t(e){return e.filter((function(e){return["Move","Over","Enter","Out","Leave"].some((function(t){var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}))}function n(t){var n,r=e.getState().internal,a=N(r.hovered.values());try{var i=function(){var e=n.value;if(!t.length||!t.find((function(t){return t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId}))){var a=e.eventObject.__r3f,i=null==a?void 0:a.handlers;if(r.hovered.delete(Vv(e)),null!=a&&a.eventCount){var o=_(_({},e),{},{intersections:t});null==i.onPointerOut||i.onPointerOut(o),null==i.onPointerLeave||i.onPointerLeave(o)}}};for(a.s();!(n=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(a){switch(a){case"onPointerLeave":case"onPointerCancel":return function(){return n([])};case"onLostPointerCapture":return function(t){var r=e.getState().internal;"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame((function(){r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))}))}}return function(i){var o=e.getState(),s=o.onPointerMissed,u=o.internal;u.lastEvent.current=i;var l="onPointerMove"===a,c="onClick"===a||"onContextMenu"===a||"onDoubleClick"===a,h=function(t,n){for(var r=e.getState(),a=new Set,i=[],o=n?n(r.internal.interaction):r.internal.interaction,s=0;s<o.length;s++){var u=Iv(o[s]);u&&(u.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);var l=o.flatMap((function(e){var n,r=Iv(e);return r&&r.events.enabled&&null!==r.raycaster.camera?(void 0===r.raycaster.camera&&(null==r.events.compute||r.events.compute(t,r,null==(n=r.previousRoot)?void 0:n.getState()),void 0===r.raycaster.camera&&(r.raycaster.camera=null)),r.raycaster.camera?r.raycaster.intersectObject(e,!0):[]):[]})).sort((function(e,t){var n=Iv(e.object),r=Iv(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance})).filter((function(e){var t=Vv(e);return!a.has(t)&&(a.add(t),!0)}));r.events.filter&&(l=r.events.filter(l,r));var c,h=N(l);try{for(h.s();!(c=h.n()).done;)for(var d=c.value,f=d.object;f;){var p;null!=(p=f.__r3f)&&p.eventCount&&i.push(_(_({},d),{},{eventObject:f})),f=f.parent}}catch(y){h.e(y)}finally{h.f()}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId)){var v,m=N(r.internal.capturedMap.get(t.pointerId).values());try{for(m.s();!(v=m.n()).done;){var g=v.value;a.has(Vv(g.intersection))||i.push(g.intersection)}}catch(y){m.e(y)}finally{m.f()}}return i}(i,l?t:void 0),d=c?function(t){var n=e.getState().internal,r=t.offsetX-n.initialClick[0],a=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+a*a))}(i):0;"onPointerDown"===a&&(u.initialClick=[i.offsetX,i.offsetY],u.initialHits=h.map((function(e){return e.eventObject}))),c&&!h.length&&d<=2&&(r(i,u.interaction),s&&s(i)),l&&n(h),function(t,r,a,i){var o=e.getState();if(t.length){var s,u={stopped:!1},l=N(t);try{var c=function(){var e=s.value,l=Iv(e.object)||o,c=l.raycaster,h=l.pointer,d=l.camera,f=l.internal,p=new Gr(h.x,h.y,0).unproject(d),v=function(t){var n,r;return null!=(n=null==(r=f.capturedMap.get(t))?void 0:r.has(e.eventObject))&&n},m=function(t){var n={intersection:e,target:r.target};f.capturedMap.has(t)?f.capturedMap.get(t).set(e.eventObject,n):f.capturedMap.set(t,new Map([[e.eventObject,n]])),r.target.setPointerCapture(t)},y=function(t){var n=f.capturedMap.get(t);n&&Gv(f.capturedMap,e.eventObject,n,t)},b={};for(var x in r){var w=r[x];"function"!==typeof w&&(b[x]=w)}var k=_(_(_({},e),b),{},{pointer:h,intersections:t,stopped:u.stopped,delta:a,unprojectedPoint:p,ray:c.ray,camera:d,stopPropagation:function(){var a="pointerId"in r&&f.capturedMap.get(r.pointerId);if((!a||a.has(e.eventObject))&&(k.stopped=u.stopped=!0,f.hovered.size&&Array.from(f.hovered.values()).find((function(t){return t.eventObject===e.eventObject})))){var i=t.slice(0,t.indexOf(e));n([].concat(g(i),[e]))}},target:{hasPointerCapture:v,setPointerCapture:m,releasePointerCapture:y},currentTarget:{hasPointerCapture:v,setPointerCapture:m,releasePointerCapture:y},nativeEvent:r});if(i(k),!0===u.stopped)return"break"};for(l.s();!(s=l.n()).done&&"break"!==c(););}catch(h){l.e(h)}finally{l.f()}}}(h,i,d,(function(e){var t=e.eventObject,n=t.__r3f,o=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(o.onPointerOver||o.onPointerEnter||o.onPointerOut||o.onPointerLeave){var s=Vv(e),h=u.hovered.get(s);h?h.stopped&&e.stopPropagation():(u.hovered.set(s,e),null==o.onPointerOver||o.onPointerOver(e),null==o.onPointerEnter||o.onPointerEnter(e))}null==o.onPointerMove||o.onPointerMove(e)}else{var d=o[a];d?c&&!u.initialHits.includes(t)||(r(i,u.interaction.filter((function(e){return!u.initialHits.includes(e)}))),d(e)):c&&u.initialHits.includes(t)&&r(i,u.interaction.filter((function(e){return!u.initialHits.includes(e)})))}}))}}}}var jv,Xv=function(e){return!(null==e||!e.render)},qv=i.createContext(null),Kv=function(e,t){var n=nv((function(n,r){var a=new Gr,o=new Gr,s=new Gr;function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size,i=n.width,u=n.height,l=n.top,c=n.left,h=i/u;t instanceof Gr?s.copy(t):s.set.apply(s,g(t));var d=e.getWorldPosition(a).distanceTo(s);if(xv(e))return{width:i/e.zoom,height:u/e.zoom,top:l,left:c,factor:1,distance:d,aspect:h};var f=e.fov*Math.PI/180,p=2*Math.tan(f/2)*d,v=p*(i/u);return{width:v,height:p,top:l,left:c,factor:i/v,distance:d,aspect:h}}var l=void 0,c=function(e){return n((function(t){return{performance:_(_({},t.performance),{},{current:e})}}))},h=new fr,d={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(r(),t)},advance:function(e,n){return t(e,n,r())},legacy:!1,linear:!1,flat:!1,controls:null,clock:new pf,pointer:h,mouse:h,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:function(){var e=r();l&&clearTimeout(l),e.performance.current!==e.performance.min&&c(e.performance.min),l=setTimeout((function(){return c(r().performance.max)}),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:function(e){return n((function(t){return _(_({},t),{},{events:_(_({},t.events),e)})}))},setSize:function(e,t,a,i,s){var l=r().camera,c={width:e,height:t,top:i||0,left:s||0,updateStyle:a};n((function(e){return{size:c,viewport:_(_({},e.viewport),u(l,o,c))}}))},setDpr:function(e){return n((function(t){var n=Cv(e);return{viewport:_(_({},t.viewport),{},{dpr:n,initialDpr:t.viewport.initialDpr||n})}}))},setFrameloop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always",t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n((function(){return{frameloop:e}}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:i.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:function(e,t,n){var a=r().internal;return a.priority=a.priority+(t>0?1:0),a.subscribers.push({ref:e,priority:t,store:n}),a.subscribers=a.subscribers.sort((function(e,t){return e.priority-t.priority})),function(){var n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter((function(t){return t.ref!==e})))}}}};return d})),r=n.getState(),a=r.size,o=r.viewport.dpr,s=r.camera;return n.subscribe((function(){var e=n.getState(),t=e.camera,r=e.size,i=e.viewport,u=e.gl,l=e.set;if(r!==a||i.dpr!==o){var c;a=r,o=i.dpr,Wv(t,r),u.setPixelRatio(i.dpr);var h=null!=(c=r.updateStyle)?c:"undefined"!==typeof HTMLCanvasElement&&u.domElement instanceof HTMLCanvasElement;u.setSize(r.width,r.height,h)}t!==s&&(s=t,l((function(e){return{viewport:_(_({},e.viewport),e.viewport.getCurrentViewport(t))}})))})),n.subscribe((function(t){return e(t)})),n};var Yv,Zv,Jv=new Set,Qv=new Set,$v=new Set;function em(e,t){if(e.size){var n,r=N(e.values());try{for(r.s();!(n=r.n()).done;){(0,n.value.callback)(t)}}catch(a){r.e(a)}finally{r.f()}}}function tm(e,t){switch(e){case"before":return em(Jv,t);case"after":return em(Qv,t);case"tail":return em($v,t)}}function nm(e,t,n){var r=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Yv=t.internal.subscribers,jv=0;jv<Yv.length;jv++)(Zv=Yv[jv]).ref.current(Zv.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function rm(){var e=i.useContext(qv);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function am(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=arguments.length>1?arguments[1]:void 0;return rm()(e,t)}function im(e,t){return function(n){var r=new n;e&&e(r);for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];return Promise.all(i.map((function(e){return new Promise((function(n,a){return r.load(e,(function(e){e.scene&&Object.assign(e,Rv(e.scene)),n(e)}),t,(function(t){return a(new Error("Could not load ".concat(e,": ").concat(t.message,")")))}))}))})))}}function om(e,t,n,r){var a=Array.isArray(t)?t:[t],i=function(e,t,n){return uv(e,t,!1,n)}(im(n,r),[e].concat(g(a)),{equal:Av.equ});return Array.isArray(t)?i:i[0]}om.preload=function(e,t,n){var r=Array.isArray(t)?t:[t];return function(e,t,n){uv(e,t,!0,n)}(im(n),[e].concat(g(r)))},om.clear=function(e,t){var n=Array.isArray(t)?t:[t];return function(e){if(void 0===e||0===e.length)sv.splice(0,sv.length);else{var t=sv.find((function(t){return ov(e,t.keys,t.equal)}));if(t){var n=sv.indexOf(t);-1!==n&&sv.splice(n,1)}}}([e].concat(g(n)))};var sm=new Map,um=function(e){var t,n,r,a=!1;function i(o){n=requestAnimationFrame(i),a=!0,t=0,tm("before",o);var s,u=N(e.values());try{for(u.s();!(s=u.n()).done;){var l,c=s.value;!(r=c.store.getState()).internal.active||!("always"===r.frameloop||r.internal.frames>0)||null!=(l=r.gl.xr)&&l.isPresenting||(t+=nm(o,r))}}catch(h){u.e(h)}finally{u.f()}if(tm("after",o),0===t)return tm("tail",o),a=!1,cancelAnimationFrame(n)}return{loop:i,invalidate:function t(n){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!n)return e.forEach((function(e){return t(e.store.getState())}),o);null!=(r=n.gl.xr)&&r.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=Math.min(60,n.internal.frames+o),a||(a=!0,requestAnimationFrame(i)))},advance:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;if(n&&tm("before",t),r)nm(t,r,a);else{var i,o=N(e.values());try{for(o.s();!(i=o.n()).done;){nm(t,i.value.store.getState())}}catch(s){o.e(s)}finally{o.f()}}n&&tm("after",t)}}}(sm),lm=um.invalidate,cm=um.advance,hm=function(e,t){function n(e,t,n){var r,a=t.args,i=void 0===a?[]:a,o=t.attach,s=L(t,hv),u="".concat(e[0].toUpperCase()).concat(e.slice(1));if("primitive"===e){if(void 0===s.object)throw new Error("R3F: Primitives without 'object' are invalid!");r=Nv(s.object,{type:e,root:n,attach:o,primitive:!0})}else{var l=gv[u];if(!l)throw new Error("R3F: ".concat(u," is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively"));if(!Array.isArray(i))throw new Error("R3F: The args prop must be an array!");r=Nv(f(l,g(i)),{type:e,root:n,attach:o,memoizedProps:{args:i}})}return void 0===r.__r3f.attach&&(r instanceof Oi?r.__r3f.attach="geometry":r instanceof ai&&(r.__r3f.attach="material")),"inject"!==u&&zv(r,s),r}function r(e,t){var n,r,a=!1;t&&(null!=(n=t.__r3f)&&n.attach?Dv(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),a=!0),a||null==(r=e.__r3f)||r.objects.push(t),t.__r3f||Nv(t,{}),t.__r3f.parent=e,Bv(t),Uv(t))}function a(e,t,n){var r=!1;if(t){var a,i;if(null!=(a=t.__r3f)&&a.attach)Dv(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"});var o=e.children.filter((function(e){return e!==t})),s=o.indexOf(n);e.children=[].concat(g(o.slice(0,s)),[t],g(o.slice(s))),r=!0}r||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||Nv(t,{}),t.__r3f.parent=e,Bv(t),Uv(t)}}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&g(e).forEach((function(e){return o(t,e,n)}))}function o(e,t,n){if(t){var r,a,o;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter((function(e){return e!==t}))),null!=(a=t.__r3f)&&a.attach)Fv(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&function(e,t){var n=e.getState().internal;n.interaction=n.interaction.filter((function(e){return e!==t})),n.initialHits=n.initialHits.filter((function(e){return e!==t})),n.hovered.forEach((function(e,r){e.eventObject!==t&&e.object!==t||n.hovered.delete(r)})),n.capturedMap.forEach((function(e,r){Gv(n.capturedMap,t,e,r)}))}(t.__r3f.root,t)}var u,l=null==(o=t.__r3f)?void 0:o.primitive,c=void 0===n?null!==t.dispose&&!l:n;if(!l)i(null==(u=t.__r3f)?void 0:u.objects,t,c),i(t.children,t,c);t.__r3f&&(delete t.__r3f.root,delete t.__r3f.objects,delete t.__r3f.handlers,delete t.__r3f.memoizedProps,l||delete t.__r3f),c&&t.dispose&&"Scene"!==t.type&&(0,iv.unstable_scheduleCallback)(iv.unstable_IdlePriority,(function(){try{t.dispose()}catch(e){}})),Uv(e)}}var s=function(){return console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.")};return{reconciler:av()({createInstance:n,removeChild:o,appendChild:r,appendInitialChild:r,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:function(e,t){if(t){var n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))}},removeChildFromContainer:function(e,t){t&&o(e.getState().scene,t)},insertInContainerBefore:function(e,t,n){if(t&&n){var r=e.getState().scene;r.__r3f&&a(r,t,n)}},getRootHostContext:function(){return null},getChildHostContext:function(e){return e},finalizeInitialChildren:function(e){var t,n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate:function(e,t,n,r){if(e.__r3f.primitive&&r.object&&r.object!==e)return[!0];var a=r.args,i=void 0===a?[]:a,o=(r.children,L(r,dv)),s=n.args,u=void 0===s?[]:s,l=(n.children,L(n,fv));if(!Array.isArray(i))throw new Error("R3F: the args prop must be an array!");if(i.some((function(e,t){return e!==u[t]})))return[!0];var c=Ov(e,o,l,!0);return c.changes.length?[!1,c]:null},commitUpdate:function(e,t,a,i,s,u){var l=x(t,2),c=l[0],h=l[1];c?function(e,t,a,i){var s,u=null==(s=e.__r3f)?void 0:s.parent;if(u){var l=n(t,a,e.__r3f.root);if(e.children){var c,h=N(e.children);try{for(h.s();!(c=h.n()).done;){var d=c.value;d.__r3f&&r(l,d)}}catch(f){h.e(f)}finally{h.f()}e.children=e.children.filter((function(e){return!e.__r3f}))}e.__r3f.objects.forEach((function(e){return r(l,e)})),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||o(u,e),l.parent&&(l.__r3f.autoRemovedBeforeAppend=!0),r(u,l),l.raycast&&l.__r3f.eventCount&&l.__r3f.root.getState().internal.interaction.push(l),[i,i.alternate].forEach((function(e){null!==e&&(e.stateNode=l,e.ref&&("function"===typeof e.ref?e.ref(l):e.ref.current=l))}))}}(e,a,s,u):zv(e,h)},commitMount:function(e,t,n,r){var a,i=null!=(a=e.__r3f)?a:{};e.raycast&&i.handlers&&i.eventCount&&e.__r3f.root.getState().internal.interaction.push(e)},getPublicInstance:function(e){return e},prepareForCommit:function(){return null},preparePortalMount:function(e){return Nv(e.getState().scene)},resetAfterCommit:function(){},shouldSetTextContent:function(){return!1},clearContainer:function(){return!1},hideInstance:function(e){var t,n=null!=(t=e.__r3f)?t:{},r=n.attach,a=n.parent;r&&a&&Fv(a,e,r),e.isObject3D&&(e.visible=!1),Uv(e)},unhideInstance:function(e,t){var n,r=null!=(n=e.__r3f)?n:{},a=r.attach,i=r.parent;a&&i&&Dv(i,e,a),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),Uv(e)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:function(){return t?t():$p.DefaultEventPriority},beforeActiveInstanceBlur:function(){},afterActiveInstanceBlur:function(){},detachDeletedInstance:function(){},now:"undefined"!==typeof performance&&Av.fun(performance.now)?performance.now:Av.fun(Date.now)?Date.now:function(){return 0},scheduleTimeout:Av.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Av.fun(clearTimeout)?clearTimeout:void 0}),applyProps:zv}}(0,(function(){var e,t="undefined"!==typeof self&&self||"undefined"!==typeof window&&window;if(!t)return $p.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return $p.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return $p.ContinuousEventPriority;default:return $p.DefaultEventPriority}})),dm=hm.reconciler,fm=hm.applyProps,pm={objects:"shallow",strict:!1},vm=function(e,t){var n="function"===typeof e?e(t):e;return Xv(n)?n:new el(_({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0},e))};function mm(e){var t=sm.get(e),n=null==t?void 0:t.fiber,r=null==t?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");var a,o="function"===typeof reportError?reportError:console.error,s=r||Kv(lm,cm),u=n||dm.createContainer(s,$p.ConcurrentRoot,null,!1,null,"",o,null);t||sm.set(e,{fiber:u,store:s});var l,c=!1;return{configure:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.gl,r=t.size,i=t.scene,o=t.events,u=t.onCreated,h=t.shadows,d=void 0!==h&&h,f=t.linear,p=void 0!==f&&f,v=t.flat,m=void 0!==v&&v,g=t.legacy,y=void 0!==g&&g,b=t.orthographic,x=void 0!==b&&b,w=t.frameloop,k=void 0===w?"always":w,S=t.dpr,E=void 0===S?[1,2]:S,T=t.performance,M=t.raycaster,C=t.camera,I=t.onPointerMissed,A=s.getState(),R=A.gl;A.gl||A.set({gl:R=vm(n,e)});var N=A.raycaster;N||A.set({raycaster:N=new Xf});var P,D=M||{},F=D.params,O=L(D,mv);if(Av.equ(O,N,pm)||fm(N,_({},O)),Av.equ(F,N.params,pm)||fm(N,{params:_(_({},N.params),F)}),!A.camera||A.camera===l&&!Av.equ(l,C,pm)){l=C;var z=C instanceof lo,U=z?C:x?new Fo(0,0,0,0,.1,1e3):new co(75,0,.1,1e3);z||(U.position.z=5,C&&fm(U,C),A.camera||null!=C&&C.rotation||U.lookAt(0,0,0)),A.set({camera:U})}A.scene||(i instanceof il?P=i:(P=new il,i&&fm(P,i)),A.set({scene:Nv(P)}));if(!A.xr){var B=function(e,t){var n=s.getState();"never"!==n.frameloop&&cm(e,!0,n,t)},W=function(){var e=s.getState();e.gl.xr.enabled=e.gl.xr.isPresenting,e.gl.xr.setAnimationLoop(e.gl.xr.isPresenting?B:null),e.gl.xr.isPresenting||lm(e)},V={connect:function(){var e=s.getState().gl;e.xr.addEventListener("sessionstart",W),e.xr.addEventListener("sessionend",W)},disconnect:function(){var e=s.getState().gl;e.xr.removeEventListener("sessionstart",W),e.xr.removeEventListener("sessionend",W)}};R.xr&&V.connect(),A.set({xr:V})}if(R.shadowMap){var q=R.shadowMap.enabled,K=R.shadowMap.type;if(R.shadowMap.enabled=!!d,Av.boo(d))R.shadowMap.type=j;else if(Av.str(d)){var Y,Z={basic:G,percentage:H,soft:j,variance:X};R.shadowMap.type=null!=(Y=Z[d])?Y:j}else Av.obj(d)&&Object.assign(R.shadowMap,d);q===R.shadowMap.enabled&&K===R.shadowMap.type||(R.shadowMap.needsUpdate=!0)}var J=bv();J&&("enabled"in J?J.enabled=!y:"legacyMode"in J&&(J.legacyMode=y));fm(R,{outputEncoding:p?3e3:3001,toneMapping:m?Ae:Pe}),A.legacy!==y&&A.set((function(){return{legacy:y}})),A.linear!==p&&A.set((function(){return{linear:p}})),A.flat!==m&&A.set((function(){return{flat:m}})),!n||Av.fun(n)||Xv(n)||Av.equ(n,R,pm)||fm(R,n),o&&!A.events.handlers&&A.set({events:o(s)});var Q=function(e,t){if(t)return t;if("undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){var n=e.parentElement.getBoundingClientRect();return{width:n.width,height:n.height,top:n.top,left:n.left}}return"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0}:{width:0,height:0,top:0,left:0}}(e,r);return Av.equ(Q,A.size,pm)||A.setSize(Q.width,Q.height,Q.updateStyle,Q.top,Q.left),E&&A.viewport.dpr!==Cv(E)&&A.setDpr(E),A.frameloop!==k&&A.setFrameloop(k),A.onPointerMissed||A.set({onPointerMissed:I}),T&&!Av.equ(T,A.performance,pm)&&A.set((function(e){return{performance:_(_({},e.performance),T)}})),a=u,c=!0,this},render:function(t){return c||this.configure(),dm.updateContainer(i.createElement(gm,{store:s,children:t,onCreated:a,rootElement:e}),u,null,(function(){})),s},unmount:function(){ym(e)}}}function gm(e){var t=e.store,n=e.children,r=e.onCreated,a=e.rootElement;return wv((function(){var e=t.getState();e.set((function(e){return{internal:_(_({},e.internal),{},{active:!0})}})),r&&r(e),t.getState().events.connected||null==e.events.connect||e.events.connect(a)}),[]),i.createElement(qv.Provider,{value:t},n)}function ym(e,t){var n=sm.get(e),r=null==n?void 0:n.fiber;if(r){var a=null==n?void 0:n.store.getState();a&&(a.internal.active=!1),dm.updateContainer(null,r,null,(function(){a&&setTimeout((function(){try{var n,r,i,o;null==a.events.disconnect||a.events.disconnect(),null==(n=a.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(i=a.gl)||null==i.forceContextLoss||i.forceContextLoss(),null!=(o=a.gl)&&o.xr&&a.xr.disconnect(),function(e){for(var t in e.dispose&&"Scene"!==e.type&&e.dispose(),e)null==t.dispose||t.dispose(),delete e[t]}(a),sm.delete(e),t&&t(e)}catch(s){}}),500)}))}}dm.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:i.version});i.unstable_act;function bm(){return bm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bm.apply(this,arguments)}var xm=n(494),wm=n.n(xm);function km(e){var t=void 0===e?{debounce:0,scroll:!1,offsetSize:!1}:e,n=t.debounce,r=t.scroll,a=t.polyfill,o=t.offsetSize,s=a||("undefined"===typeof window?M((function e(){E(this,e)})):window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");var u=x((0,i.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),2),l=u[0],c=u[1],h=(0,i.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:l}),d=n?"number"===typeof n?n:n.scroll:null,f=n?"number"===typeof n?n:n.resize:null,p=(0,i.useRef)(!1);(0,i.useEffect)((function(){return p.current=!0,function(){p.current=!1}}));var v=x((0,i.useMemo)((function(){var e=function(){if(h.current.element){var e=h.current.element.getBoundingClientRect(),t={left:e.left,top:e.top,width:e.width,height:e.height,bottom:e.bottom,right:e.right,x:e.x,y:e.y};h.current.element instanceof HTMLElement&&o&&(t.height=h.current.element.offsetHeight,t.width=h.current.element.offsetWidth),Object.freeze(t),p.current&&!Em(h.current.lastBounds,t)&&c(h.current.lastBounds=t)}};return[e,f?wm()(e,f):e,d?wm()(e,d):e]}),[c,o,d,f]),3),m=v[0],g=v[1],y=v[2];function b(){h.current.scrollContainers&&(h.current.scrollContainers.forEach((function(e){return e.removeEventListener("scroll",y,!0)})),h.current.scrollContainers=null),h.current.resizeObserver&&(h.current.resizeObserver.disconnect(),h.current.resizeObserver=null)}function w(){h.current.element&&(h.current.resizeObserver=new s(y),h.current.resizeObserver.observe(h.current.element),r&&h.current.scrollContainers&&h.current.scrollContainers.forEach((function(e){return e.addEventListener("scroll",y,{capture:!0,passive:!0})})))}var k,S,_;return k=y,S=Boolean(r),(0,i.useEffect)((function(){if(S){var e=k;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),function(){window.removeEventListener("scroll",e,!0)}}}),[k,S]),_=g,(0,i.useEffect)((function(){var e=_;return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[_]),(0,i.useEffect)((function(){b(),w()}),[r,y,g]),(0,i.useEffect)((function(){return b}),[]),[function(e){e&&e!==h.current.element&&(b(),h.current.element=e,h.current.scrollContainers=Sm(e),w())},l,m]}function Sm(e){var t=[];if(!e||e===document.body)return t;var n=window.getComputedStyle(e);return[n.overflow,n.overflowX,n.overflowY].some((function(e){return"auto"===e||"scroll"===e}))&&t.push(e),[].concat(t,g(Sm(e.parentElement)))}var _m=["x","y","top","bottom","left","right","width","height"],Em=function(e,t){return _m.every((function(n){return e[n]===t[n]}))},Tm=Object.defineProperty,Mm=Object.defineProperties,Cm=Object.getOwnPropertyDescriptors,Im=Object.getOwnPropertySymbols,Am=Object.prototype.hasOwnProperty,Rm=Object.prototype.propertyIsEnumerable,Nm=function(e,t,n){return t in e?Tm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Lm=function(e,t){for(var n in t||(t={}))Am.call(t,n)&&Nm(e,n,t[n]);if(Im){var r,a=N(Im(t));try{for(a.s();!(r=a.n()).done;){n=r.value;Rm.call(t,n)&&Nm(e,n,t[n])}}catch(i){a.e(i)}finally{a.f()}}return e};function Pm(e,t,n){if(e){if(!0===n(e))return e;for(var r=t?e.return:e.child;r;){var a=Pm(r,t,n);if(a)return a;r=t?null:r.sibling}}}function Dm(e){try{return Object.defineProperties(e,{_currentRenderer:{get:function(){return null},set:function(){}},_currentRenderer2:{get:function(){return null},set:function(){}}})}catch(t){return e}}var Fm=Dm(i.createContext(null)),Om=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"render",value:function(){return i.createElement(Fm.Provider,{value:this._reactInternals},this.props.children)}}]),n}(i.Component),zm=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Um=zm.ReactCurrentOwner,Bm=zm.ReactCurrentDispatcher;function Wm(){var e=i.useContext(Fm);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");var t=i.useId(),n=i.useMemo((function(){for(var n=0,r=[null==Um?void 0:Um.current,e,null==e?void 0:e.alternate];n<r.length;n++){var a=r[n];if(a){var i=Pm(a,!1,(function(e){for(var n=e.memoizedState;n;){if(n.memoizedState===t)return!0;n=n.next}}));if(i)return i}}}),[e,t]);return n}function Vm(){var e=function(){var e,t,n=Wm(),r=x(i.useState((function(){return new Map})),1)[0];r.clear();for(var a=n;a;){var o=null==(e=a.type)?void 0:e._context;o&&o!==Fm&&!r.has(o)&&r.set(o,null==(t=null==Bm?void 0:Bm.current)?void 0:t.readContext(Dm(o))),a=a.return}return r}();return i.useMemo((function(){return Array.from(e.keys()).reduce((function(t,n){return function(r){return i.createElement(t,null,i.createElement(n.Provider,(a=Lm({},r),o={value:e.get(n)},Mm(a,Cm(o)))));var a,o}}),(function(e){return i.createElement(Om,Lm({},e))}))}),[e])}var Gm=["children","fallback","resize","style","gl","events","eventSource","eventPrefix","shadows","linear","flat","legacy","orthographic","frameloop","dpr","performance","raycaster","camera","onPointerMissed","onCreated"],Hm={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function jm(e){var t=Hv(e).handlePointer;return{priority:1,enabled:!0,compute:function(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(Hm).reduce((function(e,n){return _(_({},e),{},k({},n,t(n)))}),{}),update:function(){var t,n=e.getState(),r=n.events,a=n.internal;null!=(t=a.lastEvent)&&t.current&&r.handlers&&r.handlers.onPointerMove(a.lastEvent.current)},connect:function(t){var n,r=e.getState(),a=r.set,i=r.events;null==i.disconnect||i.disconnect(),a((function(e){return{events:_(_({},e.events),{},{connected:t})}})),Object.entries(null!=(n=i.handlers)?n:[]).forEach((function(e){var n=x(e,2),r=n[0],a=n[1],i=x(Hm[r],2),o=i[0],s=i[1];t.addEventListener(o,a,{passive:s})}))},disconnect:function(){var t,n=e.getState(),r=n.set,a=n.events;a.connected&&(Object.entries(null!=(t=a.handlers)?t:[]).forEach((function(e){var t=x(e,2),n=t[0],r=t[1];if(a&&a.connected instanceof HTMLElement){var i=x(Hm[n],1)[0];a.connected.removeEventListener(i,r)}})),r((function(e){return{events:_(_({},e.events),{},{connected:void 0})}})))}}}var Xm=i.forwardRef((function(t,n){var r=t.children,a=t.fallback,o=t.resize,s=t.style,u=t.gl,l=t.events,c=void 0===l?jm:l,h=t.eventSource,d=t.eventPrefix,f=t.shadows,p=t.linear,v=t.flat,m=t.legacy,g=t.orthographic,y=t.frameloop,b=t.dpr,w=t.performance,k=t.raycaster,S=t.camera,E=t.onPointerMissed,T=t.onCreated,M=L(t,Gm);i.useMemo((function(){return t=e,void Object.assign(gv,t);var t}),[]);var C=Vm(),I=x(km(_({scroll:!0,debounce:{scroll:50,resize:0}},o)),2),A=I[0],R=I[1],N=i.useRef(null),P=i.useRef(null);i.useImperativeHandle(n,(function(){return N.current}));var D=kv(E),F=x(i.useState(!1),2),O=F[0],z=F[1],U=x(i.useState(!1),2),B=U[0],W=U[1];if(O)throw O;if(B)throw B;var V=i.useRef(null);wv((function(){var e=N.current;R.width>0&&R.height>0&&e&&(V.current||(V.current=mm(e)),V.current.configure({gl:u,events:c,shadows:f,linear:p,flat:v,legacy:m,orthographic:g,frameloop:y,dpr:b,performance:w,raycaster:k,camera:S,size:R,onPointerMissed:function(){return null==D.current?void 0:D.current.apply(D,arguments)},onCreated:function(e){var t;null==e.events.connect||e.events.connect(h?(t=h)&&t.hasOwnProperty("current")?h.current:h:P.current),d&&e.setEvents({compute:function(e,t){var n=e[d+"X"],r=e[d+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==T||T(e)}}),V.current.render(i.createElement(C,null,i.createElement(_v,{set:W},i.createElement(i.Suspense,{fallback:i.createElement(Sv,{set:z})},r)))))})),i.useEffect((function(){var e=N.current;if(e)return function(){return ym(e)}}),[]);var G=h?"none":"auto";return i.createElement("div",bm({ref:P,style:_({position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:G},s)},M),i.createElement("div",{ref:A,style:{width:"100%",height:"100%"}},i.createElement("canvas",{ref:N,style:{display:"block"}},a)))})),qm=i.forwardRef((function(e,t){return i.createElement(Om,null,i.createElement(Xm,bm({},e,{ref:t})))})),Km=function(e,t){return(e%t+t)%t},Ym=function(e){C(n,e);var t=R(n);function n(e,r){var a;E(this,n),k(A(a=t.call(this)),"object",void 0),k(A(a),"domElement",void 0),k(A(a),"enabled",!0),k(A(a),"target",new Gr),k(A(a),"minDistance",0),k(A(a),"maxDistance",1/0),k(A(a),"minZoom",0),k(A(a),"maxZoom",1/0),k(A(a),"minPolarAngle",0),k(A(a),"maxPolarAngle",Math.PI),k(A(a),"minAzimuthAngle",-1/0),k(A(a),"maxAzimuthAngle",1/0),k(A(a),"enableDamping",!1),k(A(a),"dampingFactor",.05),k(A(a),"enableZoom",!0),k(A(a),"zoomSpeed",1),k(A(a),"enableRotate",!0),k(A(a),"rotateSpeed",1),k(A(a),"enablePan",!0),k(A(a),"panSpeed",1),k(A(a),"screenSpacePanning",!0),k(A(a),"keyPanSpeed",7),k(A(a),"autoRotate",!1),k(A(a),"autoRotateSpeed",2),k(A(a),"reverseOrbit",!1),k(A(a),"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),k(A(a),"mouseButtons",{LEFT:O.ROTATE,MIDDLE:O.DOLLY,RIGHT:O.PAN}),k(A(a),"touches",{ONE:z.ROTATE,TWO:z.DOLLY_PAN}),k(A(a),"target0",void 0),k(A(a),"position0",void 0),k(A(a),"zoom0",void 0),k(A(a),"_domElementKeyEvents",null),k(A(a),"getPolarAngle",void 0),k(A(a),"getAzimuthalAngle",void 0),k(A(a),"setPolarAngle",void 0),k(A(a),"setAzimuthalAngle",void 0),k(A(a),"getDistance",void 0),k(A(a),"listenToKeyEvents",void 0),k(A(a),"saveState",void 0),k(A(a),"reset",void 0),k(A(a),"update",void 0),k(A(a),"connect",void 0),k(A(a),"dispose",void 0),a.object=e,a.domElement=r,a.target0=a.target.clone(),a.position0=a.object.position.clone(),a.zoom0=a.object instanceof co?a.object.zoom:1,a.getPolarAngle=function(){return d.phi},a.getAzimuthalAngle=function(){return d.theta},a.setPolarAngle=function(e){var t=Km(e,2*Math.PI),n=d.phi;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);var r=Math.abs(t-n);2*Math.PI-r<r&&(t<n?t+=2*Math.PI:n+=2*Math.PI),f.phi=t-n,i.update()},a.setAzimuthalAngle=function(e){var t=Km(e,2*Math.PI),n=d.theta;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);var r=Math.abs(t-n);2*Math.PI-r<r&&(t<n?t+=2*Math.PI:n+=2*Math.PI),f.theta=t-n,i.update()},a.getDistance=function(){return i.object.position.distanceTo(i.target)},a.listenToKeyEvents=function(e){e.addEventListener("keydown",ee),a._domElementKeyEvents=e},a.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object instanceof co?i.object.zoom:1},a.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object instanceof co&&(i.object.zoom=i.zoom0,i.object.updateProjectionMatrix()),i.dispatchEvent(o),i.update(),c=l.NONE},a.update=function(){var t=new Gr,n=(new Vr).setFromUnitVectors(e.up,new Gr(0,1,0)),r=n.clone().invert(),a=new Gr,s=new Vr,u=2*Math.PI;return function(){var e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(n),d.setFromVector3(t),i.autoRotate&&c===l.NONE&&N(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(d.theta+=f.theta*i.dampingFactor,d.phi+=f.phi*i.dampingFactor):(d.theta+=f.theta,d.phi+=f.phi);var g=i.minAzimuthAngle,y=i.maxAzimuthAngle;return isFinite(g)&&isFinite(y)&&(g<-Math.PI?g+=u:g>Math.PI&&(g-=u),y<-Math.PI?y+=u:y>Math.PI&&(y-=u),d.theta=g<=y?Math.max(g,Math.min(y,d.theta)):d.theta>(g+y)/2?Math.max(g,d.theta):Math.min(y,d.theta)),d.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=p,d.radius=Math.max(i.minDistance,Math.min(i.maxDistance,d.radius)),!0===i.enableDamping?i.target.addScaledVector(v,i.dampingFactor):i.target.add(v),t.setFromSpherical(d),t.applyQuaternion(r),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(f.theta*=1-i.dampingFactor,f.phi*=1-i.dampingFactor,v.multiplyScalar(1-i.dampingFactor)):(f.set(0,0,0),v.set(0,0,0)),p=1,!!(m||a.distanceToSquared(i.object.position)>h||8*(1-s.dot(i.object.quaternion))>h)&&(i.dispatchEvent(o),a.copy(i.object.position),s.copy(i.object.quaternion),m=!1,!0)}}(),a.connect=function(e){e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),i.domElement=e,i.domElement.style.touchAction="none",i.domElement.addEventListener("contextmenu",te),i.domElement.addEventListener("pointerdown",Y),i.domElement.addEventListener("pointercancel",Q),i.domElement.addEventListener("wheel",$)},a.dispose=function(){var e,t,n,r,a,o;null===(e=i.domElement)||void 0===e||e.removeEventListener("contextmenu",te),null===(t=i.domElement)||void 0===t||t.removeEventListener("pointerdown",Y),null===(n=i.domElement)||void 0===n||n.removeEventListener("pointercancel",Q),null===(r=i.domElement)||void 0===r||r.removeEventListener("wheel",$),null===(a=i.domElement)||void 0===a||a.ownerDocument.removeEventListener("pointermove",Z),null===(o=i.domElement)||void 0===o||o.ownerDocument.removeEventListener("pointerup",J),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",ee)};var i=A(a),o={type:"change"},s={type:"start"},u={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},c=l.NONE,h=1e-6,d=new Yf,f=new Yf,p=1,v=new Gr,m=!1,g=new fr,y=new fr,b=new fr,x=new fr,w=new fr,S=new fr,_=new fr,T=new fr,M=new fr,C=[],I={};function R(){return Math.pow(.95,i.zoomSpeed)}function N(e){i.reverseOrbit?f.theta+=e:f.theta-=e}function L(e){i.reverseOrbit?f.phi+=e:f.phi-=e}var P=function(){var e=new Gr;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),v.add(e)}}(),D=function(){var e=new Gr;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),v.add(e)}}(),F=function(){var e=new Gr;return function(t,n){var r=i.domElement;if(r&&i.object instanceof co&&i.object.isPerspectiveCamera){var a=i.object.position;e.copy(a).sub(i.target);var o=e.length();o*=Math.tan(i.object.fov/2*Math.PI/180),P(2*t*o/r.clientHeight,i.object.matrix),D(2*n*o/r.clientHeight,i.object.matrix)}else r&&i.object instanceof Fo&&i.object.isOrthographicCamera?(P(t*(i.object.right-i.object.left)/i.object.zoom/r.clientWidth,i.object.matrix),D(n*(i.object.top-i.object.bottom)/i.object.zoom/r.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function U(e){i.object instanceof co&&i.object.isPerspectiveCamera?p/=e:i.object instanceof Fo&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function B(e){i.object instanceof co&&i.object.isPerspectiveCamera?p*=e:i.object instanceof Fo&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function W(e){g.set(e.clientX,e.clientY)}function V(e){x.set(e.clientX,e.clientY)}function G(){if(1==C.length)g.set(C[0].pageX,C[0].pageY);else{var e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);g.set(e,t)}}function H(){if(1==C.length)x.set(C[0].pageX,C[0].pageY);else{var e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);x.set(e,t)}}function j(){var e=C[0].pageX-C[1].pageX,t=C[0].pageY-C[1].pageY,n=Math.sqrt(e*e+t*t);_.set(0,n)}function X(e){if(1==C.length)y.set(e.pageX,e.pageY);else{var t=ae(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);y.set(n,r)}b.subVectors(y,g).multiplyScalar(i.rotateSpeed);var a=i.domElement;a&&(N(2*Math.PI*b.x/a.clientHeight),L(2*Math.PI*b.y/a.clientHeight)),g.copy(y)}function q(e){if(1==C.length)w.set(e.pageX,e.pageY);else{var t=ae(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);w.set(n,r)}S.subVectors(w,x).multiplyScalar(i.panSpeed),F(S.x,S.y),x.copy(w)}function K(e){var t=ae(e),n=e.pageX-t.x,r=e.pageY-t.y,a=Math.sqrt(n*n+r*r);T.set(0,a),M.set(0,Math.pow(T.y/_.y,i.zoomSpeed)),U(M.y),_.copy(T)}function Y(e){if(!1!==i.enabled){var t,n;if(0===C.length)null===(t=i.domElement)||void 0===t||t.ownerDocument.addEventListener("pointermove",Z),null===(n=i.domElement)||void 0===n||n.ownerDocument.addEventListener("pointerup",J);!function(e){C.push(e)}(e),"touch"===e.pointerType?function(e){switch(re(e),C.length){case 1:switch(i.touches.ONE){case z.ROTATE:if(!1===i.enableRotate)return;G(),c=l.TOUCH_ROTATE;break;case z.PAN:if(!1===i.enablePan)return;H(),c=l.TOUCH_PAN;break;default:c=l.NONE}break;case 2:switch(i.touches.TWO){case z.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&j(),i.enablePan&&H(),c=l.TOUCH_DOLLY_PAN;break;case z.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&j(),i.enableRotate&&G(),c=l.TOUCH_DOLLY_ROTATE;break;default:c=l.NONE}break;default:c=l.NONE}c!==l.NONE&&i.dispatchEvent(s)}(e):function(e){var t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case O.DOLLY:if(!1===i.enableZoom)return;!function(e){_.set(e.clientX,e.clientY)}(e),c=l.DOLLY;break;case O.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;V(e),c=l.PAN}else{if(!1===i.enableRotate)return;W(e),c=l.ROTATE}break;case O.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;W(e),c=l.ROTATE}else{if(!1===i.enablePan)return;V(e),c=l.PAN}break;default:c=l.NONE}c!==l.NONE&&i.dispatchEvent(s)}(e)}}function Z(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(re(e),c){case l.TOUCH_ROTATE:if(!1===i.enableRotate)return;X(e),i.update();break;case l.TOUCH_PAN:if(!1===i.enablePan)return;q(e),i.update();break;case l.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&K(e),i.enablePan&&q(e)}(e),i.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&K(e),i.enableRotate&&X(e)}(e),i.update();break;default:c=l.NONE}}(e):function(e){if(!1===i.enabled)return;switch(c){case l.ROTATE:if(!1===i.enableRotate)return;!function(e){y.set(e.clientX,e.clientY),b.subVectors(y,g).multiplyScalar(i.rotateSpeed);var t=i.domElement;t&&(N(2*Math.PI*b.x/t.clientHeight),L(2*Math.PI*b.y/t.clientHeight)),g.copy(y),i.update()}(e);break;case l.DOLLY:if(!1===i.enableZoom)return;!function(e){T.set(e.clientX,e.clientY),M.subVectors(T,_),M.y>0?U(R()):M.y<0&&B(R()),_.copy(T),i.update()}(e);break;case l.PAN:if(!1===i.enablePan)return;!function(e){w.set(e.clientX,e.clientY),S.subVectors(w,x).multiplyScalar(i.panSpeed),F(S.x,S.y),x.copy(w),i.update()}(e)}}(e))}function J(e){var t,n,r;(ne(e),0===C.length)&&(null===(t=i.domElement)||void 0===t||t.releasePointerCapture(e.pointerId),null===(n=i.domElement)||void 0===n||n.ownerDocument.removeEventListener("pointermove",Z),null===(r=i.domElement)||void 0===r||r.ownerDocument.removeEventListener("pointerup",J));i.dispatchEvent(u),c=l.NONE}function Q(e){ne(e)}function $(e){!1===i.enabled||!1===i.enableZoom||c!==l.NONE&&c!==l.ROTATE||(e.preventDefault(),i.dispatchEvent(s),function(e){e.deltaY<0?B(R()):e.deltaY>0&&U(R()),i.update()}(e),i.dispatchEvent(u))}function ee(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){var t=!1;switch(e.code){case i.keys.UP:F(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:F(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:F(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:F(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function te(e){!1!==i.enabled&&e.preventDefault()}function ne(e){delete I[e.pointerId];for(var t=0;t<C.length;t++)if(C[t].pointerId==e.pointerId)return void C.splice(t,1)}function re(e){var t=I[e.pointerId];void 0===t&&(t=new fr,I[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ae(e){var t=e.pointerId===C[0].pointerId?C[1]:C[0];return I[t.pointerId]}return void 0!==r&&a.connect(r),a.update(),a}return M(n)}(Qn),Zm=["makeDefault","camera","regress","domElement","enableDamping","onChange","onStart","onEnd"],Jm=i.forwardRef((function(e,t){var n=e.makeDefault,r=e.camera,a=e.regress,o=e.domElement,s=e.enableDamping,u=void 0===s||s,l=e.onChange,c=e.onStart,h=e.onEnd,d=L(e,Zm),f=am((function(e){return e.invalidate})),p=am((function(e){return e.camera})),v=am((function(e){return e.gl})),m=am((function(e){return e.events})),g=am((function(e){return e.setEvents})),y=am((function(e){return e.set})),b=am((function(e){return e.get})),x=am((function(e){return e.performance})),w=r||p,k=o||m.connected||v.domElement,S=i.useMemo((function(){return new Ym(w)}),[w]);return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=rm(),r=n.getState().internal.subscribe,a=kv(e);wv((function(){return r(a,t,n)}),[t,r,n])}((function(){S.enabled&&S.update()}),-1),i.useEffect((function(){return S.connect(k),function(){S.dispose()}}),[k,a,S,f]),i.useEffect((function(){var e=function(e){f(),a&&x.regress(),l&&l(e)},t=function(e){c&&c(e)},n=function(e){h&&h(e)};return S.addEventListener("change",e),S.addEventListener("start",t),S.addEventListener("end",n),function(){S.removeEventListener("start",t),S.removeEventListener("end",n),S.removeEventListener("change",e)}}),[l,c,h,S,f,g]),i.useEffect((function(){if(n){var e=b().controls;return y({controls:S}),function(){return y({controls:e})}}}),[n,S]),i.createElement("primitive",bm({ref:t,object:S,enableDamping:u},d))})),Qm=function(){function e(t,n){E(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return M(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),$m=function(){function e(){E(this,e)}return M(e,[{key:"refCount",value:function(e){return eg("refCount")}},{key:"incRef",value:function(e){return eg("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return eg("time")}},{key:"read",value:function(e){return eg("read")}},{key:"readSync",value:function(e){return eg("readSync")}},{key:"readToGPU",value:function(e,t){return eg("readToGPU")}},{key:"numDataIds",value:function(){return eg("numDataIds")}},{key:"disposeData",value:function(e,t){return eg("disposeData")}},{key:"write",value:function(e,t,n){return eg("write")}},{key:"move",value:function(e,t,n,r,a){return eg("move")}},{key:"createTensorFromGPUData",value:function(e,t,n){return eg("createTensorFromGPUData")}},{key:"memory",value:function(){return eg("memory")}},{key:"floatPrecision",value:function(){return eg("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return eg("dispose")}}]),e}();function eg(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function tg(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,ag(e,--t,n)}function ng(e,t,n){return Math.max(e,Math.min(t,n))}function rg(e){return e%2===0?e:e+1}function ag(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function ig(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function og(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function sg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";og(cg(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function ug(e){og(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function lg(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function cg(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function hg(e){return e%1===0}function dg(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function fg(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function pg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((function(a,i){var o=0;!function s(){if(e())a();else{o++;var u=t(o);null!=n&&o>=n?i():null!=r?r(s,u):setTimeout(s,u)}}()}))}function vg(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function mg(e,t){var n=t.length;return e=null==e?t.map((function(e,t){return t})):[].concat(e),og(e.every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),og(e.every((function(e){return hg(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function gg(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:mg(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function yg(e,t){return bg(e,t)}function bg(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function xg(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function wg(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function kg(e){return"string"===typeof e||e instanceof String}function Sg(e){return"number"===typeof e}function _g(e){return Array.isArray(e)?_g(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Sg(e)?"float32":kg(e)?"string":"boolean"===typeof e?"bool":"float32"}function Eg(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Tg(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function Mg(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Cg(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),l=u.reduce((function(e,t){return e*t}))*(r?2:1),c=0;c<s;c++)a[c]=Cg(e+c*l,u,n,r);return a}function Ig(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return Cg(0,e,t,n)}function Ag(e,t){for(var n=Rg(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Rg(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Ng(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return Ig(e,new Float32Array(n));if("int32"===t)return Ig(e,new Int32Array(n));if("bool"===t)return Ig(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function Lg(e){e.forEach((function(t){og(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function Pg(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Dg(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Fg(e){return e&&e.then&&"function"===typeof e.then}var Og="tfjsflags",zg=function(){function e(t){E(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Ug,this.populateURLFlags()}return M(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(Bg().getBool("IS_TEST")||Bg().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];Bg().getBool("IS_TEST")||Bg().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Fg(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getString",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);if(Og in t)t[Og].split(",").forEach((function(t){var n=x(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){var n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,a)}))}}}]),e}();function Ug(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}function Bg(){return Vg}var Wg,Vg=null;function Gg(){if(null==Wg){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}Wg=e}return Wg}function Hg(e,t){var n=function(){var e=Gg();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var jg="Abs",Xg="Acos",qg="Acosh",Kg="Add",Yg="AddN",Zg="All",Jg="Any",Qg="ArgMax",$g="ArgMin",ey="Asin",ty="Asinh",ny="Atan",ry="Atanh",ay="Atan2",iy="AvgPool",oy="AvgPoolGrad",sy="AvgPool3D",uy="AvgPool3DGrad",ly="BatchMatMul",cy="BatchToSpaceND",hy="Bincount",dy="BitwiseAnd",fy="BroadcastArgs",py="Cast",vy="Ceil",my="ClipByValue",gy="Complex",yy="ComplexAbs",by="Concat",xy="Conv2D",wy="Conv2DBackpropFilter",ky="Conv2DBackpropInput",Sy="Conv3D",_y="Conv3DBackpropFilterV2",Ey="Conv3DBackpropInputV2",Ty="Cos",My="Cosh",Cy="Cumprod",Iy="Cumsum",Ay="CropAndResize",Ry="DenseBincount",Ny="DepthToSpace",Ly="DepthwiseConv2dNative",Py="DepthwiseConv2dNativeBackpropFilter",Dy="DepthwiseConv2dNativeBackpropInput",Fy="Diag",Oy="Dilation2D",zy="Dilation2DBackpropInput",Uy="Dilation2DBackpropFilter",By="RealDiv",Wy="Einsum",Vy="Elu",Gy="EluGrad",Hy="Erf",jy="Equal",Xy="Exp",qy="ExpandDims",Ky="Expm1",Yy="FFT",Zy="Fill",Jy="FlipLeftRight",Qy="Floor",$y="FloorDiv",eb="FusedBatchNorm",tb="GatherV2",nb="GatherNd",rb="Greater",ab="GreaterEqual",ib="Identity",ob="IFFT",sb="Imag",ub="IsFinite",lb="IsInf",cb="IsNan",hb="LeakyRelu",db="Less",fb="LessEqual",pb="LinSpace",vb="Log",mb="Log1p",gb="LogicalAnd",yb="LogicalNot",bb="LogicalOr",xb="LRN",wb="LRNGrad",kb="Max",Sb="Maximum",_b="MaxPool",Eb="MaxPoolGrad",Tb="MaxPool3D",Mb="MaxPool3DGrad",Cb="MaxPoolWithArgmax",Ib="Mean",Ab="Min",Rb="Minimum",Nb="MirrorPad",Lb="Mod",Pb="Multinomial",Db="Multiply",Fb="Neg",Ob="NotEqual",zb="NonMaxSuppressionV3",Ub="NonMaxSuppressionV4",Bb="NonMaxSuppressionV5",Wb="OnesLike",Vb="OneHot",Gb="Pack",Hb="PadV2",jb="Pow",Xb="Prelu",qb="Prod",Kb="RaggedGather",Yb="RaggedRange",Zb="RaggedTensorToTensor",Jb="Range",Qb="Real",$b="Reciprocal",ex="Relu",tx="Reshape",nx="ResizeNearestNeighbor",rx="ResizeNearestNeighborGrad",ax="ResizeBilinear",ix="ResizeBilinearGrad",ox="Relu6",sx="Reverse",ux="Round",lx="Rsqrt",cx="ScatterNd",hx="TensorScatterUpdate",dx="SearchSorted",fx="Select",px="Selu",vx="Slice",mx="Sin",gx="Sinh",yx="Sign",bx="Sigmoid",xx="Softplus",wx="Sqrt",kx="Sum",Sx="SpaceToBatchND",_x="SplitV",Ex="Softmax",Tx="SparseFillEmptyRows",Mx="SparseReshape",Cx="SparseSegmentMean",Ix="SparseSegmentSum",Ax="SparseToDense",Rx="SquaredDifference",Nx="Square",Lx="StaticRegexReplace",Px="StridedSlice",Dx="StringNGrams",Fx="StringSplit",Ox="StringToHashBucketFast",zx="Sub",Ux="Tan",Bx="Tanh",Wx="Tile",Vx="TopK",Gx="Transform",Hx="Transpose",jx="Unique",Xx="Unpack",qx="UnsortedSegmentSum",Kx="ZerosLike",Yx="Step",Zx="RotateWithOffset",Jx="_FusedMatMul",Qx="FusedConv2D",$x="FusedDepthwiseConv2D";function ew(){var e;Bg().getBool("IS_TEST")||Bg().getBool("PROD")||(e=console).warn.apply(e,arguments)}var tw=Hg("kernelRegistry",(function(){return new Map})),nw=Hg("gradRegistry",(function(){return new Map}));function rw(e,t){var n=uw(e,t);return tw.get(n)}function aw(e){return nw.get(e)}function iw(e){for(var t=tw.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=x(i,2),s=o[0],u=o[1];x(s.split("_"),1)[0]===e&&n.push(u)}return n}function ow(e){var t=e.kernelName,n=e.backendName,r=uw(t,n);tw.has(r)&&ew("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),tw.set(r,e)}function sw(e){var t=e.kernelName;nw.has(t)&&Bg().getBool("DEBUG")&&ew("Overriding the gradient for '".concat(t,"'")),nw.set(t,e)}function uw(e,t){return"".concat(t,"_").concat(e)}function lw(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var cw=n(987),hw=n.n(cw)()||cw;function dw(e){return hw.fromString(e,!0,16)}var fw=dw("c3a5c85c97cb3127"),pw=dw("b492b66fbe98f273"),vw=dw("9ae16a3b2f90404f");function mw(e){return e.xor(e.shru(47))}function gw(e,t,n){var r=e.slice(t,t+n);return hw.fromBytes(Array.from(r),!0,!0)}function yw(e,t){return gw(e,t,8)}function bw(e,t){return gw(e,t,4)}function xw(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function ww(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:dw("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function kw(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=xw(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(xw(a,44)),[a.add(r),i.add(o)]}(yw(e,t),yw(e,t+8),yw(e,t+16),yw(e,t+24),n,r)}function Sw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=hw.fromNumber(81,!0);if(t<=32)return t<=16?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=vw.add(2*t),r=yw(e,0).add(vw),a=yw(e,t-8);return ww(xw(a,37).mul(n).add(r),xw(r,25).add(a).mul(n),n)}if(t>=4){var i=vw.add(2*t);return ww(bw(e,0).shl(3).add(t),bw(e,t-4),i)}if(t>0){var o=e[0]+(e[t>>1]<<8),s=t+(e[t-1]<<2);return mw(vw.mul(o).xor(fw.mul(s))).mul(vw)}return vw}(e,t):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=vw.add(2*t),r=yw(e,0).mul(pw),a=yw(e,8),i=yw(e,t-8).mul(n),o=yw(e,t-16).mul(vw);return ww(xw(r.add(a),43).add(xw(i,30)).add(o),r.add(xw(a.add(vw),18)).add(i),n)}(e,t);if(t<=64)return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=vw.add(2*t),r=yw(e,0).mul(vw),a=yw(e,8),i=yw(e,t-8).mul(n),o=yw(e,t-16).mul(vw),s=xw(r.add(a),43).add(xw(i,30)).add(o),u=ww(s,r.add(xw(a.add(vw),18)).add(i),n),l=yw(e,16).mul(n),c=yw(e,24),h=s.add(yw(e,t-32)).mul(n),d=u.add(yw(e,t-24)).mul(n);return ww(xw(l.add(c),43).add(xw(h,30)).add(d),l.add(xw(c.add(r),18)).add(h),n)}(e,t);var r=n,a=n.mul(pw).add(113),i=mw(a.mul(vw).add(113)).mul(vw),o=[hw.UZERO,hw.UZERO],s=[hw.UZERO,hw.UZERO];r=r.mul(vw).add(yw(e,0));var u=0,l=64*(t-1>>6),c=l+(t-1&63)-63;do{r=xw(r.add(a).add(o[0]).add(yw(e,u+8)),37).mul(pw),a=xw(a.add(o[1]).add(yw(e,u+48)),42).mul(pw),r=r.xor(s[1]),a=a.add(o[0]).add(yw(e,u+40)),i=xw(i.add(s[0]),33).mul(pw),o=kw(e,u,o[1].mul(pw),r.add(s[0])),s=kw(e,u+32,i.add(s[1]),a.add(yw(e,u+16)));var h=[r,i];i=h[0],r=h[1],u+=64}while(u!==l);var d=pw.add(i.and(255).shl(1));u=c,s[0]=s[0].add(t-1&63),o[0]=o[0].add(s[0]),s[0]=s[0].add(o[0]),r=xw(r.add(a).add(o[0]).add(yw(e,u+8)),37).mul(d),a=xw(a.add(o[1]).add(yw(e,u+48)),42).mul(d),r=r.xor(s[1].mul(9)),a=a.add(o[0].mul(9).add(yw(e,u+40))),i=xw(i.add(s[0]),33).mul(d),o=kw(e,u,o[1].mul(d),r.add(s[0])),s=kw(e,u+32,i.add(s[1]),a.add(yw(e,u+16)));var f=[r,i];return i=f[0],r=f[1],ww(ww(o[0],s[0],d).add(mw(a).mul(fw)).add(i),ww(o[1],s[1],d).add(r),d)}function _w(e,t){return"string"===t?Mw(e):Ew([e],t)}function Ew(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Aw(e)),Bg().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function Tw(){return Bg().platform.now()}function Mw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Bg().platform.encode(e,t)}function Cw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Bg().platform.decode(e,t)}function Iw(e){return null!=Bg().platform.isTypedArray?Bg().platform.isTypedArray(e):lw(e)}function Aw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"===typeof e||"number"===typeof e||"string"===typeof e||Fg(e)||null==e||Iw(e)&&n)t.push(e);else if(Array.isArray(e)||Iw(e))for(var r=0;r<e.length;++r)Aw(e[r],t,n);else{for(var a=-1,i=0,o=Object.keys(e);i<o.length;i++){var s=o[i];/^([1-9]+[0-9]*|0)$/.test(s)&&(a=Math.max(a,Number(s)))}for(var u=0;u<=a;u++)Aw(e[u],t,n)}return t}var Rw=function(){function e(t,n){E(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new Nw)}return M(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=Tw();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=N(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(h){u.e(h)}finally{u.f()}a=Promise.resolve({kernelMs:Tw()-o})}if(Bg().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var l=function(){var t=r[c];t.data().then((function(n){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(n,t.dtype,e)}))},c=0;c<r.length;c++)l();return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var Nw=function(){function e(){E(this,e)}return M(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?fg("".concat(r,"ms"),9):r.error,s=fg(e,25),u=t.rank,l=t.size,c=fg(t.shape.toString(),14),h="";for(var d in a){var f=a[d];if(null!=f){var p=f.shape||t.shape,v=p.length;h+="".concat(d,": ").concat(v,"D ").concat(v>0?p:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(c,"\t%c").concat(l,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();var Lw=20,Pw=3,Dw=7;function Fw(e,t,n,r){var a=Mg(t),i=function(e,t,n,r){var a=lg(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?Bw(e):e;if(s>1)for(var l=0;l<a/i;l++)for(var c=l*i,h=0;h<i;h++)o[h]=Math.max(o[h],Ow(u[c+h],0,n).length);return o}(e,t,n,a),o=t.length,s=Uw(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function Ow(e,t,n){return fg(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(Dw))," + ")+"".concat(parseFloat(e[1].toFixed(Dw)),"j"):kg(e)?"'".concat(e,"'"):"bool"===n?zw(e):parseFloat(e.toFixed(Dw)).toString(),t)}function zw(e){return 0===e?"false":"true"}function Uw(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[Ow(Bw(e)[0],0,n)]:"bool"===n?[zw(e[0])]:[e[0].toString()];if(1===u){if(s>Lw){var l=Pw*o,c=Array.from(e.slice(0,l)),h=Array.from(e.slice((s-Pw)*o,s*o));return"complex64"===n&&(c=Bw(c),h=Bw(h)),["["+c.map((function(e,t){return Ow(e,a[t],n)})).join(", ")+", ..., "+h.map((function(e,t){return Ow(e,a[s-Pw+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?Bw(e):Array.from(e)).map((function(e,t){return Ow(e,a[t],n)})).join(", ")+"]"]}var d=t.slice(1),f=r.slice(1),p=r[0]*o,v=[];if(s>Lw){for(var m=0;m<Pw;m++){var y=m*p,b=y+p;v.push.apply(v,g(Uw(e.slice(y,b),d,n,f,a,!1)))}v.push("...");for(var x=s-Pw;x<s;x++){var w=x*p,k=w+p;v.push.apply(v,g(Uw(e.slice(w,k),d,n,f,a,x===s-1)))}}else for(var S=0;S<s;S++){var _=S*p,E=_+p;v.push.apply(v,g(Uw(e.slice(_,E),d,n,f,a,S===s-1)))}var T=2===u?",":"";v[0]="["+(s>0?v[0]+T:"");for(var M=1;M<v.length-1;M++)v[M]=" "+v[M]+T;for(var C=",\n",I=2;I<u;I++)C+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(i?"":C),v}function Bw(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Ww=function(){function e(t,n,r){var a=this;if(E(this,e),this.dtype=n,this.shape=t.slice(),this.size=lg(t),null!=r){var i=r.length;og(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||bg(n,this.size),this.strides=Mg(t)}return M(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),og(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],l=0;l<t.length-1;++l)u+=this.strides[l]*t[l];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return Vw().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),Vw=null,Gw=null;var Hw=function(){function e(t,n,r,a){E(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=lg(t),this.strides=Mg(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return M(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Gw.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return Gw.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Ig(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return Ig(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=c(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=Vw().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return Cw(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),Vw().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=Vw().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return Cw(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,Vw().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(Vw().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Gw.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),Gw.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Fw(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),Gw.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),Vw().makeVariable(this,e,t,n)}}]),e}();function jw(){return Hg("Tensor",(function(){return Hw}))}Object.defineProperty(Hw,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),jw();var Xw,qw,Kw,Yw,Zw,Jw=function(e){C(n,e);var t=R(n);function n(e,r,a,i){var o;return E(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return M(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!cg(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));Vw().disposeTensor(this),this.dataId=e.dataId,Vw().incRef(this,null)}},{key:"dispose",value:function(){Vw().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(Hw);Object.defineProperty(Jw,Symbol.hasInstance,{value:function(e){return e instanceof Hw&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Xw||(Xw={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(qw||(qw={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Kw||(Kw={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Yw||(Yw={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Zw||(Zw={}));var Qw={float32:Yw,int32:qw,bool:Kw,complex64:Zw};function $w(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Qw[e][t]}function ek(e){return $w(e,"int32")}function tk(e){return null!=e&&"object"===typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function nk(e){return"undefined"!==typeof GPUBuffer&&null!=e&&"object"===typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function rk(e,t){if(e.dtype===t.dtype)return[e,t];var n=$w(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function ak(e,t){return t.some((function(t){return t.id===e.id}))}function ik(e){var t=[];return ok(e,t,new Set),t}function ok(e,t,n){if(null!=e)if(e instanceof Hw)t.push(e);else if(r=e,Array.isArray(r)||"object"===typeof r){var r,a=e;for(var i in a){var o=a[i];n.has(o)||(n.add(o),ok(o,t,n))}}}function sk(e){return null!=e.kernelName}var uk=function(){function e(){E(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return M(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),lk=function(){function e(t){E(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new uk}return M(e,[{key:"ready",value:function(){var e=c(u().mark((function e(){var t,n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(ew("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Rw(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;iw(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;iw(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof $m||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,ew("Initialization of backend ".concat(e," failed")),ew(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return ew("Initialization of backend ".concat(e," failed")),ew(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=dk.runKernel(ib,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return dk.runKernel(py,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,!(null!=rw(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var l=sk(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(sk(e)){var c=e.kernelName,h=e.inputs,d=e.attrs;null==this.backendName&&this.backend;var f=rw(c,this.backendName);og(null!=f,(function(){return"Cannot find registered kernel '".concat(c,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=f.kernelFunc({inputs:h,attrs:d,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t);var n=t.map((function(e){return null!=e.rank?e:a.makeTensorFromTensorInfo(e)}));if(o){var s=a.getTensorsForGradient(c,h,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var p=e.forwardFunc,v=function(e){o&&(i=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return p(a.backend,v)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t),t}}var m,g=e.inputs,y=e.attrs,b=sk(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(m=a.profiler.profileKernel(l,g,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(m),t=m.outputs):t=n()})),o&&this.addTapeNode(l,g,t,b,i,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=aw(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(og(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&kg(e[0])&&(a=e.map((function(e){return Mw(e)})));var i=r.write(a,t,n),o=new Hw(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new Hw(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Jw(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*wg(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Jw||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*wg(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=c(u().mark((function e(t){var n,r,a,i,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,g(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=N(this.state.activeProfile.kernels),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=24;break}return o=i.value,e.next=18,o.kernelTimeMs;case 18:return o.kernelTimeMs=e.sent,e.next=21,o.extraInfo;case 21:o.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),a.e(e.t0);case 29:return e.prev=29,a.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=aw(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Rg(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=ik(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(og(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));og(i instanceof Hw,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var l in u){for(var c=u[l],h=!1,d=0;d<t.length;d++)if(r[c.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var f={};f[n.id]=!0;for(var p={},v=e.length-1;v>=0;v--)for(var m=e[v],g=m.inputs,y=0;y<m.outputs.length;y++)if(f[m.outputs[y].id]){for(var b in g)f[g[b].id]=!0,p[m.id]=!0;break}for(var x=[],w=0;w<e.length;w++){var k=e[w];if(a[k.id]&&p[k.id]){var S={};for(var _ in k.inputs){var E=k.inputs[_];r[E.id]&&(S[_]=E)}var T=Object.assign({},k);T.inputs=S,T.outputs=k.outputs,x.push(T)}}return x}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?function(e){var t=Ag(lg(e),"float32");return dk.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(var a=function(){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(a.kernelName,"."));var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(i.dtype,"'"));var o=a.inputs[t];if(!cg(i.shape,o.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(i.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=r(u,i),u.dispose()}};for(var l in a.inputs)u(l)},i=t.length-1;i>=0;i--)a()}(e,o,(function(e){return r.tidy(e)}),fk);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=N(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return og(Eg(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;og(r.every((function(e){return e instanceof Hw})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};r.forEach((function(e,t){o[t]=e}));return t.runKernelFunc({forwardFunc:function(t,n){return og((i=e.apply(void 0,[].concat(r,[n]))).value instanceof Hw,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),og(Eg(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},backwardsFunc:function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];og(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),og(a.every((function(e){return e instanceof Hw})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o},inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Tw(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=Tw()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new uk,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function ck(){var e=Gg();if(null==e._tfengine){var t=new zg(e);e._tfengine=new lk(t)}return function(e){Vg=e}(e._tfengine.ENV),Vw=function(){return e._tfengine},e._tfengine}lk.nextTensorId=0,lk.nextVariableId=0;var hk,dk=ck();function fk(e,t){var n={a:e,b:t};return dk.runKernel(Kg,n)}function pk(e){if(void 0!==hk)return hk;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function vk(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}var mk=Bg();function gk(e,t){var n=e;if(Iw(e))return"string"===t?[]:[e.length];if(tk(e)){var r=e.channels||"RGBA";return[e.height,e.width*r.length]}if(nk(e))return[e.buffer.size/(null==t?4:wg(t))];if(!Array.isArray(e))return[];for(var a=[];Array.isArray(n)||Iw(n)&&"string"!==t;)a.push(n.length),n=n[0];return Array.isArray(e)&&Bg().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&yk(e,a,[]),a}function yk(e,t,n){if(n=n||[],Array.isArray(e)||Iw(e)){og(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),og(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)yk(e[a],r,n.concat(a))}else og(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function bk(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function xk(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof Hw)return bk(r,e.dtype,t,n),e;var a=_g(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),bk(r,a,t,n),null==e||!Iw(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=gk(e,a);Iw(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?Ew(e,a):Aw(e,[],!0);return dk.makeTensor(s,o,a)}function wk(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map((function(e,a){return xk(e,"".concat(t,"[").concat(a,"]"),n,r)}))}mk.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),mk.registerFlag("IS_BROWSER",(function(){return vk()})),mk.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),mk.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),mk.registerFlag("IS_SAFARI",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)})),mk.registerFlag("PROD",(function(){return!1})),mk.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return mk.getBool("DEBUG")})),mk.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),mk.registerFlag("IS_TEST",(function(){return!1})),mk.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return mk.getBool("DEBUG")})),mk.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),mk.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),mk.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}));function kk(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){dk.startScope(n);try{var e=r.apply(void 0,arguments);return Fg(e)&&console.error("Cannot return a Promise inside of tidy."),dk.endScope(e),e}catch(t){throw dk.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Sk=kk({complex_:function(e,t){var n=xk(e,"real","complex"),r=xk(t,"imag","complex");sg(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:n,imag:r};return dk.runKernel(gy,a)}});function _k(e,t,n,r){if(null==r)r=_g(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(nk(e)||tk(e)){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return dk.backend.createTensorFromGPUData(e,t||n,r)}if(!Iw(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Lg(t);var a=lg(t),i=lg(n);og(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==lg(t.slice(o));og(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return Iw(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Ew(e,r):Aw(e,[],!0),dk.makeTensor(e,t,r)}function Ek(e,t,n){return _k(e,t,gk(e,n),n)}var Tk={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Mk=4;function Ck(e,t){return Ik.apply(this,arguments)}function Ik(){return Ik=c(u().mark((function e(t,n){var r,a,i,o,s,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=u().mark((function e(){var o,l,h,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i[s],"float32"===(l=Array.isArray(t)?t[s].tensor:t[o]).dtype||"int32"===l.dtype||"bool"===l.dtype||"string"===l.dtype||"complex64"===l.dtype){e.next=4;break}throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(l.dtype));case 4:h={name:o,shape:l.shape,dtype:l.dtype},"string"===l.dtype?(d=new Promise(function(){var e=c(u().mark((function e(t){var n,r,a,i,o,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+Mk*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)s=n[o],c=new Uint8Array(new Uint32Array([s.length]).buffer),a.set(c,i),i+=Mk,a.set(s,i),i+=s.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.push(d)):a.push(l.data()),null!=n&&(h.group=n),r.push(h);case 8:case"end":return e.stop()}}),e)})),s=0;case 5:if(!(s<i.length)){e.next=10;break}return e.delegateYield(o(),"t0",7);case 7:++s,e.next=5;break;case 10:return e.next=12,Promise.all(a);case 12:return l=e.sent,e.abrupt("return",{data:Rk(l),specs:r});case 14:case"end":return e.stop()}}),e)}))),Ik.apply(this,arguments)}function Ak(e,t){var n,r,a={},i=0,o=N(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,l=s.dtype,c=s.shape,h=lg(c),d=void 0;if("quantization"in s){var f=s.quantization;if("uint8"===f.dtype||"uint16"===f.dtype){if(!("min"in f)||!("scale"in f))throw new Error("Weight ".concat(s.name," with quantization ").concat(f.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==f.dtype)throw new Error("Weight ".concat(s.name," has unknown ")+"quantization dtype ".concat(f.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==l)throw new Error("Weight ".concat(s.name," is quantized with ").concat(f.dtype," ")+"which only supports weights of type float32 not ".concat(l,"."))}var p=Tk[f.dtype],v=e.slice(i,i+h*p),m="uint8"===f.dtype?new Uint8Array(v):new Uint16Array(v);if("float32"===l)if("uint8"===f.dtype||"uint16"===f.dtype){d=new Float32Array(m.length);for(var g=0;g<m.length;g++){var y=m[g];d[g]=y*f.scale+f.min}}else{if("float16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," ")+"for weight type float32.");void 0===n&&(n=Hk()),d=n(m)}else{if("int32"!==l)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(l));if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," ")+"for weight type int32.");d=new Int32Array(m.length);for(var b=0;b<m.length;b++){var x=m[b];d[b]=Math.round(x*f.scale+f.min)}}i+=h*p}else if("string"===l){var w=lg(s.shape);d=[];for(var k=0;k<w;k++){var S=new Uint32Array(e.slice(i,i+Mk))[0];i+=Mk;var _=new Uint8Array(e.slice(i,i+S));d.push(_),i+=S}}else{var E=Tk[l],T=e.slice(i,i+h*E);if("float32"===l)d=new Float32Array(T);else if("int32"===l)d=new Int32Array(T);else if("bool"===l)d=new Uint8Array(T);else{if("complex64"!==l)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(l));d=new Float32Array(T);for(var M=new Float32Array(d.length/2),C=new Float32Array(d.length/2),I=0;I<M.length;I++)M[I]=d[2*I],C[I]=d[2*I+1];var A=Ek(M,c,"float32"),R=Ek(C,c,"float32");a[u]=Sk(A,R),A.dispose(),R.dispose()}i+=h*E}"complex64"!==l&&(a[u]=Ek(d,c,l))}}catch(L){o.e(L)}finally{o.f()}return a}function Rk(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var Nk="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function Lk(e){return Nk?Buffer.byteLength(e):new Blob([e]).size}function Pk(e){if(Nk)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function Dk(e){if(Nk){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function Fk(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Ok(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function zk(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function Uk(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}function Bk(e,t){return Wk.apply(this,arguments)}function Wk(){return Wk=c(u().mark((function e(t,n){var r,a,i,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.weightsManifest){e.next=7;break}return e.next=3,n(t.weightsManifest);case 3:i=e.sent,o=x(i,2),r=o[0],a=o[1];case 7:return e.abrupt("return",Uk(t,r,a));case 8:case"end":return e.stop()}}),e)}))),Wk.apply(this,arguments)}function Vk(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Lk(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Lk(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function Gk(e){var t,n=[],r=N(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,g(a.weights))}}catch(i){r.e(i)}finally{r.f()}return n}function Hk(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var jk=function(){function e(){E(this,e),this.saveRouters=[],this.loadRouters=[]}return M(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),Xk=function(e){return jk.registerSaveRouter(e)},qk=function(e){return jk.registerLoadRouter(e)},Kk=function(e){return jk.getSaveHandlers(e)},Yk=function(e,t){return jk.getLoadHandlers(e,t)},Zk="tensorflowjs",Jk="models_store",Qk="model_info_store";function $k(){if(!Bg().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function eS(e){var t=e.result;t.createObjectStore(Jk,{keyPath:"modelPath"}),t.createObjectStore(Qk,{keyPath:"modelPath"})}var tS=function(){function e(t){if(E(this,e),this.indexedDB=$k(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return M(e,[{key:"save",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(Zk,1);a.onupgradeneeded=function(){return eS(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(Jk,"readonly"),s=o.objectStore(Jk).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,l,c=Vk(t),h=i.transaction(Qk,"readwrite"),d=h.objectStore(Qk);try{u=d.put({modelPath:n.modelPath,modelArtifactsInfo:c})}catch(f){return r(f)}u.onsuccess=function(){var a,o=(l=i.transaction(Jk,"readwrite")).objectStore(Jk);try{a=o.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c})}catch(f){return r(f)}a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(d=h.objectStore(Qk)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},u.onerror=function(e){return i.close(),r(u.error)},h.oncomplete=function(){null==l?i.close():l.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();tS.URL_SCHEME="indexeddb://";var nS=function(e){return Bg().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(tS.URL_SCHEME)?(t=e.slice(tS.URL_SCHEME.length),new tS(t)):null;var t};jk.registerSaveRouter(nS),jk.registerLoadRouter(nS);var rS=function(){function e(){E(this,e),this.indexedDB=$k()}return M(e,[{key:"listModels",value:function(){var e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(Zk,1);r.onupgradeneeded=function(){return eS(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(Qk,"readonly"),i=a.objectStore(Qk).getAll();i.onsuccess=function(){var t,n={},r=N(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=c(u().mark((function e(t){var n=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(tS.URL_SCHEME)?r.slice(tS.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(Zk,1);a.onupgradeneeded=function(){return eS(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(Qk,"readwrite"),s=o.objectStore(Qk),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction(Jk,"readwrite")).objectStore(Jk).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),aS="/",iS="tensorflowjs_models",oS="info",sS="model_topology",uS="weight_specs",lS="weight_data",cS="model_metadata";function hS(e){return{info:[iS,e,oS].join(aS),topology:[iS,e,sS].join(aS),weightSpecs:[iS,e,uS].join(aS),weightData:[iS,e,lS].join(aS),modelMetadata:[iS,e,cS].join(aS)}}function dS(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function fS(e){var t=e.split(aS);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(aS)}var pS=function(){function e(t){if(E(this,e),!Bg().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=hS(this.modelPath)}return M(e,[{key:"save",value:function(){var e=c(u().mark((function e(t){var n,r,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Vk(t),e.prev=7,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Pk(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,initializerSignature:null!=t.initializerSignature?t.initializerSignature:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),e.abrupt("return",{modelArtifactsInfo:a});case 17:throw e.prev=17,e.t0=e.catch(7),dS(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 21:case"end":return e.stop()}}),e,this,[[7,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=c(u().mark((function e(){var t,n,r,a,i,o,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.initializerSignature&&(n.initializerSignature=o.initializerSignature),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=Dk(s),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();pS.URL_SCHEME="localstorage://";var vS=function(e){return Bg().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(pS.URL_SCHEME)?(t=e.slice(pS.URL_SCHEME.length),new pS(t)):null;var t};jk.registerSaveRouter(vS),jk.registerLoadRouter(vS);var mS=function(){function e(){E(this,e),og(Bg().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),og("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return M(e,[{key:"listModels",value:function(){var e=c(u().mark((function e(){var t,n,r,a,i,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=iS+aS,r=aS+oS,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=fS(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(pS.URL_SCHEME)?a.slice(pS.URL_SCHEME.length):a,n=hS(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),dS(n),e.abrupt("return",r);case 7:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),gS="://",yS=function(){function e(){E(this,e),this.managers={}}return M(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){og(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(gS)&&(t=t.slice(0,t.indexOf(gS))),og(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();og(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function bS(e){if(-1===e.indexOf(gS))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(yS.getSchemes().join(",")));return{scheme:e.split(gS)[0],path:e.split(gS)[1]}}function xS(e,t){return wS.apply(this,arguments)}function wS(){return wS=c(u().mark((function e(t,n){var r,a,i,o,s,l,c,h,d,f,p=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>2&&void 0!==p[2]&&p[2],og(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),og((a=jk.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),og(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"load handlers for source URL ".concat(t,".")})),i=a[0],og((o=jk.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(n,".")})),og(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"save handlers for destination URL ".concat(n,".")})),s=o[0],l=bS(t).scheme,c=bS(t).path,h=l===bS(t).scheme,e.next=15,i.load();case 15:if(d=e.sent,!r||!h){e.next=19;break}return e.next=19,yS.getManager(l).removeModel(c);case 19:return e.next=21,s.save(d);case 21:if(f=e.sent,!r||h){e.next=25;break}return e.next=25,yS.getManager(l).removeModel(c);case 25:return e.abrupt("return",f.modelArtifactsInfo);case 26:case"end":return e.stop()}}),e)}))),wS.apply(this,arguments)}function kS(){return SS.apply(this,arguments)}function SS(){return(SS=c(u().mark((function e(){var t,n,r,a,i,o,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=yS.getSchemes(),n={},r=N(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=13;break}return i=a.value,e.next=9,yS.getManager(i).listModels();case 9:for(s in o=e.sent)n[i+gS+s]=o[s];case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))).apply(this,arguments)}function _S(e){return ES.apply(this,arguments)}function ES(){return(ES=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=bS(t),r=yS.getManager(n.scheme),e.abrupt("return",r.removeModel(n.path));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function TS(e,t){return MS.apply(this,arguments)}function MS(){return(MS=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,e.abrupt("return",xS(t,n,false));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function CS(e,t){return IS.apply(this,arguments)}function IS(){return(IS=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0,e.abrupt("return",xS(t,n,true));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var AS=function(){function e(){E(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return M(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;"undefined"!==typeof window&&Bg().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}},{key:"isTypedArray",value:function(e){return lw(e)}}]),e}();if(Bg().get("IS_BROWSER")){Bg().setPlatform("browser",new AS);try{yS.registerManager(pS.URL_SCHEME,new mS)}catch(R0){}try{yS.registerManager(tS.URL_SCHEME,new rS)}catch(R0){}}var RS,NS=function(){return n(410)};var LS=function(){function e(){E(this,e),this.util=n(628),this.textEncoder=new this.util.TextEncoder}return M(e,[{key:"fetch",value:function(e,t){return null!=Bg().global.fetch?Bg().global.fetch(e,t):(null==RS&&(RS=NS()),RS(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}},{key:"isTypedArray",value:function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}]),e}();function PS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Lg(e),new Ww(e,t,n)}Bg().get("IS_NODE")&&!Bg().get("IS_BROWSER")&&Bg().setPlatform("node",new LS);var DS=kk({cast_:function(e,t){var n=xk(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return dk.runKernel(py,r,a)}});var FS=kk({clone_:function(e){var t={x:xk(e,"x","clone","string_or_numeric")};return dk.runKernel(ib,t)}});ck();var OS={buffer:PS,cast:DS,clone:FS,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};function zS(){return dk}function US(){return dk.memory()}function BS(e,t){return dk.tidy(e,t)}function WS(e){ik(e).forEach((function(e){return e.dispose()}))}function VS(e){return dk.keep(e)}function GS(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return dk.registerBackend(e,t,n)}Gw=OS;var HS=kk({add_:function(e,t){var n=xk(e,"a","add"),r=xk(t,"b","add"),a=x(rk(n,r),2),i={a:n=a[0],b:r=a[1]};return dk.runKernel(Kg,i)}});var jS=kk({floorDiv_:function(e,t){var n=xk(e,"a","floorDiv"),r=xk(t,"b","floorDiv"),a=x(rk(n,r),2),i={a:n=a[0],b:r=a[1]};return dk.runKernel($y,i)}});var XS=kk({div_:function(e,t){var n=xk(e,"a","div"),r=xk(t,"b","div"),a=x(rk(n,r),2);if(n=a[0],r=a[1],"int32"===n.dtype&&"int32"===r.dtype)return jS(n,r);var i={a:n,b:r};return dk.runKernel(By,i,{})}});var qS=kk({mul_:function(e,t){var n=xk(e,"a","mul"),r=xk(t,"b","mul"),a=x(rk(n,r),2),i={a:n=a[0],b:r=a[1]};return dk.runKernel(Db,i)}});var KS=kk({sqrt_:function(e){var t={x:xk(e,"x","sqrt","float32")};return dk.runKernel(wx,t)}});var YS=kk({square_:function(e){var t=xk(e,"x","square");return dk.runKernel("Square",{x:t},{})}});var ZS=kk({zerosLike_:function(e){var t={x:xk(e,"x","zerosLike")};return dk.runKernel(Kx,t)}});function JS(e){return dk.customGrad(e)}function QS(e,t){if((Iw(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Iw(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return _k(e,[],[],t)}var $S=function(){function e(){E(this,e)}return M(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),e_=function(){function e(){E(this,e),this.classNameMap={}}return M(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function t_(e){og(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),og("string"===typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),og(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),e_.register(e)}var n_=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return WS(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return function(e,t){og(Eg(e),(function(){return"The f passed in variableGrads(f) must be a function"})),og(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Jw})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],dk.registeredVariables)t.push(dk.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),og(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."}));var o=dk.gradients(e,t,null,!0),s=o.value,u=o.grads;og(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),og(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(s.rank," tensor")}));var l={};return t.forEach((function(e,t){null!=u[t]&&(l[e.name]=u[t])})),null!=a&&a.forEach((function(e){return l[e.name]=null})),{value:s,grads:l}}(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&WS(this.iterations_)}},{key:"saveIterations",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this.iterations_&&(this.iterations_=0),e.abrupt("return",{name:"iter",tensor:QS(this.iterations_,"int32")});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}($S);Object.defineProperty(n_,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var r_=function(e){C(n,e);var t=R(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return E(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=dk.backend.epsilon()),a}return M(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=dk.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:BS((function(){return ZS(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:BS((function(){return ZS(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;BS((function(){var e=HS(qS(o,t.rho),qS(YS(i),1-t.rho)),n=qS(XS(KS(HS(s,t.epsilon)),KS(HS(o,t.epsilon))),i),r=HS(qS(s,t.rho),qS(YS(n),1-t.rho));o.assign(e),s.assign(r);var u=HS(qS(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(WS(this.accumulatedGrads.map((function(e){return e.variable}))),WS(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(g(this.accumulatedGrads),g(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adadelta"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(n_);function a_(e,t,n){Lg(e);var r={shape:e,value:t,dtype:n=n||_g(t)};return dk.runKernel(Zy,{},r)}var i_=function(e){C(n,e);var t=R(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return E(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return M(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=dk.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:BS((function(){return a_(a.shape,t.initialAccumulatorValue).variable(false)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;BS((function(){var e=HS(o,YS(i));o.assign(e);var n=HS(qS(XS(i,KS(HS(e,dk.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&WS(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"className",get:function(){return"Adagrad"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(n_);var o_=kk({pow_:function(e,t){var n=xk(e,"base","pow"),r=xk(t,"exp","pow"),a=x(rk(n,r),2),i={a:n=a[0],b:r=a[1]};return dk.runKernel(jb,i)}});var s_=kk({sub_:function(e,t){var n=xk(e,"a","sub"),r=xk(t,"b","sub"),a=x(rk(n,r),2),i={a:n=a[0],b:r=a[1]};return dk.runKernel(zx,i)}}),u_=function(e){C(n,e);var t=R(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return E(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],BS((function(){i.accBeta1=QS(r).variable(),i.accBeta2=QS(a).variable()})),null==o&&(i.epsilon=dk.backend.epsilon()),i}return M(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);BS((function(){var r=s_(1,t.accBeta1),a=s_(1,t.accBeta2);n.forEach((function(n,i){var o=dk.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:BS((function(){return ZS(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:BS((function(){return ZS(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,l=t.accumulatedSecondMoment[i].variable,c=HS(qS(u,t.beta1),qS(s,1-t.beta1)),h=HS(qS(l,t.beta2),qS(YS(s),1-t.beta2)),d=XS(c,r),f=XS(h,a);u.assign(c),l.assign(h);var p=HS(qS(XS(d,HS(KS(f),t.epsilon)),-t.learningRate),o);o.assign(p)}})),t.accBeta1.assign(qS(t.accBeta1,t.beta1)),t.accBeta2.assign(qS(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&WS(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&WS(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(g(this.accumulatedFirstMoment),g(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(u().mark((function e(t){var n,r=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,BS((function(){r.accBeta1.assign(o_(r.beta1,r.iterations_+1)),r.accBeta2.assign(o_(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adam"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(n_);var l_=kk({abs_:function(e){var t=xk(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return dk.runKernel(yy,n)}var r={x:t};return dk.runKernel(jg,r)}});function c_(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function h_(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function d_(e,t){for(var n=Math.max(e.length,t.length),r=new Array(n),a=0;a<n;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)r[n-a-1]=o;else if(1===o)r[n-a-1]=i;else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}r[n-a-1]=i}}return r}var f_=kk({maximum_:function(e,t){var n=xk(e,"a","maximum"),r=xk(t,"b","maximum"),a=x(rk(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=DS(n,"int32"),r=DS(r,"int32")),d_(n.shape,r.shape);var i={a:n,b:r};return dk.runKernel(Sb,i)}}),p_=function(e){C(n,e);var t=R(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return E(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],BS((function(){i.iteration=QS(0).variable(),i.accBeta1=QS(r).variable()})),null==o&&(i.epsilon=dk.backend.epsilon()),i}return M(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);BS((function(){var r=s_(1,t.accBeta1),a=XS(-t.learningRate,HS(qS(t.iteration,t.decay),1));n.forEach((function(n,i){var o=dk.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:ZS(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:ZS(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,l=t.accumulatedWeightedInfNorm[i].variable,c=HS(qS(u,t.beta1),qS(s,1-t.beta1)),h=qS(l,t.beta2),d=l_(s),f=f_(h,d);u.assign(c),l.assign(f);var p=HS(qS(XS(a,r),XS(c,HS(f,t.epsilon))),o);o.assign(p)}})),t.iteration.assign(HS(t.iteration,1)),t.accBeta1.assign(qS(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&WS(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&WS(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"className",get:function(){return"Adamax"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(n_),v_=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return M(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=dk.registeredVariables[n];BS((function(){var e=HS(qS(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=VS(QS(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"className",get:function(){return"SGD"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(n_),m_=function(e){C(n,e);var t=R(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return E(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=QS(a.momentum),a}return M(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=dk.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:BS((function(){return ZS(a).variable(false)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&BS((function(){var e,n=HS(qS(t.m,i),o);e=t.useNesterov?HS(qS(t.c,HS(o,qS(n,t.m))),a):HS(qS(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&WS(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"className",get:function(){return"Momentum"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(v_),g_=function(e){C(n,e);var t=R(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(E(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=dk.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return r}return M(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=dk.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:BS((function(){return ZS(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:BS((function(){return ZS(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:BS((function(){return ZS(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;BS((function(){var e=HS(qS(s,t.decay),qS(YS(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=HS(qS(n,t.decay),qS(o,1-t.decay)),l=XS(qS(o,t.learningRate),KS(s_(e,HS(YS(i),t.epsilon)))),c=HS(qS(u,t.momentum),l);s.assign(e),n.assign(i),u.assign(c);var h=s_(a,c);a.assign(h)}else{var d=HS(qS(s,t.decay),qS(YS(o),1-t.decay)),f=HS(qS(u,t.momentum),XS(qS(o,t.learningRate),KS(HS(d,t.epsilon))));s.assign(d),u.assign(f);var p=s_(a,f);a.assign(p)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&WS(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&WS(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&WS(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(g(this.accumulatedMeanSquares),g(this.accumulatedMoments)),this.centered&&t.push.apply(t,g(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"className",get:function(){return"RMSProp"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(n_),y_=[r_,i_,u_,p_,m_,g_,v_];function b_(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var x_=function(){function e(t){if(E(this,e),!Bg().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return M(e,[{key:"save",value:function(){var e=c(u().mark((function e(t){var n,r,a,i,o,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=7;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 7:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=zk(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=15,b_((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 15:if(null==t.weightData){e.next=21;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=21,b_((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 21:return e.abrupt("return",{modelArtifactsInfo:Vk(t)});case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();x_.URL_SCHEME="downloads://";var w_=function(){function e(t){if(E(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return M(e,[{key:"load",value:function(){var e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=Bk(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON "+"from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=N(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,g(o.weights)),a.push.apply(a,g(o.paths))}}catch(R0){i.e(R0)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,Fk(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return Ok(e.name)})),i={},o=N(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=Ok(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(R0){o.e(R0)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(r.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return i}}]),e}();function k_(e){return new w_(e)}jk.registerSaveRouter((function(e){return Bg().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(x_.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new x_(e)}(e.slice(x_.URL_SCHEME.length)):null}));var S_=function(){function e(t){if(E(this,e),this.shards=[],this.previousShardIndex=0,t instanceof Array||(t=[t]),0!==(t=t.map((function(e){return Iw(e)?e.buffer:e}))).length){this.bufferUniformSize=t[0].byteLength;for(var n=0,r=0;r<t.length;r++){var a=t[r];r!==t.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=n+a.byteLength;this.shards.push({buffer:a,start:n,end:i}),n=i}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return M(e,[{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),(t=Math.min(this.byteLength,t))<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));for(var r=new ArrayBuffer(t-e),a=new Uint8Array(r),i=0,o=n;o<this.shards.length;o++){var s=this.shards[o],u=e+i-s.start,l=i,c=Math.min(t,s.end)-s.start,h=new Uint8Array(s.buffer.slice(u,c));if(a.set(h,l),i+=h.length,t<s.end)break}return r}},{key:"findShardForByte",value:function(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;var n=function(e,t){var n=0,r=e.length;for(;n<=r;){var a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}]),e}();function __(e,t,n,r){!function(e){og(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){og(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),og(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),og(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function E_(e,t){return T_.apply(this,arguments)}function T_(){return(T_=c(u().mark((function e(t,n){var r,a,i,o,s,l,c,h,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?Bg().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,__(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,l=s.map((function(e){return e.arrayBuffer()})),c=.5,h=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(l);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,__(l,n.onProgress,c,h);case 26:e.t1=e.sent;case 27:return d=e.t1,e.abrupt("return",d);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M_(e){return C_.apply(this,arguments)}function C_(){return C_=c(u().mark((function e(t){var n,r,a,i,o=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,i=I_((function(e){return E_(e,{requestInit:a})})),e.abrupt("return",i(t,n,r));case 6:case"end":return e.stop()}}),e)}))),C_.apply(this,arguments)}function I_(e){return function(){var t=c(u().mark((function t(n){var r,a,i,o,s,l,c,h,d,f,p,v,m=arguments;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],l=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,u=Tk[r]*lg(e.shape),c=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:u})};null!=a?a.forEach((function(t,n){t===e.name&&(c(),s[n]=!0)})):c(),l.push(e.name),n+=u}))})),s.every((function(e){return e}))){t.next=10;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(l.join(", "),"."));case 10:return h=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),d=[],h.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;d.push(t)}))})),t.next=15,e(d);case 15:return f=t.sent,p={},v=0,h.forEach((function(e){var t=n[e].paths.length,r=new S_(f.slice(v,v+t));o[e].forEach((function(e){var t=Ak(r.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)p[n]=t[n]})),v+=t})),t.abrupt("return",p);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}var A_=function(){function e(t,n){if(E(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(og("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=Bg().platform.fetch,og(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&og(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return M(e,[{key:"save",value:function(){var e=c(u().mark((function e(t){var n,r,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=zk(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=10,this.fetch(this.path,n);case 10:if(!(i=e.sent).ok){e.next=15;break}return e.abrupt("return",{modelArtifactsInfo:Vk(t),responses:[i]});case 15:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=c(u().mark((function e(){var t,n,r,a,i,o=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=20;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 20:return e.abrupt("return",Bk(n,(function(e){return o.loadWeights(e)})));case 21:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=c(u().mark((function e(t){var n,r,a,i,o,s,l,c,h,d,f,p,v,m,y,b;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=R_(n),a=x(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,l=Gk(t),c=[],h=[],d=N(t);try{for(d.s();!(f=d.n()).done;){p=f.value,v=N(p.paths);try{for(v.s();!(m=v.n()).done;)y=m.value,null!=this.weightUrlConverter?h.push(this.weightUrlConverter(y)):c.push(s+y+o)}catch(R0){v.e(R0)}finally{v.f()}}}catch(R0){d.e(R0)}finally{d.f()}if(!this.weightUrlConverter){e.next=17;break}return e.t0=c.push,e.t1=c,e.t2=g,e.next=14,Promise.all(h);case 14:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 17:return e.next=19,E_(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 19:return b=e.sent,e.abrupt("return",[l,Fk(b)]);case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function R_(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function N_(e){return null!=e.match(A_.URL_SCHEME_REGEX)}A_.URL_SCHEME_REGEX=/^https?:\/\//;var L_=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return N_(e)})):N_(e))?P_(e,t):null};function P_(e,t){return new A_(e,t)}function D_(e,t){return P_(e,t)}jk.registerSaveRouter(L_),jk.registerLoadRouter(L_);var F_=function(){function e(t){E(this,e),this.modelArtifacts=t}return M(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),O_=function(){function e(t){E(this,e),this.saveHandler=t}return M(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),z_=M((function e(t){E(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function U_(e,t,n,r){var a=arguments;return new z_(B_.apply(void 0,g(a)))}function B_(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new F_(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new F_({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new F_({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function W_(e){return new O_(e)}function V_(e){return new O_(e)}var G_=-2,H_=-1;function j_(e,t,n){var r=e.shape.length;og(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),og(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var a=function(a){og(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function X_(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function q_(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function K_(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Y_(e,t,n){var r,a,i=e.shape.length;return(r="number"===typeof t?[t].concat(g(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){og(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"===typeof n?[n].concat(g(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(og(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function Z_(e,t,n,r,a,i,o,s,u){var l;if(null==r?(l=new Array(t.length)).fill(1):l=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");for(var c=!1,h={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},d=0;d<h.dims;d++)c&&0!==(1<<d&s)&&h.numAddAxisAfterEllipsis++,1<<d&o&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);var f={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(G_),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(H_),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(h,f);for(var p=!0,v=!0,m=!0,g=[],y=[],b=0;b<e.length;++b){if(0===f.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(f.shrinkAxisMask&1<<b),w=e[b];if(-1!==w){var k=[f.beginMask&1<<b,f.endMask&1<<b],S=[f.strides[b]>0?0:-1,f.strides[b]>0?w:w-1];if(x&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===f.strides[b];var _=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(x){var E=f.begin[b]<0?w+f.begin[b]:f.begin[b];if(f.begin[b]=E,f.end[b]=f.begin[b]+1,E<0||E>=w)throw Error("slice index ".concat(f.begin[b]," of dimension ").concat(b," out of bounds."))}else f.begin[b]=J_(f.begin[b],0,f.strides[b],w,k,S),f.end[b]=J_(f.end[b],1,f.strides[b],w,k,S);var T=1===f.strides[b]&&0===f.begin[b]&&f.end[b]===w;p=p&&T,v=v&&(0===b&&1===f.strides[b]||T)}else p=p&&1===f.strides[b]&&_,v=v&&(0===b&&1===f.strides[b]||_);var M=void 0,C=!1;if(f.beginValid&&f.endValid?(M=f.end[b]-f.begin[b],C=!0):x?(M=1,C=!0):_&&w>=0&&(M=f.strides[b]<0?-w:w,C=!0),C){var I=void 0;I=0===M||M<0!==f.strides[b]<0?0:Math.trunc(M/f.strides[b])+(M%f.strides[b]!==0?1:0),g.push(I)}else g.push(-1)}else g.push(x?1:-1)}for(var A=0;A<f.finalShapeGatherIndices.length;++A){var R=f.finalShapeGatherIndices[A];R>=0?y.push(g[R]):R===G_&&y.push(1)}var N=y.filter((function(e,t){return f.finalShapeGatherIndices[t]!==G_}));return{finalShapeSparse:N,finalShape:y,isIdentity:p,sliceDim0:v,isSimpleSlice:m,begin:f.begin,end:f.end,strides:f.strides}}function J_(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var Q_=kk({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:xk(e,"x","all","bool")},a={axis:t,keepDims:n};return dk.runKernel(Zg,r,a)}});var $_=kk({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:xk(e,"x","any","bool")},a={axis:t,keepDims:n};return dk.runKernel(Jg,r,a)}});var eE=kk({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:xk(e,"x","argMax")},r={axis:t};return dk.runKernel(Qg,n,r)}});function tE(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3];return aE(e,[].concat(g(t),[o]),n,i,r,null,null,pE(a))}function nE(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=x(sE(t),2),l=u[0],c=u[1];if("channelsLast"===s)o=[l,c,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,c,e[1],e[1]]}return aE(e,o,n,r,a,i,!1,s)}function rE(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",l=x(uE(t),3),c=l[0],h=l[1],d=l[2];if("NDHWC"===u)s="channelsLast",o=[c,h,d,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[c,h,d,e[1],e[1]]}return iE(e,o,n,r,a,!1,s,i)}function aE(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,l=-1,c=-1,h=-1;if("channelsLast"===s){var d=x(e,4);u=d[0],l=d[1],c=d[2],h=d[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var f=x(e,4);u=f[0],h=f[1],l=f[2],c=f[3]}var p,v=x(t,4),m=v[0],g=v[1],y=v[3],b=x(sE(n),2),w=b[0],k=b[1],S=x(sE(r),2),_=S[0],E=S[1],T=lE(m,_),M=lE(g,E),C=function(e,t,n,r,a,i,o,s,u){var l,c,h;if("number"===typeof e){l={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var d=function(e,t,n,r,a){null==r&&(r=oE(e,t,n));var i=e[0],o=e[1],s=cE((i-t+2*r)/n+1,a),u=cE((o-t+2*r)/n+1,a);return[s,u]}([t,n],i,r,e,s);c=d[0],h=d[1]}else if("same"===e){c=Math.ceil(t/r),h=Math.ceil(n/a);var f=Math.max(0,(c-1)*r+i-t),p=Math.max(0,(h-1)*a+o-n),v=Math.floor(f/2),m=f-v,g=Math.floor(p/2);l={top:v,bottom:m,left:g,right:p-g,type:"SAME"}}else if("valid"===e)l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],w="channelsLast"===u?e[2][1]:e[3][1];l={top:y,bottom:b,left:x,right:w,type:0===y&&0===b&&0===x&&0===w?"VALID":"EXPLICIT"},c=cE((t-i+y+b)/r+1,s),h=cE((n-o+x+w)/a+1,s)}return{padInfo:l,outHeight:c,outWidth:h}}(a,l,c,w,k,T,M,i,s),I=C.padInfo,A=C.outHeight,R=C.outWidth,N=o?y*h:y;return"channelsFirst"===s?p=[u,N,A,R]:"channelsLast"===s&&(p=[u,A,R,N]),{batchSize:u,dataFormat:s,inHeight:l,inWidth:c,inChannels:h,outHeight:A,outWidth:R,outChannels:N,padInfo:I,strideHeight:w,strideWidth:k,filterHeight:m,filterWidth:g,effectiveFilterHeight:T,effectiveFilterWidth:M,dilationHeight:_,dilationWidth:E,inShape:e,outShape:p,filterShape:t}}function iE(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,l=-1,c=-1,h=-1,d=-1;if("channelsLast"===o){var f=x(e,5);u=f[0],l=f[1],c=f[2],h=f[3],d=f[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var p=x(e,5);u=p[0],d=p[1],l=p[2],c=p[3],h=p[4]}var v,m=x(t,5),g=m[0],y=m[1],b=m[2],w=m[4],k=x(uE(n),3),S=k[0],_=k[1],E=k[2],T=x(uE(r),3),M=T[0],C=T[1],I=T[2],A=lE(g,M),R=lE(y,C),N=lE(b,I),L=function(e,t,n,r,a,i,o,s,u,l,c){var h,d,f,p;"valid"===e&&(e=0);if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,a,i){null==a&&(a=oE(e,t[0],r[0]));for(var o=[0,0,0,n],s=0;s<3;s++)e[s]+2*a>=t[s]&&(o[s]=cE((e[s]-t[s]+2*a)/r[s]+1,i));return o}([t,n,r,1],[s,u,l],1,[a,i,o],e,c);d=v[0],f=v[1],p=v[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));var m=((d=Math.ceil(t/a))-1)*a+s-t,g=((f=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/o))-1)*o+l-r,b=Math.floor(m/2),x=m-b,w=Math.floor(g/2),k=g-w,S=Math.floor(y/2);h={top:w,bottom:k,left:S,right:y-S,front:b,back:x,type:"SAME"}}return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}(a,l,c,h,S,_,E,A,R,N,s),P=L.padInfo,D=L.outDepth,F=L.outHeight,O=L.outWidth,z=i?w*d:w;return"channelsFirst"===o?v=[u,z,D,F,O]:"channelsLast"===o&&(v=[u,D,F,O,z]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:c,inWidth:h,inChannels:d,outDepth:D,outHeight:F,outWidth:O,outChannels:z,padInfo:P,strideDepth:S,strideHeight:_,strideWidth:E,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:A,effectiveFilterHeight:R,effectiveFilterWidth:N,dilationDepth:M,dilationHeight:C,dilationWidth:I,inShape:e,outShape:v,filterShape:t}}function oE(e,t,n){var r=lE(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function sE(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function uE(e){return"number"===typeof e?[e,e,e]:e}function lE(e,t){return t<=1?e:e+(e-1)*(t-1)}function cE(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function hE(e){var t=x(sE(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function dE(e,t){return hE(e)||hE(t)}function fE(e){return sE(e).every((function(e){return e>0}))}function pE(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function vE(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)og(hg(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){og(hg(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}))}))}))}}}var mE=kk({reshape_:function(e,t){var n={x:xk(e,"x","reshape","string_or_numeric")},r={shape:t};return dk.runKernel(tx,n,r)}});var gE=kk({avgPool_:function(e,t,n,r,a){var i=xk(e,"x","avgPool","float32");og(dE(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=mE(i,[1,i.shape[0],i.shape[1],i.shape[2]])),og(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),vE("avgPool",r,a);var u={x:o},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a},c=dk.runKernel(iy,u,l);return c=DS(c,i.dtype),s?mE(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var yE=kk({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=xk(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=mE(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),og(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),og("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),og("number"===typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")})),vE("avgPool3d",r,a);var l={x:s},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},h=dk.runKernel(sy,l,c);return h=DS(h,s.dtype),u?mE(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var bE=kk({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=xk(e,"x","batchNorm"),l=xk(t,"mean","batchNorm"),c=xk(n,"variance","batchNorm");null!=a&&(o=xk(a,"scale","batchNorm")),null!=r&&(s=xk(r,"offset","batchNorm")),og(l.rank===c.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),og(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),og(null==o||l.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h={x:function(e){return 0===e.rank||1===e.rank?mE(e,[1,1,1,e.size]):2===e.rank?mE(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?mE(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),scale:o,offset:s,mean:l,variance:c},d={varianceEpsilon:i},f=dk.runKernel(eb,h,d);return mE(f,u.shape)}});var xE=kk({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=xk(e,"x","batchNorm"),l=xk(t,"mean","batchNorm"),c=xk(n,"variance","batchNorm");return null!=a&&(o=xk(a,"scale","batchNorm")),null!=r&&(s=xk(r,"offset","batchNorm")),og(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(u.rank,".")})),og(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(l.rank,".")})),og(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")})),null!=o&&og(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&og(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(s.rank,".")})),bE(u,l,c,s,o,i)}});var wE=kk({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=xk(e,"x","batchNorm"),l=xk(t,"mean","batchNorm"),c=xk(n,"variance","batchNorm");return null!=a&&(o=xk(a,"scale","batchNorm")),null!=r&&(s=xk(r,"offset","batchNorm")),og(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),og(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(l.rank,".")})),og(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")})),null!=o&&og(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&og(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(s.rank,".")})),bE(u,l,c,s,o,i)}});var kE=kk({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=xk(e,"x","batchNorm"),l=xk(t,"mean","batchNorm"),c=xk(n,"variance","batchNorm");return null!=a&&(o=xk(a,"scale","batchNorm")),null!=r&&(s=xk(r,"offset","batchNorm")),og(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(u.rank,".")})),og(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(l.rank,".")})),og(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")})),null!=o&&og(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&og(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(s.rank,".")})),bE(u,l,c,s,o,i)}});var SE=kk({broadcastTo_:function(e,t){var n=xk(e,"broadcastTo","x"),r=n.shape;if(Lg(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=mE(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return FS(n);var l={x:n},c={reps:o};return dk.runKernel(Wx,l,c)}});var _E=kk({clipByValue_:function(e,t,n){var r=xk(e,"x","clipByValue");if(og(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")})),t===n)return a_(r.shape,t,r.dtype);var a={x:r},i={clipValueMin:t,clipValueMax:n};return dk.runKernel(my,a,i)}});var EE=kk({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;og(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=wk(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return FS(n[0]);var r=n,a={axis:t};return dk.runKernel(by,r,a)}});var TE=kk({concat1d_:function(e){return EE(e,0)}});var ME=kk({concat2d_:function(e,t){return EE(e,t)}});var CE=kk({concat3d_:function(e,t){return EE(e,t)}});var IE=kk({concat4d_:function(e,t){return EE(e,t)}});var AE=kk({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=xk(e,"x","conv2d","float32"),u=xk(t,"filter","conv2d","float32"),l=s,c=!1;3===s.rank&&(c=!0,l=mE(s,[1,s.shape[0],s.shape[1],s.shape[2]])),og(4===l.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),og(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),vE("conv2d",r,o);var h="NHWC"===a?l.shape[3]:l.shape[1];og(h===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(u.shape[2],".")})),og(dE(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),og(fE(i),(function(){return"Error in conv2D: Dilated rates should be larger than 0."})),og(fE(n),(function(){return"Error in conv2D: Strides should be larger than 0."}));var d={x:l,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=dk.runKernel(xy,d,f);return c?mE(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var RE=kk({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=xk(e,"x","conv1d"),u=xk(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=mE(s,[1,s.shape[0],s.shape[1]])),og(3===l.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(l.rank,".")})),og(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")})),vE("conv1d",r,o),og(l.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(l.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")})),og(dE(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")})),og(fE(i),(function(){return"Error in conv1D: Dilated rates should be larger than 0."})),og(fE(n),(function(){return"Error in conv1D: Stride should be larger than 0."})),og("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var h=mE(u,[1,u.shape[0],u.shape[1],u.shape[2]]),d=mE(l,[l.shape[0],1,l.shape[1],l.shape[2]]),f=AE(d,h,[1,n],r,"NHWC",[1,i],o);return mE(f,c?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}});var NE=kk({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;og(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,l=!1;3===t.rank&&(l=!0,u=mE(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),og(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")})),og(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)})),og(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var c="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];og(c===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(c,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),og(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),vE("conv2dDerInput",a,o);var d={dy:u,filter:n},f={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=dk.runKernel(ky,d,f);return l?mE(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var LE=kk({conv2dTranspose_:function(e,t,n,r,a,i){var o=xk(e,"x","conv2dTranspose"),s=xk(t,"filter","conv2dTranspose");return NE(n,o,s,r,a,"NHWC",i)}});var PE=kk({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=xk(e,"x","conv3d"),s=xk(t,"filter","conv3d"),u=o,l=!1;4===o.rank&&(l=!0,u=mE(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),og(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),og(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),og(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),og(dE(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),og("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")})),og(fE(i),(function(){return"Error in conv3D: Dilated rates should be larger than 0."})),og(fE(n),(function(){return"Error in conv3D: Strides should be larger than 0."}));var c={x:u,filter:s},h={strides:n,pad:r,dataFormat:a,dilations:i},d=dk.runKernel(Sy,c,h);return l?mE(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var DE=kk({conv3DBackpropInput_:function(e,t,n,r,a){og(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=mE(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],l=o.shape[4];og(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")})),og(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)})),og(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),og(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),og(l===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(l,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var c={dy:o,filter:n},h={pad:a,strides:r,inputShape:i},d=dk.runKernel(Ey,c,h);return s?mE(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var FE=kk({conv3dTranspose_:function(e,t,n,r,a){var i=xk(e,"x","conv3dTranspose"),o=xk(t,"filter","conv3dTranspose");return DE(n,i,o,r,a)}});var OE=kk({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=xk(e,"x","denseBincount"),i=xk(t,"weights","denseBincount");og("int32"===a.dtype,(function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)})),og(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")})),og(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),og(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return dk.runKernel(Ry,o,s)}});var zE=kk({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=xk(e,"x","depthwiseConv2d","float32"),u=xk(t,"filter","depthwiseConv2d","float32"),l=s,c=!1;3===s.rank&&(c=!0,l=mE(s,[1,s.shape[0],s.shape[1],s.shape[2]])),og(4===l.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")})),og(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}));var h="NHWC"===a?l.shape[3]:l.shape[1];og(h===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(h,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")})),vE("depthwiseConv2d",r,o);var d={x:l,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=dk.runKernel(Ly,d,f);return c?mE(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var UE=kk({elu_:function(e){var t={x:xk(e,"x","elu","float32")};return dk.runKernel(Vy,t)}});var BE=kk({equal_:function(e,t){var n=xk(e,"a","equal","string_or_numeric"),r=xk(t,"b","equal","string_or_numeric"),a=x(rk(n,r),2);n=a[0],r=a[1],d_(n.shape,r.shape);var i={a:n,b:r};return dk.runKernel(jy,i)}});var WE=kk({exp_:function(e){var t={x:xk(e,"x","exp")};return dk.runKernel(Xy,t)}});var VE=kk({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=xk(e,"x","expandDims","string_or_numeric");og(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return dk.runKernel(qy,r,a)}});var GE=kk({tile_:function(e,t){var n=xk(e,"x","tile","string_or_numeric");og(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var r={x:n},a={reps:t};return dk.runKernel(Wx,r,a)}});var HE=kk({eye_:function(e,t,n){null==t&&(t=e);for(var r=PS([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t,i=0;i<a;++i)r.set(1,i,i);var o=mE(r.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return GE(VE(o,0),[n[0],1,1]);if(2===n.length)return GE(VE(VE(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return GE(VE(VE(VE(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});var jE=kk({floor_:function(e){var t={x:xk(e,"x","floor","float32")};return dk.runKernel(Qy,t)}});var XE=kk({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={x:xk(e,"x","gather"),indices:xk(t,"indices","gather","int32")},i={axis:n,batchDims:r};return dk.runKernel(tb,a,i)}});var qE=kk({greater_:function(e,t){var n=xk(e,"a","greater","string_or_numeric"),r=xk(t,"b","greater","string_or_numeric"),a=x(rk(n,r),2);n=a[0],r=a[1],d_(n.shape,r.shape);var i={a:n,b:r};return dk.runKernel(rb,i)}});var KE=kk({greaterEqual_:function(e,t){var n=xk(e,"a","greaterEqual","string_or_numeric"),r=xk(t,"b","greaterEqual","string_or_numeric"),a=x(rk(n,r),2);n=a[0],r=a[1],d_(n.shape,r.shape);var i={a:n,b:r};return dk.runKernel(ab,i)}});var YE=kk({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:xk(e,"x","leakyRelu")},r={alpha:t};return dk.runKernel(hb,n,r)}});var ZE=kk({log_:function(e){var t={x:xk(e,"x","log","float32")};return dk.runKernel(vb,t)}});var JE=kk({log1p_:function(e){var t={x:xk(e,"x","log1p")};return dk.runKernel(mb,t)}});var QE=kk({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:xk(e,"x","max")},a={reductionIndices:t,keepDims:n};return dk.runKernel(kb,r,a)}});var $E=kk({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=xk(e,"x","sum");"bool"===r.dtype&&(r=DS(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return dk.runKernel(kx,a,i)}});var eT=kk({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=xk(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var r=JS((function(e,n){var r=QE(e,t,!0),a=s_(e,r),i=s_(DS(a,"float32"),ZE($E(WE(a),t,!0)));n([i]);return{value:i,gradFunc:function(e,n){var r=x(n,1)[0],a=WE(r);return s_(e,qS($E(e,t,!0),a))}}}));return r(n)}});var tT=kk({logicalAnd_:function(e,t){var n=xk(e,"a","logicalAnd","bool"),r=xk(t,"b","logicalAnd","bool");d_(n.shape,r.shape);var a={a:n,b:r};return dk.runKernel(gb,a)}});var nT=kk({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=xk(e,"a","matMul"),i=xk(t,"b","matMul"),o=x(rk(a,i),2),s={a:a=o[0],b:i=o[1]},u={transposeA:n,transposeB:r};return dk.runKernel(ly,s,u)}});var rT=kk({maxPool_:function(e,t,n,r,a){var i=xk(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=mE(i,[1,i.shape[0],i.shape[1],i.shape[2]])),og(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),og(dE(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),vE("maxPool",r,a);var u={x:o},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a},c=dk.runKernel(_b,u,l);return s?mE(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var aT=kk({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=xk(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=mE(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),og(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),og("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),vE("maxPool3d",r,a);var l={x:s},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},h=dk.runKernel(Tb,l,c);return u?mE(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var iT=kk({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:xk(e,"x","mean")},a={axis:t,keepDims:n};return dk.runKernel(Ib,r,a)}});var oT=kk({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:xk(e,"x","min")},a={axis:t,keepDims:n};return dk.runKernel(Ab,r,a)}});var sT=kk({minimum_:function(e,t){var n=xk(e,"a","minimum"),r=xk(t,"b","minimum"),a=x(rk(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=DS(n,"int32"),r=DS(r,"int32")),d_(n.shape,r.shape);var i={a:n,b:r};return dk.runKernel(Rb,i)}});function uT(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function lT(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function cT(e,t){return function(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}(e,t.map((function(e){return 1})),t)}function hT(e,t,n){og(uT(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function dT(e,t){if(uT(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function fT(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function pT(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var vT=kk({moments_:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=mg(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=xk(e,"x","moments")).shape),r=iT(e,n,t),a=r.shape;t||(a=cT(r.shape,n));var i=YS(s_(DS(e,"float32"),mE(r,a)));return{mean:r,variance:iT(i,n,t)}}});var mT=kk({neg_:function(e){var t={x:xk(e,"x","neg")};return dk.runKernel(Fb,t)}});var gT=kk({notEqual_:function(e,t){var n=xk(e,"a","notEqual","string_or_numeric"),r=xk(t,"b","notEqual","string_or_numeric"),a=x(rk(n,r),2);n=a[0],r=a[1],d_(n.shape,r.shape);var i={a:n,b:r};return dk.runKernel(Ob,i)}});var yT=kk({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var i={indices:xk(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return dk.runKernel(Vb,i,o)}});function bT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(Lg(e),"complex64"===t){var n=bT(e,"float32"),r=bT(e,"float32");return Sk(n,r)}var a=Rg(lg(e),t);return dk.makeTensor(a,e,t)}function xT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(Lg(e),"complex64"===t){var n=xT(e,"float32"),r=bT(e,"float32");return Sk(n,r)}var a=Ag(lg(e),t);return dk.makeTensor(a,e,t)}var wT=kk({onesLike_:function(e){var t={x:xk(e,"x","onesLike")};return dk.runKernel(Wb,t)}});var kT=kk({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=xk(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return dk.runKernel(Hb,i,a)}});var ST=kk({prelu_:function(e,t){var n={x:xk(e,"x","prelu"),alpha:xk(t,"alpha","prelu")};return dk.runKernel(Xb,n)}}),_T=n(699),ET=function(){function e(t,n,r,a,i){E(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=_T.alea(o.toString())}return M(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),TT=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(E(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=_T.alea(i)}return M(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var MT=kk({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(Lg(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new ET(t,n,r,!1,a),o=PS(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var CT=kk({randomUniform_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;Lg(e);for(var i=PS(e,r),o=new TT(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function IT(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return dk.runKernel(Jb,{},a)}var AT=kk({relu_:function(e){var t={x:xk(e,"x","relu")};return dk.runKernel(ex,t)}});var RT=kk({reverse_:function(e,t){var n={x:xk(e,"x","reverse")},r={dims:t};return dk.runKernel(sx,n,r)}});var NT=kk({selu_:function(e){var t={x:xk(e,"x","selu")};return dk.runKernel(px,t)}});var LT=kk({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=xk(e,"x","separableConv2d"),u=xk(t,"depthwiseFilter","separableConv2d"),l=xk(n,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(3===s.rank&&(h=!0,c=mE(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");og(4===c.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")})),og(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),og(4===l.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),og(1===l.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(l.shape[0],".")})),og(1===l.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(l.shape[1],".")}));var d=u.shape[2],f=u.shape[3];og(l.shape[2]===d*f,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(d*f,", ")+"but got ".concat(l.shape[2],".")}));var p=zE(c,u,r,a,o,i),v=AE(p,l,1,"valid",o);return h?mE(v,[v.shape[1],v.shape[2],v.shape[3]]):v}});var PT=kk({sigmoid_:function(e){var t={x:xk(e,"x","sigmoid","float32")};return dk.runKernel(bx,t)}});var DT=kk({slice_:function(e,t,n){var r=xk(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return dk.runKernel(vx,a,i)}});var FT=kk({slice1d_:function(e,t,n){var r=xk(e,"x","slice1d");return og(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),DT(r,[t],[n])}});var OT=kk({slice2d_:function(e,t,n){var r=xk(e,"x","slice2d");return og(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),DT(r,t,n)}});var zT=kk({slice3d_:function(e,t,n){var r=xk(e,"x","slice3d");return og(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),DT(r,t,n)}});var UT=kk({slice4d_:function(e,t,n){var r=xk(e,"x","slice4d");return og(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),DT(r,t,n)}});var BT=kk({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=xk(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return dk.runKernel(Ex,r,a)}});var WT=kk({softplus_:function(e){var t={x:xk(e,"x","softplus")};return dk.runKernel(xx,t)}});var VT=kk({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:xk(e,"x","split")},a={numOrSizeSplits:t,axis:n};return dk.runKernel(_x,r,a)}});var GT=kk({squeeze_:function(e,t){var n=xk(e,"x","squeeze","string_or_numeric");return mE(n,gg(n.shape,t).newShape)}});var HT=kk({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=wk(e,"tensors","stack","string_or_numeric");og(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&og(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return dk.runKernel(Gb,r,a)}});var jT=kk({tanh_:function(e){var t={x:xk(e,"x","tanh","float32")};return dk.runKernel(Bx,t)}});function XT(e,t){ug(e);var n=gk(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return _k(e,null,n,t)}var qT=kk({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(Lg(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new ET(t,n,r,!0,a),o=PS(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var KT=kk({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=xk(e,"x","unstack","string_or_numeric");og(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return dk.runKernel(Xx,r,a)}});var YT=kk({where_:function(e,t,n){var r=xk(t,"a","where"),a=xk(n,"b","where"),i=xk(e,"condition","where","bool"),o=d_(d_(i.shape,r.shape),a.shape),s={condition:SE(i,o),t:SE(r,o),e:SE(a,o)};return dk.runKernel(fx,s)}});var ZT=kk({imag_:function(e){var t={input:xk(e,"input","imag")};return dk.runKernel(sb,t)}});var JT=kk({real_:function(e){var t={input:xk(e,"input","real")};return dk.runKernel(Qb,t)}});var QT=kk({transpose_:function(e,t,n){var r=xk(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),og(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){og(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?BS((function(){var e=JT(r),t=ZT(r);return e=dk.runKernel(Hx,{x:e},i),t=dk.runKernel(Hx,{x:t},i),n&&(t=mT(t)),Sk(e,t)})):dk.runKernel(Hx,a,i)}});var $T=kk({dropout_:function(e,t,n,r){var a=xk(e,"x","dropout");if(og("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")})),og(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof Hw?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(cg(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=XS(jE(HS(CT(i,0,1,"float32",r),o)),o);return qS(a,s)}});var eM=kk({fft_:function(e){og("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return dk.runKernel(Yy,t)}});var tM=kk({rfft_:function(e,t){og("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=DT(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=EE([e,bT(s)],e.shape.length-1),r=t}else n=e;var u=ZS(n),l=mE(Sk(n,u),[a,r]),c=eM(l),h=Math.floor(r/2)+1,d=JT(c),f=ZT(c),p=VT(d,[h,r-h],d.shape.length-1),v=VT(f,[h,r-h],f.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,mE(Sk(p[0],v[0]),m)}});var nM=kk({ifft_:function(e){og("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return dk.runKernel(ob,t)}});var rM=kk({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=mE(e,[r,n]);t=nM(a)}else{var i=[r,2*(n-1)],o=mE(JT(e),[r,n]),s=mE(ZT(e),[r,n]),u=RT(DT(o,[0,1],[r,n-2]),1),l=qS(RT(DT(s,[0,1],[r,n-2]),1),QS(-1)),c=EE([o,u],1),h=EE([s,l],1),d=mE(Sk(c,h),[i[0],i[1]]);t=nM(d)}if(t=JT(t),3===e.rank&&0!==e.shape[0]){var f=t,p=e.shape[0];t=mE(t,[p,t.shape[0]/p,t.shape[1]]),f.dispose()}return t}});var aM=kk({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=mE(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=mE(t,[1,t.shape[0],t.shape[1],t.shape[2]])),og(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")})),og(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")})),og(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var l="NHWC"===i?s.shape[3]:s.shape[1],c="NHWC"===i?u.shape[3]:u.shape[1];og(l===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(l,") must ")+"match input depth in filter (".concat(n[2],".")})),og(c===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(c,") must ")+"match output depth for filter (".concat(n[3],").")})),vE("conv2dDerFilter",a,o);var h={x:s,dy:u},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return dk.runKernel(wy,h,d)}});var iM=kk({relu6_:function(e){var t={x:xk(e,"x","relu6")};return dk.runKernel(ox,t)}});var oM=kk({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:xk(e,"x","step")},r={alpha:t};return dk.runKernel(Yx,n,r)}});function sM(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return qS(e,oM(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function uM(e,t){var n=t,r=h_(e.shape,t.shape);return r.length>0&&(n=$E(n,r)),mE(n,e.shape)}function lM(e,t,n,r){if("linear"===t)return e;if("relu"===t)return AT(e);if("elu"===t)return UE(e);if("relu6"===t)return iM(e);if("prelu"===t)return ST(e,n);if("leakyrelu"===t)return YE(e,r);if("sigmoid"===t)return PT(e);throw new Error("Unknown fused activation ".concat(t,"."))}var cM=function(e,t){return!(e>0)||"linear"===t};var hM=kk({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,h=e.activation,d=void 0===h?"linear":h,f=e.preluActivationWeights,p=e.leakyreluAlpha;if(d=d||"linear",!1===cM(dk.state.gradientDepth,d)){og("NHWC"===o,(function(){return"Error in fused conv2d: got dataFormat of ".concat(o," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."}));var v=AE(t,n,r,a,o,u,l);return null!=c&&(v=HS(v,c)),lM(v,d,f,p)}var m=xk(t,"x","conv2d","float32"),g=xk(n,"filter","conv2d","float32"),y=m,b=!1;3===m.rank&&(b=!0,y=mE(m,[1,m.shape[0],m.shape[1],m.shape[2]])),og(4===y.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(y.rank,".")})),og(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(g.rank,".")})),vE("fused conv2d",a,l);var w="NHWC"===o?y.shape[3]:y.shape[1];og(g.shape[2]===w,(function(){return"Error in conv2d: depth of input (".concat(w,") must match ")+"input depth for filter ".concat(g.shape[2],".")})),og(dE(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(u,"'")}));var k,S,_=aE(y.shape,g.shape,r,u,a,l);if(null!=c){var E=x(rk(k=xk(c,"bias","fused conv2d"),m),1);k=E[0],"NHWC"===o?d_(_.outShape,k.shape):(og(k.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(k.shape.length,".")})),og(0===k.shape.length||k.shape[0]===_.outChannels||1===k.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(k.shape,") is not ")+"compatible with the number of output channels "+"(".concat(_.outChannels,")")})))}if(null!=f){var T=f.shape;if(og(T.length<=1||3===T.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(T.length,".")})),1===T.length)og(1===T[0]||T[0]===_.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(T,") is not compatible with the number of output ")+"channels (".concat(_.outChannels,").")}));else if(3===T.length)try{d_(T,_.outShape)}catch(L){var M="Error in fused conv2d: PReLU activation weights (".concat(T,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(_.outShape,").");throw Error(M)}S=xk(f,"prelu weights","fused conv2d")}var C=function(e,t){og("NHWC"===o,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var n=x(t,4),i=n[0],s=n[1],l=n[2],c=n[3],h=sM(e,l,d);og(hE(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(u,"'")}));var f=[NE(s.shape,h,i,r,a),aM(s,h,i.shape,r,a)];if(null!=c){var p=uM(c,h);f.push(p)}return f},I={x:y,filter:g,bias:k,preluActivationWeights:S},A={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:l,activation:d,leakyreluAlpha:p};if(null==c){var R=JS((function(e,t,n){var r=dk.runKernel(Qx,I,A);return n([t,e,r]),b&&(r=mE(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:C}}));return R(y,g)}var N=JS((function(e,t,n,r){var a=dk.runKernel(Qx,I,A);return r([t,e,a,n]),b&&(a=mE(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:C}}));return N(y,g,k)}});var dM=kk({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=mE(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=mE(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var l={x:s,dy:u},c={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return dk.runKernel(Py,l,c)}});var fM=kk({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=mE(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var l={dy:s,filter:n},c={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},h=dk.runKernel(Dy,l,c);return u?mE(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var pM=kk({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,s=e.bias,u=e.activation,l=void 0===u?"linear":u,c=e.preluActivationWeights,h=e.leakyreluAlpha,d=void 0===h?.2:h;if(!1===cM(dk.state.gradientDepth,l)){var f=nT(t,n,a,o);return null!=s&&(f=HS(f,s)),lM(f,l,c,d)}var p=xk(t,"a","fused matMul"),v=xk(n,"b","fused matMul"),m=x(rk(p,v),2);p=m[0],v=m[1];var g=a?p.shape[p.rank-2]:p.shape[p.rank-1],y=o?v.shape[v.rank-1]:v.shape[v.rank-2],b=a?p.shape[p.rank-1]:p.shape[p.rank-2],w=o?v.shape[v.rank-2]:v.shape[v.rank-1],k=p.shape.slice(0,-2),S=v.shape.slice(0,-2),_=lg(k),E=lg(S);og(g===y,(function(){return"Error in fused matMul: inner shapes (".concat(g,") and (")+"".concat(y,") of Tensors with shapes ").concat(p.shape," and ")+"".concat(v.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match.")}));var T,M,C=d_(p.shape.slice(0,-2),v.shape.slice(0,-2)).concat([b,w]),I=mE(p,a?[_,g,b]:[_,b,g]),A=mE(v,o?[E,w,y]:[E,y,w]);null!=s&&(T=x(rk(T=xk(s,"bias","fused matMul"),p),1)[0],d_(C,T.shape)),null!=c&&(M=xk(c,"prelu weights","fused matMul"));var R=function(e,t){var n,r,i=x(t,4),u=i[0],c=i[1],h=i[2],d=i[3],f=sM(mE(e,h.shape),h,l);return a||o?!a&&o?(n=nT(f,c,!1,!1),r=nT(f,u,!0,!1)):a&&!o?(n=nT(c,f,!1,!0),r=nT(u,f,!1,!1)):(n=nT(c,f,!0,!0),r=nT(f,u,!0,!0)):(n=nT(f,c,!1,!0),r=nT(u,f,!0,!1)),null!=s?[n,r,uM(d,f)]:[n,r]},N={a:I,b:A,bias:T,preluActivationWeights:M},L={transposeA:a,transposeB:o,activation:l,leakyreluAlpha:d};if(null==s){var P=JS((function(e,t,n){var r=dk.runKernel(Jx,N,L);return n([e,t,r]),{value:mE(r,C),gradFunc:R}}));return P(I,A)}var D=JS((function(e,t,n,r){var a=dk.runKernel(Jx,N,L);return r([e,t,a,n]),{value:mE(a,C),gradFunc:R}}));return D(I,A,T)}});function vM(e,t,n){if(ug(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=gk(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return _k(e,t,r,n)}var mM=kk({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=xk(e,"image","cropAndResize"),s=xk(t,"boxes","cropAndResize","float32"),u=xk(n,"boxInd","cropAndResize","int32"),l=s.shape[0];og(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),og(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(l,",4] ")+"but had shape ".concat(s.shape,".")})),og(1===u.rank&&u.shape[0]===l,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(l,"] ")+"but had shape ".concat(s.shape,".")})),og(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),og(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),og("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var c={image:o,boxes:s,boxInd:u},h={method:a,extrapolationValue:i,cropSize:r};return dk.runKernel(Ay,c,h)}});var gM=kk({flipLeftRight_:function(e){var t=xk(e,"image","flipLeftRight","float32");og(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return dk.runKernel(Jy,n,{})}});var yM=kk({grayscaleToRGB_:function(e){var t=xk(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];og(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")})),og(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,GE(t,a)}});var bM=kk({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=xk(e,"image","rotateWithOffset","float32");og(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return dk.runKernel(Zx,i,o)}});function xM(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),og(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),og(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),og(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),og(1===t.rank,(function(){return"scores must be a 1D tensor"})),og(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),og(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var wM=kk({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=xk(e,"boxes","nonMaxSuppression","float32"),o=xk(t,"scores","nonMaxSuppression","float32"),s=xM(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return dk.runKernel(zb,{boxes:i,scores:o},u)}});function kM(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||SM)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function SM(e,t){return e>t?1:e<t?-1:0}function _M(e,t,n,r,a){return MM(e,t,n,r,a,0)}function EM(e,t,n,r,a,i){return MM(e,t,n,r,a,0,!1,i,!0)}function TM(e,t,n,r,a,i){return MM(e,t,n,r,a,i,!0)}function MM(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=[],c=0;c<t.length;c++)t[c]>a&&l.push({score:t[c],boxIndex:c,suppressBeginIndex:0});l.sort(AM);for(var h=i>0?-.5/i:0,d=[],f=[];d.length<n&&l.length>0;){var p=l.pop(),v=p.score,m=p.boxIndex,y=p.suppressBeginIndex;if(v<a)break;for(var b=!1,x=d.length-1;x>=y;--x){var w=CM(e,m,d[x]);if(w>=r){b=!0;break}if(p.score=p.score*IM(r,h,w),p.score<=a)break}p.suppressBeginIndex=d.length,b||(p.score===v?(d.push(m),f.push(p.score)):p.score>a&&kM(l,p,AM))}var k=d.length,S=n-k;s&&S>0&&(d.push.apply(d,g(new Array(S).fill(0))),f.push.apply(f,g(new Array(S).fill(0))));var _={selectedIndices:d};return o&&(_.selectedScores=f),u&&(_.validOutputs=k),_}function CM(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),f=(s-i)*(u-o),p=(h-l)*(d-c);if(f<=0||p<=0)return 0;var v=Math.max(i,l),m=Math.max(o,c),g=Math.min(s,h),y=Math.min(u,d),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(f+p-b)}function IM(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function AM(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function RM(){return RM=c(u().mark((function e(t,n,r){var a,i,o,s,l,c,h,d,f,p,v=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=xk(t,"boxes","nonMaxSuppressionAsync"),s=xk(n,"scores","nonMaxSuppressionAsync"),l=xM(o,s,r,a,i),r=l.maxOutputSize,a=l.iouThreshold,i=l.scoreThreshold,e.next=10,Promise.all([o.data(),s.data()]);case 10:return c=e.sent,h=c[0],d=c[1],f=_M(h,d,r,a,i),p=f.selectedIndices,o!==t&&o.dispose(),s!==n&&s.dispose(),e.abrupt("return",XT(p,"int32"));case 17:case"end":return e.stop()}}),e)}))),RM.apply(this,arguments)}var NM=function(e,t,n){return RM.apply(this,arguments)};var LM=kk({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=xk(e,"boxes","nonMaxSuppression"),s=xk(t,"scores","nonMaxSuppression"),u=xM(o,s,n,r,a,i),l={boxes:o,scores:s},c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},h=dk.runKernel(Bb,l,c);return{selectedIndices:h[0],selectedScores:h[1]}}});function PM(){return PM=c(u().mark((function e(t,n,r){var a,i,o,s,l,c,h,d,f,p,v,m,g=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>3&&void 0!==g[3]?g[3]:.5,i=g.length>4&&void 0!==g[4]?g[4]:Number.NEGATIVE_INFINITY,o=g.length>5&&void 0!==g[5]?g[5]:0,s=xk(t,"boxes","nonMaxSuppressionAsync"),l=xk(n,"scores","nonMaxSuppressionAsync"),c=xM(s,l,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=12,Promise.all([s.data(),l.data()]);case 12:return h=e.sent,d=h[0],f=h[1],p=TM(d,f,r,a,i,o),v=p.selectedIndices,m=p.selectedScores,s!==t&&s.dispose(),l!==n&&l.dispose(),e.abrupt("return",{selectedIndices:XT(v,"int32"),selectedScores:XT(m)});case 19:case"end":return e.stop()}}),e)}))),PM.apply(this,arguments)}var DM=function(e,t,n){return PM.apply(this,arguments)};var FM=kk({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=xk(e,"boxes","nonMaxSuppression"),s=xk(t,"scores","nonMaxSuppression"),u=xM(o,s,n,r,a,null),l={boxes:o,scores:s},c={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i},h=dk.runKernel(Ub,l,c);return{selectedIndices:h[0],validOutputs:h[1]}}});function OM(){return OM=c(u().mark((function e(t,n,r){var a,i,o,s,l,c,h,d,f,p,v,m,g,y,b,w,k=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k.length>3&&void 0!==k[3]?k[3]:.5,i=k.length>4&&void 0!==k[4]?k[4]:Number.NEGATIVE_INFINITY,o=k.length>5&&void 0!==k[5]&&k[5],s=xk(t,"boxes","nonMaxSuppressionAsync"),l=xk(n,"scores","nonMaxSuppressionAsync"),c=xM(s,l,r,a,i,null),h=c.maxOutputSize,d=c.iouThreshold,f=c.scoreThreshold,e.next=11,Promise.all([s.data(),l.data()]);case 11:return p=e.sent,v=x(p,2),m=v[0],g=v[1],y=EM(m,g,h,d,f,o),b=y.selectedIndices,w=y.validOutputs,s!==t&&s.dispose(),l!==n&&l.dispose(),e.abrupt("return",{selectedIndices:XT(b,"int32"),validOutputs:QS(w,"int32")});case 19:case"end":return e.stop()}}),e)}))),OM.apply(this,arguments)}var zM=function(e,t,n){return OM.apply(this,arguments)};var UM=kk({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=xk(e,"images","resizeBilinear");og(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),og(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),og(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=mE(a,[1,a.shape[0],a.shape[1],a.shape[2]])),x(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},l=dk.runKernel(ax,s,u);return o?mE(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var BM=kk({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=xk(e,"images","resizeNearestNeighbor");og(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),og(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),og("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),og(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=mE(a,[1,a.shape[0],a.shape[1],a.shape[2]])),x(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},l=dk.runKernel(nx,s,u);return o?mE(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var WM=kk({bincount_:function(e,t,n){var r=xk(e,"x","bincount"),a=xk(t,"weights","bincount");og("int32"===r.dtype,(function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)})),og(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),og(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return dk.runKernel(hy,i,o)}});var VM=kk({lessEqual_:function(e,t){var n=xk(e,"a","lessEqual","string_or_numeric"),r=xk(t,"b","lessEqual","string_or_numeric"),a=x(rk(n,r),2);n=a[0],r=a[1],d_(n.shape,r.shape);var i={a:n,b:r};return dk.runKernel(fb,i)}});var GM=kk({round_:function(e){var t={x:xk(e,"x","round")};return dk.runKernel(ux,t)}});var HM=kk({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=xk(e,"image","threshold"),l=u.shape[0]*u.shape[1],c=qS(XT([s]),255);if(og(3===u.rank,(function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(u.rank,".")})),og(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(u.shape[2],".")})),og("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(u.dtype,".")})),og("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var h=x(VT(u,[1,1,1],-1),3);t=h[0],n=h[1],r=h[2];var d=qS(t,.2989),f=qS(n,.587),p=qS(r,.114);a=HS(HS(d,f),p)}else a=e;"otsu"===i&&(c=function(e,t){for(var n,r,a,i,o,s,u=XT([-1]),l=XT([0]),c=XT([0]),h=0;h<e.size-1;h++){n=DT(e,0,h+1),r=DT(e,h+1),o=XS($E(n),t),s=XS($E(r),t);var d=$E(qS(n,IT(0,n.size)));a=XS(d,$E(n));var f=a_(r.shape,n.size),p=HS(IT(0,r.size),f),v=qS(r,p);i=XS($E(v),$E(r));var m=s_(a,i),g=s_(a,i),y=qS(o,s);c=qS(qS(y,m),g);var b=qE(c,l);l=YT(b,c,l),u=YT(b,XT([h]),u)}return u}(WM(DS(GM(a),"int32"),Ek([]),256),l));var v=o?VM(a,c):qE(a,c);return DS(qS(v,255),"int32")}});var jM=kk({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=xk(e,"image","transform","float32"),s=xk(t,"transforms","transform","float32");og(4===o.rank,(function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),og(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),og(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")}));var u={image:o,transforms:s},l={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return dk.runKernel(Gx,u,l)}});var XM=kk({less_:function(e,t){var n=xk(e,"a","less","string_or_numeric"),r=xk(t,"b","less","string_or_numeric"),a=x(rk(n,r),2);n=a[0],r=a[1],d_(n.shape,r.shape);var i={a:n,b:r};return dk.runKernel(db,i)}});var qM=kk({bandPart_:function(e,t,n){var r=xk(e,"a","bandPart");og(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a,i,o=r.shape,s=x(r.shape.slice(-2),2),u=s[0],l=s[1];"number"===typeof t?(og(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),og(t<=u,(function(){return"bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(u,").")})),a=xk(t<0?u:t,"numLower","bandPart")):(og("int32"===t.dtype,(function(){return"bandPart(): numLower's dtype must be an int32."})),a=YT(XM(t,0),u,sT(t,u))),"number"===typeof n?(og(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")})),og(n<=l,(function(){return"bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(l,").")})),i=xk(n<0?l:n,"numUpper","bandPart")):(og("int32"===n.dtype,(function(){return"bandPart(): numUpper's dtype must be an int32."})),i=YT(XM(n,0),l,sT(n,l)));var c=mE(IT(0,u,1,"int32"),[-1,1]),h=IT(0,l,1,"int32"),d=s_(c,h),f=tT(VM(d,a),KE(d,mT(i))),p=bT([u,l],r.dtype);return mE(HT(KT(mE(r,[-1,u,l])).map((function(e){return YT(f,e,p)}))),o)}});function KM(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return l_(e);if(1!==e.rank&&null===n)return KM(mE(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return $E(l_(e),n);if(t===1/0)return QE(l_(e),n);if(t===-1/0)return oT(l_(e),n);if("euclidean"===t||2===t)return KS($E(o_(l_(e),QS(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return QE($E(l_(e),n[0]),n[1]-1);if(t===1/0)return QE($E(l_(e),n[1]),n[0]);if(t===-1/0)return oT($E(l_(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return KS($E(YS(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var YM=kk({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=KM(e=xk(e,"x","norm"),t,n),i=a.shape;if(r){var o=mg(n,e.shape);i=cT(a.shape,o)}return mE(a,i)}});var ZM=kk({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,og(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){og(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}else t=!0,e=VT(e,e.shape[0],0).map((function(e){return GT(e,[0])}));og(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var i=[],o=e,s=function(e){i.push(dk.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=qS($E(qS(i[n],t)),i[n]);t=s_(t,r)}return XS(t,YM(t,"euclidean"))})))},u=0;u<e.length;++u)s(u);return t?HT(i,0):i}});function JM(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return dk.tidy((function(){og(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=HE(n),i=FS(e),o=vM([[1]],[1,1]),s=FS(o),u=n>=r?r:n,l=function(e){var t=i,u=s,l=a,c=x(dk.tidy((function(){var t=DT(i,[e,e],[n-e,1]),u=YM(t),l=DT(i,[e,e],[1,1]),c=YT(qE(l,0),vM([[-1]]),vM([[1]])),h=s_(l,qS(c,u)),d=XS(t,h);s=1===d.shape[0]?FS(o):EE([o,DT(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);var f=mT(XS(nT(c,h),u)),p=DT(i,[e,0],[n-e,r]),v=qS(f,s),m=QT(s);if(0===e)i=s_(p,nT(v,nT(m,p)));else{var g=s_(p,nT(v,nT(m,p)));i=EE([DT(i,[0,0],[e,r]),g],0)}var y=QT(v),b=DT(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=s_(b,nT(nT(b,s),y));else{var x=s_(b,nT(nT(b,s),y));a=EE([DT(a,[0,0],[n,e]),x],1)}return[s,i,a]})),3);s=c[0],i=c[1],a=c[2],WS([t,u,l])},c=0;c<u;++c)l(c);return!t&&n>r&&(a=DT(a,[0,0],[n,r]),i=DT(i,[0,0],[r,r])),[a,i]}))}var QM,$M=kk({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(og(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return JM(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=KT(mE(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=x(JM(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)})),[mE(HT(a,0),e.shape),mE(HT(i,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(QM||(QM={}));var eC=kk({squaredDifference_:function(e,t){var n=xk(e,"a","squaredDifference"),r=xk(t,"b","squaredDifference"),a=x(rk(n,r),2);n=a[0],r=a[1],d_(n.shape,r.shape);var i={a:n,b:r};return dk.runKernel(Rx,i,{})}});var tC=kk({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=xk(e,"x","logSumExp"),a=mg(t,r.shape),i=QE(r,a,!0),o=s_(r,i),s=WE(o),u=$E(s,a),l=ZE(u),c=HS(mE(i,l.shape),l);if(n){var h=cT(c.shape,a);return mE(c,h)}return c}});var nC,rC={flipLeftRight:gM,grayscaleToRGB:yM,resizeNearestNeighbor:BM,resizeBilinear:UM,rotateWithOffset:bM,cropAndResize:mM,nonMaxSuppression:wM,nonMaxSuppressionAsync:NM,nonMaxSuppressionWithScore:LM,nonMaxSuppressionWithScoreAsync:DM,nonMaxSuppressionPadded:FM,nonMaxSuppressionPaddedAsync:zM,threshold:HM,transform:jM},aC={bandPart:qM,gramSchmidt:ZM,qr:$M},iC=function(){function e(){E(this,e)}return M(e,null,[{key:"sgd",value:function(e){return new v_(e)}},{key:"momentum",value:function(e,t){return new m_(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}},{key:"rmsprop",value:function(e){return new g_(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}},{key:"adam",value:function(){return new u_(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},{key:"adadelta",value:function(){return new r_(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"adamax",value:function(){return new p_(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}},{key:"adagrad",value:function(e){return new i_(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}}]),e}(),oC=iC,sC="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:function(e){return e()};function uC(){return new Promise((function(e){return sC((function(){return e()}))}))}function lC(e,t){var n=e[0].length;e.forEach((function(e,t){og(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),og(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)og(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}function cC(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(nC||(nC={}));var hC=30;function dC(e){return e<=hC?e:Tg(e,Math.floor(Math.sqrt(e)))}function fC(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function pC(e,t,n){var r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])(r=r.concat(t.slice(0))).push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);for(var a=t.length,i=0;i<a;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(a+1))}return r}function vC(e,t){var n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(var r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{for(var a=[],i=[],o=1;o<e;++o)o>=2*t+1||o%2===1?i.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,i)}return n}function mC(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function gC(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function yC(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function bC(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===lg(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,l=a.slice();l.pop();for(var c=1,h=i;h<n;++h)c*=u[h],l.push(u[h]);var d=[].concat(g(Mg(e.shape).map((function(e){return e/c}))),[1]).slice(0,i);return[l,o,c,d]}function xC(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:lg(t.shape)/u,sliceSize:o,strides:[].concat(g(Mg(n.slice(0,a))),[1]),outputSize:lg(n)}}var wC=1.7580993408473768,kC=1.0507009873554805,SC=.3275911,_C=.254829592,EC=-.284496736,TC=1.421413741,MC=-1.453152027,CC=1.061405429;function IC(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function AC(e,t){return{real:e[2*t],imag:e[2*t+1]}}function RC(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function NC(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var LC="->",PC=/->/g,DC=",",FC="...";function OC(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(PC,"").length)/LC.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(LC,'").'));var r=x(e.split(LC),2),a=r[0],i=r[1];og(-1===a.indexOf(FC),(function(){return'The ellipsis notation ("'.concat(FC,'") is not supported yet.')}));var o=a.split(DC),s=o.length;if(t!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(t));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],l=function(){var e=i[c];if(!o.some((function(t){return-1!==t.indexOf(e)})))throw new Error("Output subscripts contain the label ".concat(e," ")+"not present in the input subscripts.");-1===u.indexOf(e)&&u.push(e)},c=0;c<i.length;++c)l();for(var h=0;h<a.length;++h){var d=a[h];-1===u.indexOf(d)&&d!==DC&&u.push(d)}for(var f=new Array(o.length),p=0;p<s;++p){if(new Set(o[p].split("")).size!==o[p].length)throw new Error("Found duplicate axes in input component ".concat(o[p],". ")+"Support for duplicate axes in input is not implemented yet.");f[p]=[];for(var v=0;v<o[p].length;++v)f[p].push(u.indexOf(o[p][v]))}for(var m=u.length,g=[],y=i.length;y<m;++y)g.push(y);return{allDims:u,summedDims:g,idDims:f}}function zC(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return{permutationIndices:n=n.filter((function(e){return-1!==e})),expandDims:a}}function UC(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:og(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(a),", ")+"but got dimension ".concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function BC(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,l=N(VC(t,r[s]));try{for(l.s();!(u=l.n()).done;){var c=u.value;-1===o.indexOf(c)&&(a[s].push(c),o.push(c))}}catch(R0){l.e(R0)}finally{l.f()}}return{path:r,steps:a}}function WC(e){return e.every((function(e,t){return e===t}))}function VC(e,t){for(var n=[],r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function GC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)og(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);og(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}og(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function HC(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function jC(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function XC(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function qC(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],l=1,c=1,h=1,d=0;d<r;++d)u.push(e.shape[d]),l*=e.shape[d];for(var f=r;f<n;f++)u.push(e.shape[f]),c*=e.shape[f];for(var p=r;p<a;p++)u.push(t.shape[p]);for(var v=n+1;v<i;v++)u.push(e.shape[v]),h*=e.shape[v];return{batchSize:l,sliceSize:h,outerSize:c,dimSize:s,outputShape:u}}function KC(e){try{return e.map((function(e){return Cw(e)}))}catch(R0){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(R0))}}function YC(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=PS(e,"int32"),i=PS([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}!function(){var e,t=N(y_);try{for(t.s();!(e=t.n()).done;){t_(e.value)}}catch(R0){t.e(R0)}finally{t.f()}}();var ZC={kernelName:jg,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(e,oM(DS(n,"float32"),-1))}}}},JC={kernelName:Xg,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){var t=YS(DS(n,"float32")),r=KS(s_(QS(1),t));return mT(XS(e,r))}}}},QC={kernelName:qg,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){var t=KS(s_(YS(DS(n,"float32")),1));return XS(e,t)}}}},$C={kernelName:Kg,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1],i=d_(r.shape,a.shape);return{a:function(){var t=e,n=h_(r.shape,i);return n.length>0&&(t=$E(t,n)),mE(t,r.shape)},b:function(){var t=e,n=h_(a.shape,i);return n.length>0&&(t=$E(t,n)),mE(t,a.shape)}}}},eI={kernelName:Yg,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},tI={kernelName:Qg,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return ZS(n)}}}},nI={kernelName:$g,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return ZS(n)}}}},rI={kernelName:ey,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return XS(e,KS(s_(QS(1),YS(DS(n,"float32")))))}}}},aI={kernelName:ty,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){var t=KS(HS(QS(1),YS(DS(n,"float32"))));return XS(e,t)}}}},iI={kernelName:ay,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1],i=d_(r.shape,a.shape);return{a:function(){var t=HS(YS(r),YS(a)),n=qS(e,XS(a,t)),o=h_(r.shape,i);return o.length>0&&(n=$E(n,o)),mE(n,r.shape)},b:function(){var t=HS(YS(r),YS(a)),n=mT(qS(e,XS(r,t))),o=h_(a.shape,i);return o.length>0&&(n=$E(n,o)),mE(n,a.shape)}}}},oI={kernelName:ny,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return XS(e,HS(YS(DS(n,"float32")),1))}}}},sI={kernelName:ry,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return XS(e,s_(QS(1),YS(DS(n,"float32"))))}}}};var uI=kk({avgPool3dGrad_:function(e,t,n,r,a,i){var o=xk(e,"dy","avgPool3dGrad"),s=xk(t,"input","avgPool3dGrad"),u=o,l=s,c=!1;4===s.rank&&(c=!0,u=mE(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=mE(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),og(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")})),og(5===l.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(l.rank,".")})),vE("avgPool3dGrad",a,i);var h={dy:u,input:l},d={filterSize:n,strides:r,pad:a,dimRoundingMode:i},f=dk.runKernel(uy,h,d);return c?mE(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),lI={kernelName:sy,inputsToSave:["x"],gradFunc:function(e,t,n){var r=x(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return uI(e,r,a,i,o,s)}}}};var cI=kk({avgPoolGrad_:function(e,t,n,r,a){var i=xk(e,"dy","avgPoolGrad"),o=xk(t,"input","avgPoolGrad");og(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,l=!1;3===o.rank&&(l=!0,s=mE(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=mE(i,[1,i.shape[0],i.shape[1],i.shape[2]])),og(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),og(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")}));var c={dy:u,input:s},h={filterSize:n,strides:r,pad:a},d=dk.runKernel(oy,c,h);return l?mE(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),hI={kernelName:iy,inputsToSave:["x"],gradFunc:function(e,t,n){var r=x(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return cI(e,r,a,i,o)}}}},dI={kernelName:ly,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=x(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return nT(e,i,!1,!1)},b:function(){return nT(e,a,!0,!1)}}:o&&!s?{a:function(){return nT(i,e,!1,!0)},b:function(){return nT(a,e,!1,!1)}}:{a:function(){return nT(i,e,!0,!0)},b:function(){return nT(e,a,!0,!0)}}:{a:function(){return nT(e,i,!1,!0)},b:function(){return nT(a,e,!0,!1)}}}};var fI=kk({spaceToBatchND_:function(e,t,n){var r=xk(e,"x","spaceToBatchND");og(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),og(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),og(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return dk.runKernel(Sx,a,i)}}),pI={kernelName:cy,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return fI(e,r,a)}}}},vI={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],l=0;l<o.length;l++)o[l]>1&&u.push(l);return{x:function(){return $E(e,u,!0)}}}},mI={kernelName:py,gradFunc:function(e){return{x:function(){return e.clone()}}}},gI={kernelName:vy,gradFunc:function(e){return{x:function(){return ZS(e)}}}},yI={kernelName:my,inputsToSave:["x"],gradFunc:function(e,t,n){var r=x(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return YT(tT(KE(r,a),VM(r,i)),e,ZS(e))}}}},bI={kernelName:yy,inputsToSave:["x"],gradFunc:ZC.gradFunc},xI={kernelName:by,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=mg(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return VT(e,i,a).map((function(e){return function(){return e}}))}},wI={kernelName:xy,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=x(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,l=n.dataFormat;return og(hE(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return NE(a.shape,e,i,s,u,l)},filter:function(){return aM(a,e,i.shape,s,u,l)}}}},kI={kernelName:ky,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=x(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,l=n.dimRoundingMode;return{dy:function(){return AE(e,i,o,s,u,1,l)},filter:function(){return aM(e,a,i.shape,o,s,u,l)}}}};var SI=kk({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=mE(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=mE(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),og(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),og(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),og(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),og(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),og(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return dk.runKernel(_y,s,u)}}),_I={kernelName:Sy,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;og(hE(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=x(t,2),s=o[0],u=o[1];return{x:function(){return DE(s.shape,e,u,a,i)},filter:function(){return SI(s,e,u.shape,a,i)}}}};var EI=kk({sin_:function(e){var t={x:xk(e,"x","sin","float32")};return dk.runKernel(mx,t)}}),TI={kernelName:Ty,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(mT(EI(DS(n,"float32"))),e)}}}};var MI=kk({sinh_:function(e){var t={x:xk(e,"x","sinh")};return dk.runKernel(gx,t)}}),CI={kernelName:My,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(MI(DS(n,"float32")),e)}}}};var II=kk({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:xk(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return dk.runKernel(Iy,a,i)}}),AI={kernelName:Iy,inputsToSave:["x"],gradFunc:function(e,t,n){var r=x(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=dT([a],r.rank),n=II(e,a,i,!o);return null!=t&&(n=QT(n,t)),n}}}},RI={kernelName:Ly,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;og(hE(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=x(t,2),l=u[0],c=u[1];return og(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(l.rank,".")})),og(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(c.rank,".")})),og(l.shape[3]===c.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(l.shape[3],") must match the inChannels dimension ")+"in filter ".concat(c.shape[2],".")})),og(dE(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),vE("depthwiseConv2d",i,o),{x:function(){return fM(l.shape,e,c,a,i,s,o)},filter:function(){return dM(l,e,c.shape,a,i,s,o)}}}},NI={kernelName:Oy,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=x(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return dk.runKernel(zy,o,n)},filter:function(){return dk.runKernel(Uy,s,n)}}}},LI={kernelName:Vy,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:x(t,1)[0]};return{x:function(){return dk.runKernel(Gy,n)}}}},PI={kernelName:Hy,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0],r=qS(WE(mT(YS(n))),2/Math.sqrt(Math.PI));return{x:function(){return qS(e,r)}}}},DI={kernelName:Xy,outputsToSave:[!0],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(e,n)}}}},FI={kernelName:qy,inputsToSave:["input"],gradFunc:function(e,t){var n=x(t,1)[0];return{input:function(){return mE(e,n.shape)}}}},OI={kernelName:Ky,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(e,WE(n))}}}},zI={kernelName:Qy,gradFunc:function(e){return{x:function(){return ZS(e)}}}},UI={kernelName:$y,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1],i=d_(r.shape,a.shape);return{a:function(){var t=XS(e,DS(a,"float32")),n=h_(r.shape,i);return n.length>0?mE($E(t,n),r.shape):t},b:function(){var t=qS(e,DS(r,"float32")),n=h_(a.shape,i);n.length>0&&(t=mE($E(t,n),a.shape));var o=YS(a);return mT(XS(t,DS(o,"float32")))}}}};var BI=kk({rsqrt_:function(e){var t={x:xk(e,"x","rsqrt","float32")};return dk.runKernel(lx,t)}}),WI={kernelName:eb,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=x(t,4),i=a[0],o=a[1],s=a[2],u=a[3],l=null==u?QS(1):u,c=h_(o.shape,i.shape),h=[];if(1===o.rank){for(var d=0;d<i.shape.length-1;++d)h.push(i.shape[d]);h.push(1)}var f=s_(i,o),p=qS(e,l),v=BI(HS(s,QS(r))),m=qS(qS(qS(v,v),v),QS(-.5));return{x:function(){return 1===o.rank?mE(qS(qS(e,GE(mE(v,[1,1,1,o.shape[0]]),h)),l),i.shape):mE(qS(qS(e,v),l),i.shape)},mean:function(){var e=qS(qS(v,QS(-1)),p);return 1===o.rank&&(e=$E(e,c)),mE(e,o.shape)},variance:function(){var e=qS(qS(m,f),p);return 1===o.rank&&(e=$E(e,c)),mE(e,o.shape)},scale:function(){var t=qS(f,v),n=qS(e,t);return 1===o.rank&&(n=$E(n,c)),mE(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=$E(t,c)),mE(t,o.shape)}}}};var VI=kk({unsortedSegmentSum_:function(e,t,n){var r=xk(e,"x","unsortedSegmentSum"),a=xk(t,"segmentIds","unsortedSegmentSum","int32");og(hg(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return dk.runKernel(qx,i,o)}}),GI={kernelName:tb,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=x(t,2),a=r[0],i=r[1],o=n.axis,s=mg(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,l=t.slice(o,t.length).slice(1),c=l.length,h=HI(0,u),d=HI(u+1,u+1+c),f=jI([r,[n],l]),p=mE(e,f),v=mE(i,[n]),m=jI([[u],h,d]),g=QT(p,m),y=VI(g,v,a.shape[s]),b=fT(m);return y=QT(y,b)},indices:function(){return i}}}};function HI(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function jI(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var XI={kernelName:ab,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1];return{a:function(){return ZS(r)},b:function(){return ZS(a)}}}},qI={kernelName:ib,gradFunc:function(e){return{x:function(){return DS(e,"float32")}}}},KI={kernelName:ub,gradFunc:function(e){return{x:function(){return ZS(e)}}}},YI={kernelName:lb,gradFunc:function(e){return{x:function(){return ZS(e)}}}},ZI={kernelName:cb,gradFunc:function(e){return{x:function(){return ZS(e)}}}},JI={kernelName:hb,inputsToSave:["x"],gradFunc:function(e,t,n){var r=x(t,1)[0],a=n.alpha,i=qE(r,0);return{x:function(){return YT(i,e,qS(e,a))}}}},QI={kernelName:mb,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return XS(e,HS(n,1))}}}},$I={kernelName:vb,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return XS(e,DS(n,"float32"))}}}},eA={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=x(t,1)[0],a=n.axis;return{logits:function(){var t=WE(r);return s_(e,qS($E(e,a,!0),t))}}}};var tA=kk({localResponseNormalizationBackprop_:function(e,t,n){var r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return dk.runKernel(wb,r,a)}}),nA={kernelName:xb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=x(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,l=n.beta;return{x:function(){return tA(a,i,e,o,s,u,l)}}}};function rA(e,t,n,r){return t.rank<n.rank&&(t=mE(t,cT(t.shape,r))),e.rank<n.rank&&(e=mE(e,cT(e.shape,r))),{x:function(){return qS(e,DS(BE(n,t),e.dtype))}}}var aA={kernelName:kb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=rA(e,t[1],a,mg(r,a.shape));return{x:function(){return i.x()}}}},iA={kernelName:Sb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1];return{a:function(){return qS(e,DS(KE(r,a),"float32"))},b:function(){return qS(e,DS(XM(r,a),"float32"))}}}};var oA=kk({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=xk(e,"dy","maxPool3dGrad"),u=xk(t,"input","maxPool3dGrad"),l=xk(n,"output","maxPool3dGrad"),c=s,h=u,d=l,f=!1;4===u.rank&&(f=!0,c=mE(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),h=mE(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),d=mE(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),og(5===c.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(c.rank,".")})),og(5===h.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(h.rank,".")})),og(5===d.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(d.rank,".")})),vE("maxPool3dGrad",i,o);var p={dy:c,input:h,output:d},v={filterSize:r,strides:a,pad:i,dimRoundingMode:o},m=dk.runKernel(Mb,p,v);return f?mE(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),sA={kernelName:Tb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=x(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,l=n.dimRoundingMode;return{x:function(){return oA(e,a,i,o,s,u,l)}}}};var uA=kk({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=xk(e,"dy","maxPoolGrad"),u=xk(t,"input","maxPoolGrad"),l=xk(n,"output","maxPoolGrad");og(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")})),og(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")})),og(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")})),vE("maxPoolGrad",i,o);var c={dy:s,input:u,output:l},h={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return dk.runKernel(Eb,c,h)}}),lA={kernelName:_b,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=x(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return uA(e,a,i,o,s,u)}}}},cA={kernelName:Ib,inputsToSave:["x"],gradFunc:function(e,t,n){var r=x(t,1)[0],a=mg(n.axis,r.shape),i=lg(lT(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=mE(e,t);return XS(qS(n,xT(r.shape,"float32")),i)}}}},hA={kernelName:Ab,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=x(t,2),i=a[0],o=rA(e,a[1],i,mg(r,i.shape));return{x:function(){return o.x()}}}},dA={kernelName:Rb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1];return{a:function(){return qS(e,DS(VM(r,a),"float32"))},b:function(){return qS(e,DS(qE(r,a),"float32"))}}}},fA={kernelName:Nb,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return DT(e,a,r.shape)}}}},pA={kernelName:Lb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1],i=d_(r.shape,a.shape);return{a:function(){var t=h_(r.shape,i);return t.length>0?mE($E(e,t),r.shape):e},b:function(){var t=qS(e,mT(jE(XS(r,a)))),n=h_(a.shape,i);return n.length>0?mE($E(t,n),a.shape):t}}}},vA={kernelName:Db,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1],i=d_(r.shape,a.shape);return{a:function(){var t=qS(e,DS(a,"float32")),n=h_(r.shape,i);return n.length>0?mE($E(t,n),r.shape):t},b:function(){var t=qS(e,DS(r,"float32")),n=h_(a.shape,i);return n.length>0?mE($E(t,n),a.shape):t}}}},mA={kernelName:Fb,gradFunc:function(e){return{x:function(){return mT(e)}}}},gA={kernelName:Vb,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return bT(n.shape,"float32")}}}},yA={kernelName:Wb,gradFunc:function(e){return{x:function(){return ZS(e)}}}},bA={kernelName:Gb,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return KT(e,r).map((function(e){return function(){return e}}))}},xA={kernelName:Hb,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return DT(e,a,r.shape)}}}},wA={kernelName:jb,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=x(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=d_(o.shape,s.shape);return{a:function(){var t=DS(s,"float32"),n=qS(e,qS(t,o_(o,s_(t,QS(1))))),r=h_(o.shape,u);return r.length>0&&(n=$E(n,r)),mE(n,o.shape)},b:function(){var t=qE(o,0),n=YT(t,ZE(o),ZS(o)),r=qS(e,qS(i,n)),a=h_(s.shape,u);return a.length>0&&(r=$E(r,a)),mE(r,s.shape)}}}},kA={kernelName:Xb,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1],i=qE(r,0);return{x:function(){return YT(i,e,qS(e,a))},alpha:function(){var t=YT(i,ZS(e),qS(e,r)),n=h_(a.shape,e.shape);return n.length>0&&(t=$E(t,n)),mE(t,a.shape)}}}};var SA=kk({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:xk(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return dk.runKernel(Cy,a,i)}});function _A(e,t,n){var r=e.shape.length,a=r-n.length,i=dT(n,r),o=e;null!=i&&(o=QT(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var l=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=mE(t,r),i=SA(e,n,!0,!1),o=SA(e,n,!0,!0),s=qS(i,o);return qS(a,s)}(o.reshape(s),t,a);if(l=l.reshape(o.shape),null!=i){var c=fT(i);l=QT(l,c)}return l}var EA={kernelName:qb,inputsToSave:["x"],gradFunc:function(e,t,n){var r=x(t,1)[0],a=n.axis,i=[];return i=void 0===a||null===a?r.shape.map((function(e,t){return t})):"number"===typeof a?[a]:a,{x:function(){return _A(r,e,i)}}}},TA={kernelName:By,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1],i=d_(r.shape,a.shape);return{a:function(){var t=XS(e,DS(a,"float32")),n=h_(r.shape,i);return n.length>0?mE($E(t,n),r.shape):t},b:function(){var t=qS(e,DS(r,"float32")),n=h_(a.shape,i);n.length>0&&(t=mE($E(t,n),a.shape));var o=YS(a);return mT(XS(t,DS(o,"float32")))}}}},MA={kernelName:$b,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return XS(e,mT(YS(n)))}}}},CA={kernelName:ox,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0],r=qS(VM(n,6),oM(n));return{x:function(){return qS(e,DS(r,"float32"))}}}},IA={kernelName:ex,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(e,DS(oM(n),"float32"))}}}},AA={kernelName:tx,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return mE(e,n.shape)}}}},RA={kernelName:ax,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:x(t,1)[0]};return{images:function(){return dk.runKernel(ix,r,n)}}}},NA={kernelName:nx,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:x(t,1)[0]};return{images:function(){return dk.runKernel(rx,r,n)}}}},LA={kernelName:sx,gradFunc:function(e,t,n){var r=mg(n.dims,e.shape);return{x:function(){return RT(e,r)}}}},PA={kernelName:ux,gradFunc:function(e){return{x:function(){return ZS(e)}}}},DA={kernelName:lx,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return mT(XS(e,qS(o_(n,1.5),2)))}}}};var FA=kk({logicalNot_:function(e){var t={x:xk(e,"x","logicalNot","bool")};return dk.runKernel(yb,t)}}),OA={kernelName:fx,inputsToSave:["condition"],gradFunc:function(e,t){var n=x(t,1)[0];return{condition:function(){return DS(ZS(n),"float32")},t:function(){return qS(e,DS(n,e.dtype))},e:function(){return qS(e,DS(FA(n),e.dtype))}}}},zA={kernelName:px,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){var t=qE(n,QS(0)),r=QS(wC),a=QS(kC),i=qS(e,a),o=qS(qS(e,r),WE(DS(n,"float32")));return YT(t,i,o)}}}},UA={kernelName:bx,outputsToSave:[!0],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(e,qS(n,s_(QS(1),n)))}}}},BA={kernelName:yx,gradFunc:function(e){return{x:function(){return ZS(e)}}}};var WA=kk({cos_:function(e){var t={x:xk(e,"x","cos","float32")};return dk.runKernel(Ty,t)}}),VA={kernelName:mx,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(WA(DS(n,"float32")),e)}}}};var GA=kk({cosh_:function(e){var t={x:xk(e,"x","cosh","float32")};return dk.runKernel(My,t)}}),HA={kernelName:gx,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(GA(DS(n,"float32")),e)}}}},jA={kernelName:vx,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=x(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=x(Y_(r,a,i),2),u=s[0],l=s[1],c=[],h=0;h<e.rank;h++)c.push([u[h],o[h]-u[h]-l[h]]);return{x:function(){return kT(e,c)}}}},XA={kernelName:Ex,outputsToSave:[!0],gradFunc:function(e,t,n){var r=x(t,1)[0],a=n.dim,i=qS(e,r);return{logits:function(){return s_(i,qS($E(i,[a],true),r))}}}},qA={kernelName:xx,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(e,PT(n))}}}};var KA=kk({batchToSpaceND_:function(e,t,n){var r=xk(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));og(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),og(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),og(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return dk.runKernel(cy,i,o)}}),YA={kernelName:Sx,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return KA(e,r,a)}}}},ZA={kernelName:_x,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return EE(e,r)}}}},JA={kernelName:wx,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return XS(e,qS(KS(DS(n,"float32")),2))}}}},QA={kernelName:Nx,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(e,qS(DS(n,"float32"),2))}}}},$A={kernelName:Ux,inputsToSave:["x"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return XS(e,YS(WA(n)))}}}},eR={kernelName:Wx,inputsToSave:["x"],gradFunc:function(e,t,n){var r=x(t,1)[0],a=n.reps;return{x:function(){var t=ZS(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=HS(t,DT(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=HS(t,DT(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var l=0;l<a[2];++l)t=HS(t,DT(e,[s*r.shape[0],u*r.shape[1],l*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var c=0;c<a[0];++c)for(var h=0;h<a[1];++h)for(var d=0;d<a[2];++d)for(var f=0;f<a[3];++f)t=HS(t,DT(e,[c*r.shape[0],h*r.shape[1],d*r.shape[2],f*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},tR={kernelName:qx,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return function(e,t){for(var n=f_(t,ZS(t)),r=XE(e,n),a=KE(t,QS(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=VE(a,o+1);a=tT(a,xT(r.shape,"bool"));var s=ZS(r);return YT(a,r,s)}(e,n)}}}};for(var nR=0,rR=[ZC,JC,QC,$C,eI,tI,nI,rI,aI,iI,oI,sI,lI,hI,dI,pI,vI,mI,gI,yI,bI,xI,kI,wI,_I,TI,CI,AI,RI,NI,TA,LI,PI,DI,FI,OI,UI,zI,WI,GI,XI,qI,KI,YI,ZI,JI,QI,$I,eA,nA,aA,aA,iA,sA,lA,cA,hA,dA,fA,pA,vA,mA,gA,yA,bA,xA,xA,wA,kA,EA,MA,CA,IA,AA,RA,NA,LA,PA,DA,OA,zA,UA,BA,VA,HA,jA,XA,qA,YA,YA,ZA,ZA,JA,{kernelName:Rx,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1],i=QS(2);return{a:function(){return qS(e,qS(i,s_(r,a)))},b:function(){return qS(e,qS(i,s_(a,r)))}}}},QA,{kernelName:Yx,gradFunc:function(e){return{x:function(){return ZS(e)}}}},{kernelName:zx,inputsToSave:["a","b"],gradFunc:function(e,t){var n=x(t,2),r=n[0],a=n[1],i=d_(r.shape,a.shape);return{a:function(){var t=e,n=h_(r.shape,i);return n.length>0&&(t=$E(t,n)),mE(t,r.shape)},b:function(){var t=e,n=h_(a.shape,i);return n.length>0&&(t=$E(t,n)),mE(mT(t),a.shape)}}}},{kernelName:kx,inputsToSave:["x"],gradFunc:function(e,t,n){var r=x(t,1)[0],a=r.shape.slice();mg(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=mE(e,a),o=qS(i,xT(r.shape,"float32"));return{x:function(){return o}}}},$A,{kernelName:Bx,outputsToSave:[!0],gradFunc:function(e,t){var n=x(t,1)[0];return{x:function(){return qS(s_(QS(1),YS(n)),e)}}}},eR,{kernelName:Hx,gradFunc:function(e,t,n){var r=fT(n.perm);return{x:function(){return QT(e,r)}}}},{kernelName:Xx,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return HT(e,r)}}}},tR,{kernelName:Kx,gradFunc:function(e){return{x:function(){return ZS(e)}}}}];nR<rR.length;nR++){sw(rR[nR])}jw().prototype.abs=function(){return this.throwIfDisposed(),l_(this)};var aR=kk({acos_:function(e){var t={x:xk(e,"x","acos")};return dk.runKernel(Xg,t)}});jw().prototype.acos=function(){return this.throwIfDisposed(),aR(this)};var iR=kk({acosh_:function(e){var t={x:xk(e,"x","acosh")};return dk.runKernel(qg,t)}});jw().prototype.acosh=function(){return this.throwIfDisposed(),iR(this)},jw().prototype.add=function(e){return this.throwIfDisposed(),HS(this,e)},jw().prototype.all=function(e,t){return this.throwIfDisposed(),Q_(this,e,t)},jw().prototype.any=function(e,t){return this.throwIfDisposed(),$_(this,e,t)},jw().prototype.argMax=function(e){return this.throwIfDisposed(),eE(this,e)};var oR=kk({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:xk(e,"x","argMin")},r={axis:t};return dk.runKernel($g,n,r)}});jw().prototype.argMin=function(e){return this.throwIfDisposed(),oR(this,e)},jw().prototype.asScalar=function(){return this.throwIfDisposed(),og(1===this.size,(function(){return"The array must have only 1 element."})),mE(this,[])},jw().prototype.asType=function(e){return this.throwIfDisposed(),DS(this,e)},jw().prototype.as1D=function(){return this.throwIfDisposed(),mE(this,[this.size])},jw().prototype.as2D=function(e,t){return this.throwIfDisposed(),mE(this,[e,t])},jw().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),mE(this,[e,t,n])},jw().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),mE(this,[e,t,n,r])},jw().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),mE(this,[e,t,n,r,a])};var sR=kk({asin_:function(e){var t={x:xk(e,"x","asin")};return dk.runKernel(ey,t)}});jw().prototype.asin=function(){return this.throwIfDisposed(),sR(this)};var uR=kk({asinh_:function(e){var t={x:xk(e,"x","asinh")};return dk.runKernel(ty,t)}});jw().prototype.asinh=function(){return this.throwIfDisposed(),uR(this)};var lR=kk({atan_:function(e){var t={x:xk(e,"x","atan")};return dk.runKernel(ny,t)}});jw().prototype.atan=function(){return this.throwIfDisposed(),lR(this)};var cR=kk({atan2_:function(e,t){var n=xk(e,"a","atan2"),r=xk(t,"b","atan2"),a=x(rk(n,r),2),i={a:n=a[0],b:r=a[1]};return dk.runKernel(ay,i)}});jw().prototype.atan2=function(e){return this.throwIfDisposed(),cR(this,e)};var hR=kk({atanh_:function(e){var t={x:xk(e,"x","atanh")};return dk.runKernel(ry,t)}});jw().prototype.atanh=function(){return this.throwIfDisposed(),hR(this)},jw().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),gE(this,e,t,n,r)},jw().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),KA(this,e,t)},jw().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),bE(this,e,t,n,r,a)},jw().prototype.broadcastTo=function(e){return this.throwIfDisposed(),SE(this,e)},jw().prototype.cast=function(e){return this.throwIfDisposed(),DS(this,e)};var dR=kk({ceil_:function(e){var t={x:xk(e,"x","ceil","float32")};return dk.runKernel(vy,t)}});jw().prototype.ceil=function(){return this.throwIfDisposed(),dR(this)},jw().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),_E(this,e,t)},jw().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Hw&&(e=[e]),EE([this].concat(g(e)),t)},jw().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),RE(this,e,t,n,r,a,i)},jw().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),LE(this,e,t,n,r,a)},jw().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),AE(this,e,t,n,r,a,i)},jw().prototype.cos=function(){return this.throwIfDisposed(),WA(this)},jw().prototype.cosh=function(){return this.throwIfDisposed(),GA(this)},jw().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),SA(this,e,t,n)},jw().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),II(this,e,t,n)};var fR=kk({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=xk(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];og(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),og(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),og(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),og(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return dk.runKernel(Ny,s,u)}});jw().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),fR(this,e,t)},jw().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),zE(this,e,t,n,r,a,i)};var pR=kk({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=xk(e,"x","dilation2d"),s=xk(t,"filter","dilation2d");og(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")})),og(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")})),og("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)}));var u=o,l=!1;3===o.rank&&(u=mE(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0),og(u.shape[3]===s.shape[2],(function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])}));var c={x:u,filter:s},h={strides:n,pad:r,dilations:a},d=dk.runKernel(Oy,c,h);return l?mE(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});jw().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),pR(this,e,t,n,r,a)};var vR=kk({divNoNan_:function(e,t){var n=xk(e,"a","div"),r=xk(t,"b","div"),a=x(rk(n,r),2);n=a[0],r=a[1];var i=XS(n,r),o=ZS(i),s=BE(r,o);return YT(s,o,i)}});jw().prototype.divNoNan=function(e){return this.throwIfDisposed(),vR(this,e)},jw().prototype.div=function(e){return this.throwIfDisposed(),XS(this,e)};var mR=kk({dot_:function(e,t){var n=xk(e,"t1","dot"),r=xk(t,"t2","dot");og((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(og(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=mE(n,[1,-1]),s=mE(r,[-1,1]),u=nT(o,s);return mE(u,[])}if(1===n.rank&&2===r.rank){var l=mE(n,[1,-1]),c=mE(r,[r.shape[0],r.shape[1]]),h=nT(l,c);return mE(h,[h.size])}if(2===n.rank&&1===r.rank){var d=mE(r,[-1,1]),f=nT(n,d);return mE(f,[f.size])}var p=mE(r,[r.shape[0],r.shape[1]]);return nT(n,p)}});jw().prototype.dot=function(e){return this.throwIfDisposed(),mR(this,e)},jw().prototype.elu=function(){return this.throwIfDisposed(),UE(this)},jw().prototype.equal=function(e){return this.throwIfDisposed(),BE(this,e)};var gR=kk({erf_:function(e){var t=xk(e,"x","erf");og("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=DS(t,"float32"));var n={x:t};return dk.runKernel(Hy,n)}});jw().prototype.erf=function(){return this.throwIfDisposed(),gR(this)};var yR=kk({euclideanNorm_:function(e){return YM(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});jw().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),yR(this,e,t)},jw().prototype.exp=function(){return this.throwIfDisposed(),WE(this)},jw().prototype.expandDims=function(e){return this.throwIfDisposed(),VE(this,e)};var bR=kk({expm1_:function(e){var t={x:xk(e,"x","expm1")};return dk.runKernel(Ky,t)}});jw().prototype.expm1=function(){return this.throwIfDisposed(),bR(this)},jw().prototype.fft=function(){return this.throwIfDisposed(),eM(this)},jw().prototype.flatten=function(){return this.throwIfDisposed(),mE(this,[this.size])},jw().prototype.floor=function(){return this.throwIfDisposed(),jE(this)},jw().prototype.floorDiv=function(e){return this.throwIfDisposed(),jS(this,e)},jw().prototype.gather=function(e,t,n){return this.throwIfDisposed(),XE(this,e,t,n)},jw().prototype.greaterEqual=function(e){return this.throwIfDisposed(),KE(this,e)},jw().prototype.greater=function(e){return this.throwIfDisposed(),qE(this,e)},jw().prototype.ifft=function(){return this.throwIfDisposed(),nM(this)},jw().prototype.irfft=function(){return this.throwIfDisposed(),rM(this)};var xR=kk({isFinite_:function(e){var t={x:xk(e,"x","isFinite")};return dk.runKernel(ub,t)}});jw().prototype.isFinite=function(){return this.throwIfDisposed(),xR(this)};var wR=kk({isInf_:function(e){var t={x:xk(e,"x","isInf")};return dk.runKernel(lb,t)}});jw().prototype.isInf=function(){return this.throwIfDisposed(),wR(this)};var kR=kk({isNaN_:function(e){var t={x:xk(e,"x","isNaN")};return dk.runKernel(cb,t)}});jw().prototype.isNaN=function(){return this.throwIfDisposed(),kR(this)},jw().prototype.leakyRelu=function(e){return this.throwIfDisposed(),YE(this,e)},jw().prototype.lessEqual=function(e){return this.throwIfDisposed(),VM(this,e)},jw().prototype.less=function(e){return this.throwIfDisposed(),XM(this,e)};var SR=kk({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=xk(e,"x","localResponseNormalization");og(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),og(hg(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=mE(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},l={depthRadius:t,bias:n,alpha:r,beta:a},c=dk.runKernel(xb,u,l);return s?mE(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});jw().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),SR(this,e,t,n,r)};var _R=kk({logSigmoid_:function(e){var t=xk(e,"x","logSigmoid");return JS((function(e){return{value:mT(WT(mT(e))),gradFunc:function(t){return qS(t,PT(mT(e)))}}}))(t)}});jw().prototype.logSigmoid=function(){return this.throwIfDisposed(),_R(this)},jw().prototype.logSoftmax=function(e){return this.throwIfDisposed(),eT(this,e)},jw().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),tC(this,e,t)},jw().prototype.log=function(){return this.throwIfDisposed(),ZE(this)},jw().prototype.log1p=function(){return this.throwIfDisposed(),JE(this)},jw().prototype.logicalAnd=function(e){return this.throwIfDisposed(),tT(this,e)},jw().prototype.logicalNot=function(){return this.throwIfDisposed(),FA(this)};var ER=kk({logicalOr_:function(e,t){var n=xk(e,"a","logicalOr","bool"),r=xk(t,"b","logicalOr","bool");d_(n.shape,r.shape);var a={a:n,b:r};return dk.runKernel(bb,a)}});jw().prototype.logicalOr=function(e){return this.throwIfDisposed(),ER(this,e)};var TR=kk({logicalXor_:function(e,t){var n=xk(e,"a","logicalXor","bool"),r=xk(t,"b","logicalXor","bool");return d_(n.shape,r.shape),tT(ER(e,t),FA(tT(e,t)))}});jw().prototype.logicalXor=function(e){return this.throwIfDisposed(),TR(this,e)},jw().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),nT(this,e,t,n)},jw().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),rT(this,e,t,n,r)},jw().prototype.max=function(e,t){return this.throwIfDisposed(),QE(this,e,t)},jw().prototype.maximum=function(e){return this.throwIfDisposed(),f_(this,e)},jw().prototype.mean=function(e,t){return this.throwIfDisposed(),iT(this,e,t)},jw().prototype.min=function(e,t){return this.throwIfDisposed(),oT(this,e,t)},jw().prototype.minimum=function(e){return this.throwIfDisposed(),sT(this,e)};var MR=kk({mirrorPad_:function(e,t,n){og("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var r=xk(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");og(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){og(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),og(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(r.shape[e]-a," or less than 0 for input of ")+"shape ".concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return dk.runKernel(Nb,u,s)}});jw().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),MR(this,e,t)};var CR=kk({mod_:function(e,t){var n=xk(e,"a","mod"),r=xk(t,"b","mod"),a=x(rk(n,r),2),i={a:n=a[0],b:r=a[1]};return dk.runKernel(Lb,i)}});jw().prototype.mod=function(e){return this.throwIfDisposed(),CR(this,e)},jw().prototype.mul=function(e){return this.throwIfDisposed(),qS(this,e)},jw().prototype.neg=function(){return this.throwIfDisposed(),mT(this)},jw().prototype.norm=function(e,t,n){return this.throwIfDisposed(),YM(this,e,t,n)},jw().prototype.notEqual=function(e){return this.throwIfDisposed(),gT(this,e)},jw().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),yT(this,e,t,n)},jw().prototype.onesLike=function(){return this.throwIfDisposed(),wT(this)},jw().prototype.pad=function(e,t){return this.throwIfDisposed(),kT(this,e,t)};var IR=kk({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=xk(e,"x","maxPool"),u=s,l=!1;3===s.rank&&(l=!0,u=mE(s,[1,s.shape[0],s.shape[1],s.shape[2]])),og(dE(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")}));var c,h=nE(u.shape,t,i,a,r),d=[h.dilationHeight,h.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})),r=n.map((function(e){return e-1})),a=r.map((function(e){return Math.floor(e/2)})),i=r.map((function(e,t){return e-a[t]}));return r.map((function(e,t){return[a[t],i[t]]}))}([h.filterHeight,h.filterWidth],d):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],p=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),l=t.map((function(e,t){return[0,o[t]]}));return[u,l]}([h.inHeight,h.inWidth],d,c),v=x(p,2),m=v[0],g=v[1],y=f?r:"valid",b=f?u:fI(u,d,m),w=("avg"===n?function(){return gE(b,t,i,y,o)}:function(){return rT(b,t,i,y,o)})(),k=f?w:KA(w,d,g);return l?mE(k,[k.shape[1],k.shape[2],k.shape[3]]):k}});jw().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),IR(this,e,t,n,r,a,i)},jw().prototype.pow=function(e){return this.throwIfDisposed(),o_(this,e)},jw().prototype.prelu=function(e){return this.throwIfDisposed(),ST(this,e)};var AR=kk({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=xk(e,"x","prod");"bool"===r.dtype&&(r=DS(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return dk.runKernel(qb,a,i)}});jw().prototype.prod=function(e,t){return this.throwIfDisposed(),AR(this,e,t)};var RR=kk({reciprocal_:function(e){var t={x:xk(e,"x","reciprocal")};return dk.runKernel($b,t)}});jw().prototype.reciprocal=function(){return this.throwIfDisposed(),RR(this)},jw().prototype.relu=function(){return this.throwIfDisposed(),AT(this)},jw().prototype.relu6=function(){return this.throwIfDisposed(),iM(this)},jw().prototype.reshapeAs=function(e){return this.throwIfDisposed(),mE(this,e.shape)},jw().prototype.reshape=function(e){return this.throwIfDisposed(),mE(this,e)},jw().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),UM(this,e,t,n)},jw().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),BM(this,e,t,n)},jw().prototype.reverse=function(e){return this.throwIfDisposed(),RT(this,e)},jw().prototype.rfft=function(){return this.throwIfDisposed(),tM(this)},jw().prototype.round=function(){return this.throwIfDisposed(),GM(this)},jw().prototype.rsqrt=function(){return this.throwIfDisposed(),BI(this)},jw().prototype.selu=function(){return this.throwIfDisposed(),NT(this)},jw().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),LT(this,e,t,n,r,a,i)},jw().prototype.sigmoid=function(){return this.throwIfDisposed(),PT(this)};var NR=kk({sign_:function(e){var t={x:xk(e,"x","sign")};return dk.runKernel(yx,t)}});jw().prototype.sign=function(){return this.throwIfDisposed(),NR(this)},jw().prototype.sin=function(){return this.throwIfDisposed(),EI(this)},jw().prototype.sinh=function(){return this.throwIfDisposed(),MI(this)},jw().prototype.slice=function(e,t){return this.throwIfDisposed(),DT(this,e,t)},jw().prototype.softmax=function(e){return this.throwIfDisposed(),BT(this,e)},jw().prototype.softplus=function(){return this.throwIfDisposed(),WT(this)},jw().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),fI(this,e,t)},jw().prototype.split=function(e,t){return this.throwIfDisposed(),VT(this,e,t)},jw().prototype.sqrt=function(){return this.throwIfDisposed(),KS(this)},jw().prototype.square=function(){return this.throwIfDisposed(),YS(this)},jw().prototype.squaredDifference=function(e){return this.throwIfDisposed(),eC(this,e)},jw().prototype.squeeze=function(e){return this.throwIfDisposed(),GT(this,e)},jw().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof Hw?[this,e]:[this].concat(g(e));return HT(n,t)},jw().prototype.step=function(e){return this.throwIfDisposed(),oM(this,e)};var LR=kk({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l={x:xk(e,"x","stridedSlice","string_or_numeric")},c={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return dk.runKernel(Px,l,c)}});jw().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),LR(this,e,t,n,r,a,i,o,s)},jw().prototype.sub=function(e){return this.throwIfDisposed(),s_(this,e)},jw().prototype.sum=function(e,t){return this.throwIfDisposed(),$E(this,e,t)};var PR=kk({tan_:function(e){var t={x:xk(e,"x","tan","float32")};return dk.runKernel(Ux,t)}});jw().prototype.tan=function(){return this.throwIfDisposed(),PR(this)},jw().prototype.tanh=function(){return this.throwIfDisposed(),jT(this)},jw().prototype.tile=function(e){return this.throwIfDisposed(),GE(this,e)},jw().prototype.toBool=function(){return this.throwIfDisposed(),DS(this,"bool")},jw().prototype.toFloat=function(){return this.throwIfDisposed(),DS(this,"float32")},jw().prototype.toInt=function(){return this.throwIfDisposed(),DS(this,"int32")};var DR=kk({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=xk(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));var i={x:r},o={k:t,sorted:n},s=x(dk.runKernel(Vx,i,o),2);return{values:s[0],indices:s[1]}}});jw().prototype.topk=function(e,t){return this.throwIfDisposed(),DR(this,e,t)},jw().prototype.transpose=function(e){return this.throwIfDisposed(),QT(this,e)};var FR=kk({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=xk(e,"x","unique","string_or_numeric");og(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=x(dk.runKernel(jx,r,a),2);return{values:i[0],indices:i[1]}}});jw().prototype.unique=function(e){return this.throwIfDisposed(),FR(this,e)},jw().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),VI(this,e,t)},jw().prototype.unstack=function(e){return this.throwIfDisposed(),KT(this,e)},jw().prototype.where=function(e,t){return this.throwIfDisposed(),YT(e,this,t)},jw().prototype.zerosLike=function(){return this.throwIfDisposed(),ZS(this)};var OR=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this,e),Object.setPrototypeOf(A(r),n.prototype),r}return M(n)}(P(Error)),zR=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this,e),Object.setPrototypeOf(A(r),n.prototype),r}return M(n)}(P(Error)),UR=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this,e),Object.setPrototypeOf(A(r),n.prototype),r}return M(n)}(P(Error)),BR=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this,e),Object.setPrototypeOf(A(r),n.prototype),r}return M(n)}(P(Error)),WR=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this,e),Object.setPrototypeOf(A(r),n.prototype),r}return M(n)}(P(Error)),VR=(Error,function(){function e(t){E(this,e),this.maxEntries=t||100,this.cache=new Map}return M(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}());function GR(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function HR(e,t){if(!e)throw new WR(t)}function jR(e,t){var n,r=0,a=N(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(R0){a.e(R0)}finally{a.f()}return r}function XR(e){return 1===e.length?e[0]:e}function qR(e){return Array.isArray(e)?e:[e]}function KR(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function YR(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var ZR={};function JR(e){if(null===e||void 0===e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function QR(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((function(e){return QR(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"===typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!==typeof a.value?QR(a):e[r]=a.value)}}function $R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){var i,o=e;if(o in n)i=n[o];else if(o in ZR)i=ZR[o];else if(null==(i=t[o]))throw new UR("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}var s=e;if(null==s.className||null==s.config)throw new UR("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(s),".\n")+"'className' and 'config' must set.");var u,l,c=s.className;if(c in n){var h=x(n[c],2);u=h[0],l=h[1]}else if(c in ZR){var d=x(ZR.className,2);u=d[0],l=d[1]}else if(c in t){var f=x(t[c],2);u=f[0],l=f[1]}if(null==u)throw new UR("Unknown ".concat(r,": ").concat(c,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=l){for(var p={},v=0,m=Object.keys(ZR);v<m.length;v++){var g=m[v];p[g]=ZR[g]}for(var y=0,b=Object.keys(n);y<b.length;y++){var w=b[y];p[w]=n[w]}s.config.customObjects=p;for(var k=Object.assign({},ZR),S=0,_=Object.keys(n);S<_.length;S++){var E=_[S];ZR[E]=n[E]}QR(s.config);var T=l(u,s.config,n,a);return ZR=Object.assign({},k),T}for(var M=Object.assign({},ZR),C=0,I=Object.keys(n);C<I.length;C++){var A=I[C];ZR[A]=n[A]}var R=new u(s.config);return ZR=Object.assign({},M),R}function eN(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function tN(e){if(null==e)return e;var t,n=[],r=N(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(R0){r.e(R0)}finally{r.f()}return n}function nN(e){if(null==e)throw new UR("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function rN(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new UR("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function aN(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return HR(n>=0),HR(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function iN(e,t){Array.isArray(e)?(og(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return iN(e,"element ".concat(n+1," of ").concat(t))}))):og(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+"".concat(oN(e),".")}))}function oN(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return oN(e)})).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function sN(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var uN=0;function lN(){return uN++}var cN={};function hN(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in cN||(cN[e]=0),cN[e]+=1,e+cN[e].toString()}var dN=["channelsFirst","channelsLast"],fN=["nearest","bilinear"],pN=["valid","same","causal"],vN=["max","avg"],mN=["sum","mul","concat","ave"],gN=new Map;function yN(e){rN(dN,"DataFormat",e)}function bN(e){rN(pN,"PaddingMode",e)}function xN(e){rN(vN,"PoolMode",e)}var wN=[],kN="/";function SN(e,t){wN.push(e);try{var n=t();return wN.pop(),n}catch(r){throw wN.pop(),r}}function _N(e){if(!CN(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===wN.length?"":wN.join(kN)+kN)+e}function EN(e){if(!CN(e))throw new Error("Not a valid tensor name: '"+e+"'");gN.has(e)||gN.set(e,0);var t=gN.get(e);if(gN.set(e,gN.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return gN.set(n,1),n}return e}var TN,MN=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function CN(e){return!!e.match(MN)}function IN(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function AN(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function RN(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function NN(e,t){if(t<e)throw new UR("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function LN(){return null==TN&&(TN=dk.backend.epsilon()),TN}function PN(e,t){return DS(e,t)}function DN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),mE(e,n)}function FN(e,t,n){return BS((function(){switch(e.rank){case 1:return FT(e,t,n);case 2:return OT(e,[t,0],[n,e.shape[1]]);case 3:return zT(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return UT(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return DT(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return DT(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new UR("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function ON(e,t,n){return BS((function(){switch(e.rank){case 1:return FT(e,t,n);case 2:return OT(e,[0,t],[e.shape[0],n]);case 3:return zT(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return UT(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new UR("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function zN(e,t,n,r){return BS((function(){switch(e.rank){case 1:return FT(e,t,n);case 2:switch(r){case 1:return FN(e,t,n);case 2:return ON(e,t,n);default:throw new UR("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return FN(e,t,n);case 2:return zT(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return ON(e,t,n);default:throw new UR("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return FN(e,t,n);case 2:return UT(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return UT(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return ON(e,t,n);default:throw new UR("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new UR("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function UN(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),EE(e,n)}function BN(e,t){switch(e.rank){case 1:return TE([e,t]);case 2:return ME([e,t],0);case 3:return CE([e,t],0);case 4:return IE([e,t],0);default:throw new UR("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function WN(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new UR("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return GE(e,t)}function VN(e){return MT(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function GN(e,t,n,r){if(e.rank<2||t.rank<2)throw new BR("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new BR("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape));if(2===e.rank&&2===t.rank){return pM({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?XN(e.rank,r,"channelsLast"):null,activation:n})}var a=e.shape.slice(),i=a.pop();e=mE(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),l=[].concat(g(o),[s]),c=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=mE(QT(t,c),[u,-1]);var h=[].concat(g(a),g(l));return mE(pM({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?XN(e.rank,r,"channelsLast"):null,activation:n}),h)}function HN(e,t,n){return BS((function(){return t=Array.isArray(t)?XT(t,"int32"):DS(t,"int32"),XE(e,t,n)}))}function jN(e){return qS(e,e)}function XN(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new UR("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?mE(t,[1,r[0],1,1,1]):mE(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?mE(t,[1,1,1,1,r[0]]):mE(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?mE(t,[1,r[0],1,1]):mE(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?mE(t,[1,1,1,r[0]]):mE(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?mE(t,[1,r[0],1]):mE(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?mE(t,[1,1,r[0]]):mE(t,[1].concat(r))}else if(e<3)return t;throw new UR("Unsupported input rank by biasAdd: ".concat(t.rank))}function qN(e,t,n){return BS((function(){return null==n&&(n="channelsLast"),yN(n),HS(e,XN(e.rank,t,n))}))}function KN(e,t,n,r){return BS((function(){return $T(e,t,n,r)}))}function YN(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}var ZN=["fanIn","fanOut","fanAvg"],JN=["normal","uniform","truncatedNormal"];var QN=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}($S),$N=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e,t){return bT(e,t)}}]),n}(QN);$N.className="Zeros",t_($N);var eL=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e,t){return xT(e,t)}}]),n}(QN);eL.className="Ones",t_(eL);var tL=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),r=t.call(this),"object"!==typeof e)throw new UR("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new UR("config must have value set but got ".concat(e));return r.value=e.value,r}return M(n,[{key:"apply",value:function(e,t){var n=this;return BS((function(){return qS(QS(n.value),xT(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(QN);tL.className="Constant",t_(tL);var nL=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return M(n,[{key:"apply",value:function(e,t){return CT(e,this.minval,this.maxval,t,this.seed)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(QN);nL.className="RandomUniform",t_(nL);var rL=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return M(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new BR("randomNormal does not support dType ".concat(t,"."));return VN(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(QN);rL.className="RandomNormal",t_(rL);var aL=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return M(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new BR("truncatedNormal does not support dType ".concat(t,"."));return qT(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(QN);aL.className="TruncatedNormal",t_(aL);var iL=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return M(n,[{key:"apply",value:function(e,t){var n=this;return BS((function(){if(2!==e.length||e[0]!==e[1])throw new UR("Identity matrix initializer can only be used for 2D square matrices.");return qS(n.gain,HE(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(QN);iL.className="Identity",t_(iL);var oL=function(e){C(n,e);var t=R(n);function n(e){var r,a;if(E(this,n),r=t.call(this),e.scale<0)throw new UR("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,a=r.mode,rN(ZN,"FanMode",a),r.distribution=null==e.distribution?"normal":e.distribution,function(e){rN(JN,"Distribution",e)}(r.distribution),r.seed=e.seed,r}return M(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(yN(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=IN(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=IN(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=IN(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new BR("".concat(this.getClassName()," does not support dType ").concat(t,"."));return qT(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return CT(e,-s,s,t,this.seed)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(QN);oL.className="VarianceScaling",t_(oL);var sL=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return M(n,[{key:"getClassName",value:function(){return oL.className}}]),n}(oL);sL.className="GlorotUniform",t_(sL);var uL=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return M(n,[{key:"getClassName",value:function(){return oL.className}}]),n}(oL);uL.className="GlorotNormal",t_(uL);var lL=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return M(n,[{key:"getClassName",value:function(){return oL.className}}]),n}(oL);lL.className="HeNormal",t_(lL);var cL=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return M(n,[{key:"getClassName",value:function(){return oL.className}}]),n}(oL);cL.className="HeUniform",t_(cL);var hL=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return M(n,[{key:"getClassName",value:function(){return oL.className}}]),n}(oL);hL.className="LeCunNormal",t_(hL);var dL=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return M(n,[{key:"getClassName",value:function(){return oL.className}}]),n}(oL);dL.className="LeCunUniform",t_(dL);var fL=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.ELEMENTS_WARN_SLOW=2e3,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,r}return M(n,[{key:"apply",value:function(e,t){var n=this;return BS((function(){if(e.length<2)throw new BR("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));var r=lg(e.slice(0,-1)),a=e[e.length-1],i=r*a;i>n.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(n.ELEMENTS_WARN_SLOW," (").concat(i,") elements: ")+"Slowness may result.");var o=VN([Math.max(a,r),Math.min(a,r)],0,1,t,n.seed),s=aC.qr(o,!1),u=s[0],l=s[1].flatten().stridedSlice([0],[Math.min(a,r)*Math.min(a,r)],[Math.min(a,r)+1]);return u=qS(u,l.sign()),r<a&&(u=u.transpose()),qS(QS(n.gain),u.reshape(e))}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(QN);fL.className="Orthogonal",t_(fL);var pL={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function vL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $R(e,e_.getMap().classNameMap,t,"initializer")}function mL(e){return JR(e)}function gL(e){if("string"===typeof e){var t=e in pL?pL[e]:e;if("GlorotNormal"===t)return new uL;if("GlorotUniform"===t)return new sL;if("HeNormal"===t)return new lL;if("HeUniform"===t)return new cL;if("LeCunNormal"===t)return new hL;if("LeCunUniform"===t)return new dL;var n={};return n.className=t,n.config={},vL(n)}return e instanceof QN?e:vL(e)}function yL(e){return Array.isArray(e)&&Array.isArray(e[0])}function bL(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function xL(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new UR("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function wL(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new UR("Expected exactly 1 Shape; got ".concat(e.length))}return e}function kL(e){var t,n=0,r=N(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(R0){r.e(R0)}finally{r.f()}return n}var SL="Variable",_L=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:SL,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;E(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=lN(),r=null==r?SL:r,this.originalName=_N(r),this.name=EN(this.originalName),this.trainable_=a,this.constraint=i,this.val=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return dk.makeVariable(e,t,n,r)}(t,this.trainable_,this.name,this.dtype)}return M(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function EL(e){return e.map((function(e){return e.read()}))}function TL(e){e.forEach((function(e){e[0].write(e[1])}))}var ML=M((function e(t){E(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),CL=M((function e(t,n,r,a,i,o,s){E(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=lN(),null!=o&&(this.originalName=_N(o),this.name=EN(this.originalName)),this.rank=n.length})),IL=0,AL=function(){function e(t,n){E(this,e),this.callArgs=n,this.id=IL++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=N(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(R0){a.e(R0)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return M(e,[{key:"getConfig",value:function(){var e,t=[],n=N(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(R0){n.e(R0)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),RL=0,NL=function(e){C(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=RL++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=KR(i)+"_"+hN(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return M(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new zR("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new UR("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return XR(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return XR(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new OR("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new OR("Layer ".concat(this.name)+" is not connected, no input to return.");return XR(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new OR("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new OR("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return XR(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=qR(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=qR(this.inputSpec);if(e.length!==t.length)throw new UR("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new UR("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new UR("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new UR("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new UR("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),l=a.axes[s],c=u>=0?o[u]:o[o.length+u];if(null!=l&&-1===[l,null].indexOf(c))throw new UR("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(u," of input shape to ")+"have value ".concat(l," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var h=0;h<a.shape.length;++h){var d=a.shape[h],f=r.shape[h];if(null!=d&&null!=f&&d!==f)throw new UR("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=qR(e),i=!0,o=N(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof CL)){i=!1;break}}}catch(R0){o.e(R0)}finally{o.f()}var s,u=!0,l=N(a);try{for(l.s();!(s=l.n()).done;){if(s.value instanceof CL){u=!1;break}}}catch(R0){l.e(R0)}finally{l.f()}if(i===u)throw new UR("Arguments to apply() must be all SymbolicTensors or all Tensors");return SN(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=N(qR(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(R0){o.e(R0)}finally{o.f()}n.build(XR(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var l,c=n.call(e,t),h=[],d=N(qR(c));try{for(d.s();!(l=d.n()).done;){var f=l.value;-1!==a.indexOf(f)&&(f=f.clone()),h.push(f)}}catch(R0){d.e(R0)}finally{d.f()}if(c=XR(h),null!=n.activityRegularizer)throw new BR("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}var p,v=function(e){e=qR(e);var t,n=[],r=N(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(R0){r.e(R0)}finally{r.f()}return XR(n)}(e),m=n.computeOutputShape(v),g="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?v[0]:v),p=null!=m&&m.length>0&&Array.isArray(m[0])?m.map((function(r,a){return new CL(g,r,n,qR(e),t,n.name,a)})):new CL(g,m,n,qR(e),t,n.name),n.addInboundNode(e,p,null,null,v,m,t),n._refCount++,null!=n.activityRegularizer)throw new BR("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new OR("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var e,t=[],n=N(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(R0){n.e(R0)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new OR("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}},{key:"countParams",value:function(){if(!this.built)throw new zR("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return kL(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return EL(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;BS((function(){var n=t.weights;if(n.length!==e.length)throw new UR('You called setWeights(weights) on layer "'.concat(t.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(n.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0!==n.length){for(var r=[],a=EL(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!cg(o.shape,u.shape))throw new UR("Layer weight shape ".concat(o.shape," ")+"not compatible with provided weight shape ".concat(u.shape));r.push([s,u])}TL(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new UR("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():gL("zeros"));var u=r.apply(t,n),l=new _L(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(l.read())})),null==i&&(i=!0),i?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=qR(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,g(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=qR(e);t=qR(t),n=qR(n),r=qR(r),a=bL(a),i=bL(i);var u,l=[],c=[],h=[],d=N(s);try{for(d.s();!(u=d.n()).done;){var f=u.value;l.push(f.sourceLayer),c.push(f.nodeIndex),h.push(f.tensorIndex)}}catch(R0){d.e(R0)}finally{d.f()}new AL({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:h,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}($S);function LL(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=N(LL(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(s.s();!(o=s.n()).done;){var u=o.value;-1===a.indexOf(u)&&a.push(u)}}catch(R0){s.e(R0)}finally{s.f()}}return a}var PL=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:hN("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new UR("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new UR("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new UR("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new CL(r.dtype,r.batchInputShape,A(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new AL({outboundLayer:A(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return M(n,[{key:"apply",value:function(e,t){throw new UR("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(NL);PL.className="InputLayer",t_(PL);var DL=function(){function e(t){if(E(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=N(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(R0){a.e(R0)}finally{a.f()}}}return M(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new UR("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return DS(t,e.dtype)}catch(R0){throw new UR("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof CL){if(null==this.id2Value[e.id])throw new UR("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new UR("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof CL){if(null==this.id2Value[e.id])throw new UR("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new UR("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&WS(this.id2Mask)}}]),e}(),FL=new VR,OL=new VR;function zL(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),l=[],c=t.names(),h=N(u);try{for(h.s();!(a=h.n()).done;){var d=a.value;-1!==c.indexOf(d)?l.push(t.getValue(d)):l.push(null)}}catch(R0){h.e(R0)}finally{h.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var f,p=u.join(",")+"|"+t.names().sort().join(","),v=FL.get(p);if(null==v){var m=function(e,t){og(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=BL(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=N(e);try{for(s.s();!(i=s.n()).done;){var u,l=BL(i.value,t),c=l.sorted,h=l.recipientMap,d=N(c);try{for(d.s();!(u=d.n()).done;){var f=u.value;o.has(f.name)||(n.push(f),o.add(f.name))}}catch(R0){d.e(R0)}finally{d.f()}var p=function(e){null==r[e]&&(r[e]=new Set),h[e].forEach((function(t){return r[e].add(t)}))};for(var v in h)p(v)}}catch(R0){s.e(R0)}finally{s.f()}}return{sorted:n,recipientCounts:UL(r)}}(s,t);v=m.sorted,f=m.recipientCounts,FL.put(p,v),OL.put(p,f)}f={},i||Object.assign(f,OL.get(p));for(var g=new DL(t),y=0;y<v.length;++y){if(null!=r){var b=US().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var x=v[y],w=x.sourceLayer;if(!(w instanceof PL)){var k,S=[],_=[],E=[],T=!1,M=N(x.inputs);try{for(M.s();!(k=M.n()).done;){var C=k.value,I=g.getValue(C),A=g.getMask(C);S.push(I),_.push(A),null!=A&&(T=!0),i||(f[C.name]--,0!==f[C.name]||t.hasKey(C)||-1!==u.indexOf(C.name)||I.isDisposed||!0===C.sourceLayer.stateful||E.push(I))}}catch(R0){M.e(R0)}finally{M.f()}T&&((n=n||{}).mask=_[0]);var R=qR(w.apply(S,n)),L=null;w.supportsMasking&&(L=w.computeMask(S,_));for(var P=WL(x),D=Array.isArray(P)?P:[P],F=0;F<D.length;++F){g.hasKey(D[F])||g.add(D[F],R[F],Array.isArray(L)?L[0]:L);var O=u.indexOf(D[F].name);-1!==O&&(l[O]=R[F])}i||WS(E)}}return g.disposeMasks(),o?l:l[0]}function UL(e){var t={};for(var n in e)t[n]=e[n].size;return t}function BL(e,t){var n,r=new Set,a=[],i={},o=N(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(R0){o.e(R0)}finally{o.f()}var u=[],l=[];for(u.push(e);u.length>0;){var c=u[u.length-1];if(r.has(c.name))u.pop();else{var h=l[l.length-1]===u.length-1;if(0===c.inputs.length||h)u.pop(),a.push(c),r.add(c.name),h&&l.pop();else{l.push(u.length-1);var d,f=N(c.inputs);try{for(f.s();!(d=f.n()).done;){var p=d.value;null==i[p.name]&&(i[p.name]=new Set),i[p.name].add(c.name),r.has(p.name)||u.push(p)}}catch(R0){f.e(R0)}finally{f.f()}}}}return{sorted:a,recipientMap:i}}function WL(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=N(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(R0){i.e(R0)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function VL(e,t){return BS((function(){return KS($E(qS(e,e),t,!0))}))}Bg().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=FL&&FL.setMaxEntries(e),null!=OL&&OL.setMaxEntries(e)}));var GL=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"getConfig",value:function(){return{}}}]),n}($S),HL=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return M(n,[{key:"apply",value:function(e){var t=this;return BS((function(){var n=VL(e,t.axis),r=_E(n,0,t.maxValue);return qS(e,XS(r,HS(LN(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(GL);HL.className="MaxNorm",t_(HL);var jL=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return M(n,[{key:"apply",value:function(e){var t=this;return BS((function(){return XS(e,HS(LN(),VL(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(GL);jL.className="UnitNorm",t_(jL);var XL=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return AT(e)}}]),n}(GL);XL.className="NonNeg",t_(XL);var qL=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return M(n,[{key:"apply",value:function(e){var t=this;return BS((function(){var n=VL(e,t.axis),r=HS(qS(t.rate,_E(n,t.minValue,t.maxValue)),qS(1-t.rate,n));return qS(e,XS(r,HS(LN(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(GL);qL.className="MinMaxNorm",t_(qL);var KL,YL={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function ZL(e){return JR(e)}function JL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $R(e,e_.getMap().classNameMap,t,"constraint")}function QL(e){return null==e?null:"string"===typeof e?JL({className:e in YL?YL[e]:e,config:{}}):e instanceof GL?e:JL(e)}function $L(e){return eP.apply(this,arguments)}function eP(){return eP=c(u().mark((function e(t){var n,r,a,i,o,s,l,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!==typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=12;break}return e.next=9,Promise.all(n);case 9:for(l=e.sent,c=0;c<l.length;++c)t[r[c]]=l[c][0];WS(a);case 12:case"end":return e.stop()}}),e)}))),eP.apply(this,arguments)}function tP(e){if(null!=e)for(var t in e){var n=e[t];"number"!==typeof n&&n.dispose()}}!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(KL||(KL={}));var nP=function(){function e(){E(this,e),this.validationData=null}return M(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),rP=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;E(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return M(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=N(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(R0){n.e(R0)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=N(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(R0){n.e(R0)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=c(u().mark((function e(t,n){var r,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=N(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(u().mark((function e(t,n){var r,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=N(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=c(u().mark((function e(t,n){var r,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=N(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=c(u().mark((function e(t,n){var r,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=N(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=c(u().mark((function e(t){var n,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=N(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=c(u().mark((function e(t){var n,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=N(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),aP=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.call(this)}return M(n,[{key:"onEpochBegin",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=c(u().mark((function e(t,n){var r,a,i,o=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=u().mark((function e(t){var a,i,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"number"===typeof(a=n[t])?(o.totals.hasOwnProperty(t)||(o.totals[t]=0),o.totals[t]=o.totals[t]+a*r):(t in o.totals?i=o.totals[t]:o.totals[t]=0,s=BS((function(){return HS(o.totals[t],qS(a,r))})),o.totals[t]=s,null!=i&&i.dispose());case 2:case"end":return e.stop()}}),e)})),e.t0=u().keys(n);case 5:if((e.t1=e.t0()).done){e.next=10;break}return i=e.t1.value,e.delegateYield(a(i),"t2",8);case 8:e.next=5;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(u().mark((function e(t,n){var r,a,i,o=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=20;break}r=N(this.params.metrics),e.prev=2,i=u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.value,null!=o.totals[t]){e.next=3;break}return e.abrupt("return","continue");case 3:"number"===typeof o.totals[t]?n[t]=o.totals[t]/o.seen:BS((function(){var e=qS(XS(1,o.seen),o.totals[t]);n[t]=e,o.totals[t].dispose(),VS(n[t])}));case 4:case"end":return e.stop()}}),e)})),r.s();case 5:if((a=r.n()).done){e.next=12;break}return e.delegateYield(i(),"t0",7);case 7:if("continue"!==e.t0){e.next=10;break}return e.abrupt("continue",10);case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(2),r.e(e.t1);case 17:return e.prev=17,r.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[2,14,17,20]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(nP),iP=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"onTrainBegin",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=c(u().mark((function e(){var t,n,r,a,i,o,s,l,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!==typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=6,Promise.all(t);case 6:for(l=e.sent,c=0;c<l.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=l[c][0];case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(nP),oP=function(e){C(n,e);var t=R(n);function n(e,r){var a;if(E(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||uC,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Sg(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():Tw();return function(){var i=null!=n?n():Tw();return i-a<t?r:(a=i,r=e.apply(void 0,arguments))}}(a.maybeWait.bind(A(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,a}return M(n,[{key:"maybeWait",value:function(){var e=c(u().mark((function e(t,n,r){var a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],null==this.yield){e.next=5;break}return e.next=4,$L(r);case 4:a.push(this.yield(t,n,r));case 5:return a.push(this.nextFrameFunc()),e.next=8,Promise.all(a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,null==this.epochBegin){e.next=6;break}return e.next=4,$L(n);case 4:return e.next=6,this.epochBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.epochEnd){e.next=5;break}return e.next=4,$L(n);case 4:r.push(this.epochEnd(t,n));case 5:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.batchBegin){e.next=5;break}return e.next=3,$L(n);case 3:return e.next=5,this.batchBegin(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=c(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.batchEnd){e.next=5;break}return e.next=4,$L(n);case 4:r.push(this.batchEnd(t,n));case 5:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):Sg(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainBegin){e.next=5;break}return e.next=3,$L(t);case 3:return e.next=5,this.trainBegin(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainEnd){e.next=5;break}return e.next=3,$L(t);case 3:return e.next=5,this.trainEnd(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(nP);function sP(e,t){return null==e&&(e={}),e instanceof nP?[e]:Array.isArray(e)&&e[0]instanceof nP?e:qR(e).map((function(e){return new oP(e,t)}))}var uP=function(){function e(){E(this,e)}return M(e,null,[{key:"registerCallbackConstructor",value:function(t,n){og(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors){e.constructors[+n].forEach((function(e){if(e===t)throw new UR("Duplicate callback constructor.")}))}}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,g(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function lP(e,t,n,r,a,i,o,s,u){var l=new iP,c=[new aP].concat(g(uP.createCallbacks(t)));null!=e&&c.push.apply(c,g(e)),c.push(l);var h=new rP(c);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:h,history:l}}function cP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return $R(e,e_.getMap().classNameMap,t,"layer",n)}function hP(e,t){return BS((function(){"float32"!==e.dtype&&(e=DS(e,"float32"));var n=$E(jN(e),t,!0),r=a_(n.shape,LN()),a=KS(f_(n,r));return XS(e,a)}))}function dP(e,t){return BS((function(){return iT(jN(s_(t,e)),-1)}))}function fP(e,t){return BS((function(){return iT(l_(s_(t,e)),-1)}))}function pP(e,t){return BS((function(){var n=s_(e,t),r=_E(l_(e),LN(),Number.MAX_VALUE),a=l_(XS(n,r));return qS(100,iT(a,-1))}))}function vP(e,t){return BS((function(){var n=_E(t,LN(),Number.MAX_VALUE),r=ZE(HS(1,n)),a=_E(e,LN(),Number.MAX_VALUE),i=ZE(HS(1,a));return iT(jN(s_(r,i)),-1)}))}function mP(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return BS((function(){if(n)t=BT(t);else{var r=$E(t,t.shape.length-1,!0);t=XS(t,r)}return t=_E(t,LN(),1-LN()),mT($E(qS(DS(e,"float32"),ZE(t)),t.shape.length-1))}))}function gP(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return BS((function(){var r=DS(jE(function(e){var t=[IN(e.shape)];return mE(e,t)}(e)),"int32"),a=(t=_E(t,LN(),1-LN())).shape;return mP(mE(yT(r,a[a.length-1]),a),t,n)}))}function yP(e,t){return BS((function(){var n;return n=_E(t,LN(),1-LN()),n=ZE(XS(n,s_(1,n))),iT(function(e,t){if(!cg(e.shape,t.shape))throw new UR("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return BS((function(){var n=AT(t),r=mT(l_(t));return HS(s_(n,qS(t,e)),JE(WE(r)))}))}(e,n),-1)}))}function bP(e,t){return BS((function(){var n=_E(e,LN(),1),r=_E(t,LN(),1);return $E(qS(e,ZE(XS(n,r))),-1)}))}function xP(e,t){return BS((function(){var n=hP(e,-1),r=hP(t,-1),a=qS(n,r);return mT($E(a,-1))}))}uP.constructors={};var wP={meanSquaredError:dP,meanAbsoluteError:fP,meanAbsolutePercentageError:pP,meanSquaredLogarithmicError:vP,squaredHinge:function(e,t){return BS((function(){var n=f_(0,s_(1,qS(e,t)));return iT(jN(n),-1)}))},hinge:function(e,t){return BS((function(){var n=f_(0,s_(1,qS(e,t)));return iT(n,-1)}))},categoricalHinge:function(e,t){return BS((function(){var n=$E(qS(e,t),-1),r=QE(qS(s_(1,e),t),-1);return f_(0,HS(1,s_(r,n)))}))},logcosh:function(e,t){return BS((function(){var n=Math.log(2),r=s_(t,e),a=s_(HS(r,WT(qS(-2,r))),n);return iT(a,-1)}))},categoricalCrossentropy:mP,sparseCategoricalCrossentropy:gP,binaryCrossentropy:yP,kullbackLeiblerDivergence:bP,poisson:function(e,t){return BS((function(){var n=ZE(HS(LN(),t));return iT(s_(t,qS(e,n)),-1)}))},cosineProximity:xP};function kP(e){if("string"===typeof e){if(e in wP)return wP[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new UR(t)}return e}function SP(e,t){return BS((function(){var n=qS(.5,wT(t)),r=PN(qE(t,n),e.dtype);return iT(BE(e,r),-1)}))}function _P(e,t){return BS((function(){return PN(BE(eE(e,-1),eE(t,-1)),"float32")}))}function EP(e,t){return BS((function(){return DS($E(tT(BE(e,1),BE(t,1))),"float32")}))}function TP(e,t){return yP(e,t)}function MP(e,t){return e.rank===t.rank&&(e=GT(e,[e.rank-1])),(t=eE(t,-1)).dtype!==e.dtype&&(t=DS(t,e.dtype)),DS(BE(e,t),"float32")}var CP=mP,IP=gP,AP={binaryAccuracy:SP,categoricalAccuracy:_P,precision:function(e,t){return BS((function(){var n=EP(e,t),r=function(e,t){return BS((function(){return DS($E(tT(BE(e,0),BE(t,1))),"float32")}))}(e,t),a=HS(n,r);return DS(YT(qE(a,0),XS(n,a),0),"float32")}))},categoricalCrossentropy:CP,sparseCategoricalCrossentropy:IP,mse:dP,MSE:dP,mae:fP,MAE:fP,mape:pP,MAPE:pP,cosine:xP};function RP(e){if(HR(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;for(var t,n=0,r=Object.keys(wP);n<r.length;n++){var a=r[n];if(wP[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(AP);i<o.length;i++){var s=o[i];if(AP[s]===e){t=s;break}}return void 0!==t?t:e.name}var NP=1048576;function LP(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!PP(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>NP&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(NP,"."))}}function PP(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!==typeof r)return!1;if(!PP(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=N(e);try{for(i.s();!(a=i.n()).done;){if(!PP(a.value))return!1}}catch(R0){i.e(R0)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function DP(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,g(s))}if(t){var u,l=N(e.layers);try{for(l.s();!(u=l.n()).done;){var c,h=u.value,d=!1,f=N(h.inboundNodes);try{for(f.s();!(c=f.n()).done;){var p=c.value;if(-1!==r.indexOf(p)){if(d){t=!1;break}d=!0}}}catch(R0){f.e(R0)}finally{f.f()}if(!t)break}}catch(R0){l.e(R0)}finally{l.f()}}return t}(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,g(e.nodesByDepth[s]))}a("_".repeat(t)),FP(o,n,a),a("=".repeat(t));for(var l=e.layers,c=0;c<l.length;++c)i?OP(l[c],n,a):zP(l[c],n,r,a),a((c===l.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var h=function(e){var t;t=null!=e.collectedTrainableWeights?kL(e.collectedTrainableWeights):kL(e.trainableWeights);return t}(e),d=kL(e.nonTrainableWeights);a("Total params: ".concat(h+d)),a("Trainable params: ".concat(h)),a("Non-trainable params: ".concat(d)),a("_".repeat(t))}function FP(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function OP(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(R0){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(R0){r="multiple"}var i=e.name,o=e.getClassName();FP(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function zP(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(R0){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(R0){a="multiple"}var o,s=[],u=N(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var l=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(l)))for(var c=0;c<l.inboundLayers.length;++c){var h=l.inboundLayers[c].name,d=l.nodeIndices[c],f=l.tensorIndices[c];s.push("".concat(h,"[").concat(d,"][").concat(f,"]"))}}}catch(R0){u.e(R0)}finally{u.f()}var p=e.name,v=e.getClassName(),m=0===s.length?"":s[0];FP(["".concat(p," (").concat(v,")"),i,a,e.countParams().toString(),m],t,r);for(var g=1;g<s.length;++g)FP(["","","","",s[g]],t,r)}function UP(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function BP(e,t){if(null===e)return null;if("string"===typeof e)return YR(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];UP(t,a,i)?n.push(i):n.push(BP(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var l=u[s],c=e[l];if("name"===l&&"string"===typeof c)o[l]=c;else{var h=YR(l);o[h]=BP(c,h)}}return o}function WP(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return KR(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];UP(t,a,i)?n.push(i):n.push(WP(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var l=u[s],c=e[l],h=KR(l);o[h]="name"!==l&&"className"!==l||"string"!==typeof c?WP(c,l):c}return o}var VP="4.5.0",GP=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=hN(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],tN(r.inputs).length!==r.inputs.length)throw new UR("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(r.inputs.map((function(e){return e.name}))));tN(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=N(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,l=s.nodeIndex,c=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(l),r.outputLayersTensorIndices.push(c)}}catch(R0){o.e(R0)}finally{o.f()}var h,d=N(r.inputs);try{for(d.s();!(h=d.n()).done;){var f=h.value,p=f.sourceLayer,v=f.nodeIndex,m=f.tensorIndex;HR(0===v,"input layer has >1 nodes"),HR(0===m,"input layer has >1 tensors"),r.inputLayers.push(p),r.inputLayersNodeIndices.push(v),r.inputLayersTensorIndices.push(m)}}catch(R0){d.e(R0)}finally{d.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var g=0;g<r.inputLayers.length;g++){var y=r.inputLayers[g];if(!(y instanceof PL))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(g," (0-based) originates ")+"from layer type ".concat(y.getClassName(),"."));r.inputNames.push(y.name),r.feedInputShapes.push(y.batchInputShape),r.feedInputNames.push(y.name)}var b,x=N(r.outputLayers);try{for(x.s();!(b=x.n()).done;){var w=b.value;r.outputNames.push(w.name)}}catch(R0){x.e(R0)}finally{x.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var k,S={},_={},T={},M={},C={},I=[],R=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var l=o.inboundNodes[s];if(-1!==i.indexOf(l))throw new zR("The tensor ".concat(t.name,' at layer "').concat(o.name,'" ')+"is part of a cycle.");if(-1===a.indexOf(l)){r.containerNodes.add(n.nodeKey(o,s)),o.id in C||(C[o.id]=Object.keys(C).length),-1===i.indexOf(l)&&i.push(l);for(var c=l.inboundLayers.length,h=0;h<c;h++){e(l.inputTensors[h],a,i,l.inboundLayers[h],l.nodeIndices[h],l.tensorIndices[h])}for(a.push(l);i.indexOf(l)>=0;)i.splice(i.indexOf(l),1);I.push(l)}},L=[],P=[],D=N(r.outputs);try{for(D.s();!(k=D.n()).done;){R(k.value,L,P)}}catch(R0){D.e(R0)}finally{D.f()}var F,O=N(I.slice().reverse());try{for(O.s();!(F=O.n()).done;){var z=F.value;_[z.id]=z,z.id in S||(S[z.id]=0);var U=S[z.id],B=null==T[z.outboundLayer.id]?0:T[z.outboundLayer.id];U=Math.max(U,B),T[z.outboundLayer.id]=U,M[z.outboundLayer.id]=z.outboundLayer,S[z.id]=U;for(var W=0;W<z.inboundLayers.length;W++){var V=z.inboundLayers[W],G=z.nodeIndices[W],H=V.inboundNodes[G],j=null==S[H.id]?0:S[H.id];S[H.id]=Math.max(U+1,j),_[H.id]=H}}}catch(R0){O.e(R0)}finally{O.f()}var X={};for(var q in S){var K=S[q];K in X||(X[K]=[]),X[K].push(_[q])}var Y={};for(var Z in T){var J=T[Z];J in Y||(Y[J]=[]),Y[J].push(M[Z])}var Q=Object.keys(Y).map((function(e){return parseInt(e,10)})).sort(eN);r.layers=[];var $,ee=N(Q);try{for(ee.s();!($=ee.n()).done;){var te=Y[$.value];te.sort((function(e,t){var n=C[e.id],r=C[t.id];return n<r?-1:n>r?1:0}));var ne,re=N(te);try{for(re.s();!(ne=re.n()).done;){var ae=ne.value;ae instanceof n&&r.internalContainerRefs.push(ae),r.layers.push(ae)}}catch(R0){re.e(R0)}finally{re.f()}}}catch(R0){ee.e(R0)}finally{ee.f()}r.layersByDepth=Y,Q=Object.keys(X).map((function(e){return parseInt(e,10)})).sort(eN);var ie,oe=r.inputs.slice(),se=[],ue=N(Q);try{for(ue.s();!(ie=ue.n()).done;){var le,ce=N(X[ie.value]);try{for(ce.s();!(le=ce.n()).done;){var he=le.value,de=he.outboundLayer;if(null!=de){var fe,pe=N(he.inputTensors);try{for(pe.s();!(fe=pe.n()).done;){var ve=fe.value;if(-1===oe.indexOf(ve))throw new zR("Graph disconnected: cannot obtain value for tensor ".concat(ve)+' at layer "'.concat(de.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(se))}}catch(R0){pe.e(R0)}finally{pe.f()}var me,ge=N(he.outputTensors);try{for(ge.s();!(me=ge.n()).done;){var ye=me.value;oe.push(ye)}}catch(R0){ge.e(R0)}finally{ge.f()}se.push(de.name)}}}catch(R0){ce.e(R0)}finally{ce.f()}}}catch(R0){ue.e(R0)}finally{ue.f()}r.nodesByDepth=X;var be,xe=r.layers.map((function(e){return e.name})),we=N(xe);try{var ke=function(){var e=be.value,t=xe.filter((function(t){return t===e})).length;if(1!==t)throw new zR('The name "'.concat(e,'" is used ').concat(t," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(xe))};for(we.s();!(be=we.n()).done;)ke()}catch(R0){we.e(R0)}finally{we.f()}return r.outboundNodes=[],r.inboundNodes=[],new AL({outboundLayer:A(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return M(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=N(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(R0){n.e(R0)}finally{n.f()}var a,i=N(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(R0){i.e(R0)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new UR("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=N(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(R0){n.e(R0)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=N(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,g(r.nonTrainableWeights))}}catch(R0){n.e(R0)}finally{n.f()}if(!this.trainable){var a,i=[],o=N(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,g(s.trainableWeights))}}catch(R0){o.e(R0)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=N(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=N(t.value.weights);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(null!=r[u.originalName])throw new UR("Duplicate weight name: ".concat(u.originalName));r[u.originalName]=u,a++}}catch(R0){s.e(R0)}finally{s.f()}}}catch(R0){i.e(R0)}finally{i.f()}var l=[];for(var c in e){var h=c;if(null==r[c]){var d=c.split("/");h=d.slice(0,-2).concat([d[d.length-1]]).join("/")}if(null!=r[h])l.push([r[h],e[c]]);else if(n)throw new UR("Provided weight data has no target variable: ".concat(c));delete r[h]}if(n){var f=[];for(var p in r)f.push(p);if(f.length>0)throw new UR("".concat(f.length," of ").concat(a," weights are not set: ")+"".concat(f))}TL(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(VP),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=WP(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return BS((function(){e=qR(e);for(var r=new DL,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return zL(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return BS((function(){var r;return e=qR(e),r=null==t?GR(null,e.length):qR(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=bL(e);if(t.length!==this.inputLayers.length)throw new UR("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(eN);if(o.length>1){var s,u=N(o);try{for(u.s();!(s=u.n()).done;){var l,c=s.value,h=N(this.nodesByDepth[c]);try{for(h.s();!(l=h.n()).done;){var d=l.value,f=d.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(f.id)){for(var p=[],v=0;v<d.inboundLayers.length;v++){var m=d.inboundLayers[v],g=d.nodeIndices[v],y=d.tensorIndices[v],b=n["".concat(m.name,"_").concat(g,"_").concat(y)];p.push(b)}for(var x=bL(f.computeOutputShape(XR(p))),w=f.inboundNodes.indexOf(d),k=0;k<x.length;k++){n["".concat(f.name,"_").concat(w,"_").concat(k)]=x[k]}}}}catch(R0){h.e(R0)}finally{h.f()}}}catch(R0){u.e(R0)}finally{u.f()}}for(var S=[],_=[],E=0;E<this.outputLayers.length;E++){var T=this.outputLayers[E],M=this.outputLayersNodeIndices[E],C=this.outputLayersTensorIndices[E],I="".concat(T.name,"_").concat(M,"_").concat(C);_.push(I)}for(var A=0;A<_.length;A++){var R=_[A];HR(R in n),S.push(n[R])}return XR(S)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=GR(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(eN),l=N(u);try{for(l.s();!(s=l.n()).done;){var c,h=s.value,d=N(this.nodesByDepth[h]);try{for(d.s();!(c=d.n()).done;){var f,p=c.value,v=p.outboundLayer,m=p.inputTensors,g=p.outputTensors,y=new Array,b=N(m);try{for(b.s();!(f=b.n()).done;){var w=f.value;w.id in n&&y.push(n[w.id])}}catch(R0){b.e(R0)}finally{b.f()}if(y.length===m.length){var k={},S=void 0,_=void 0,E=void 0,T=void 0;if(null!=p.callArgs&&(k=p.callArgs),1===y.length){var M=x(y[0],2),C=M[0],I=M[1];null==k.mask&&(k.mask=I),E=qR(v.call(C,k)),T=qR(v.computeMask(C,I)),S=[C],_=[I]}else S=y.map((function(e){return e[0]})),_=y.map((function(e){return e[1]})),null==k.mask&&(k.mask=_),E=qR(v.call(S,k)),T=qR(v.computeMask(S,_));if(v.activityRegularizer)throw new BR("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var A=0;A<g.length;++A){var R=g[A],L=E[A],P=T[A];n[R.id]=[L,P]}}}}catch(R0){d.e(R0)}finally{d.f()}}}catch(R0){l.e(R0)}finally{l.f()}var D,F=[],O=[],z=[],U=N(this.outputs);try{for(U.s();!(D=U.n()).done;){var B=D.value;HR(B.id in n,"Could not compute output ".concat(B.name," : ").concat(B.id));var W=x(n[B.id],2),V=W[0],G=W[1];z.push(V.shape),F.push(V),O.push(G)}}catch(R0){U.e(R0)}finally{U.f()}return[F,O,z]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=N(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(R0){i.e(R0)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new UR("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new UR("Provide either a layer name or layer index");var n,r=N(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(R0){r.e(R0)}finally{r.f()}throw new UR("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return BS((function(){var t,r=[],a=N(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,g(i.calculateLosses()))}}catch(R0){a.e(R0)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=N(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),l=[],c=0;c<o.inboundNodes.length;c++){var h=o.inboundNodes[c],d=n.nodeKey(o,c),f={};if(this.containerNodes.has(d)){if(h.callArgs)try{JSON.stringify(h.callArgs),f=h.callArgs}catch(R0){console.warn("Layer ".concat(o.name," was passed ")+"non-serializable keyword arguments: "+"".concat(h.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),f={}}if(h.inboundLayers.length>0){for(var p=[],v=0;v<h.inboundLayers.length;v++){var m=h.inboundLayers[v],g=h.nodeIndices[v],y=h.tensorIndices[v],b=r[n.nodeKey(m,g)];null==b&&(b=0),p.push([m.name,b,y,f])}l.push(p)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=l,a.push(x)}}catch(R0){i.e(R0)}finally{i.f()}t.layers=a;for(var w=[],k=0;k<this.inputLayers.length;k++){var S=this.inputLayers[k],_=this.inputLayersNodeIndices[k],E=n.nodeKey(S,_);if(this.containerNodes.has(E)){var T=r[E];null!==T&&void 0!==T||(T=0);var M=this.inputLayersTensorIndices[k];w.push([S.name,T,M])}}t.inputLayers=w;for(var C=[],I=0;I<this.outputLayers.length;I++){var A=this.outputLayers[I],R=this.outputLayersNodeIndices[I],L=n.nodeKey(A,R);if(this.containerNodes.has(L)){var P=r[L];null!==P&&void 0!==P||(P=0);var D=this.outputLayersTensorIndices[I];C.push([A.name,P,D])}}return t.outputLayers=C,t}},{key:"stateful",get:function(){if(this._stateful)throw new UR("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=N(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(R0){t.e(R0)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;BS((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=N(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,l=u[0],c=u[1],h=u[2];if(n=null==u[3]?{}:u[3],!(l in r))return void i(e,t);var d=r[l];if(d.inboundNodes.length<=c)return void i(e,t);var f=d.inboundNodes[c];o.push(f.outputTensors[h])}}catch(R0){s.e(R0)}finally{s.f()}o.length>0&&e.apply(XR(o),n)}function s(e){var a=e.name,o=cP(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new UR("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,l=t.name,c=t.layers,h=N(c);try{for(h.s();!(u=h.n()).done;){s(u.value)}}catch(R0){h.e(R0)}finally{h.f()}for(;!nN(a);){var d,f=N(c);try{for(f.s();!(d=f.n()).done;){var p=d.value,v=r[p.name];if(v.name in a){var m=a[v.name];delete a[v.name];var g,y=N(m);try{for(y.s();!(g=y.n()).done;){o(v,g.value)}}catch(R0){y.e(R0)}finally{y.f()}}}}catch(R0){f.e(R0)}finally{f.f()}}var b,x=[],w=[],k=N(t.inputLayers);try{for(k.s();!(b=k.n()).done;){var S=b.value,_=S[0],E=S[1],T=S[2];HR(_ in r);var M=r[_].inboundNodes[E].outputTensors;x.push(M[T])}}catch(R0){k.e(R0)}finally{k.f()}var C,I=N(t.outputLayers);try{for(I.s();!(C=I.n()).done;){var A=C.value,R=A[0],L=A[1],P=A[2];HR(R in r);var D=r[R].inboundNodes[L].outputTensors;w.push(D[P])}}catch(R0){I.e(R0)}finally{I.f()}return new e({inputs:x,outputs:w,name:l})}}]),n}(NL);function HP(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function jP(e,t){return HP(e,t,"classWeight")}function XP(e,t,n,r){return qP.apply(this,arguments)}function qP(){return qP=c(u().mark((function e(t,n,r,a){var i,o,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=15;break}return i=BS((function(){if(1===t.shape.length)return FS(t);if(2===t.shape.length){if(t.shape[1]>1){return eE(t,1)}if(1===t.shape[1])return mE(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),WS(i),s=[],o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");s.push(r[e])})),e.abrupt("return",XT(s,"float32"));case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)}))),qP.apply(this,arguments)}function KP(e,t){return qS(e,t)}var YP=32;function ZP(e,t){var n,r,a=t;n=a.xs,r=a.ys,og(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)}));var i=JP("input",e.inputNames,n),o=JP("output",e.outputNames,r),s=i[0].shape[0];og(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")})),og(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){og(i[t].shape[0]===s,(function(){return"Batch size mismatch: input "+"".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},l=0;l<i.length;l++)u(l);for(var c=function(t){og(o[t].shape[0]===s,(function(){return"Batch size mismatch: output "+"".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},h=0;h<o.length;h++)c(h);return{xs:i,ys:o}}function JP(e,t,n){if(n instanceof Hw)return[n];if(Array.isArray(n))return og(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=N(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new UR("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(R0){i.e(R0)}finally{i.f()}return a}function QP(e){if(3===e.length)throw new BR("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function $P(e,t,n){return eD.apply(this,arguments)}function eD(){return eD=c(u().mark((function e(t,n,r){var a,i,o,s,l,c,h,d,f,p,v,m,g,y,b,x,w,k,S,_,E,T,M,C,I,A,R,N,L,P,D,F,O;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,og(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),og(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),og(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(r.epochs)})),og(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(r.batchesPerEpoch)})),og(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=8;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 8:return t.isTraining=!0,e.prev=9,(i=null!=r.validationData)&&(nD(r.validationData)?og(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(r.validationBatches)})):(l=QP(r.validationData),o=l.xs,s=l.ys)),c=t.makeTrainFunction(),h=t.getDedupedMetricsNames(),d=i?h.slice().concat(h.map((function(e){return"val_"+e}))):h.slice(),f=sP(r.callbacks,r.yieldEvery),p=null==r.verbose?1:r.verbose,v=lP(f,p,r.epochs,null,null,tD(n,r),null,i,d),m=v.callbackList,g=v.history,m.setModel(t),t.history=g,e.next=22,m.onTrainBegin();case 22:return t.stopTraining_=!1,y=null==r.initialEpoch?0:r.initialEpoch,e.next=26,n.iterator();case 26:b=e.sent;case 27:if(!(y<r.epochs)){e.next=98;break}return x={},e.next=31,m.onEpochBegin(y);case 31:if(w=0,k=0,a){e.next=37;break}return e.next=36,n.iterator();case 36:b=e.sent;case 37:if(a&&!(w<r.batchesPerEpoch)){e.next=91;break}return e.next=40,b.next();case 40:if(S=e.sent,!a||!S.done){e.next=44;break}return console.warn("You provided `batchesPerEpoch` as "+"".concat(r.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(w," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(r.batchesPerEpoch*r.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("break",91);case 44:if(null==S.value){e.next=73;break}return _=ZP(t,S.value),E=_.xs,T=_.ys,(M={}).batch=k,M.size=E[0].shape[0],e.next=51,m.onBatchBegin(k,M);case 51:if(C=[],null==r.classWeight){e.next=64;break}I=jP(r.classWeight,t.outputNames),A=0;case 55:if(!(A<I.length)){e.next=64;break}return e.t0=C,e.next=59,XP(T[A],null,I[A]);case 59:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 61:++A,e.next=55;break;case 64:for(R=E.concat(T).concat(C),N=c(R),WS(R),L=0;L<h.length;++L)P=h[L],D=N[L],M[P]=D,VS(D);return e.next=70,m.onBatchEnd(k,M);case 70:tP(M),k++,w++;case 73:if(!(a?w>=r.batchesPerEpoch:S.done)){e.next=87;break}if(!i){e.next=86;break}if(F=void 0,!nD(r.validationData)){e.next=84;break}return e.t2=qR,e.next=80,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 80:e.t3=e.sent,F=(0,e.t2)(e.t3),e.next=85;break;case 84:F=qR(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?YP:r.validationBatchSize,verbose:0}));case 85:for(O=0;O<t.metricsNames.length;++O)x["val_".concat(t.metricsNames[O])]=F[O];case 86:return e.abrupt("break",91);case 87:if(!t.stopTraining_){e.next=89;break}return e.abrupt("break",91);case 89:e.next=37;break;case 91:return e.next=93,m.onEpochEnd(y,x);case 93:if(y++,!t.stopTraining_){e.next=96;break}return e.abrupt("break",98);case 96:e.next=27;break;case 98:return e.next=100,m.onTrainEnd();case 100:return e.next=102,t.history.syncData();case 102:return e.abrupt("return",t.history);case 103:return e.prev=103,t.isTraining=!1,e.finish(103);case 106:case"end":return e.stop()}}),e,null,[[9,,103,106]])}))),eD.apply(this,arguments)}function tD(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function nD(e){return"function"===typeof e.iterator}function rD(e,t,n){return aD.apply(this,arguments)}function aD(){return aD=c(u().mark((function e(t,n,r){var a,i,o,s,l,c,h,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=6;break}throw new BR("Verbose mode is not implemented yet.");case 6:if(og(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(r.batches))})),"function"!==typeof n.next){e.next=11;break}e.t0=n,e.next=14;break;case 11:return e.next=13,n.iterator();case 13:e.t0=e.sent;case 14:s=e.t0,l=0,c=0,h=u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=BS((function(){if(n.value){var e=ZP(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),u=BS((function(){return i(s)}));if(WS(s),0===c)for(var h=0;h<u.length;++h)o.push(QS(0));for(var d=s[0].shape[0],f=function(e){var t=u[e],n=o[e];o[e]=BS((function(){return HS(o[e],qS(d,t))})),c>0&&WS(n)},p=0;p<u.length;++p)f(p);WS(u),l+=d,++c}return o})),!n.done){e.next=7;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(r.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("return","break");case 7:case"end":return e.stop()}}),e)}));case 18:if(a&&!(c<r.batches)){e.next=25;break}return e.delegateYield(h(),"t1",20);case 20:if("break"!==e.t1){e.next=23;break}return e.abrupt("break",25);case 23:e.next=18;break;case 25:for(d=0;d<o.length;++d)f=o[d],o[d]=XS(o[d],l),WS(f);return e.abrupt("return",XR(o));case 27:case"end":return e.stop()}}),e)}))),aD.apply(this,arguments)}function iD(e){og(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function oD(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return FN(e,t,n-t)})):FN(e,t,n-t)}function sD(e,t){return BS((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return sD(e,t)})):HN(e,"int32"===t.dtype?t:DS(t,"int32"))}))}function uD(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function lD(e){var t=[];e instanceof Hw&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(DN(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function cD(e,t){if(null!=e){var n=[];if(t instanceof Hw)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof Hw)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function hD(e){return Array.isArray(e)}function dD(e){return!function(e){return e instanceof Hw}(e)&&!hD(e)}function fD(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(hD(e)&&e.length>0)o=!0;else if(dD(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new UR("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(dD(e)){r=[];var u,l=N(t);try{for(l.s();!(u=l.n()).done;){var c=u.value;if(null==e[c])throw new UR('No data provided for "'.concat(c,'". Need data for each key in: ')+"".concat(t));r.push(e[c])}}catch(R0){l.e(R0)}finally{l.f()}}else if(hD(e)){if(e.length!==t.length)throw new UR("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new UR("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=lD(r),null!=n)for(var h=0;h<t.length;++h)if(null!=n[h]){var d=r[h];if(d.shape.length!==n[h].length)throw new UR("Error when checking ".concat(i,": expected ").concat(t[h]," ")+"to have ".concat(n[h].length," dimension(s). but got array with ")+"shape ".concat(d.shape));for(var f=0;f<n[h].length;++f)if(0!==f||a){var p=d.shape[f],v=n[h][f];if(null!=v&&v>=0&&p!==v)throw new UR("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[h].slice(1,n[h].length),"] ")+"(i.e.,tensor shape [*,".concat(n[h].slice(1,n[h].length),"])")+" but the ".concat(i," received an input with ").concat(d.shape[0])+" examples, each with shape [".concat(d.shape.slice(1,d.shape.length),"]")+" (tensor shape [".concat(d.shape,"])"))}}return r}function pD(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new UR("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new UR("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new UR("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var l=s.shape[u],c=n[o][u];if(null!=c&&c!==l)throw new UR("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}var vD=function(e){C(r,e);var n=R(r);function r(e){var t;return E(this,r),(t=n.call(this,e)).isTraining=!1,t}return M(r,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new UR("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");DP(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return oC.adagrad(.01)},Adadelta:function(){return oC.adadelta(1,.95,LN())},Adam:function(){return oC.adam(.001,.9,.999,LN())},Adamax:function(){return oC.adamax(.002,.9,.999,LN(),0)},RMSProp:function(){return oC.rmsprop(.001,.9,0,LN())},SGD:function(){return oC.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new UR("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof n_))throw new UR("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new UR("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));var r=e.loss;n=r.map((function(e){return kP(e)}))}else{var a=kP(e.loss);this.outputs.forEach((function(e){n.push(a)}))}else{for(var i in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(i))throw new UR('Unknown entry in loss dictionary: "'.concat(i,'". ')+"Only expected the following keys: ".concat(this.outputNames));var o,s=N(this.outputNames);try{for(s.s();!(o=s.n()).done;){var u=o.value;null==e.loss[u]&&console.warn('Output "'.concat(u,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(u," during training")),n.push(kP(e.loss[u]))}}catch(R0){s.e(R0)}finally{s.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var l=0;l<this.outputs.length;++l){var c=this.internalOutputShapes[l],h=this.outputNames[l];this.feedOutputNames.push(h),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[l])}var d=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],SN("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===d.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var f=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=N(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(R0){i.e(R0)}finally{i.f()}return a}(e.metrics,this.outputNames);SN("metric",(function(){for(var e=function(e){if(-1!==d.indexOf(e))return"continue";!function(n){var r,a,i,o,s=N(n);try{var u=function(){var n,s=o.value;if("string"===typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){var u,l=t.internalOutputShapes[e];1===l[l.length-1]||t.lossFunctions[e]===yP?-1!==["accuracy","acc"].indexOf(s)?a=SP:-1!==["crossentropy","ce"].indexOf(s)&&(a=TP):t.lossFunctions[e]===gP?-1!==["accuracy","acc"].indexOf(s)?a=MP:-1!==["crossentropy","ce"].indexOf(s)&&(a=IP):-1!==["accuracy","acc"].indexOf(s)?a=_P:-1!==["crossentropy","ce"].indexOf(s)&&(a=CP),-1!==["accuracy","acc"].indexOf(s)?u="acc":-1!==["crossentropy","ce"].indexOf(s)&&(u="ce"),i=a,r=""+u}else{var c=function(e){if("string"===typeof e&&e in AP)return AP[e];if("string"!==typeof e&&null!=e)return e;throw new UR("Unknown metric ".concat(e))}(s);i=c,r=""+RP(s)}SN(r,(function(){n=i})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,n)};for(s.s();!(o=s.n()).done;)u()}catch(R0){s.e(R0)}finally{s.f()}}(f[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;iD(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);this.makeTestFunction();var o=this.testFunction;return XR(this.testLoop(o,i,r,n.verbose,n.steps))}finally{cD(a[0],e),cD(a[1],t)}}},{key:"evaluateDataset",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.makeTestFunction(),e.abrupt("return",rD(this,t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new UR("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new UR("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new UR("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new DL;if(e instanceof Hw&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new UR("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=N(this.inputs);try{for(u.s();!(s=u.n()).done;){var l=s.value,c=e[l.name];if(null==c)throw new UR("No value is provided for the model's input ".concat(l.name));i.add(l,c)}}catch(R0){u.e(R0)}finally{u.f()}}var h=zL(a,i);return n?h:h[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=GR(null,e.length),r=e.length,a=N(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var l=s.indexOf(e[u]);if(-1!==l&&(n[u]=o[l],r--),0===r)break}if(0===r)break}}catch(R0){a.e(R0)}finally{a.f()}if(r>0){var c=[];throw n.forEach((function(t,n){null==t&&c.push(e[n])})),new UR("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(c)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return BS((function(){var a=t.checkNumSamples(e);if(r)throw new BR("Verbose predictLoop() is not implemented yet.");for(var i=uD(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){var r=BS((function(){var r=i[n][0],a=i[n][1],o=oD(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var l=new DL(s);return zL(t.outputs,l)}));r.forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return XR(o.map((function(e){return EE(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=lD(e);pD(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return iD(r),this.predictLoop(n,r)}finally{cD(n,e)}}},{key:"predictOnBatch",value:function(e){pD(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new zR("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===gP?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(function(e,t,n){var r=tN(e.map((function(e){return e.shape[0]})));r.sort();var a=tN(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new UR("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new UR("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!cg(r,a))throw new UR("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}(e=fD(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=fD(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){for(var r=[dP,yP,mP],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===mP&&1===i.shape[i.shape.length-1])throw new UR("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var h=u[c],d=l[c];if(null!=d&&h!==d)throw new UR("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new UR("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=c(u().mark((function e(t,n,r,a){var i,o,s,l,c,h,d,f,p,v=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(v.length>4&&void 0!==v[4])||v[4],o=v.length>5?v[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),l=x(s,2),c=l[0],h=l[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(d=null,null==a){e.next=19;break}f=jP(a,this.outputNames),d=[],p=0;case 10:if(!(p<f.length)){e.next=19;break}return e.t0=d,e.next=14,XP(h[p],null,f[p]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++p,e.next=10;break;case 19:return e.abrupt("return",[c,h,d]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return BS((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new BR("Verbose mode is not implemented yet.");if(null!=i)throw new BR("steps mode in testLoop() is not implemented yet");for(var u=uD(o,n),l=XT(NN(0,o)),c=0;c<u.length;++c){var h=u[c][0],d=u[c][1],f=FN(l,h,d-h),p=sD(t,f),v=e(p);if(0===c)for(var m=0;m<v.length;++m)s.push(QS(0));for(var g=0;g<v.length;++g){var y=v[g];s[g]=HS(s[g],qS(d-h,y))}}for(var b=0;b<s.length;++b)s[b]=XS(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(jR(e,r)>1){var i=jR(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()})),u=e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,l=new DL(t),c=zL(e.outputs,l,{training:!0}),h=0;h<e.lossFunctions.length;++h){var d=(0,e.lossFunctions[h])(a[h],c[h]);null!=i[h]&&(d=KP(d,i[h]));var f=iT(d);n.push(f),u=0===h?d:HS(u,d)}for(var p=0;p<e.metricsTensors.length;++p){var v=void 0;if(e.outputs.length>1&&p<e.outputs.length)v=n[p];else{var m=e.metricsTensors[p][0],g=e.metricsTensors[p][1];v=iT(m(a[g],c[g]))}VS(v),o.push(v)}return u=iT(u),e.calculateLosses().forEach((function(e){u=HS(u,e)})),u}),!0,s);return[u].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return BS((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new DL(o),l=zL(e.outputs,u),c=0;c<e.lossFunctions.length;++c){var h=e.lossFunctions[c],d=iT(h(i[c],l[c]));n=0===c?d:HS(n,d),r.push(n)}for(var f=0;f<e.metricsTensors.length;++f){var p=e.metricsTensors[f][0],v=e.metricsTensors[f][1],m=iT(p(i[v],l[v]));r.push(m)}return r}))}}},{key:"fit",value:function(){var e=c(u().mark((function e(t,n){var r,a,i,o,s,l,c,h,d,f,p,v,m,g,y,b,x,w,k,S,_,E,T,M,C=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=C.length>2&&void 0!==C[2]?C[2]:{},!this.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return this.isTraining=!0,e.prev=4,iD(p=null==r.batchSize?32:r.batchSize),!1,e.next=10,this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,false,p);case 10:if(v=e.sent,a=v[0],i=v[1],f=v[2],m=!1,!(null!=r.validationData&&r.validationData.length>0)){e.next=36;break}if(m=!0,2!==r.validationData.length){e.next=22;break}l=r.validationData[0],c=r.validationData[1],e.next=27;break;case 22:if(3!==r.validationData.length){e.next=26;break}throw new BR("validationData including sample weights is not supported yet.");case 26:throw new UR("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(r.validationData," is invalid."));case 27:return!0,e.next=30,this.standardizeUserData(l,c,null,null,true,p);case 30:y=e.sent,h=y[0],d=y[1],g=h.concat(d),e.next=37;break;case 36:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(m=!0,b=Math.floor(a[0].shape[0]*(1-r.validationSplit)),x=a[0].shape[0],h=oD(a,b,x),o=a,a=oD(a,0,b),d=oD(i,b,x),s=i,i=oD(i,0,b),g=h.concat(d)):null!=r.validationSteps&&(m=!0);case 37:return w=a.concat(i).concat(f),this.checkTrainableWeightsConsistency(),k=this.makeTrainFunction(),S=this.getDedupedMetricsNames(),m?(this.makeTestFunction(),_=this.testFunction,E=S.slice().concat(S.map((function(e){return"val_"+e})))):(_=null,g=[],E=S.slice()),T=sP(r.callbacks,r.yieldEvery),e.next=45,this.fitLoop(k,w,S,p,r.epochs,r.verbose,T,_,g,r.shuffle,E,r.initialEpoch,null,null);case 45:return M=e.sent,e.abrupt("return",M);case 47:return e.prev=47,this.isTraining=!1,cD(a,t),cD(i,n),cD(o,t),cD(s,n),cD(h,l),cD(d,c),null!=f&&WS(f),e.finish(47);case 57:case"end":return e.stop()}}),e,this,[[4,,47,57]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitLoop",value:function(){var e=c(u().mark((function e(t,n,r,a,i,o,s,l,c,h,d,f,p,v){var m,g,y,b,x,w,k,S,_=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==a&&(a=32),null==i&&(i=1),null==h&&(h=!0),null==f&&(f=0),m=!1,null!=l&&null!=c&&(m=!0),null==v){e.next=10;break}if(m=!0,null!=p){e.next=10;break}throw new UR("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 10:return null!=(g=this.checkNumSamples(n,a,p,"steps_per_epoch"))&&(y=NN(0,g)),null==o&&(o=1),b=lP(s,o,i,f,g,p,a,m,d),x=b.callbackList,w=b.history,x.setModel(this),this.history=w,e.next=18,x.onTrainBegin();case 18:this.stopTraining_=!1,k=u().mark((function e(){var i,o,s,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.onEpochBegin(S);case 2:if(i={},null==p){e.next=7;break}throw new BR("stepsPerEpoch mode is not implemented yet.");case 7:if("batch"!==h){e.next=11;break}throw new BR("batch shuffling is not implemneted yet");case 11:h&&tg(y);case 12:o=XT(y),s=uD(g,a),d=u().mark((function e(h){var d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d={},e.next=3,x.onBatchBegin(h,d);case 3:return BS((function(){var e=s[h][0],u=s[h][1],f=FN(o,e,u-e);d.batch=h,d.size=u-e;for(var p=sD(n,f),v=t(p),g=0;g<r.length;++g){var y=r[g],b=v[g];d[y]=b,VS(b)}if(h===s.length-1&&m)for(var x=_.testLoop(l,c,a),w=0;w<r.length;++w){var k=r[w],S=x[w];VS(S),i["val_"+k]=S}})),e.next=6,x.onBatchEnd(h,d);case 6:if(tP(d),!_.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),f=0;case 16:if(!(f<s.length)){e.next=24;break}return e.delegateYield(d(f),"t0",18);case 18:if("break"!==e.t0){e.next=21;break}return e.abrupt("break",24);case 21:++f,e.next=16;break;case 24:o.dispose();case 25:return e.next=27,x.onEpochEnd(S,i);case 27:if(!_.stopTraining_){e.next=29;break}return e.abrupt("return","break");case 29:case"end":return e.stop()}}),e)})),S=f;case 21:if(!(S<i)){e.next=29;break}return e.delegateYield(k(),"t0",23);case 23:if("break"!==e.t0){e.next=26;break}return e.abrupt("break",29);case 26:++S,e.next=21;break;case 29:return e.next=31,x.onTrainEnd();case 31:return e.next=33,this.history.syncData();case 33:return e.abrupt("return",this.history);case 34:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i,o,s,u,l,c,h,d,f,p){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$P(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=c(u().mark((function e(t,n){var r,a,i,o,s,l,c,h,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction(),s=o(a.concat(i)),l=[],c=N(s),e.prev=9,c.s();case 11:if((h=c.n()).done){e.next=19;break}return d=h.value,e.next=15,d.data();case 15:f=e.sent,l.push(f[0]);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),c.e(e.t0);case 24:return e.prev=24,c.f(),e.finish(24);case 27:return WS(s),cD(r[0],t),cD(r[1],n),e.abrupt("return",XR(l));case 31:case"end":return e.stop()}}),e,this,[[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=D(I(r.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=US().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-US().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"===typeof this.loss)e=KR(this.loss);else if(Array.isArray(this.loss)){var t,n=N(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!==typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(R0){n.e(R0)}finally{n.f()}e=this.loss.map((function(e){return KR(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!==typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=KR(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[KR(RP(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return KR(RP(e))}));var e={};for(var t in this.metrics)e[t]=KR(RP(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=cP(BP(e.optimizer_config));if("string"===typeof e.loss)t=YR(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return YR(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=YR(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return YR(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=YR(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=c(u().mark((function e(n,r){var a,i,o,s,l,c,h,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof n){e.next=9;break}if(0!==(a=Kk(n)).length){e.next=6;break}throw new UR("Cannot find any save handlers for URL '".concat(n,"'"));case 6:if(!(a.length>1)){e.next=8;break}throw new UR("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(n,"'"));case 8:n=a[0];case 9:if(null!=n.save){e.next=11;break}throw new UR("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.next=13,Ck(this.getNamedWeights(r));case 13:if(i=e.sent,!1,null,o=this.toJSON(null,false),s={modelTopology:o,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(VP),convertedBy:null},!(null!=r&&r.includeOptimizer)||null==this.optimizer){e.next=34;break}return s.trainingConfig=this.getTrainingConfig(),c="optimizer",e.t0=t,e.next=25,this.optimizer.getWeights();case 25:return e.t1=e.sent,e.t2=c,e.next=29,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 29:h=e.sent,d=h.data,f=h.specs,(l=i.specs).push.apply(l,g(f)),i.data=Fk([i.data,d]);case 34:return null!=this.userDefinedMetadata&&(!0,LP(this.userDefinedMetadata,this.name,true),s.userDefinedMetadata=this.userDefinedMetadata),s.weightData=i.data,s.weightSpecs=i.specs,e.abrupt("return",n.save(s));case 38:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){LP(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),r}(GP);vD.className="Model",t_(vD);var mD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n)}(vD);function gD(e,t){return yD.apply(this,arguments)}function yD(){return(yD=c(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!==typeof t){e.next=10;break}if(0!==(r=Yk(t,n)).length){e.next=7;break}r.push(D_(t,n)),e.next=9;break;case 7:if(!(r.length>1)){e.next=9;break}throw new UR("Found more than one (".concat(r.length,") load handlers for ")+"URL '".concat(t,"'"));case 9:t=r[0];case 10:return e.abrupt("return",bD(t,void 0,n));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bD(e,t,n){return xD.apply(this,arguments)}function xD(){return xD=c(u().mark((function e(t,n,r){var a,i,o,s,l,c,h,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=3;break}throw new UR("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 3:return e.next=5,t.load();case 5:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,s=null!=a.weightData&&null!=a.weightSpecs&&o,l=cP(BP(i),n,s),null!=(c=a.trainingConfig)&&l.loadTrainingConfig(c),null!=a.userDefinedMetadata&&l.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=24;break}if(null!=a.weightSpecs){e.next=17;break}throw new UR("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 17:if(h=wD(a.weightData,a.weightSpecs),d=h.modelWeights,f=h.optimizerWeights,l.loadWeights(d,o),!(null!=l.optimizer&&f.length>0)){e.next=22;break}return e.next=22,l.optimizer.setWeights(f);case 22:WS(d),WS(f.map((function(e){return e.tensor})));case 24:return e.abrupt("return",l);case 25:case"end":return e.stop()}}),e)}))),xD.apply(this,arguments)}function wD(e,t){var n=Ak(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}mD.className="Functional",t_(mD);var kD=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:hN("sequential_"),null!=e.layers){var a,i=N(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(R0){i.e(R0)}finally{i.f()}}return r}return M(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new UR("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof vD;if(r){if(1!==(t=e).outputs.length)throw new UR("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new UR("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new UR("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new UR("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new PL({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new UR("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new UR("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=LL(this.outputs[0])}this.inboundNodes=[],new AL({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:GR(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(wL(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new vD({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),D(I(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),D(I(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new zR("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new zR("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=c(u().mark((function e(t,n){var r,a=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new zR("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new zR("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new UR("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new UR("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=N(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(R0){n.e(R0)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new UR("Legacy serialization format not supported yet.");r=t}else og(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new BR("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=N(r);try{for(u.s();!(s=u.n()).done;){var l=s.value,c=cP(l,undefined,a);a&&c.setFastWeightInitDuringBuild(!0),o.add(c)}}catch(R0){u.e(R0)}finally{u.f()}return o}}]),n}(vD);kD.className="Sequential",t_(kD);var SD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"getConfig",value:function(){return{}}}]),n}($S),_D=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new BR("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return UE(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}]),n}(SD);_D.className="elu",t_(_D);var ED=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return NT(e)}}]),n}(SD);ED.className="selu",t_(ED);var TD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return AT(e)}}]),n}(SD);TD.className="relu",t_(TD);var MD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return BS((function(){return sT(6,AT(e))}))}}]),n}(SD);MD.className="relu6",t_(MD);var CD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return e}}]),n}(SD);CD.className="linear",t_(CD);var ID=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return PT(e)}}]),n}(SD);ID.className="sigmoid",t_(ID);var AD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return function(e){return BS((function(){var t=HS(.5,qS(.2,e));return _E(t,0,1)}))}(e)}}]),n}(SD);AD.className="hardSigmoid",t_(AD);var RD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return WT(e)}}]),n}(SD);RD.className="softplus",t_(RD);var ND=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return function(e){return BS((function(){return XS(e,HS(l_(e),1))}))}(e)}}]),n}(SD);ND.className="softsign",t_(ND);var LD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return jT(e)}}]),n}(SD);LD.className="tanh",t_(LD);var PD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return BT(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(SD);PD.className="softmax",t_(PD);var DD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return eT(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(SD);DD.className="logSoftmax",t_(DD);var FD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return BS((function(){return qS(PT(qS(e,t)),e)}))}}]),n}(SD);FD.className="swish",t_(FD);var OD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e){return BS((function(){return qS(e,jT(WT(e)))}))}}]),n}(SD);function zD(e){return e.getClassName()}function UD(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $R(e,e_.getMap().classNameMap,t,"activation")}function BD(e){if(null==e){var t={className:"linear",config:{}};return UD(t)}if("string"===typeof e){var n={};return n.className=e,n.config={},UD(n)}return e instanceof SD?e:UD(e)}function WD(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}OD.className="mish",t_(OD);var VD=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n)}($S),GD=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this),WD(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return M(n,[{key:"apply",value:function(e){var t=this;return BS((function(){var n=bT([1]);return t.hasL1&&(n=HS(n,$E(qS(t.l1,l_(e))))),t.hasL2&&(n=HS(n,$E(qS(t.l2,jN(e))))),mE(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(VD);GD.className="L1L2",t_(GD);var HD={l1l2:"L1L2"};function jD(e){return JR(e)}function XD(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $R(e,e_.getMap().classNameMap,t,"regularizer")}function qD(e){return null==e?null:"string"===typeof e?XD({className:e in HD?HD[e]:e,config:{}}):e instanceof VD?e:XD(e)}var KD=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return M(n,[{key:"call",value:function(e,t){e=xL(e);var n=AT(e);return null!=this.maxValue&&(n=_E(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);KD.className="ReLU",t_(KD);var YD=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return M(n,[{key:"call",value:function(e,t){var n=xL(e);return YE(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);YD.className="LeakyReLU",t_(YD);var ZD=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=gL(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=qD(e.alphaRegularizer),r.alphaConstraint=QL(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new UR("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return r}return M(n,[{key:"build",value:function(e){var t=(e=wL(e)).slice(1);if(null!=this.sharedAxes){var n,r=N(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(R0){r.e(R0)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new ML({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=xL(e),ST(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:mL(this.alphaInitializer),alphaRegularizer:jD(this.alphaRegularizer),alphaConstraint:ZL(this.alphaConstraint),sharedAxes:this.sharedAxes},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);ZD.className="PReLU",t_(ZD);var JD=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new BR("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return M(n,[{key:"call",value:function(e,t){var n=xL(e);return UE(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);JD.className="ELU",t_(JD);var QD=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return M(n,[{key:"call",value:function(e,t){var n=xL(e);return qS(n,DS(qE(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);QD.className="ThresholdedReLU",t_(QD);var $D=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new PD).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return M(n,[{key:"call",value:function(e,t){var n=xL(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);function eF(e,t,n){if("number"===typeof e)return GR(e,t);if(e.length!==t)throw new UR("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if((i=a)!==parseInt(i.toString(),10))throw new UR("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e;var i}function tF(e,t,n,r){var a;return null==e?e:(a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r))}function nF(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+RN([n-t,0]);else{if("same"!==r)throw new UR("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function rF(e,t){return BS((function(){return yN(t),"channelsFirst"===t?QT(e,[0,2,3,1]):e}))}function aF(e,t){return BS((function(){return yN(t),"channelsFirst"===t?QT(e,[0,2,3,4,1]):e}))}function iF(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return BS((function(){if(null==i&&(i="channelsLast"),yN(i),3!==e.shape.length)throw new UR("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new UR("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new UR("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=QT(e,[0,2,1])),"causal"===a)throw new BR("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=RE(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=qN(s,n)),s}))}function oF(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return BS((function(){if(null==i&&(i="channelsLast"),yN(i),3!==e.rank&&4!==e.rank)throw new UR("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new UR("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));var u=rF(e,i);if("causal"===a)throw new BR("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=hM({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=QT(u,[0,3,1,2])),u}))}function sF(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return BS((function(){if(null==i&&(i="channelsLast"),yN(i),4!==e.rank&&5!==e.rank)throw new UR("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new UR("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));var s=aF(e,i);if("causal"===a)throw new BR("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=PE(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=qN(s,n)),"channelsFirst"===i&&(s=QT(s,[0,4,1,2,3])),s}))}$D.className="Softmax",t_($D);var uF=function(e){C(n,e);var t=R(n);function n(e,r){var a;if(E(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,iN(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new BR("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=eF(r.kernelSize,e,"kernelSize"),a.strides=eF(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,bN(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,yN(a.dataFormat),a.activation=BD(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=gL(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=QL(r.biasConstraint),a.biasRegularizer=qD(r.biasRegularizer),a.activityRegularizer=qD(r.activityRegularizer),a.dilationRate=eF(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new UR("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new UR("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new UR("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)));return a}return M(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:zD(this.activation),useBias:this.useBias,biasInitializer:mL(this.biasInitializer),biasRegularizer:jD(this.biasRegularizer),activityRegularizer:jD(this.activityRegularizer),biasConstraint:ZL(this.biasConstraint)},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(HR("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!aN(e.kernelSize,"number",1,3))throw new UR("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(NL),lF=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,iN(a.filters,"filters"),a.kernelInitializer=gL(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=QL(r.kernelConstraint),a.kernelRegularizer=qD(r.kernelRegularizer),a}return M(n,[{key:"build",value:function(e){e=wL(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new UR("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:k({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){var t;e=xL(e);var r=null==n.bias?null:n.bias.read(),a=sN(n.activation.getClassName());if(null!=a&&2===n.rank)t=oF(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=iF(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=oF(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new BR("convolutions greater than 3D are not implemented yet.");t=sF(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=wL(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=tF(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:mL(this.kernelInitializer),kernelRegularizer:jD(this.kernelRegularizer),kernelConstraint:ZL(this.kernelConstraint)},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new UR("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}]),n}(uF),cF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return M(n,[{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!aN(e.kernelSize,"number",1,2))throw new UR("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(lF);cF.className="Conv2D",t_(cF);var hF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return M(n,[{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new UR("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(lF);hF.className="Conv3D",t_(hF);var dF=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this,e)).inputSpec=[new ML({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new UR("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return M(n,[{key:"build",value:function(e){if(4!==(e=wL(e)).length)throw new UR("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new UR("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ML({ndim:4,axes:k({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){var t=xL(e);if(4!==t.shape.length)throw new UR("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],l=n.kernelSize[0],c=n.kernelSize[1],h=n.strides[0],d=n.strides[1],f=[o,nF(s,h,l,n.padding),nF(u,d,c,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=QT(t,[0,2,3,1]));var p=LE(t,n.kernel.read(),f,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(p=QT(p,[0,3,1,2])),null!=n.bias&&(p=qN(p,n.bias.read(),n.dataFormat)),null!=n.activation&&(p=n.activation.apply(p)),p}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=wL(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=nF(a[n],s,i,this.padding),a[r]=nF(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(cF);dF.className="Conv2DTranspose",t_(dF);var fF=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this,e)).inputSpec=[new ML({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new UR("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return M(n,[{key:"build",value:function(e){if(5!==(e=wL(e)).length)throw new UR("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new UR("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ML({ndim:5,axes:k({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){var t=xL(e);if(5!==t.shape.length)throw new UR("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],l=o[r],c=o[a],h=n.kernelSize[0],d=n.kernelSize[1],f=n.kernelSize[2],p=n.strides[0],v=n.strides[1],m=n.strides[2],g=[s,nF(u,p,h,n.padding),nF(l,v,d,n.padding),nF(c,m,f,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=QT(t,[0,2,3,4,1]));var y=FE(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=QT(y,[0,4,1,2,3])),null!==n.bias&&(y=qN(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=wL(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],l=this.strides[0],c=this.strides[1],h=this.strides[2];return i[t]=this.filters,i[n]=nF(i[n],l,o,this.padding),i[r]=nF(i[r],c,s,this.padding),i[a]=nF(i[a],h,u,this.padding),i}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(hF);fF.className="Conv3DTranspose",t_(fF);var pF=function(e){C(n,e);var t=R(n);function n(e,r){var a;if(E(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new UR("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new UR("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new UR("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=gL(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=qD(r.depthwiseRegularizer),a.depthwiseConstraint=QL(r.depthwiseConstraint),a.pointwiseInitializer=gL(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=qD(r.pointwiseRegularizer),a.pointwiseConstraint=QL(r.pointwiseConstraint),a}return M(n,[{key:"build",value:function(e){if((e=wL(e)).length<this.rank+2)throw new UR("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new UR("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new ML({ndim:this.rank+2,axes:k({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){var t;if(e=xL(e),1===n.rank)throw new BR("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=QT(e,[0,2,3,1])),t=LT(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=qN(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=QT(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=mL(this.depthwiseInitializer),e.pointwiseInitializer=mL(this.pointwiseInitializer),e.depthwiseRegularizer=jD(this.depthwiseRegularizer),e.pointwiseRegularizer=jD(this.pointwiseRegularizer),e.depthwiseConstraint=ZL(this.depthwiseConstraint),e.pointwiseConstraint=ZL(this.pointwiseConstraint),e}}]),n}(lF);pF.className="SeparableConv";var vF=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,2,e)}return M(n)}(pF);vF.className="SeparableConv2D",t_(vF);var mF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return M(n,[{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!aN(e.kernelSize,"number",1,1))throw new UR("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(lF);mF.className="Conv1D",t_(mF);var gF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),r=t.call(this,e),"number"===typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return M(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return BS((function(){if(e=xL(e),"channelsLast"===n.dataFormat){var t=zN(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return zN(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=zN(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return zN(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);gF.className="Cropping2D",t_(gF);var yF=function(e){C(n,e);var t=R(n);function n(e){var r,a;return E(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yN(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,a=r.interpolation,rN(fN,"InterpolationFormat",a),r}return M(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return BS((function(){var t=xL(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=QT(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?rC.resizeNearestNeighbor(t,[a,i]):rC.resizeBilinear(t,[a,i]);return QT(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?rC.resizeNearestNeighbor(t,[s,u]):rC.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);yF.className="UpSampling2D",t_(yF);var bF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=gL(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=QL(e.depthwiseConstraint),r.depthwiseRegularizer=qD(e.depthwiseRegularizer),r}return M(n,[{key:"build",value:function(e){if((e=wL(e)).length<4)throw new UR("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new UR("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return BS((function(){null==a&&(a="channelsLast"),yN(a);var o=rF(e,a);if(4!==e.rank)throw new UR("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new UR("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=zE(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=QT(o,[0,3,1,2])),o}))}(e=xL(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=qN(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=wL(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=tF(t,this.kernelSize[0],this.padding,this.strides[0]),i=tF(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=mL(this.depthwiseInitializer),e.depthwiseRegularizer=jD(this.depthwiseRegularizer),e.depthwiseConstraint=ZL(this.depthwiseRegularizer),e}}]),n}(uF);function xF(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new UR("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function wF(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return BS((function(){var u=t.shape.length;if(u<3)throw new UR("Input should be at least 3D, but is ".concat(u,"D."));var l=[1,0].concat(NN(2,u));if(t=QT(t,l),null!=i)throw new BR("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=DS(DS(a,"bool"),"float32")).rank===u-1&&(a=VE(a,-1)),a=QT(a,l)),r&&(t=RT(t,0),null!=a&&(a=RT(a,0)));var c,h,d=[],f=n,p=t.shape[0],v=KT(t);null!=a&&(h=KT(a));for(var m,g=function(t){var n=v[t],r=BS((function(){return e(n,f)}));if(null==a)c=r[0],f=r[1];else{var i=BS((function(){var e=h[t],n=s_(wT(e),e),a=HS(qS(r[0],e),qS(f[0],n)),i=f.map((function(t,a){return HS(qS(r[1][a],e),qS(t,n))}));return{output:a,newStates:i}}));c=i.output,f=i.newStates}s&&d.push(c)},y=0;y<p;++y)g(y);if(s){m=HT(d,1)}return[c,m,f]}))}bF.className="DepthwiseConv2D",t_(bF);var kF=function(e){C(n,e);var t=R(n);function n(e){var r,a;if(E(this,n),r=t.call(this,e),null==e.cell)throw new UR("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new AF({cells:e.cell}):e.cell).stateSize)throw new UR("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new ML({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return M(n,[{key:"getStates",value:function(){return null==this.states_?NN(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){yL(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=N(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(R0){o.e(R0)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return BS((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new BR("Constants support is not implemented in RNN yet.");yL(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new ML({shape:[t,null].concat(g(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!cg(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new UR("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new ML({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];BS((function(){if(!t.stateful)throw new OR("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new UR("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return bT([r,e])})):t.states_=[bT([r,t.cell.stateSize])];else if(null==e)WS(t.states_),null!=t.keptStates&&(WS(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return bT([r,e])})):t.states_[0]=bT([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new UR("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===n?t.keptStates.push(t.states_.slice()):WS(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!cg(i.shape,s))throw new UR("State ".concat(a," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return VS(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=xF(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,l=N(r);try{for(l.s();!(u=l.n()).done;){var c=u.value;this.stateSpec.push(new ML({shape:c.shape}))}}catch(R0){l.e(R0)}finally{l.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof CL){var h=[e].concat(o),d=this.inputSpec.concat(s),f=this.inputSpec;this.inputSpec=d;var p=D(I(n.prototype),"apply",this).call(this,h,t);return this.inputSpec=f,p}return D(I(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return BS((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=xL(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new UR("RNN Layer has ".concat(o," state(s) but was passed ")+"".concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=wF((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),l=u[0],c=u[1],h=u[2];n.stateful&&n.resetStates(h,a);var d=n.returnSequences?c:l;return n.returnState?[d].concat(h):d}))}},{key:"getInitialState",value:function(e){var t=this;return BS((function(){var n=bT(e.shape);return n=DN(n=$E(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?WN(n,[1,e]):n})):t.cell.stateSize>1?[WN(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){D(I(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=cP(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(NL);kF.className="RNN",t_(kF);var SF=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n)}(NL),_F=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,iN(r.units,"units"),r.activation=BD(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=gL(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=gL(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=gL(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=qD(e.kernelRegularizer),r.recurrentRegularizer=qD(e.recurrentRegularizer),r.biasRegularizer=qD(e.biasRegularizer),r.kernelConstraint=QL(e.kernelConstraint),r.recurrentConstraint=QL(e.recurrentConstraint),r.biasConstraint=QL(e.biasConstraint),r.dropout=AN([1,RN([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=AN([1,RN([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return M(n,[{key:"build",value:function(e){e=wL(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){if(2!==e.length)throw new UR("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=RF({ones:function(){return wT(e)},rate:n.dropout,training:i,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=RF({ones:function(){return wT(r)},rate:n.recurrentDropout,training:i,dropoutFunc:n.dropoutFunc}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=GN(null!=o?qS(e,o):e,n.kernel.read()),null!=n.bias&&(a=qN(a,n.bias.read())),null!=s&&(r=qS(r,s));var u=HS(a,GN(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:zD(this.activation),useBias:this.useBias,kernelInitializer:mL(this.kernelInitializer),recurrentInitializer:mL(this.recurrentInitializer),biasInitializer:mL(this.biasInitializer),kernelRegularizer:jD(this.kernelRegularizer),recurrentRegularizer:jD(this.recurrentRegularizer),biasRegularizer:jD(this.biasRegularizer),activityRegularizer:jD(this.activityRegularizer),kernelConstraint:ZL(this.kernelConstraint),recurrentConstraint:ZL(this.recurrentConstraint),biasConstraint:ZL(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}]),n}(SF);_F.className="SimpleRNNCell",t_(_F);var EF=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),e.cell=new _F(e),t.call(this,e)}return M(n,[{key:"call",value:function(e,t){var r=this;return BS((function(){null!=r.cell.dropoutMask&&(WS(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(WS(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return D(I(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(kF);EF.className="SimpleRNN",t_(EF);var TF=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new UR("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,iN(r.units,"units"),r.activation=BD(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=BD(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=gL(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=gL(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=gL(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=qD(e.kernelRegularizer),r.recurrentRegularizer=qD(e.recurrentRegularizer),r.biasRegularizer=qD(e.biasRegularizer),r.kernelConstraint=QL(e.kernelConstraint),r.recurrentConstraint=QL(e.recurrentConstraint),r.biasConstraint=QL(e.biasConstraint),r.dropout=AN([1,RN([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=AN([1,RN([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return M(n,[{key:"build",value:function(e){var t=(e=wL(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){if(2!==e.length)throw new UR("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=RF({ones:function(){return wT(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=RF({ones:function(){return wT(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,l=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=qS(e,u[0]));var c=GN(e,n.kernel.read());n.useBias&&(c=qN(c,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=qS(a,l[0]));var h=n.recurrentKernel.read(),d=x(VT(h,[2*n.units,n.units],h.rank-1),2),f=d[0],p=d[1],v=GN(a,f),m=x(VT(c,3,c.rank-1),3),g=m[0],y=m[1],b=m[2],w=x(VT(v,2,v.rank-1),2),k=w[0],S=w[1];i=n.recurrentActivation.apply(HS(g,k)),o=n.recurrentActivation.apply(HS(y,S));var _=GN(qS(o,a),p);s=n.activation.apply(HS(b,_));var E=HS(qS(i,a),qS(HS(1,mT(i)),s));return[E,E]}))}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:zD(this.activation),recurrentActivation:zD(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mL(this.kernelInitializer),recurrentInitializer:mL(this.recurrentInitializer),biasInitializer:mL(this.biasInitializer),kernelRegularizer:jD(this.kernelRegularizer),recurrentRegularizer:jD(this.recurrentRegularizer),biasRegularizer:jD(this.biasRegularizer),activityRegularizer:jD(this.activityRegularizer),kernelConstraint:ZL(this.kernelConstraint),recurrentConstraint:ZL(this.recurrentConstraint),biasConstraint:ZL(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}]),n}(SF);TF.className="GRUCell",t_(TF);var MF=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new TF(e),t.call(this,e)}return M(n,[{key:"call",value:function(e,t){var r=this;return BS((function(){null!=r.cell.dropoutMask&&(WS(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(WS(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return D(I(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(kF);MF.className="GRU",t_(MF);var CF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,iN(r.units,"units"),r.activation=BD(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=BD(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=gL(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=gL(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=gL(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=qD(e.kernelRegularizer),r.recurrentRegularizer=qD(e.recurrentRegularizer),r.biasRegularizer=qD(e.biasRegularizer),r.kernelConstraint=QL(e.kernelConstraint),r.recurrentConstraint=QL(e.recurrentConstraint),r.biasConstraint=QL(e.biasConstraint),r.dropout=AN([1,RN([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=AN([1,RN([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return M(n,[{key:"build",value:function(e){var t,n,r=(e=wL(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new eL).apply([i]),o=a.apply([2*i]);return BN(BN(n,r),o)}}]),n}(QN),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new UR("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=RF({ones:function(){return wT(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=RF({ones:function(){return wT(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,l,c=n.dropoutMask,h=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=qS(e,c[0]));var d=GN(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=qS(a,h[0])),d=HS(d,GN(a,n.recurrentKernel.read())),n.useBias&&(d=qN(d,n.bias.read()));var f=x(VT(d,4,d.rank-1),4),p=f[0],v=f[1],m=f[2],g=f[3];o=n.recurrentActivation.apply(p),s=n.recurrentActivation.apply(v),u=HS(qS(s,i),qS(o,n.activation.apply(m))),l=n.recurrentActivation.apply(g);var y=qS(l,n.activation.apply(u));return[y,y,u]}))}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:zD(this.activation),recurrentActivation:zD(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mL(this.kernelInitializer),recurrentInitializer:mL(this.recurrentInitializer),biasInitializer:mL(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:jD(this.kernelRegularizer),recurrentRegularizer:jD(this.recurrentRegularizer),biasRegularizer:jD(this.biasRegularizer),activityRegularizer:jD(this.activityRegularizer),kernelConstraint:ZL(this.kernelConstraint),recurrentConstraint:ZL(this.recurrentConstraint),biasConstraint:ZL(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}]),n}(SF);CF.className="LSTMCell",t_(CF);var IF=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new CF(e),t.call(this,e)}return M(n,[{key:"call",value:function(e,t){var r=this;return BS((function(){null!=r.cell.dropoutMask&&(WS(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(WS(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return D(I(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(kF);IF.className="LSTM",t_(IF);var AF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).cells=e.cells,r}return M(n,[{key:"stateSize",get:function(){var e,t=[],n=N(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,g(r.stateSize)):t.push(r.stateSize)}}catch(R0){n.e(R0)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return BS((function(){var r,a=e.slice(1),i=[],o=N(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(R0){o.e(R0)}finally{o.f()}i.reverse();for(var u,l=[],c=0;c<n.cells.length;++c){var h=n.cells[c];a=i[c],u=0===c?[e[0]].concat(a):[u[0]].concat(a),u=h.call(u,t),l.push(u.slice(1))}a=[];var d,f=N(l.slice().reverse());try{for(f.s();!(d=f.n()).done;){var p,v=d.value;(p=a).push.apply(p,g(v))}}catch(R0){f.e(R0)}finally{f.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;yL(e)&&(e=e[0]),this.cells.forEach((function(n,r){SN("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign(Object.assign({},e),t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=N(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,g(r.trainableWeights))}}catch(R0){n.e(R0)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=N(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,g(r.nonTrainableWeights))}}catch(R0){n.e(R0)}finally{n.f()}if(!this.trainable){var a,i=[],o=N(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,g(s.trainableWeights))}}catch(R0){o.e(R0)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=N(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,g(r.weights))}}catch(R0){n.e(R0)}finally{n.f()}return EL(t)}},{key:"setWeights",value:function(e){var t,n=[],r=N(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(R0){r.e(R0)}finally{r.f()}TL(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=N(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(cP(o,r))}}catch(R0){i.e(R0)}finally{i.f()}return new e({cells:a})}}]),n}(SF);function RF(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):KN(t(),n)},l=function(){return YN(u,t,a)};return!o||o<=1?VS(l().clone()):Array(o).fill(void 0).map(l).map((function(e){return VS(e.clone())}))}AF.className="StackedRNNCells",t_(AF);var NF=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},LF=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),e.unroll)throw new BR("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new BR("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new ML({ndim:5})],r}return M(n,[{key:"call",value:function(e,t){var r=this;return BS((function(){if(null!=r.cell.dropoutMask&&(WS(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(WS(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new UR("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return D(I(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(g(t.slice(2)))),this.returnState&&(t=[t].concat(g(Array(2).fill([e[0]].concat(g(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return BS((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=bT([a[0]].concat(g(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];BS((function(){if(!t.stateful)throw new OR("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat(g(a.slice(2)));if(null==r[0])throw new UR("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return bT(i)})):t.states_=[bT(i)];else if(null==e)WS(t.states_),null!=t.keptStates&&(WS(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return bT(i)})):t.states_[0]=bT(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new UR("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));n?t.keptStates.push(t.states_.slice()):WS(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!cg(s.shape,u))throw new UR("State ".concat(o," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return VS(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,l=e[u?3:2],c=e[u?4:3],h=tF(l,a[0],i,o[0],s[0]),d=tF(c,a[1],i,o[1],s[1]);return[].concat(g(e.slice(0,2)),g(u?[r,h,d]:[h,d,r]))}}]),n}(kF);LF.className="ConvRNN2D";var PF=function(e){C(n,e);var t=R(n);function n(e){var r;E(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,l=e.dilationRate;return(r=t.call(this,Object.assign(Object.assign({},e),{units:a}))).filters=a,iN(r.filters,"filters"),r.kernelSize=eF(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return iN(e,"kernelSize")})),r.strides=eF(o||1,2,"strides"),r.strides.forEach((function(e){return iN(e,"strides")})),r.padding=s||"valid",bN(r.padding),r.dataFormat=u||"channelsLast",yN(r.dataFormat),r.dilationRate=eF(l||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return iN(e,"dilationRate")})),r}return M(n,[{key:"build",value:function(e){var t;e=wL(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new UR("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"apply",value:function(e,t){return UN([s.apply([u]),xT([u]),s.apply([2*u])])}}]),n}(QN),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){if(3!==e.length)throw new UR("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=RF({ones:function(){return wT(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?qS(t[n],e):e},l=u(a,s,0),c=u(a,s,1),h=u(a,s,2),d=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=RF({ones:function(){return wT(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var f=n.recurrentDropoutMask,p=u(i,f,0),v=u(i,f,1),m=u(i,f,2),g=u(i,f,3),y=x(VT(n.kernel.read(),4,3),4),b=y[0],w=y[1],k=y[2],S=y[3],_=x(n.useBias?VT(n.bias.read(),4):[null,null,null,null],4),E=_[0],T=_[1],M=_[2],C=_[3];l=n.inputConv(l,b,E,n.padding),c=n.inputConv(c,w,T,n.padding),h=n.inputConv(h,k,M,n.padding),d=n.inputConv(d,S,C,n.padding);var I=x(VT(n.recurrentKernel.read(),4,3),4),A=I[0],R=I[1],N=I[2],L=I[3];p=n.recurrentConv(p,A),v=n.recurrentConv(v,R),m=n.recurrentConv(m,N),g=n.recurrentConv(g,L);var P=n.recurrentActivation.apply(HS(l,p)),D=n.recurrentActivation.apply(HS(c,v)),F=HS(qS(D,o),qS(P,n.activation.apply(HS(h,m)))),O=qS(n.recurrentActivation.apply(HS(d,g)),n.activation.apply(F));return[O,O,F]}))}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t=(e.units,NF(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}},{key:"inputConv",value:function(e,t,n,r){var a=AE(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?qN(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return AE(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(CF);PF.className="ConvLSTM2DCell",t_(PF);var DF=function(e){C(n,e);var t=R(n);function n(e){E(this,n);var r=new PF(e);return t.call(this,Object.assign(Object.assign({},e),{cell:r}))}return M(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(LF);DF.className="ConvLSTM2D",t_(DF);var FF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return M(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t);var r=xL(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return YN((function(){return KN(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return D(I(n.prototype),"dispose",this).call(this)}}]),n}(NL);FF.className="Dropout",t_(FF);var OF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return M(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(FF);OF.className="SpatialDropout1D",t_(OF);var zF=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,iN(r.units,"units"),r.activation=BD(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=gL(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=gL(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=QL(e.kernelConstraint),r.biasConstraint=QL(e.biasConstraint),r.kernelRegularizer=qD(e.kernelRegularizer),r.biasRegularizer=qD(e.biasRegularizer),r.activityRegularizer=qD(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return M(n,[{key:"build",value:function(e){var t=(e=wL(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:k({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=wL(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t);var r,a=xL(e),i=sN(n.activation.getClassName());return null!=i?r=GN(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=GN(a,n.kernel.read()),null!=n.bias&&(r=qN(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:zD(this.activation),useBias:this.useBias,kernelInitializer:mL(this.kernelInitializer),biasInitializer:mL(this.biasInitializer),kernelRegularizer:jD(this.kernelRegularizer),biasRegularizer:jD(this.biasRegularizer),activityRegularizer:jD(this.activityRegularizer),kernelConstraint:ZL(this.kernelConstraint),biasConstraint:ZL(this.biasConstraint)},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);zF.className="Dense",t_(zF);var UF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return M(n,[{key:"computeOutputShape",value:function(e){var t,n=N((e=wL(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new UR('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(R0){n.e(R0)}finally{n.f()}return[e[0],IN(e,1)]}},{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t);var r=xL(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=QT(r,a)}return function(e){if(e.rank<=1)throw new UR("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],IN(e.shape,1)];return mE(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);UF.className="Flatten",t_(UF);var BF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=BD(e.activation),r}return M(n,[{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t);var r=xL(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:zD(this.activation)},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);BF.className="Activation",t_(BF);var WF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return M(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return BS((function(){return e=xL(e),t=e,r=n.n,BS((function(){if(2!==t.shape.length)throw new UR("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(t.shape.length," tensor."));return WN(DN(t,1),[1,r,1])}));var t,r}))}},{key:"getConfig",value:function(){var e={n:this.n},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);WF.className="RepeatVector",t_(WF);var VF=function(e){C(n,e);var t=R(n);function n(e){var r;E(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return M(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new UR("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=IN(e);if(null!==i){if(0===a||u%a!==0)throw new UR(n);r[i]=u/a}else if(u!==a)throw new UR(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t);var r=xL(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return mE(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);VF.className="Reshape",t_(VF);var GF=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));var a=NN(1,e.dims.length+1);if(!cg(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new ML({ndim:r.dims.length+1})],r}return M(n,[{key:"computeOutputShape",value:function(e){var t=(e=wL(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return QT(xL(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);GF.className="Permute",t_(GF);var HF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return M(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=xL(e);return $_(gT(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t);var r=xL(e),a=$_(gT(r,n.maskValue),-1,!0);return qS(r,DS(a,r.dtype))}))}}]),n}(NL);HF.className="Masking",t_(HF);var jF=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(qR(e.inputLength))}return r.inputDim=e.inputDim,iN(r.inputDim,"inputDim"),r.outputDim=e.outputDim,iN(r.outputDim,"outputDim"),r.embeddingsInitializer=gL(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=qD(e.embeddingsRegularizer),r.activityRegularizer=qD(e.activityRegularizer),r.embeddingsConstraint=QL(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,r}return M(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return BS((function(){return n.maskZero?(e=xL(e),gT(e,ZS(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=wL(e),null==this.inputLength)return[].concat(g(e),[this.outputDim]);var t=qR(this.inputLength);if(t.length!==e.length-1)throw new UR('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new UR('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(g(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t);var r=xL(e);"int32"!==r.dtype&&(r=PN(r,"int32"));var a=HN(n.embeddings.read(),mE(r,[r.size]));return mE(a,wL(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:mL(this.embeddingsInitializer),embeddingsRegularizer:jD(this.embeddingsRegularizer),activityRegularizer:jD(this.activityRegularizer),embeddingsConstraint:ZL(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);jF.className="Embedding",t_(jF);var XF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return M(n,[{key:"mergeFunction",value:function(e){throw new BR}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new UR("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[wL(e)]),e.length<2)throw new UR("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));var t,n=[],r=N(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(R0){r.e(R0)}finally{r.f()}if((n=tN(n)).length>1)throw new UR("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===tN(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=RN(r),o=N(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,l=0;l<i-u;++l)s=DN(s,1);t.push(s)}}catch(R0){o.e(R0)}finally{o.f()}return n.mergeFunction(t)}var c,h=!1,d=N(e);try{for(d.s();!(c=d.n()).done;){var f=c.value,p=f.rank;if(null==p){var v=f.shape,m=v[0],g=v.slice(1).concat([m]),y=mE(f,[m].concat(IN(v.slice(1))));y=QT(y,[1,0]),y=mE(y,g),t.push(y),h=!0}else if(p>1){var b=NN(1,p).concat([0]);t.push(QT(f,b)),h=!0}else t.push(f)}}catch(R0){d.e(R0)}finally{d.f()}var x=n.mergeFunction(t),w=x.rank;if(h)if(null==w){var k=x.shape,S=k[k.length-1],_=[S].concat(k.slice(0,k.length-1));x=mE(QT(mE(x,[-1,S]),[1,0]),_)}else if(w>1){var E=[w-1].concat(NN(0,w-1));x=QT(x,E)}return x}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=N(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(R0){o.e(R0)}finally{o.f()}return t=1===(i=tN(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return BS((function(){if(null==t)return null;if(!Array.isArray(t))throw new UR("`mask` should be an Array");if(!Array.isArray(e))throw new UR("`inputs` should be an Array");if(t.length!==e.length)throw new UR("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:VE(e,0)})))[0],r=1;r<t.length-1;++r)n=tT(n,t[r]);return n}))}}]),n}(NL),qF=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"mergeFunction",value:function(e){return BS((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=HS(t,e[n]);return t}))}}]),n}(XF);qF.className="Add",t_(qF);var KF=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"mergeFunction",value:function(e){return BS((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=qS(t,e[n]);return t}))}}]),n}(XF);KF.className="Multiply",t_(KF);var YF=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"mergeFunction",value:function(e){return BS((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=HS(t,e[n]);return qS(1/e.length,t)}))}}]),n}(XF);YF.className="Average",t_(YF);var ZF=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"mergeFunction",value:function(e){return BS((function(){for(var t=e[0],n=1;n<e.length;++n)t=f_(t,e[n]);return t}))}}]),n}(XF);ZF.className="Maximum",t_(ZF);var JF=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"mergeFunction",value:function(e){return BS((function(){for(var t=e[0],n=1;n<e.length;++n)t=sT(t,e[n]);return t}))}}]),n}(XF);JF.className="Minimum",t_(JF);var QF=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return M(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new UR("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=N(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(R0){r.e(R0)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,l=N(a);try{for(l.s();!(s=l.n()).done;){if(cg(s.value,o)){u=!0;break}}}catch(R0){l.e(R0)}finally{l.f()}u||a.push(o)}if(a.length>1)throw new UR("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return BS((function(){return UN(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new UR("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=N(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(R0){i.e(R0)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new UR("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new UR("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new UR("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return BS((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(DS(wT(e[i]),"bool")):t[i].rank<e[i].rank?a.push(VE(t[i],-1)):a.push(t[i]);var o=EE(a,n.axis);return Q_(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(XF);function $F(e,t){for(;e<0;)e+=t;return e}QF.className="Concatenate",t_(QF);var eO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return M(n,[{key:"build",value:function(e){og(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new BR("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new UR("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new UR("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return $F(t,e[n].shape.length)})):[$F(this.axes,n.shape.length),$F(this.axes,r.shape.length)],this.normalize&&(n=hP(n,t[0]),r=hP(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new BR("batchDot is not implemented for tensors of 4D or higher rank yet");if(og(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)})),og(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)})),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new BR("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return BS((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=mE(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var l=[],c=0;c<n;++c)l.push(1);e=mE(e,e.shape.concat(l))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?$E(qS(e,t),i[0]):$E(qS(QT(e,[1,0]),t),i[1]);else{var h=i[0]!==e.shape.length-1,d=i[1]===t.shape.length-1;o=nT(e,t,h,d)}if(n>0){for(var f,p=[],v=f=r>a?r+a-3:r-1;v<f+n;++v)p.push(v);o=GT(o,p)}return 1===o.shape.length&&(o=VE(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[$F(this.axes,e.length),$F(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){og(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new BR("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(XF);eO.className="Dot",t_(eO);var tO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return M(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t);var r=xL(e);return YN((function(){return HS(VN(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(NL);tO.className="GaussianNoise",t_(tO);var nO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return M(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t);var r=xL(e);if(n.rate>0&&n.rate<1){return YN((function(){var e=Math.sqrt(n.rate/(1-n.rate));return qS(r,VN(r.shape,1,e))}),(function(){return r}),t.training||!1)}return r}))}}]),n}(NL);nO.className="GaussianDropout",t_(nO);var rO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return M(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||xL(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=D(I(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return BS((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return YN((function(){var t=xL(e),a=-1.7580993408473766,i=KE(CT(r),n.rate);i=PN(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=HS(qS(t,i),qS(HS(i,-1),a));return HS(qS(u,o),s)}),(function(){return xL(e)}),t.training||!1)}return e}))}}]),n}(NL);function aO(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=xE(e,t,n,r,a,o);else if(3===e.rank)i=wE(e,t,n,r,a,o);else{if(4!==e.rank)throw new BR("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=kE(e,t,n,r,a,o)}return i}function iO(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return cg(r.slice().sort(),NN(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return BS((function(){var i=vT(e,r),o=i.mean,s=i.variance;return[aO(e,o,s,n,t,a),o,s]}))}(e,t,n,r,a):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return BS((function(){var i,o=vT(e,r),s=o.mean,u=o.variance,l=[],c=N(NN(0,e.rank));try{for(c.s();!(i=c.n()).done;){var h=i.value;-1!==r.indexOf(h)?l.push(1):l.push(e.shape[h])}}catch(R0){c.e(R0)}finally{c.f()}var d=mE(s,l),f=mE(u,l),p=null==t?null:mE(t,l),v=null==n?null:mE(n,l);return[aO(e,d,f,v,p,a),s,u]}))}(e,t,n,r,a)}rO.className="AlphaDropout",t_(rO);var oO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=gL(e.betaInitializer||"zeros"),r.gammaInitializer=gL(e.gammaInitializer||"ones"),r.movingMeanInitializer=gL(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=gL(e.movingVarianceInitializer||"ones"),r.betaConstraint=QL(e.betaConstraint),r.gammaConstraint=QL(e.gammaConstraint),r.betaRegularizer=qD(e.betaRegularizer),r.gammaRegularizer=qD(e.gammaRegularizer),r}return M(n,[{key:"build",value:function(e){e=wL(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new UR("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new ML({ndim:e.length,axes:k({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return BS((function(){var r=null!=t.training&&t.training,a=xL(e),i=a.shape,o=i.length,s=NN(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var l=GR(1,o);l[u]=i[u];var c=s.slice();c.sort();var h=!cg(c,NN(0,o).slice(0,o-1));if(!r)return function(){if(h){var e=mE(n.movingMean.read(),l),t=mE(n.movingVariance.read(),l),r=n.center?mE(n.beta.read(),l):null,i=n.scale?mE(n.gamma.read(),l):null;return aO(a,e,t,r,i,n.epsilon)}return aO(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var d=x(iO(a,n.gamma.read(),n.beta.read(),s,n.epsilon),3),f=d[0],p=d[1],v=d[2],m=function(e,t,n){BS((function(){var r=1-n,a=e.read(),i=qS(s_(a,t),r);e.write(s_(a,i))}))};return m(n.movingMean,p,n.momentum),m(n.movingVariance,v,n.momentum),f}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mL(this.betaInitializer),gammaInitializer:mL(this.gammaInitializer),movingMeanInitializer:mL(this.movingMeanInitializer),movingVarianceInitializer:mL(this.movingVarianceInitializer),betaRegularizer:jD(this.betaRegularizer),gammaRegularizer:jD(this.gammaRegularizer),betaConstraint:ZL(this.betaConstraint),gammaConstraint:ZL(this.gammaConstraint)},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);oO.className="BatchNormalization",t_(oO);var sO=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"===typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(r.axis)));var a,i=N(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(r.axis)))}}catch(R0){i.e(R0)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=gL(e.betaInitializer||"zeros"),r.gammaInitializer=gL(e.gammaInitializer||"ones"),r.betaRegularizer=qD(e.betaRegularizer),r.gammaRegularizer=qD(e.gammaRegularizer),r.supportsMasking=!0,r}return M(n,[{key:"build",value:function(e){var t=(e=wL(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=N(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(R0){a.e(R0)}finally{a.f()}if(this.axis.length!==tN(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=xL(e),a=r.shape,i=a.length;return BS((function(){var e,t=vT(r,n.axis,!0),o=t.mean,s=t.variance,u=GR(1,i),l=N(n.axis);try{for(l.s();!(e=l.n()).done;){var c=e.value;u[c]=a[c]}}catch(R0){l.e(R0)}finally{l.f()}for(var h=function(e){return null!=e&&e.shape.length!==i?mE(e,u):e},d=n.scale?h(n.gamma.read()):null,f=n.center?h(n.beta.read()):null,p=[],v=[],m=0;m<i;++m)-1!==n.axis.indexOf(m)?(p.push(a[m]),v.push(1)):(p.push(1),v.push(a[m]));return o=GE(o,p),s=GE(s,p),null!=d&&(d=GE(d,v)),null!=f&&(f=GE(f,v)),aO(r,o,s,f,d,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mL(this.betaInitializer),gammaInitializer:mL(this.gammaInitializer),betaRegularizer:jD(this.betaRegularizer),gammaRegularizer:jD(this.gammaRegularizer)},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);sO.className="LayerNormalization",t_(sO);var uO=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new UR("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));var a,i;if("number"===typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new UR("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new UR("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new ML({ndim:4})],r}return M(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=wL(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return BS((function(){return t=xL(e),r=n.padding,a=n.dataFormat,BS((function(){if(4!==t.rank)throw new UR("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(t.rank,"-D tensor."));if(null==r&&(r=[[1,1],[1,1]]),2!==r.length||2!==r[0].length||2!==r[1].length)throw new UR("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==a&&(a="channelsLast"),"channelsLast"!==a&&"channelsFirst"!==a)throw new UR("Unknown data format: ".concat(a,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var e;return e="channelsFirst"===a?[[0,0],[0,0],r[0],r[1]]:[[0,0],r[0],r[1],[0,0]],kT(t,e)}));var t,r,a}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);function lO(e,t,n,r,a,i){return BS((function(){var o;yN(a),xN(i),bN(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=rF(e,a);var s="same"===r?"same":"valid";return o="max"===i?rT(e,t,n,s):gE(e,t,n,s),"channelsFirst"===a&&(o=QT(o,[0,3,1,2])),o}))}function cO(e,t,n,r,a,i){return BS((function(){var o;yN(a),xN(i),bN(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=aF(e,a);var s="same"===r?"same":"valid";return o="max"===i?aT(e,t,n,s):yE(e,t,n,s),"channelsFirst"===a&&(o=QT(o,[0,4,1,2,3])),o}))}uO.className="ZeroPadding2D",t_(uO);var hO=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"===typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new UR("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(iN(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"===typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new UR("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));r.strides=e.strides}return iN(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,bN(r.padding),r.inputSpec=[new ML({ndim:3})],r}return M(n,[{key:"computeOutputShape",value:function(e){var t=tF((e=wL(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return BS((function(){n.invokeCallHook(e,t),e=DN(xL(e),2);var r=n.poolingFunction(xL(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return GT(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL),dO=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yN(a),bN(r),lO(e,t,n,r,a,"max")}}]),n}(hO);dO.className="MaxPooling1D",t_(dO);var fO=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yN(a),bN(r),lO(e,t,n,r,a,"avg")}}]),n}(hO);fO.className="AveragePooling1D",t_(fO);var pO=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new UR("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return iN(r.poolSize,"poolSize"),iN(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yN(r.dataFormat),bN(r.padding),r.inputSpec=[new ML({ndim:4})],r}return M(n,[{key:"computeOutputShape",value:function(e){e=wL(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=tF(t,this.poolSize[0],this.padding,this.strides[0]),n=tF(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return BS((function(){return n.invokeCallHook(e,t),n.poolingFunction(xL(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL),vO=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yN(a),bN(r),lO(e,t,n,r,a,"max")}}]),n}(pO);vO.className="MaxPooling2D",t_(vO);var mO=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yN(a),bN(r),lO(e,t,n,r,a,"avg")}}]),n}(pO);mO.className="AveragePooling2D",t_(mO);var gO=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new UR("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return iN(r.poolSize,"poolSize"),iN(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yN(r.dataFormat),bN(r.padding),r.inputSpec=[new ML({ndim:5})],r}return M(n,[{key:"computeOutputShape",value:function(e){e=wL(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=tF(t,this.poolSize[0],this.padding,this.strides[0]),n=tF(n,this.poolSize[1],this.padding,this.strides[1]),r=tF(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return BS((function(){return n.invokeCallHook(e,t),n.poolingFunction(xL(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL),yO=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yN(a),bN(r),cO(e,t,n,r,a,"max")}}]),n}(gO);yO.className="MaxPooling3D",t_(yO);var bO=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e)}return M(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yN(a),bN(r),cO(e,t,n,r,a,"avg")}}]),n}(gO);bO.className="AveragePooling3D",t_(bO);var xO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).inputSpec=[new ML({ndim:3})],r}return M(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new BR}}]),n}(NL),wO=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e||{})}return M(n,[{key:"call",value:function(e,t){return BS((function(){var t=xL(e);return iT(t,1)}))}}]),n}(xO);wO.className="GlobalAveragePooling1D",t_(wO);var kO=function(e){C(n,e);var t=R(n);function n(e){return E(this,n),t.call(this,e||{})}return M(n,[{key:"call",value:function(e,t){return BS((function(){var t=xL(e);return QE(t,1)}))}}]),n}(xO);kO.className="GlobalMaxPooling1D",t_(kO);var SO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yN(r.dataFormat),r.inputSpec=[new ML({ndim:4})],r}return M(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new BR}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL),_O=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"call",value:function(e,t){var n=this;return BS((function(){var t=xL(e);return"channelsLast"===n.dataFormat?iT(t,[1,2]):iT(t,[2,3])}))}}]),n}(SO);_O.className="GlobalAveragePooling2D",t_(_O);var EO=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.apply(this,arguments)}return M(n,[{key:"call",value:function(e,t){var n=this;return BS((function(){var t=xL(e);return"channelsLast"===n.dataFormat?QE(t,[1,2]):QE(t,[2,3])}))}}]),n}(SO);EO.className="GlobalMaxPooling2D",t_(EO);var TO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).layer=e.layer,r}return M(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){D(I(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=cP(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(NL),MO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return M(n,[{key:"build",value:function(e){if((e=wL(e)).length<3)throw new UR("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),D(I(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=wL(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return BS((function(){return wF((function(e,r){return[xL(n.layer.call(e,t)),[]]}),e=xL(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(TO);MO.className="TimeDistributed",t_(MO);var CO=function(e){C(n,e);var t=R(n);function n(e){var r;E(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=cP(i),a.goBackwards=!0!==a.goBackwards;var o,s={};if(s.className=e.layer.getClassName(),s.config=a,r.backwardLayer=cP(s),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,o=r.mergeMode,rN(mN,"BidirectionalMergeMode",o),e.weights)throw new BR("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return M(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):XR(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=xF(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return D(I(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new UR("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,g(r));var l=r.map((function(e){return new ML({shape:e.shape})}));this.forwardLayer.stateSpec=l.slice(0,u/2),this.backwardLayer.stateSpec=l.slice(u/2),s.push.apply(s,g(l))}if(null!=a)throw new BR("Support for constants in Bidirectional layers is not implemented yet.");for(var c=o[0]instanceof CL,h=0,d=o;h<d.length;h++){if(d[h]instanceof CL!==c)throw new UR("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(c){var f=[e].concat(o),p=this.inputSpec.concat(s),v=this.inputSpec;this.inputSpec=p;var m=D(I(n.prototype),"apply",this).call(this,f,t);return this.inputSpec=v,m}return D(I(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return BS((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),l=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:l}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=RT(a,1)),"concat"===n.mergeMode?o=UN([r,a]):"sum"===n.mergeMode?o=HS(r,a):"ave"===n.mergeMode?o=qS(.5,HS(r,a)):"mul"===n.mergeMode?o=qS(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;SN(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),SN(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){D(I(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=cP(t.layer);if(delete t.layer,null!=t.numConstants)throw new BR("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(TO);CO.className="Bidirectional",t_(CO);var IO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).scale=e.scale,e.offset?r.offset=e.offset:r.offset=0,r}return M(n,[{key:"getConfig",value:function(){var e={scale:this.scale,offset:this.offset},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return BS((function(){return"float32"!==(e=xL(e)).dtype&&(e=PN(e,"float32")),HS(qS(e,n.scale),n.offset)}))}}]),n}(NL);IO.className="Rescaling",t_(IO);var AO=rC.resizeBilinear,RO=rC.cropAndResize,NO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,r}return M(n,[{key:"centerCrop",value:function(e,t,n,r,a,i,o,s){return BS((function(){var u,l=!1,c=[t/i,n/o,(r+t)/i,(a+n)/o],h=[];3===e.rank?(l=!0,u=HT([e])):u=e;for(var d=0;d<u.shape[0];d++)h.push(c);var f=Ek(h,[h.length,4]),p=IT(0,h.length,1,"int32"),v=RO(u,f,p,[r,a],"nearest");return PN(l?xL(KT(v)):v,s)}))}},{key:"upsize",value:function(e,t,n,r){return BS((function(){return PN(AO(e,[t,n]),r)}))}},{key:"call",value:function(e,t){var n=this;return BS((function(){var t=xL(e),r=t.dtype,a=t.shape,i=a[a.length-3],o=a[a.length-2],s=0;i!==n.height&&(s=Math.floor((i-n.height)/2));var u=0;return o!==n.width&&0===(u=Math.floor((o-n.width)/2))&&(u=1),s>=0&&u>=0?n.centerCrop(t,s,u,n.height,n.width,i,o,r):n.upsize(e,n.height,n.width,r)}))}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=wL(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}]),n}(NL);NO.className="CenterCrop",t_(NO);var LO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).numTokens=e.numTokens,e.outputMode?r.outputMode=e.outputMode:r.outputMode="multiHot",r}return M(n,[{key:"getConfig",value:function(){var e={numTokens:this.numTokens,outputMode:this.outputMode},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){return null==(e=wL(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}},{key:"call",value:function(e,t){var n=this;return BS((function(){var r;if("int32"!==(e=xL(e)).dtype&&(e=PN(e,"int32")),"undefined"!==typeof t.countWeights){if("count"!==n.outputMode)throw new UR("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));r=xL(t.countWeights)}var a=QE(e),i=oT(e),o=qE(n.numTokens,a).bufferSync().get(0),s=KE(i,0).bufferSync().get(0);if(!o||!s)throw new UR("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(n.numTokens));return function(e,t,n,r){var a=xL(e);if("int32"!==a.dtype&&(a=PN(a,"int32")),"int"===t)return a;var i=a.shape;if(0===a.rank&&(a=VE(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=VE(a,-1)),a.rank>2)throw new UR("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(t," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o,s=["multiHot","oneHot"].includes(t),u=a;if(o=OE(u,"undefined"!==typeof r&&"count"===t?r:[],n,s),"tfIdf"!==t)return o;if(r)return qS(o,r);throw new UR("When outputMode is 'tfIdf', weights must be provided.")}(e,n.outputMode,n.numTokens,r)}))}}]),n}(NL);LO.className="CategoryEncoding",t_(LO);var PO=new Set(["bilinear","nearest"]),DO=function(e){C(n,e);var t=R(n);function n(e){var r;if(E(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,e.interpolation){if(!PO.has(e.interpolation))throw new UR("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));r.interpolation=e.interpolation}else r.interpolation="bilinear";return r.cropToAspectRatio=Boolean(e.cropToAspectRatio),r}return M(n,[{key:"computeOutputShape",value:function(e){var t=(e=wL(e))[2];return[this.height,this.width,t]}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return BS((function(){var t=[n.height,n.width];if("bilinear"===n.interpolation)return rC.resizeBilinear(e,t,!n.cropToAspectRatio);if("nearest"===n.interpolation)return rC.resizeNearestNeighbor(e,t,!n.cropToAspectRatio);throw new Error("Interpolation is ".concat(n.interpolation," but only ").concat(g(PO)," are supported"))}))}}]),n}(NL);DO.className="Resizing",t_(DO);var FO=function(){function e(t){E(this,e),this.seed=t}return M(e,[{key:"next",value:function(){if(void 0!==this.seed)return this.seed++}}]),e}();FO.className="RandomSeed";var OO=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this,e)).randomGenerator=new FO(e.seed),r}return M(n,[{key:"getConfig",value:function(){var e={seed:this.randomGenerator.seed},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(NL);OO.className="BaseRandomLayer";var zO=new Set(["bilinear","nearest"]),UO=function(e){C(n,e);var t=R(n);function n(e){var r;E(this,n),r=t.call(this,e);var a=e.factor,i=e.interpolation,o=void 0===i?"bilinear":i;if(r.factor=a,Array.isArray(r.factor)&&2===r.factor.length)r.widthLower=r.factor[0],r.widthUpper=r.factor[1];else{if(Array.isArray(r.factor)||!(r.factor>0))throw new UR("Invalid factor: ".concat(r.factor,". Must be positive number or tuple of 2 numbers"));r.widthLower=-r.factor,r.widthUpper=r.factor}if(r.widthLower<-1||r.widthUpper<-1)throw new UR("factor must have values larger than -1. Got: ".concat(r.factor));if(r.widthUpper<r.widthLower)throw new UR("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(r.widthUpper,".\n        Got lower bound: ").concat(r.widthLower,"\n      "));if(o){if(!zO.has(o))throw new UR("Invalid interpolation parameter: ".concat(o," is not implemented"));r.interpolation=o}return r}return M(n,[{key:"getConfig",value:function(){var e={factor:this.factor,interpolation:this.interpolation},t=D(I(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=wL(e))[2];return[this.imgHeight,-1,t]}},{key:"call",value:function(e,t){var n=this;return BS((function(){var t=xL(e);n.imgHeight=t.shape[t.shape.length-3];var r=t.shape[t.shape.length-2];n.widthFactor=CT([1],1+n.widthLower,1+n.widthUpper,"float32",n.randomGenerator.next());var a=n.widthFactor.dataSync()[0]*r;a=Math.round(a);var i=[n.imgHeight,a];switch(n.interpolation){case"bilinear":return rC.resizeBilinear(e,i);case"nearest":return rC.resizeNearestNeighbor(e,i);default:throw new Error("Interpolation is ".concat(n.interpolation,"\n          but only ").concat(g(zO)," are supported"))}}))}}]),n}(OO);UO.className="RandomWidth",t_(UO);var BO,WO;Bg().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(BO||(BO={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(WO||(WO={}));Error;new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function VO(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(XO(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=VO(e[o],t,n,r);i[o]=s}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function GO(e){return HO(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:jO)}function HO(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(XO(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=HO(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function jO(e){return null===e?null:XO(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function XO(e){var t=!1;Bg().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof n(977).StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof Hw)&&!(e instanceof Promise)&&!t)}function qO(e){return function(e,t){return VO(e,t)}(e,KO)}function KO(e){return e instanceof Hw?{value:e.clone(),recurse:!1}:XO(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var YO=function(){function e(t){if(E(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return M(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=N(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(R0){n.e(R0)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),ZO=function(e){C(n,e);var t=R(n);function n(){return E(this,n),t.call(this,n.INITIAL_CAPACITY)}return M(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){D(I(n.prototype),"isFull",this).call(this)&&this.expand(),D(I(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){D(I(n.prototype),"isFull",this).call(this)&&this.expand(),D(I(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(YO);function JO(e){return new nz(e)}function QO(e,t){return new fz(e,t)}ZO.INITIAL_CAPACITY=32;var $O,ez=function(){function e(){E(this,e)}return M(e,[{key:"toArray",value:function(){var e=c(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent,e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=c(u().mark((function e(){var t,n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent,e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value),e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new lz(this,e)}},{key:"filter",value:function(e){return new sz(this,e)}},{key:"map",value:function(e){return new uz(this,e)}},{key:"mapAsync",value:function(e){return new cz(this,e)}},{key:"serialMapAsync",value:function(e){return new cz(this,e).serial()}},{key:"flatmap",value:function(e){return new dz(this,e)}},{key:"forEachAsync",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){return new oz(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jO;return this.rowMajorBatch(e,t).map((function(e){return GO(e,n)}))}},{key:"concatenate",value:function(e,t){return new fz(new tz([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new iz(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new az(this,e)}},{key:"prefetch",value:function(e){return new pz(this,e)}},{key:"shuffle",value:function(e,t){return new vz(this,e,t)}},{key:"serial",value:function(){return new rz(this)}}]),e}(),tz=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).items=e,r.trav=0,r}return M(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],this.trav++,e.abrupt("return",{value:qO(t),done:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),nz=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).nextFn=e,r}return M(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),rz=function(e){C(n,e);var t=R(n);function n(e){var r;return E(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),az=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:WS(t.value),e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),iz=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++>=this.maxCount)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.abrupt("return",this.upstream.next());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),oz=function(e){C(n,e);var t=R(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return E(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=12;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=9;break}if(!(this.enableSmallLastBatch&&t.length>0)){e.next=8;break}return e.abrupt("return",{value:t,done:!1});case 8:return e.abrupt("return",{value:null,done:!0});case 9:t.push(n.value),e.next=1;break;case 12:return e.abrupt("return",{value:t,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),sz=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=6;break}return e.abrupt("return",t);case 6:WS(t.value),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),uz=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=c(u().mark((function e(){var t,n,r,a,i,o,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=ik(t.value),r=this.transform(t.value),a=ik(r),i=N(n);try{for(i.s();!(o=i.n()).done;)ak(s=o.value,a)||s.dispose()}catch(R0){i.e(R0)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),lz=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.upstream.next();case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),this.handler(e.t0)){e.next=11;break}return e.abrupt("return",{value:null,done:!0});case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),cz=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=c(u().mark((function e(){var t,n,r,a,i,o,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=ik(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=ik(r),i=N(n);try{for(i.s();!(o=i.n()).done;)ak(s=o.value,a)||s.dispose()}catch(R0){i.e(R0)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),hz=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).outputQueue=new ZO,e.lastRead=Promise.resolve({value:null,done:!1}),e}return M(n,[{key:"next",value:function(){var e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ez),dz=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=c(u().mark((function e(){var t,n,r,a,i,o,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=ik(t.value),r=this.transform(t.value),a=ik(r),this.outputQueue.pushAll(r),i=N(n);try{for(i.s();!(o=i.n()).done;)ak(s=o.value,a)||s.dispose()}catch(R0){i.e(R0)}finally{i.f()}return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(hz),fz=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return M(n,[{key:"summary",value:function(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}},{key:"next",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.readFromChain(this.lastRead),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=10;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 10:return e.next=12,this.iterator.next();case 12:if(!(r=e.sent).done){e.next=16;break}return this.iterator=null,e.abrupt("return",this.readFromChain(t));case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ez);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}($O||($O={}));var pz=function(e){C(n,e);var t=R(n);function n(e,r){var a;return E(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new YO(r),a}return M(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(ez),vz=function(e){C(n,e);var t=R(n);function n(e,r,a){var i;return E(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=_T.alea(a||Tw().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return M(n,[{key:"next",value:function(){var e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=c(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=14;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=12;break;case 10:return this.refill(),e.abrupt("return",n);case 12:e.next=1;break;case 14:return e.abrupt("return",{value:null,done:!0});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(pz),mz=function(){function e(){E(this,e),this.size=null}return M(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return og(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),gz(c(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,yz));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,gz(c(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,gz(c(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return BS((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return gz(c(u().mark((function n(){return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return BS((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return gz(c(u().mark((function n(){return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return gz(c(u().mark((function n(){return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,gz(c(u().mark((function t(){var r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=JO(c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 4:case"end":return e.stop()}}),e)})))),t.abrupt("return",QO(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,gz(c(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=_T.alea(t||Tw().toString());return gz(c(u().mark((function t(){var i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,gz(c(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function gz(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){C(a,n);var r=R(a);function a(){var e;return E(this,a),(e=r.apply(this,arguments)).size=t,e}return M(a,[{key:"iterator",value:function(){var t=c(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(mz))}function yz(e){return null===e?null:function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof Hw||Iw(e);var t}(e[0])?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof Hw?HT(e):Ek(e)}(e),recurse:!1}:{value:null,recurse:!0}}mz.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");function bz(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&og("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var xz=YC,wz=function(e){C(n,e);var t=R(n);function n(){var e;return E(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new Qm(A(e),zS()),e}return M(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,Bg().get("IS_NODE")&&ew("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&kg(n[0])){var a=n.map((function(e){return Mw(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;return"complex64"===n?IC(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):function(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}(this.data.get(e).values,n)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Cw(e)}));return PS(e.shape,e.dtype,n)}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return PS(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return zS().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e).complexTensorInfos;null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Tw(),t(),r=Tw()-n,e.abrupt("return",{kernelMs:r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){bz([e],"where");var t=this.readSync(e.dataId);return xz(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return D(I(n.prototype),"epsilon",this).call(this)}}]),n}($m);wz.nextDataId=0;function kz(e){return function(t,n,r){for(var a=bg(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function Sz(e,t,n){return _z(e,kz(t),n)}function _z(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;bz(s,e);var u,l=o,c=l.data.get(s.dataId).values;if("string"===s.dtype){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");u=KC(c)}else u=c;var h=n||s.dtype,d=t(u,h,i);return l.makeTensorInfo(s.shape,h,d)}}GS("cpu",(function(){return new wz}),1);var Ez=Sz(Vy,(function(e){return e>=0?e:Math.exp(e)-1})),Tz={kernelName:Vy,backendName:"cpu",kernelFunc:Ez};function Mz(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Cz={kernelName:ib,backendName:"cpu",kernelFunc:Mz};function Iz(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;bz([a],"leakyRelu");for(var o=lg(a.shape),s=n.data.get(a.dataId).values,u=yg("float32",o),l=0;l<s.length;l++)u[l]=s[l]<0?i*s[l]:s[l];return n.makeTensorInfo(a.shape,"float32",u)}var Az={kernelName:hb,backendName:"cpu",kernelFunc:Iz};function Rz(e){return function(t,n,r,a,i){var o=d_(t,n),s=o.length,u=Mg(o),l=yg(i,lg(o)),c=t.length,h=n.length,d=Mg(t),f=Mg(n),p=c_(t,o),v=c_(n,o);if(p.length+v.length===0)for(var m=0;m<l.length;++m)l[m]=e(r[m%r.length],a[m%a.length]);else for(var g=function(){var t=Dg(y,s,u),n=t.slice(-c);p.forEach((function(e){return n[e]=0}));var i=Pg(n,c,d),o=t.slice(-h);v.forEach((function(e){return o[e]=0}));var m=Pg(o,h,f);l[y]=e(r[i],a[m])},y=0;y<l.length;++y)g();return[l,o]}}var Nz=Rz((function(e,t){return e<0?t*e:e}));function Lz(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;bz([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=x(Nz(r.shape,a.shape,i,o,"float32"),2),u=s[0],l=s[1];return n.makeTensorInfo(l,"float32",u)}var Pz={kernelName:Xb,backendName:"cpu",kernelFunc:Lz},Dz=Sz(ex,(function(e){return Math.max(0,e)})),Fz={kernelName:ex,backendName:"cpu",kernelFunc:Dz},Oz=Sz(ox,(function(e){return Math.min(Math.max(0,e),6)})),zz={kernelName:ox,backendName:"cpu",kernelFunc:Oz},Uz=kz((function(e){return 1/(1+Math.exp(-e))})),Bz=Sz(bx,(function(e){return 1/(1+Math.exp(-e))})),Wz={kernelName:bx,backendName:"cpu",kernelFunc:Bz};function Vz(e,t,n,r,a){if("linear"===n)return Mz({inputs:{x:t},backend:e});if("relu"===n)return Dz({inputs:{x:t},backend:e});if("elu"===n)return Ez({inputs:{x:t},backend:e});if("relu6"===n)return Oz({inputs:{x:t},backend:e});if("prelu"===n)return Lz({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return Iz({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return Bz({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function Gz(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var Hz={kernelName:gy,backendName:"cpu",kernelFunc:Gz};function jz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return Gz({inputs:{real:jz(e,t,"float32"),imag:jz(e,t,"float32")},backend:e});var r=Rg(lg(t),n);return e.makeTensorInfo(t,n,r)}function Xz(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var qz={kernelName:Qb,backendName:"cpu",kernelFunc:Xz};function Kz(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=Ew([0],n),i=x(Rz((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),2),o=i[0];return[i[1],"bool",o]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function Yz(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return Mz({inputs:{x:a},backend:n});var o=jz(n,a.shape,a.dtype),s=Yz({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=Gz({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var l=Xz({inputs:{input:a},backend:n}),c=Yz({inputs:{x:l},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(l),c}if(!xg(a.dtype,i)){var h=Mz({inputs:{x:a},backend:n});return{dataId:h.dataId,shape:h.shape,dtype:i}}var d=x(Kz(n.data.get(a.dataId).values,a.shape,a.dtype,i),3),f=d[0],p=d[1],v=d[2];return n.makeTensorInfo(f,p,v)}var Zz={kernelName:py,backendName:"cpu",kernelFunc:Yz};function Jz(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;bz([o,s],e);var l=u.data.get(o.dataId).values,c=u.data.get(s.dataId).values,h="string"===o.dtype?KC(l):l,d="string"===o.dtype?KC(c):c,f=r||o.dtype,p=x(t(o.shape,s.shape,h,d,f),2),v=p[0],m=p[1];return u.makeTensorInfo(m,f,v)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var l=Yz({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),c=u.data.get(l.dataId),h=c.complexTensorInfos.real,d=c.complexTensorInfos.imag,f=u.data.get(h.dataId).values,p=u.data.get(d.dataId).values,v=Yz({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),m=u.data.get(v.dataId),g=m.complexTensorInfos.real,y=m.complexTensorInfos.imag,b=u.data.get(g.dataId).values,w=u.data.get(y.dataId).values,k=x(n(o.shape,s.shape,f,p,b,w),3),S=k[0],_=k[1],E=k[2],T=u.makeTensorInfo(E,"float32",S),M=u.makeTensorInfo(E,"float32",_),C=Gz({inputs:{real:T,imag:M},backend:u});return u.disposeIntermediateTensorInfo(l),u.disposeIntermediateTensorInfo(v),u.disposeIntermediateTensorInfo(T),u.disposeIntermediateTensorInfo(M),C}var I=u.data.get(o.dataId).values,A=u.data.get(s.dataId).values,R=r||o.dtype,N=x(t(o.shape,s.shape,I,A,R),2),L=N[0],P=N[1];return u.makeTensorInfo(P,R,L)}}function Qz(e){return function(t,n,r,a,i,o){var s=d_(t,n),u=lg(s),l=s.length,c=Mg(s),h=yg("float32",u),d=yg("float32",u),f=c_(t,s),p=c_(n,s),v=IC(r,a),m=IC(i,o),g=t.length,y=Mg(t),b=n.length,x=Mg(n);if(f.length+p.length===0)for(var w=0;w<h.length;w++){var k=w%v.length,S=w%m.length,_=e(v[2*k],v[2*k+1],m[2*S],m[2*S+1]);h[w]=_.real,d[w]=_.imag}else for(var E=function(){var t=Dg(T,l,c),n=t.slice(-g);f.forEach((function(e){return n[e]=0}));var r=Pg(n,g,y),a=t.slice(-b);p.forEach((function(e){return a[e]=0}));var i=Pg(a,b,x),o=e(v[2*r],v[2*r+1],m[2*i],m[2*i+1]);h[T]=o.real,d[T]=o.imag},T=0;T<h.length;T++)E();return[h,d,s]}}var $z=Rz((function(e,t){return e+t})),eU=Qz((function(e,t,n,r){return{real:e+n,imag:t+r}})),tU=Jz(Kg,$z,eU),nU={kernelName:Kg,backendName:"cpu",kernelFunc:tU};function rU(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=lg(a.shape),s=vg(i,o),u=lg(s);og(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."})),n.incRef(a.dataId);var l=n.data.get(a.dataId);if(null!=l.complexTensorInfos){var c=l.complexTensorInfos.real,h=l.complexTensorInfos.imag;c.shape=s,h.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var aU={kernelName:tx,backendName:"cpu",kernelFunc:rU};function iU(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;bz([a,i],"matMul");var u=a.shape.length,l=i.shape.length,c=o?a.shape[u-2]:a.shape[u-1],h=s?i.shape[l-1]:i.shape[l-2],d=o?a.shape[u-1]:a.shape[u-2],f=s?i.shape[l-2]:i.shape[l-1],p=a.shape.slice(0,-2),v=i.shape.slice(0,-2),m=lg(p),g=lg(v),y=d_(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);og(c===h,(function(){return"Error in matMul: inner shapes (".concat(c,") and (")+"".concat(h,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")}));for(var b=s?[g,f,h]:[g,h,f],w=rU({inputs:{x:a},backend:n,attrs:{shape:o?[m,c,d]:[m,d,c]}}),k=rU({inputs:{x:i},backend:n,attrs:{shape:b}}),S=o?w.shape[1]:w.shape[2],_=o?w.shape[2]:w.shape[1],E=s?k.shape[1]:k.shape[2],T=Math.max(m,g),M=n.data.get(w.dataId).values,C=n.data.get(k.dataId).values,I=Mg(w.shape),A=Mg(k.shape),R=x(o?[I[0],1,I[1]]:[I[0],I[1],1],3),N=R[0],L=R[1],P=R[2],D=x(s?[1,A[1],A[0]]:[A[1],1,A[0]],3),F=D[0],O=D[1],z=D[2],U=_*E,B=PS([T,_,E],w.dtype),W=B.values,V=n.blockSize,G=0;G<T;G++)for(var H=G%m,j=G%g,X=0;X<_;X+=V)for(var q=Math.min(X+V,_),K=0;K<E;K+=V)for(var Y=Math.min(K+V,E),Z=0;Z<S;Z+=V)for(var J=Math.min(Z+V,S),Q=X;Q<q;Q++)for(var $=K;$<Y;$++){for(var ee=0,te=Z;te<J;te++){ee+=M[H*N+Q*L+te*P]*C[te*F+$*O+j*z]}W[G*U+(Q*E+$)]+=ee}return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(y,B.dtype,B.values)}var oU={kernelName:ly,backendName:"cpu",kernelFunc:iU};var sU={kernelName:Jx,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,l=a.bias,c=a.preluActivationWeights,h=o.transposeA,d=o.transposeB,f=o.activation,p=o.leakyreluAlpha,v=[];t=iU({inputs:{a:s,b:u},attrs:{transposeA:h,transposeB:d},backend:i}),l&&(n=tU({inputs:{a:t,b:l},backend:i}),v.push(t),t=n),f&&(r=Vz(i,t,f,c,p),v.push(t),t=r);for(var m=0,g=v;m<g.length;m++){var y=g[m];i.disposeIntermediateTensorInfo(y)}return t}};function uU(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var lU={kernelName:jg,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;bz(t,"abs");var r=new Float32Array(lg(t.shape));return r=uU(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},cU=Sz(Xg,(function(e){return Math.acos(e)})),hU={kernelName:Xg,backendName:"cpu",kernelFunc:cU},dU=Sz(qg,(function(e){return Math.acosh(e)})),fU={kernelName:qg,backendName:"cpu",kernelFunc:dU};var pU={kernelName:Yg,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;bz(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=PS(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],l=0;l<o.length;l++)o[l]+=u[l];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function vU(e,t,n,r,a){for(var i=t.length,o=lg(t),s=Mg(t),u=Mg(a),l=yg(n,lg(a)),c=0;c<o;++c){for(var h=Dg(c,i,s),d=new Array(h.length),f=0;f<d.length;f++)d[f]=h[r[f]];l[Pg(d,i,u)]=e[c]}return l}function mU(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;bz(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var l=vU(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(l,s,a.dtype),shape:s,dtype:a.dtype}}var gU={kernelName:Hx,backendName:"cpu",kernelFunc:mU};var yU={kernelName:Zg,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;bz(a,"all");var s=mg(i,a.shape),u=s,l=dT(u,a.shape.length),c=a;null!=l&&(c=mU({inputs:{x:a},backend:n,attrs:{perm:l}}),u=pT(u.length,a.shape.length)),hT("all",u,c.shape.length);for(var h=x(lT(c.shape,u),2),d=h[0],f=lg(h[1]),p=Rg(lg(d),c.dtype),v=n.data.get(c.dataId).values,m=0;m<p.length;++m){for(var g=m*f,y=v[g],b=0;b<f;++b){var w=v[g+b];y=y&&w}p[m]=y}null!=l&&n.disposeIntermediateTensorInfo(c);var k=n.makeTensorInfo(d,c.dtype,p);if(o){var S=rU({inputs:{x:k},backend:n,attrs:{shape:cT(d,s)}});return n.disposeIntermediateTensorInfo(k),S}return k}};var bU={kernelName:Jg,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;bz(a,"any");var s=mg(i,a.shape),u=s,l=dT(u,a.shape.length),c=a;null!=l&&(c=mU({inputs:{x:a},backend:n,attrs:{perm:l}}),u=pT(u.length,a.shape.length)),hT("any",u,c.shape.length);for(var h=x(lT(c.shape,u),2),d=h[0],f=lg(h[1]),p=Rg(lg(d),c.dtype),v=n.data.get(c.dataId).values,m=0;m<p.length;++m){for(var g=m*f,y=v[g],b=0;b<f;++b){var w=v[g+b];y=y||w}p[m]=y}null!=l&&n.disposeIntermediateTensorInfo(c);var k=n.makeTensorInfo(d,c.dtype,p);if(o){var S=rU({inputs:{x:k},backend:n,attrs:{shape:cT(d,s)}});return n.disposeIntermediateTensorInfo(k),S}return k}};var xU={kernelName:Qg,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;bz(a,"argMax");var o=mg(i,a.shape),s=dT(o,a.shape.length),u=a,l=[];null!=s&&(u=mU({inputs:{x:a},backend:n,attrs:{perm:s}}),l.push(u),o=pT(o.length,u.shape.length)),hT("argMax",o=[o[0]],u.shape.length);for(var c=x(lT(u.shape,o),2),h=c[0],d=c[1],f=Rg(lg(h),"int32"),p=lg(d),v=n.data.get(u.dataId).values,m=0;m<f.length;++m){for(var g=m*p,y=v[g],b=0,w=0;w<p;++w){var k=v[g+w];k>y&&(y=k,b=w)}f[m]=b}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",f)}};var wU={kernelName:$g,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;bz(a,"argMin");var o=mg(i,a.shape),s=dT(o,a.shape.length),u=a,l=[];null!=s&&(u=mU({inputs:{x:a},backend:n,attrs:{perm:s}}),l.push(u),o=pT(o.length,u.shape.length)),hT("argMin",o=[o[0]],u.shape.length);for(var c=x(lT(u.shape,o),2),h=c[0],d=c[1],f=Rg(lg(h),"int32"),p=lg(d),v=n.data.get(u.dataId).values,m=0;m<f.length;++m){for(var g=m*p,y=v[g],b=0,w=0;w<p;++w){var k=v[g+w];k<y&&(y=k,b=w)}f[m]=b}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",f)}},kU=Sz(ey,(function(e){return Math.asin(e)})),SU={kernelName:ey,backendName:"cpu",kernelFunc:kU},_U=Sz(ty,(function(e){return Math.asinh(e)})),EU={kernelName:ty,backendName:"cpu",kernelFunc:_U},TU=Sz(ny,(function(e){return Math.atan(e)})),MU={kernelName:ny,backendName:"cpu",kernelFunc:TU},CU=Rz((function(e,t){return Math.atan2(e,t)})),IU=Jz(ay,CU),AU={kernelName:ay,backendName:"cpu",kernelFunc:IU},RU=Sz(ry,(function(e){return Math.atanh(e)})),NU={kernelName:ry,backendName:"cpu",kernelFunc:RU};function LU(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,l=a.dilationWidth,c=a.effectiveFilterHeight,h=a.effectiveFilterWidth,d=a.padInfo.top,f=a.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=PS(a.outShape,n),m=v.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var w=x*g,k=x*r[0],S=0;S<a.inChannels;++S)for(var _=0;_<a.outHeight;++_)for(var E=_*o-d,T=Math.max(0,E),M=Math.min(a.inHeight,c+E),C=w+_*y,I=0;I<a.outWidth;++I){for(var A=I*s-f,R=Math.max(0,A),N=Math.min(a.inWidth,h+A),L=p,P=0,D=0,F=T;F<M;F+=u){for(var O=k+F*r[1],z=R;z<N;z+=l){var U=e[O+z*r[2]+S];"max"===i&&U>L?L=U:"avg"===i&&(P+=U,D++)}if(isNaN(L))break}m[C+I*b+S]="avg"===i?P/D:L}return v}function PU(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=PS(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,v=PS(t,n,e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-f,x=b;x<0;)x+=l;for(var w=Math.min(r.inHeight,h+b),k=0;k<r.outWidth;++k){for(var S=k*u-p,_=S;_<0;)_+=c;for(var E=Math.min(r.inWidth,d+S),T=Number.NEGATIVE_INFINITY,M=-1,C=x;C<w;C+=l)for(var I=C-b,A=_;A<E;A+=c){var R=A-S,N=v.get(m,C,A,g);N>T&&(T=N,M=a?i?((m*r.inHeight+C)*r.inWidth+A)*r.inChannels+g:(C*r.inWidth+A)*r.inChannels+g:I*d+R)}o.set(M,m,y,k,g)}}return o}function DU(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,l=a.dilationDepth,c=a.dilationHeight,h=a.dilationWidth,d=a.effectiveFilterDepth,f=a.effectiveFilterHeight,p=a.effectiveFilterWidth,v=a.padInfo.front,m=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=PS(a.outShape,n),x=b.values,w=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],k=a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[3]*a.outShape[4],_=a.outShape[4],E=0;E<a.batchSize;++E)for(var T=E*w,M=E*r[0],C=0;C<a.inChannels;++C)for(var I=0;I<a.outDepth;++I){for(var A=I*o-v,R=A;R<0;)R+=l;for(var N=Math.min(a.inDepth,d+A),L=T+I*k,P=0;P<a.outHeight;++P){for(var D=P*s-m,F=D;F<0;)F+=c;for(var O=Math.min(a.inHeight,f+D),z=L+P*S,U=0;U<a.outWidth;++U){for(var B=U*u-g,W=B;W<0;)W+=h;for(var V=Math.min(a.inWidth,p+B),G=z+U*_,H=y,j=0,X=0,q=R;q<N;q+=l){for(var K=M+q*r[1],Y=F;Y<O;Y+=c){for(var Z=K+Y*r[2],J=W;J<V;J+=h){var Q=e[Z+J*r[3]+C];if("max"===i&&Q>H?H=Q:"avg"===i&&(j+=Q,X++),isNaN(H))break}if(isNaN(H))break}if(isNaN(H))break}x[G+C]="avg"===i?j/Math.max(X,1):H}}}return b}var FU={kernelName:iy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;bz(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;og(dE(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var l,c=nE(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&cg(c.inShape,c.outShape))l=Mz({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,d=Mg(a.shape),f=LU(h,a.shape,a.dtype,d,c,"avg");l=n.makeTensorInfo(c.outShape,a.dtype,f.values)}return l}};var OU={kernelName:sy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,l=r.dataFormat;bz(a,"avgPool3d");var c=rE(a.shape,i,o,1,s,u,l),h=DU(n.data.get(a.dataId).values,a.shape,a.dtype,Mg(a.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};var zU={kernelName:uy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,l=r.dimRoundingMode;bz([a,i],"avgPool3DGrad");for(var c=rE(i.shape,o,s,1,u,l),h=c.strideDepth,d=c.strideHeight,f=c.strideWidth,p=c.filterDepth,v=c.filterHeight,m=c.filterWidth,g=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,x=c.effectiveFilterDepth,w=c.effectiveFilterHeight,k=c.effectiveFilterWidth,S=x-1-c.padInfo.front,_=k-1-c.padInfo.left,E=w-1-c.padInfo.top,T=PS(i.shape,"float32"),M=1/(p*v*m),C=n.bufferSync(a),I=0;I<c.batchSize;++I)for(var A=0;A<c.inChannels;++A)for(var R=0;R<c.inDepth;++R)for(var N=0;N<c.inHeight;++N)for(var L=0;L<c.inWidth;++L){for(var P=R-S,D=N-E,F=L-_,O=0,z=0;z<x;z+=g){var U=(P+z)/h;if(!(U<0||U>=c.outDepth||Math.floor(U)!==U))for(var B=0;B<w;B+=y){var W=(D+B)/d;if(!(W<0||W>=c.outHeight||Math.floor(W)!==W))for(var V=0;V<k;V+=b){var G=(F+V)/f;if(!(G<0||G>=c.outWidth||Math.floor(G)!==G))O+=C.get(I,U,W,G,A)}}}T.set(O*M,I,R,N,L,A)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};var UU={kernelName:oy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;bz([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,l=r.pad,c=nE(o.shape,s,u,1,l),h=c.strideHeight,d=c.strideWidth,f=c.filterHeight,p=c.filterWidth,v=c.dilationHeight,m=c.dilationWidth,g=c.effectiveFilterHeight,y=c.effectiveFilterWidth,b=y-1-c.padInfo.left,x=g-1-c.padInfo.top,w=PS(o.shape,"float32"),k=1/(f*p),S=n.data.get(a.dataId).values,_=PS(a.shape,"float32",S),E=0;E<c.batchSize;++E)for(var T=0;T<c.inChannels;++T)for(var M=0;M<c.inHeight;++M)for(var C=0;C<c.inWidth;++C){for(var I=M-x,A=C-b,R=0,N=0;N<g;N+=v){var L=(I+N)/h;if(!(L<0||L>=c.outHeight||Math.floor(L)!==L))for(var P=0;P<y;P+=m){var D=(A+P)/d;if(!(D<0||D>=c.outWidth||Math.floor(D)!==D))R+=_.get(E,L,D,T)}}w.set(R*k,E,M,C,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var BU={kernelName:eb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;og(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),og(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),og(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),bz([a,s,u,i,o],"batchNorm");var l=r.varianceEpsilon;null==l&&(l=.001);for(var c=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,d=n.data.get(u.dataId).values,f=i?n.data.get(i.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(c.length),m=p.length,g=f.length,y=d.length,b=h.length,x=0,w=0,k=0,S=0,_=0;_<c.length;++_)v[_]=p[x++]+(c[_]-h[w++])*f[k++]/Math.sqrt(d[S++]+l),x>=m&&(x=0),w>=b&&(w=0),k>=g&&(k=0),S>=y&&(S=0);return n.makeTensorInfo(a.shape,a.dtype,v)}};function WU(e,t,n,r,a){var i=q_(r,t,n),o=lg(n),s=Mg(r);if(i){var u=K_(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var l=PS(r,a,"string"===a?KC(e):e),c=PS(n,a),h=0;h<c.size;++h){var d=c.indexToLoc(h),f=d.map((function(e,n){return e+t[n]}));c.set.apply(c,[l.get.apply(l,g(f))].concat(g(d)))}return"string"===a?c.values.map((function(e){return Mw(e)})):c.values}function VU(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;bz(a,"slice");var s=x(Y_(a,i,o),2),u=s[0],l=s[1];j_(a,u,l);var c=WU(n.data.get(a.dataId).values,u,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,c)}var GU={kernelName:vx,backendName:"cpu",kernelFunc:VU};var HU={kernelName:cy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;bz([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=pC(a.shape,i,s),l=vC(u.length,i.length),c=mC(a.shape,i,s),h=gC(o,i.length),d=yC(c,o,i.length),f=rU({inputs:{x:a},backend:n,attrs:{shape:u}}),p=mU({inputs:{x:f},backend:n,attrs:{perm:l}}),v=rU({inputs:{x:p},backend:n,attrs:{shape:c}}),m=VU({inputs:{x:v},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),m}};function jU(e,t,n,r,a){for(var i=lg(r),o=Rg(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function XU(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=PS([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var l=e.get(s,u);if(l<0)throw new Error("Input x must be non-negative!");l>=n||(r?o.set(1,s,l):t.size>0?o.set(o.get(s,l)+t.get(s,u),s,l):o.set(o.get(s,l)+1,s,l))}return o}var qU={kernelName:hy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=jU(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}},KU={kernelName:dy,backendName:"cpu",kernelFunc:Jz(dy,Rz((function(e,t){return e&t})))};var YU={kernelName:fy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=d_(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},ZU=kz((function(e){return Math.ceil(e)})),JU=_z(vy,ZU),QU={kernelName:vy,backendName:"cpu",kernelFunc:JU},$U=Sz(my,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),eB={kernelName:my,backendName:"cpu",kernelFunc:$U},tB={kernelName:yy,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(lg(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,l=0;l<s.length;l++){var c=s[l],h=u[l];r[l]=Math.hypot(c,h)}return n.makeOutput(r,t.shape,"float32")}};function nB(e,t,n,r){var a=bg(n,lg(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=lg(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?KC(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,l=0;l<e.shape[1];++l)a[u+l]=r[i++];o+=e.shape[1]}))}return a}function rB(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var aB={kernelName:sb,backendName:"cpu",kernelFunc:rB};function iB(e){var t=e.inputs,n=e.backend,r=mg(e.attrs.axis,t[0].shape)[0];lC(t.map((function(e){return e.shape})),r);var a=cC(t.map((function(e){return e.shape})),r);if(0===lg(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return lg(e.shape)>0}));if(1===i.length)return Mz({inputs:{x:i[0]},backend:n});if("complex64"===i[0].dtype){var o=i.map((function(e){return Xz({inputs:{input:e},backend:n})})),s=i.map((function(e){return rB({inputs:{input:e},backend:n})})),u=iB({inputs:o,backend:n,attrs:{axis:r}}),l=iB({inputs:s,backend:n,attrs:{axis:r}}),c=Gz({inputs:{real:u,imag:l},backend:n});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),c}var h=i.map((function(e){var t=lg(e.shape.slice(r));return rU({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),d=h.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));a=cC(h.map((function(e){return e.shape})),1);var f=1===h[0].shape[0],p=nB(d,a,t[0].dtype,f),v=cC(i.map((function(e){return e.shape})),r),m=n.makeTensorInfo(v,t[0].dtype,p);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}var oB={kernelName:by,backendName:"cpu",kernelFunc:iB};function sB(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,l=r.dilations,c=r.dimRoundingMode;bz([a,i],"conv2d");for(var h=pE(u),d=aE(a.shape,i.shape,o,l,s,c,!1,h),f=d.filterHeight,p=d.filterWidth,v=d.dilationHeight,m=d.dilationWidth,g=d.padInfo.left,y=d.padInfo.top,b="channelsLast"===d.dataFormat,x=new Ww(d.outShape,a.dtype),w=Mg(a.shape),k=Mg(i.shape),S=w[0],_=b?w[1]:w[2],E=b?w[2]:1,T=b?1:w[1],M=x.strides[0],C=b?x.strides[1]:x.strides[2],I=b?x.strides[2]:1,A=b?1:x.strides[1],R=n.data.get(a.dataId).values,N=n.data.get(i.dataId).values,L=x.values,P=0;P<d.batchSize;++P)for(var D=P*S,F=P*M,O=0;O<d.outHeight;++O)for(var z=F+O*C,U=O*d.strideHeight-y,B=0;B<f;++B){var W=U+B*v;if(!(W<0||W>=d.inHeight))for(var V=B*k[0],G=D+W*_,H=0;H<d.outWidth;++H)for(var j=z+H*I,X=H*d.strideWidth-g,q=0;q<p;++q){var K=X+q*m;if(!(K<0||K>=d.inWidth))for(var Y=G+K*E,Z=V+q*k[1],J=0;J<d.inChannels;++J){for(var Q=R[Y+J*T],$=0;$<d.outChannels;++$)L[j+$*A]+=Q*N[Z+$];Z+=d.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,L)}var uB={kernelName:xy,backendName:"cpu",kernelFunc:sB};var lB={kernelName:wy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=r.filterShape;bz([a,i],"conv2dBackpropFilter");for(var h=pE(u),d=aE(a.shape,c,o,1,s,l,!1,h),f=d.strideHeight,p=d.strideWidth,v=d.filterHeight,m=d.filterWidth,g="channelsLast"===d.dataFormat,y=new Ww(d.filterShape,"float32"),b=d.padInfo.left,x=d.padInfo.top,w=n.data.get(a.dataId).values,k=n.data.get(i.dataId).values,S=new Ww(a.shape,a.dtype,w),_=new Ww(i.shape,i.dtype,k),E=0;E<v;++E)for(var T=Math.max(0,Math.ceil((x-E)/f)),M=Math.min(d.outHeight,(d.inHeight+x-E)/f),C=0;C<m;++C)for(var I=Math.max(0,Math.ceil((b-C)/p)),A=Math.min(d.outWidth,(d.inWidth+b-C)/p),R=0;R<d.inChannels;++R)for(var N=0;N<d.outChannels;++N){for(var L=0,P=0;P<d.batchSize;++P)for(var D=T;D<M;++D)for(var F=E+D*f-x,O=I;O<A;++O){var z=C+O*p-b;L+=g?S.get(P,F,z,R)*_.get(P,D,O,N):S.get(P,R,F,z)*_.get(P,N,D,O)}y.set(L,E,C,R,N)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var cB={kernelName:ky,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,l=r.dataFormat,c=r.dimRoundingMode;bz([a,i],"conv2dBackpropInput");var h=Mg(i.shape),d=Mg(a.shape),f=pE(l),p=aE(o,i.shape,s,1,u,c,!1,f),v=new Ww(p.inShape,"float32"),m=v.values,g=n.data.get(a.dataId).values,y=n.data.get(i.dataId).values,b=x(h,3),w=b[0],k=b[1],S=b[2],_=p.batchSize,E=p.filterHeight,T=p.filterWidth,M=p.inChannels,C=p.inHeight,I=p.inWidth,A=p.outChannels,R=p.outHeight,N=p.outWidth,L=p.strideHeight,P=p.strideWidth;f=p.dataFormat;for(var D=E-1-p.padInfo.top,F=T-1-p.padInfo.left,O="channelsLast"===f,z=v.strides[0],U=O?v.strides[1]:v.strides[2],B=O?v.strides[2]:1,W=O?1:v.strides[1],V=d[0],G=O?d[1]:d[2],H=O?d[2]:1,j=O?1:d[1],X=0;X<_;++X)for(var q=0;q<M;++q)for(var K=0;K<C;++K)for(var Y=K-D,Z=Math.max(0,Math.ceil(Y/L)),J=Math.min(R,(E+Y)/L),Q=0;Q<I;++Q){for(var $=Q-F,ee=Math.max(0,Math.ceil($/P)),te=Math.min(N,(T+$)/P),ne=0,re=Z;re<J;++re)for(var ae=re*L-Y,ie=ee;ie<te;++ie)for(var oe=V*X+G*re+H*ie,se=w*(E-1-ae)+k*(T-1-(ie*P-$))+S*q,ue=0;ue<A;++ue){ne+=g[oe+j*ue]*y[se+ue]}m[z*X+U*K+B*Q+W*q]=ne}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var hB={kernelName:Sy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;bz([a,i],"conv3d");for(var l=iE(a.shape,i.shape,o,u,s),c=l.filterDepth,h=l.filterHeight,d=l.filterWidth,f=l.dilationDepth,p=l.dilationHeight,v=l.dilationWidth,m=l.padInfo,g=m.front,y=m.left,b=m.top,x=new Ww(l.outShape,a.dtype),w=n.data.get(a.dataId).values,k=n.data.get(i.dataId).values,S=x.values,_=Mg(a.shape),E=Mg(i.shape),T=0;T<l.batchSize;++T)for(var M=T*_[0],C=T*x.strides[0],I=0;I<l.outDepth;++I)for(var A=C+I*x.strides[1],R=I*l.strideDepth-g,N=0;N<c;++N){var L=R+N*f;if(!(L<0||L>=l.inDepth))for(var P=N*E[0],D=M+L*_[1],F=0;F<l.outHeight;++F)for(var O=A+F*x.strides[2],z=F*l.strideHeight-b,U=0;U<h;++U){var B=z+U*p;if(!(B<0||B>=l.inHeight))for(var W=P+U*E[1],V=D+B*_[2],G=0;G<l.outWidth;++G)for(var H=O+G*l.outChannels,j=G*l.strideWidth-y,X=0;X<d;++X){var q=j+X*v;if(!(q<0||q>=l.inWidth))for(var K=W+X*E[2],Y=V+q*l.inChannels,Z=K,J=0;J<l.inChannels;++J){for(var Q=w[Y+J],$=0;$<l.outChannels;++$)S[H+$]+=Q*k[Z+$];Z+=l.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var dB={kernelName:_y,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;bz([a,i],"conv3dBackpropFilterV2");for(var l=Mg(a.shape),c=Mg(i.shape),h=iE(a.shape,u,o,1,s),d=h.strideDepth,f=h.strideHeight,p=h.strideWidth,v=h.filterDepth,m=h.filterHeight,g=h.filterWidth,y=new Ww(h.filterShape,"float32"),b=y.values,w=x(y.strides,4),k=w[0],S=w[1],_=w[2],E=w[3],T=n.data.get(i.dataId).values,M=x(c,4),C=M[0],I=M[1],A=M[2],R=M[3],N=n.data.get(a.dataId).values,L=x(l,4),P=L[0],D=L[1],F=L[2],O=L[3],z=h.padInfo.front,U=h.padInfo.left,B=h.padInfo.top,W=0;W<v;++W)for(var V=Math.max(0,Math.ceil((z-W)/d)),G=Math.min(h.outDepth,(h.inDepth+z-W)/d),H=W*k,j=0;j<m;++j)for(var X=Math.max(0,Math.ceil((B-j)/f)),q=Math.min(h.outHeight,(h.inHeight+B-j)/f),K=j*S+H,Y=0;Y<g;++Y)for(var Z=Math.max(0,Math.ceil((U-Y)/p)),J=Math.min(h.outWidth,(h.inWidth+U-Y)/p),Q=Y*_+K,$=0;$<h.inChannels;++$)for(var ee=$*E+Q,te=0;te<h.outChannels;++te){for(var ne=0,re=0;re<h.batchSize;++re)for(var ae=re*P,ie=re*C,oe=V;oe<G;++oe)for(var se=(W+oe*d-z)*D+ae,ue=oe*I+ie,le=X;le<q;++le)for(var ce=(j+le*f-B)*F+se,he=le*A+ue,de=Z;de<J;++de){var fe=de*R+he;ne+=N[(Y+de*p-U)*O+ce+$]*T[fe+te]}b[ee+te]=ne}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var fB={kernelName:Ey,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;bz([a],"conv3dBackpropInputV2");for(var l=Mg(a.shape),c=Mg(i.shape),h=iE(u,i.shape,s,1,o),d=new Ww(h.inShape,"float32"),f=d.values,p=x(d.strides,4),v=p[0],m=p[1],g=p[2],y=p[3],b=n.data.get(a.dataId).values,w=x(l,4),k=w[0],S=w[1],_=w[2],E=w[3],T=n.data.get(i.dataId).values,M=x(c,4),C=M[0],I=M[1],A=M[2],R=M[3],N=h.batchSize,L=h.filterDepth,P=h.filterHeight,D=h.filterWidth,F=h.inChannels,O=h.inDepth,z=h.inHeight,U=h.inWidth,B=h.outChannels,W=h.outDepth,V=h.outHeight,G=h.outWidth,H=h.strideDepth,j=h.strideHeight,X=h.strideWidth,q=L-1-h.padInfo.front,K=P-1-h.padInfo.top,Y=D-1-h.padInfo.left,Z=0;Z<N;++Z)for(var J=0;J<F;++J)for(var Q=0;Q<O;++Q)for(var $=Q-q,ee=Math.max(0,Math.ceil($/H)),te=Math.min(W,(L+$)/H),ne=0;ne<z;++ne)for(var re=ne-K,ae=Math.max(0,Math.ceil(re/j)),ie=Math.min(V,(P+re)/j),oe=0;oe<U;++oe){for(var se=oe-Y,ue=Math.max(0,Math.ceil(se/X)),le=Math.min(G,(D+se)/X),ce=0,he=ee;he<te;++he)for(var de=he*H-$,fe=ae;fe<ie;++fe)for(var pe=fe*j-re,ve=ue;ve<le;++ve)for(var me=k*Z+S*he+_*fe+E*ve,ge=C*(L-1-de)+I*(P-1-pe)+A*(D-1-(ve*X-se))+R*J,ye=0;ye<B;++ye){ce+=b[me+ye]*T[ge+ye]}f[v*Z+m*Q+g*ne+y*oe+J]=ce}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},pB=Sz(Ty,(function(e){return Math.cos(e)})),vB={kernelName:Ty,backendName:"cpu",kernelFunc:pB},mB=Sz(My,(function(e){return Math.cosh(e)})),gB={kernelName:My,backendName:"cpu",kernelFunc:mB};var yB={kernelName:Ay,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,l=r.extrapolationValue,c=x(a.shape,4),h=c[0],d=c[1],f=c[2],p=c[3],v=i.shape[0],m=x(s,2),g=m[0],y=m[1],b=PS([v,g,y,p],"float32"),w=n.data.get(i.dataId).values,k=n.data.get(o.dataId).values,S=n.data.get(a.dataId).values,_=Mg(a.shape),E=Mg(b.shape),T=0;T<v;T++){var M=4*T,C=w[M],I=w[M+1],A=w[M+2],R=w[M+3],N=k[T];if(!(N>=h))for(var L=g>1?(A-C)*(d-1)/(g-1):0,P=y>1?(R-I)*(f-1)/(y-1):0,D=0;D<g;D++){var F=g>1?C*(d-1)+D*L:.5*(C+A)*(d-1);if(F<0||F>d-1)for(var O=0;O<y;O++)for(var z=0;z<p;z++){var U=z+O*E[2]+D*E[1]+T*E[0];b.values[U]=l}else if("bilinear"===u)for(var B=Math.floor(F),W=Math.ceil(F),V=F-B,G=0;G<y;G++){var H=y>1?I*(f-1)+G*P:.5*(I+R)*(f-1);if(H<0||H>f-1)for(var j=0;j<p;j++){var X=j+G*E[2]+D*E[1]+T*E[0];b.values[X]=l}else for(var q=Math.floor(H),K=Math.ceil(H),Y=H-q,Z=0;Z<p;Z++){var J=Z+q*_[2]+B*_[1]+N*_[0],Q=S[J],$=S[J=Z+K*_[2]+B*_[1]+N*_[0]],ee=S[J=Z+q*_[2]+W*_[1]+N*_[0]],te=Q+($-Q)*Y,ne=ee+(S[J=Z+K*_[2]+W*_[1]+N*_[0]]-ee)*Y;J=Z+G*E[2]+D*E[1]+T*E[0],b.values[J]=te+(ne-te)*V}}else for(var re=0;re<y;++re){var ae=y>1?I*(f-1)+re*P:.5*(I+R)*(f-1);if(ae<0||ae>f-1)for(var ie=0;ie<p;ie++){var oe=ie+re*E[2]+D*E[1]+T*E[0];b.values[oe]=l}else for(var se=Math.round(ae),ue=Math.round(F),le=0;le<p;le++){var ce=le+se*_[2]+ue*_[1]+N*_[0],he=le+re*E[2]+D*E[1]+T*E[0];b.values[he]=S[ce]}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var bB={kernelName:Cy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;bz(a,"cumprod");var u=dT([i],a.shape.length),l=a;null!=u&&(l=mU({inputs:{x:a},backend:n,attrs:{perm:u}}));var c=pT(1,a.shape.length)[0];if(c!==l.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(l.shape.length-1," but got axis=").concat(c));for(var h=$w(l.dtype,"int32"),d=Ag(lg(l.shape),h),f=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],v=s?function(e,t){return e+p-t-1}:function(e,t){return e+t},m=0;m<f.length;m+=p)for(var g=0;g<p;g++){var y=v(m,g);if(0===g)d[y]=o?1:f[y];else{var b=v(m,g-1);d[y]=o?f[b]*d[b]:f[y]*d[b]}}var x=n.makeTensorInfo(l.shape,h,d);if(null!=u){var w=mU({inputs:{x:x},backend:n,attrs:{perm:fT(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(l),w}return x}};var xB={kernelName:Iy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;bz(a,"cumsum");var u=dT([i],a.shape.length),l=a;null!=u&&(l=mU({inputs:{x:a},backend:n,attrs:{perm:u}}));var c=pT(1,a.shape.length)[0];if(c!==l.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(l.shape.length-1," but got axis=").concat(c));for(var h=$w(l.dtype,"int32"),d=Rg(lg(l.shape),h),f=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],v=s?function(e,t){return e+p-t-1}:function(e,t){return e+t},m=0;m<f.length;m+=p)for(var g=0;g<p;g++){var y=v(m,g);if(0===g)d[y]=o?0:f[y];else{var b=v(m,g-1);d[y]=o?f[b]+d[b]:f[y]+d[b]}}var x=n.makeTensorInfo(l.shape,h,d);if(null!=u){var w=mU({inputs:{x:x},backend:n,attrs:{perm:fT(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(l),w}return x}};var wB={kernelName:Ry,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=jU(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var l=XU(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(l.shape,i.dtype,l.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};var kB={kernelName:Ny,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;og("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],l=a.shape[2],c=a.shape[3],h=u*i,d=l*i,f=c/(i*i),p=n.data.get(a.dataId).values,v=new Float32Array(s*h*d*f),m=0,g=0;g<s;++g)for(var y=0;y<h;++y)for(var b=Math.floor(y/i),x=y%i,w=0;w<d;++w)for(var k=Math.floor(w/i),S=(x*i+w%i)*f,_=0;_<f;++_){var E=_+S+c*(k+l*(b+u*g));v[m++]=p[E]}return n.makeTensorInfo([s,h,d,f],a.dtype,v)}};function SB(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,l=r.dimRoundingMode;bz([a,i],"depthwiseConv2DNative");var c=Mg(a.shape),h=Mg(i.shape),d=u;null==d&&(d=[1,1]),og(dE(o,d),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(d,"'")}));for(var f=aE(a.shape,i.shape,o,d,s,l,!0),p=f.filterHeight,v=f.filterWidth,m=f.dilationHeight,g=f.dilationWidth,y=f.padInfo,b=y.left,x=y.top,w=f.outChannels/f.inChannels,k=new Ww(f.outShape,a.dtype),S=n.data.get(a.dataId).values,_=n.data.get(i.dataId).values,E=k.values,T=0;T<f.batchSize;++T)for(var M=T*c[0],C=T*k.strides[0],I=0;I<f.outHeight;++I)for(var A=C+I*k.strides[1],R=I*f.strideHeight-x,N=0;N<p;++N){var L=R+N*m;if(!(L<0||L>=f.inHeight))for(var P=N*h[0],D=M+L*c[1],F=0;F<f.outWidth;++F)for(var O=A+F*k.strides[2],z=F*f.strideWidth-b,U=0;U<v;++U){var B=z+U*g;if(!(B<0||B>=f.inWidth))for(var W=P+U*h[1],V=D+B*f.inChannels,G=O,H=W,j=0;j<f.inChannels;++j){for(var X=S[V+j],q=0;q<w;++q)E[G+q]+=X*_[H+q];G+=w,H+=w}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}var _B={kernelName:Ly,backendName:"cpu",kernelFunc:SB};var EB={kernelName:Py,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,l=r.dimRoundingMode,c=r.filterShape;bz([a,i],"depthwiseConv2dNativeBackpropFilter");for(var h=aE(a.shape,c,o,s,u,l,!0),d=h.strideHeight,f=h.strideWidth,p=h.filterHeight,v=h.filterWidth,m=new Ww(h.filterShape,"float32"),g=h.padInfo.left,y=h.padInfo.top,b=h.outChannels/h.inChannels,x=n.data.get(a.dataId).values,w=new Ww(a.shape,a.dtype,x),k=n.data.get(i.dataId).values,S=new Ww(i.shape,i.dtype,k),_=0;_<p;++_)for(var E=Math.max(0,Math.ceil((y-_)/d)),T=Math.min(h.outHeight,(h.inHeight+y-_)/d),M=0;M<v;++M)for(var C=Math.max(0,Math.ceil((g-M)/f)),I=Math.min(h.outWidth,(h.inWidth+g-M)/f),A=0;A<h.outChannels;++A){for(var R=Math.trunc(A/b),N=A%b,L=0,P=0;P<h.batchSize;++P)for(var D=E;D<T;++D)for(var F=_+D*d-y,O=C;O<I;++O){var z=M+O*f-g;L+=w.get(P,F,z,R)*S.get(P,D,O,A)}m.set(L,_,M,R,N)}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var TB={kernelName:Dy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,l=r.dimRoundingMode,c=r.inputShape;bz([a,i],"depthwiseConv2DNativeBackpropInput");for(var h=Mg(a.shape),d=Mg(i.shape),f=aE(c,i.shape,o,s,u,l,!0),p=new Ww(f.inShape,"float32"),v=p.values,m=x(p.strides,3),g=m[0],y=m[1],b=m[2],w=n.data.get(a.dataId).values,k=x(h,3),S=k[0],_=k[1],E=k[2],T=n.data.get(i.dataId).values,M=x(d,3),C=M[0],I=M[1],A=M[2],R=f.batchSize,N=f.filterHeight,L=f.filterWidth,P=f.inChannels,D=f.inHeight,F=f.inWidth,O=f.outChannels,z=f.outHeight,U=f.outWidth,B=f.strideHeight,W=f.strideWidth,V=N-1-f.padInfo.top,G=L-1-f.padInfo.left,H=O/P,j=0;j<R;++j)for(var X=0;X<P;++X)for(var q=0;q<D;++q)for(var K=q-V,Y=Math.max(0,Math.ceil(K/B)),Z=Math.min(z,(N+K)/B),J=0;J<F;++J){for(var Q=J-G,$=Math.max(0,Math.ceil(Q/W)),ee=Math.min(U,(L+Q)/W),te=0,ne=Y;ne<Z;++ne)for(var re=ne*B-K,ae=$;ae<ee;++ae)for(var ie=S*j+_*ne+E*ae,oe=C*(N-1-re)+I*(L-1-(ae*W-Q))+A*X,se=0;se<H;++se){te+=w[ie+(X*H+se)]*T[oe+se]}v[g*j+y*q+b*J+X]=te}return n.makeTensorInfo(p.shape,p.dtype,p.values)}};var MB={kernelName:Fy,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=lg(r.shape),i=n.data.get(r.dataId).values,o=PS([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var l=[].concat(g(r.shape),g(r.shape));return n.makeTensorInfo(l,o.dtype,o.values)}},CB={kernelName:Oy,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,l=n,c=l.data.get(a.dataId).values,h=a.shape.length,d=l.data.get(i.dataId).values,f=i.shape.length,p=tE(a.shape,i.shape,o,s,"NHWC",u),v=p.batchSize,m=p.inHeight,g=p.inWidth,y=p.inChannels,b=p.outHeight,x=p.outWidth,w=p.padInfo,k=p.strideHeight,S=p.strideWidth,_=p.filterHeight,E=p.filterWidth,T=p.dilationHeight,M=p.dilationWidth,C=p.outShape,I=lg(C),A=C.length,R=bg(a.dtype,I),N=0;N<v;++N)for(var L=0;L<b;++L)for(var P=L*k-w.top,D=0;D<x;++D)for(var F=D*S-w.left,O=0;O<y;++O){for(var z=Number.MIN_SAFE_INTEGER,U=0;U<_;++U){var B=P+U*T;if(B>=0&&B<m)for(var W=0;W<E;++W){var V=F+W*M;if(V>=0&&V<g){var G=Pg([N,B,V,O],h,Mg(a.shape)),H=Pg([U,W,O],f,Mg(i.shape)),j=c[G]+d[H];j>z&&(z=j)}}}R[Pg([N,L,D,O],A,Mg(C))]=z}return{dataId:l.write(Ew(R,a.dtype),C,a.dtype),shape:C,dtype:a.dtype}}},IB={kernelName:Uy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,l=r.dilations,c=n,h=Ig(a.shape,c.data.get(a.dataId).values),d=Ig(i.shape,c.data.get(i.dataId).values),f=tE(a.shape,i.shape,s,u,"NHWC",l),p=f.batchSize,v=f.inHeight,m=f.inWidth,g=f.inChannels,y=f.outHeight,b=f.outWidth,x=f.padInfo,w=f.strideHeight,k=f.strideWidth,S=f.filterHeight,_=f.filterWidth,E=f.dilationHeight,T=f.dilationWidth,M=f.outShape;og(o.rank===M.length,(function(){return"Error in ".concat(Uy,", dy ")+"must have the same rank as output ".concat(M.length,", but got ")+"".concat(o.rank)}));for(var C=Ig(M,c.data.get(o.dataId).values),I=Ng(i.shape,i.dtype),A=0;A<p;++A)for(var R=0;R<y;++R)for(var N=R*w-x.top,L=0;L<b;++L)for(var P=L*k-x.left,D=0;D<g;++D){for(var F=Number.MIN_SAFE_INTEGER,O=0,z=0,U=0;U<S;++U){var B=N+U*E;if(B>=0&&B<v)for(var W=0;W<_;++W){var V=P+W*T;if(V>=0&&V<m){var G=h[A][B][V][D]+d[U][W][D];G>F&&(F=G,O=U,z=W)}}}I[O][z][D]+=C[A][R][L][D]}return{dataId:c.write(Ew(I,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},AB={kernelName:zy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,l=r.dilations,c=n,h=Ig(a.shape,c.data.get(a.dataId).values),d=Ig(i.shape,c.data.get(i.dataId).values),f=tE(a.shape,i.shape,s,u,"NHWC",l),p=f.batchSize,v=f.inHeight,m=f.inWidth,g=f.inChannels,y=f.outHeight,b=f.outWidth,x=f.padInfo,w=f.strideHeight,k=f.strideWidth,S=f.filterHeight,_=f.filterWidth,E=f.dilationHeight,T=f.dilationWidth,M=f.outShape;og(o.rank===M.length,(function(){return"Error in ".concat(zy,", dy ")+"must have the same rank as output ".concat(M.length,", but got ")+"".concat(o.rank)}));for(var C=Ig(M,c.data.get(o.dataId).values),I=Ng(a.shape,a.dtype),A=0;A<p;++A)for(var R=0;R<y;++R)for(var N=R*w-x.top,L=0;L<b;++L)for(var P=L*k-x.left,D=0;D<g;++D){for(var F=Number.MIN_SAFE_INTEGER,O=N<0?0:N,z=P<0?0:P,U=0;U<S;++U){var B=N+U*E;if(B>=0&&B<v)for(var W=0;W<_;++W){var V=P+W*T;if(V>=0&&V<m){var G=h[A][B][V][D]+d[U][W][D];G>F&&(F=G,O=B,z=V)}}}I[A][O][z][D]+=C[A][R][L][D]}return{dataId:c.write(Ew(I,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},RB=Rz((function(e,t){return e*t})),NB=Qz((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),LB=Jz(Db,RB,NB),PB={kernelName:Db,backendName:"cpu",kernelFunc:LB};function DB(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;bz(i,"sum");var u=(t="bool"===i.dtype?Yz({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):Mz({inputs:{x:i},backend:r})).shape.length,l=mg(o,t.shape),c=dT(l,u),h=l,d=t;null!=c&&(d=mU({inputs:{x:t},backend:r,attrs:{perm:c}}),h=pT(h.length,u)),hT("sum",h,d.shape.length);for(var f=x(lT(d.shape,h),2),p=f[0],v=f[1],m=jz(r,p,$w(d.dtype,"int32")),g=lg(v),y=r.data.get(m.dataId).values,b=r.data.get(d.dataId).values,w=0;w<y.length;++w){for(var k=w*g,S=0,_=0;_<g;++_)S+=b[k+_];y[w]=S}if(s){var E=m;m=rU({inputs:{x:m},backend:r,attrs:{shape:cT(m.shape,l)}}),r.disposeIntermediateTensorInfo(E)}return r.disposeIntermediateTensorInfo(t),null!=c&&r.disposeIntermediateTensorInfo(d),m}var FB={kernelName:kx,backendName:"cpu",kernelFunc:DB};var OB={kernelName:Wy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=OC(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;UC(i.length,s,r);for(var u=BC(o,s),l=u.path,c=u.steps,h=c.length,d=null,f=i.length,p=[],v=0;v<h;++v){var m,g=N(c[v]);try{for(g.s();!(m=g.n()).done;){var y=m.value,b=zC(f,s[y]),x=b.permutationIndices,w=b.expandDims,k=void 0;WC(x)?k=r[y]:(k=mU({inputs:{x:r[y]},backend:n,attrs:{perm:x}}),p.push(k));for(var S=k.shape.slice(),_=0;_<w.length;++_)S.splice(w[_],0,1);cg(k.shape,S)||(k=rU({inputs:{x:k},backend:n,attrs:{shape:S}}),p.push(k)),null===d?d=k:(d=LB({inputs:{a:k,b:d},backend:n}),p.push(d))}}catch(R0){g.e(R0)}finally{g.f()}v<h-1&&(l[v]>=0&&(d=DB({inputs:{x:d},backend:n,attrs:{axis:l[v]-(i.length-f),keepDims:!1}}),p.push(d)),f--)}for(var E=0,T=p;E<T.length;E++){var M=T[E];M!==d&&n.disposeIntermediateTensorInfo(M)}return d}};var zB={kernelName:Gy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;bz([r,a],"eluGrad");for(var i=new Float32Array(lg(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var l=o[u];i[u]=l>=0?s[u]:s[u]*(l+1)}return n.makeTensorInfo(a.shape,"float32",i)}},UB=Rz((function(e,t){return e===t?1:0})),BB=Jz(jy,UB,null,"bool"),WB={kernelName:jy,backendName:"cpu",kernelFunc:BB},VB=Sz(Hy,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+.3275911*n);return t*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))})),GB={kernelName:Hy,backendName:"cpu",kernelFunc:VB},HB=kz((function(e){return Math.exp(e)})),jB=_z(Xy,HB,"float32"),XB={kernelName:Xy,backendName:"cpu",kernelFunc:jB};function qB(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(og(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),rU({inputs:{x:a},backend:n,attrs:{shape:s}})}var KB={kernelName:qy,backendName:"cpu",kernelFunc:qB},YB=kz((function(e){return Math.expm1(e)})),ZB=_z(Ky,YB),JB={kernelName:Ky,backendName:"cpu",kernelFunc:ZB},QB=Rz((function(e,t){return e/t})),$B=Jz(By,QB),eW={kernelName:By,backendName:"cpu",kernelFunc:$B},tW=Rz((function(e,t){return e-t})),nW=Qz((function(e,t,n,r){return{real:e-n,imag:t-r}})),rW=Jz(zx,tW,nW),aW={kernelName:zx,backendName:"cpu",kernelFunc:rW};function iW(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,l=[a,i],c=lg(l),h=yg("float32",c),d=yg("float32",c),f=0;f<a;f++){for(var p=VU({inputs:{x:s},backend:n,attrs:{begin:[f,0],size:[1,i]}}),v=VU({inputs:{x:u},backend:n,attrs:{begin:[f,0],size:[1,i]}}),m=Gz({inputs:{real:p,imag:v},backend:n}),g=oW(m,t,n),y=IC(g.real,g.imag),b=0;b<i;b++){var x=AC(y,b);h[f*i+b]=x.real,d[f*i+b]=x.imag}n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m)}var w=n.makeTensorInfo(l,"float32",h),k=n.makeTensorInfo(l,"float32",d),S=Gz({inputs:{real:w,imag:k},backend:n});return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(k),S}function oW(e,t,n){var r=lg(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((g=r)&g-1)){var s=sW(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var l=n.makeTensorInfo(u,"float32",s.real),c=n.makeTensorInfo(u,"float32",s.imag),h=n.makeTensorInfo([],"float32",_w(r,"float32")),d=Mz({inputs:{x:h},backend:n}),f=eW.kernelFunc({inputs:{a:l,b:h},backend:n}),p=eW.kernelFunc({inputs:{a:c,b:d},backend:n}),v=n.data.get(f.dataId).values,m=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),{real:v,imag:m}}return s}var g,y=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=NC(a*s,t,n),l=AC(e,s);i+=l.real*u.real-l.imag*u.imag,o+=l.real*u.imag+l.imag*u.real}n&&(i/=t,o/=t),RC(r,i,o,a)}return r}(IC(i,o),r,t);return function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(y)}function sW(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=IC(e,t),o=n/2,s=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),u=s.real,l=s.imag,c=[u.length],h=a.makeTensorInfo(c,"float32",u),d=a.makeTensorInfo(c,"float32",l),f=Gz({inputs:{real:h,imag:d},backend:a}),p=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),v=p.real,m=p.imag,g=[v.length],y=a.makeTensorInfo(g,"float32",v),b=a.makeTensorInfo(g,"float32",m),x=Gz({inputs:{real:y,imag:b},backend:a}),w=sW(u,l,o,r,a),k=w.real,S=w.imag,_=[k.length],E=a.makeTensorInfo(_,"float32",k),T=a.makeTensorInfo(_,"float32",S),M=Gz({inputs:{real:E,imag:T},backend:a}),C=sW(v,m,o,r,a),I=C.real,A=C.imag,R=[I.length],N=a.makeTensorInfo(R,"float32",I),L=a.makeTensorInfo(R,"float32",A),P=Gz({inputs:{real:N,imag:L},backend:a}),D=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}(n,r),F=[D.real.length],O=a.makeTensorInfo(F,"float32",D.real),z=a.makeTensorInfo(F,"float32",D.imag),U=Gz({inputs:{real:O,imag:z},backend:a}),B=LB({inputs:{a:U,b:P},backend:a}),W=tU({inputs:{a:M,b:B},backend:a}),V=rW({inputs:{a:M,b:B},backend:a}),G=Xz({inputs:{input:W},backend:a}),H=Xz({inputs:{input:V},backend:a}),j=rB({inputs:{input:W},backend:a}),X=rB({inputs:{input:V},backend:a}),q=iB({inputs:[G,H],backend:a,attrs:{axis:0}}),K=iB({inputs:[j,X],backend:a,attrs:{axis:0}}),Y=a.data.get(q.dataId).values,Z=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(N),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),{real:Y,imag:Z}}var uW={kernelName:Yy,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=lg(r.shape),i=r.shape[r.shape.length-1],o=rU({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=iW(o,!1,n),u=rU({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function lW(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||_g(a),o=bg(i,lg(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var cW={kernelName:Zy,backendName:"cpu",kernelFunc:lW};var hW={kernelName:Jy,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=yg(r.dtype,lg(r.shape)),o=x(r.shape,4),s=o[0],u=o[1],l=o[2],c=o[3],h=a.data.get(r.dataId).values,d=0;d<s;d++)for(var f=d*l*u*c,p=0;p<u;p++)for(var v=p*(l*c),m=0;m<l;m++)for(var g=m*c,y=0;y<c;y++){var b=Math.round(l-m-1),w=f+v+g+y,k=h[w];if(b>=0&&b<l)k=h[f+v+b*c+y];i[w]=k}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},dW=kz((function(e){return Math.floor(e)})),fW=_z(Qy,dW),pW={kernelName:Qy,backendName:"cpu",kernelFunc:fW},vW=Rz((function(e,t){return Math.floor(e/t)})),mW=Jz($y,vW,null,"int32"),gW={kernelName:$y,backendName:"cpu",kernelFunc:mW};var yW={kernelName:Qx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dataFormat,h=r.dilations,d=r.dimRoundingMode,f=r.activation,p=r.leakyreluAlpha,v=sB({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){var m=v;if("NCHW"===c&&1===o.shape.length&&1!==o.shape[0]){var g=rU({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});v=tU({inputs:{a:v,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else v=tU({inputs:{a:v,b:o},backend:n});n.disposeIntermediateTensorInfo(m)}if(f){var y=v;if("NCHW"===c&&"prelu"===f&&1===s.shape.length&&1!==s.shape[0]){var b=rU({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});v=Vz(n,v,f,b,p),n.disposeIntermediateTensorInfo(b)}else v=Vz(n,v,f,s,p);n.disposeIntermediateTensorInfo(y)}return v}};var bW={kernelName:$x,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dataFormat,h=r.dilations,d=r.dimRoundingMode,f=r.activation,p=r.leakyreluAlpha,v=SB({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:d}});if(o){var m=v;v=tU({inputs:{a:v,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(f){var g=v;v=Vz(n,v,f,s,p),n.disposeIntermediateTensorInfo(g)}return v}};function xW(e,t,n,r,a,i,o,s,u){for(var l=PS([r,i],n),c=0;c<r;c++){for(var h=[],d=0,f=0;f<a;f++){var p=e[c*a+f];d+=p*o[f],h.push(p)}if(d<0||d>=u/i)throw new Error("Invalid indices: ".concat(h," does not index into ").concat(s));for(var v=0;v<i;v++)l.values[c*i+v]=t.get.apply(t,g(t.indexToLoc(d*i+v)))}return l}var wW={kernelName:nb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=lg(r.shape),o=a.shape,s=o[o.length-1],u=x(bC(r,a),4),l=u[0],c=u[1],h=u[2],d=u[3];if(0===c)return n.makeTensorInfo(l,r.dtype,[]);var f=xW(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,c,s,h,d,r.shape,i);return n.makeTensorInfo(l,r.dtype,f.values)}};function kW(e,t,n){for(var r=PS(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var l=e.locToIndex(i);0<=l&&l<e.values.length&&(r.values[a]=e.values[l])}return r}var SW={kernelName:tb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;bz([a,i],"gatherV2");for(var u=mg(o,a.shape)[0],l=n.data.get(i.dataId).values,c=a.shape[u],h=function(){var e=l[d];og(e<=c-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(c-1,"]")}))},d=0;d<l.length;++d)h();var f=s;null==s&&(f=0);var p=lg(i.shape),v=qC(a,i,u,f),m=rU({inputs:{x:a},backend:n,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),g=rU({inputs:{x:i},backend:n,attrs:{shape:[v.batchSize,p/v.batchSize]}}),y=[v.batchSize,v.outerSize,p/v.batchSize,v.sliceSize],b=n.bufferSync(g),x=kW(n.bufferSync(m),b,y);return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(v.outputShape,x.dtype,x.values)}},_W=Rz((function(e,t){return e>t?1:0})),EW=Jz(rb,_W,null,"bool"),TW={kernelName:rb,backendName:"cpu",kernelFunc:EW},MW=Rz((function(e,t){return e>=t?1:0})),CW=Jz(ab,MW,null,"bool"),IW={kernelName:ab,backendName:"cpu",kernelFunc:CW};var AW={kernelName:ob,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=lg(r.shape),i=r.shape[r.shape.length-1],o=rU({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=iW(o,!0,n),u=rU({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},RW=Sz(ub,(function(e){return Number.isFinite(e)?1:0}),"bool"),NW={kernelName:ub,backendName:"cpu",kernelFunc:RW},LW=Sz(lb,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),PW={kernelName:lb,backendName:"cpu",kernelFunc:LW},DW=Sz(cb,(function(e){return Number.isNaN(e)?1:0}),"bool"),FW={kernelName:cb,backendName:"cpu",kernelFunc:DW},OW=Rz((function(e,t){return e<t?1:0})),zW=Jz(db,OW,null,"bool"),UW={kernelName:db,backendName:"cpu",kernelFunc:zW},BW=Rz((function(e,t){return e<=t?1:0})),WW=Jz(fb,BW,null,"bool"),VW={kernelName:fb,backendName:"cpu",kernelFunc:WW};function GW(e,t,n){var r=(t-e)/(n-1),a=Rg(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var HW={kernelName:pb,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=GW(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},jW=kz((function(e){return Math.log(e)})),XW=_z(vb,jW),qW={kernelName:vb,backendName:"cpu",kernelFunc:XW},KW=Sz(mb,(function(e){return Math.log1p(e)})),YW={kernelName:mb,backendName:"cpu",kernelFunc:KW},ZW=Rz((function(e,t){return e&&t})),JW=Jz(gb,ZW,null,"bool"),QW={kernelName:gb,backendName:"cpu",kernelFunc:JW},$W=Sz(yb,(function(e){return e?0:1}),"bool"),eV={kernelName:yb,backendName:"cpu",kernelFunc:$W},tV=Rz((function(e,t){return e||t})),nV=Jz(bb,tV,null,"bool"),rV={kernelName:bb,backendName:"cpu",kernelFunc:nV};var aV={kernelName:xb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;bz(a,"LRN");var l=a.shape[3],c=l-1,h=n.data.get(a.dataId).values,d=lg(a.shape),f=new Float32Array(d);function p(e){for(var t=e%l,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,c),a=0;n<=r;n++){var o=h[n];a+=o*o}return a}for(var v=0;v<d;v++){var m=p(v),g=h[v]*Math.pow(o+s*m,-u);f[v]=g}return n.makeTensorInfo(a.shape,a.dtype,f)}};var iV={kernelName:wb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,l=r.alpha,c=r.beta;bz(o,"LRNGrad");for(var h=lg(o.shape),d=o.shape[3],f=n.data.get(o.dataId).values,p=n.data.get(a.dataId).values,v=n.data.get(i.dataId).values,m=new Float32Array(h),g=h,y=0;y<g;y++){for(var b=y%d,x=y-b+Math.max(0,b-s),w=y-b+Math.min(d,b+s+1),k=0,S=x;S<w;S++)k+=Math.pow(p[S],2);k=l*k+u;for(var _=x;_<w;_++){var E=-2*l*c*p[_]*v[y]/k;y===_&&(E+=Math.pow(k,-c)),E*=f[y],m[_]+=E}}return n.makeTensorInfo(o.shape,a.dtype,m)}};function oV(e,t,n,r){for(var a=yg(r,lg(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var l=e[o+u];(Number.isNaN(l)||l>s)&&(s=l)}a[i]=s}return a}function sV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,l=u.length,c=mg(i,u),h=c,d=dT(h,l),f=s.data.get(a.dataId).values;if(null!=d){for(var p=new Array(l),v=0;v<p.length;v++)p[v]=u[d[v]];f=vU(f,u,a.dtype,d,p),h=pT(h.length,l),u=p}bz(a,"max"),hT("max",h,l);var m=x(lT(u,h),2),g=m[0],y=oV(f,lg(m[1]),g,a.dtype),b=s.write(y,g,a.dtype),w=g;o&&(w=cT(g,c));return{dataId:b,shape:w,dtype:a.dtype}}var uV={kernelName:kb,backendName:"cpu",kernelFunc:sV},lV=Rz((function(e,t){return Math.max(e,t)})),cV=Jz(Sb,lV),hV={kernelName:Sb,backendName:"cpu",kernelFunc:cV};var dV={kernelName:_b,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;bz(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;og(dE(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var l,c=nE(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&cg(c.inShape,c.outShape))l=Mz({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,d=Mg(a.shape),f=LU(h,a.shape,a.dtype,d,c,"max");l=n.makeTensorInfo(c.outShape,a.dtype,f.values)}return l}};var fV={kernelName:Tb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,l=r.dataFormat;bz(a,"maxPool3d");var c=rE(a.shape,i,o,1,s,u,l),h=DU(n.data.get(a.dataId).values,a.shape,a.dtype,Mg(a.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};var pV={kernelName:Mb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,l=r.dimRoundingMode;bz([a,i],"maxPool3DGrad");for(var c=rE(i.shape,o,s,1,u,l),h=function(e,t){for(var n=PS(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left,v=0;v<t.batchSize;++v)for(var m=0;m<t.inChannels;++m)for(var g=0;g<t.outDepth;++g){for(var y=g*r-d,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,l+y),w=0;w<t.outHeight;++w){for(var k=w*a-f,S=k;S<0;)S+=s;for(var _=Math.min(t.inHeight,c+k),E=0;E<t.outWidth;++E){for(var T=E*i-p,M=T;M<0;)M+=u;for(var C=Math.min(t.inWidth,h+T),I=Number.NEGATIVE_INFINITY,A=-1,R=b;R<x;R+=o)for(var N=R-y,L=S;L<_;L+=s)for(var P=L-k,D=M;D<C;D+=u){var F=D-T,O=e.get(v,R,L,D,m);O>=I&&(I=O,A=N*c*h+P*c+F)}n.set(A,v,g,w,E,m)}}}return n}(n.bufferSync(i),c),d=c.strideDepth,f=c.strideHeight,p=c.strideWidth,v=c.dilationDepth,m=c.dilationHeight,g=c.dilationWidth,y=c.effectiveFilterDepth,b=c.effectiveFilterHeight,x=c.effectiveFilterWidth,w=y-1-c.padInfo.front,k=x-1-c.padInfo.left,S=b-1-c.padInfo.top,_=PS(i.shape,"float32"),E=n.bufferSync(a),T=0;T<c.batchSize;++T)for(var M=0;M<c.inChannels;++M)for(var C=0;C<c.inDepth;++C)for(var I=0;I<c.inHeight;++I)for(var A=0;A<c.inWidth;++A){for(var R=C-w,N=I-S,L=A-k,P=0,D=0;D<y;D+=v){var F=(R+D)/d;if(!(F<0||F>=c.outDepth||Math.floor(F)!==F))for(var O=0;O<b;O+=m){var z=(N+O)/f;if(!(z<0||z>=c.outHeight||Math.floor(z)!==z))for(var U=0;U<x;U+=g){var B=(L+U)/p;if(!(B<0||B>=c.outWidth||Math.floor(B)!==B)){var W=y*b*x-1-h.get(T,F,z,B,M)===D*b*x+O*x+U?1:0;if(0!==W)P+=E.get(T,F,z,B,M)*W}}}}_.set(P,T,C,I,A,M)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}};var vV={kernelName:Eb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;bz([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,l=r.pad,c=r.dimRoundingMode,h=nE(o.shape,s,u,1,l,c),d=n.data.get(o.dataId).values,f=PS(h.outShape,o.dtype,PU(d,o.shape,o.dtype,h).values),p=h.strideHeight,v=h.strideWidth,m=h.dilationHeight,g=h.dilationWidth,y=h.effectiveFilterHeight,b=h.effectiveFilterWidth,x=b-1-h.padInfo.left,w=y-1-h.padInfo.top,k=PS(o.shape,"float32"),S=n.data.get(a.dataId).values,_=PS(a.shape,"float32",S),E=0;E<h.batchSize;++E)for(var T=0;T<h.inChannels;++T)for(var M=0;M<h.inHeight;++M)for(var C=0;C<h.inWidth;++C){for(var I=M-w,A=C-x,R=0,N=0;N<y;N+=m){var L=(I+N)/p;if(!(L<0||L>=h.outHeight||Math.floor(L)!==L))for(var P=0;P<b;P+=g){var D=(A+P)/v;if(!(D<0||D>=h.outWidth||Math.floor(D)!==D)){var F=y*b-1-f.get(E,L,D,T)===N*b+P?1:0;if(0!==F)R+=_.get(E,L,D,T)*F}}}k.set(R,E,M,C,T)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var mV={kernelName:Cb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,l=r;bz(a,"MaxPoolWithArgmax");var c=l.data.get(a.dataId).values,h=nE(a.shape,i,o,[1,1],s),d=function(e,t,n,r,a){var i=LU(e,0,n,Mg(t),a,"max"),o=PU(e,t,n,a,!0,r);return[i.values,o.values]}(c,a.shape,a.dtype,u,h),f=x(d,2),p=f[0],v=f[1],m=l.write(p,h.outShape,a.dtype),g=l.write(v,h.outShape,a.dtype);return[{dataId:m,shape:h.outShape,dtype:a.dtype},{dataId:g,shape:h.outShape,dtype:"int32"}]}};var gV={kernelName:Ib,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=mg(i,a.shape),u=lg(lT(a.shape,s)[1]),l=[],c=n.makeTensorInfo([],"float32",new Float32Array([u]));l.push(c);var h=Yz({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});l.push(h);var d=$B({inputs:{a:h,b:c},backend:n});l.push(d);var f=DB({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:o}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),f}};var yV={kernelName:Ab,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;bz(a,"min");var s=mg(i,a.shape),u=s,l=dT(u,a.shape.length),c=a;null!=l&&(c=mU({inputs:{x:a},backend:n,attrs:{perm:l}}),u=pT(u.length,a.shape.length)),hT("min",u,c.shape.length);for(var h=x(lT(c.shape,u),2),d=h[0],f=lg(h[1]),p=Rg(lg(d),c.dtype),v=n.data.get(c.dataId).values,m=0;m<p.length;++m){for(var g=m*f,y=v[g],b=0;b<f;++b){var w=v[g+b];(Number.isNaN(w)||w<y)&&(y=w)}p[m]=y}null!=l&&n.disposeIntermediateTensorInfo(c);var k=n.makeTensorInfo(d,c.dtype,p);if(o){var S=rU({inputs:{x:k},backend:n,attrs:{shape:cT(d,s)}});return n.disposeIntermediateTensorInfo(k),S}return k}},bV=Rz((function(e,t){return Math.min(e,t)})),xV=Jz(Rb,bV),wV={kernelName:Rb,backendName:"cpu",kernelFunc:xV};var kV={kernelName:Nb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;bz(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),l=i.map((function(e,t){return e[0]+a.shape[t]})),c="reflect"===o?0:1,h=n.data.get(a.dataId).values,d=a.shape.length,f=Mg(a.shape),p=lg(s),v=s.length,m=Mg(s),g=yg(a.dtype,p),y=0;y<p;y++){for(var b=Dg(y,v,m),x=0;x<v;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-c:b[x]>=l[x]&&(b[x]=2*(l[x]-1)-b[x]+c);b=b.map((function(e,t){return e-u[t]}));var w=Pg(b,d,f);g[y]=h[w]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},SV=Rz((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),_V=Jz(Lb,SV),EV={kernelName:Lb,backendName:"cpu",kernelFunc:_V};function TV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=mg([s],a.shape),l=sV({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),c=cT(l.shape,u),h=rU({inputs:{x:l},backend:n,attrs:{shape:c}}),d=rW({inputs:{a:a,b:h},backend:n}),f=jB({inputs:{x:d},backend:n}),p=DB({inputs:{x:f},backend:n,attrs:{axis:u,keepDims:!1}}),v=rU({inputs:{x:p},backend:n,attrs:{shape:c}}),m=$B({inputs:{a:f,b:v},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),m}var MV={kernelName:Ex,backendName:"cpu",kernelFunc:TV};var CV={kernelName:Pb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;bz(a,"multinomial");for(var u=s?a:TV({inputs:{logits:a},backend:n,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],h=n.data.get(u.dataId).values,d=[l,i],f=Rg(lg(d),"int32"),p=0;p<l;++p){var v=p*c,m=new Float32Array(c-1);m[0]=h[v];for(var g=1;g<m.length;++g)m[g]=m[g-1]+h[v+g];for(var y=_T.alea(o.toString()),b=p*i,x=0;x<i;++x){var w=y();f[b+x]=m.length;for(var k=0;k<m.length;k++)if(w<m[k]){f[b+x]=k;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(d,"int32",f)}};function IV(e,t,n){var r=_w(-1,n);return RB([],t,r,e,n)}var AV={kernelName:Fb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;bz(r,"neg");var a=x(IV(n.data.get(r.dataId).values,r.shape,r.dtype),2),i=a[0],o=a[1];return n.makeTensorInfo(o,r.dtype,i)}},RV=_M;var NV={kernelName:zb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;bz(a,"NonMaxSuppression");var l=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,h=RV(l,c,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},LV=EM;var PV={kernelName:Ub,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,l=r.padToMaxOutputSize;bz(a,"NonMaxSuppressionPadded");var c=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,d=LV(c,h,o,s,u,l),f=d.selectedIndices,p=d.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},DV=TM;var FV={kernelName:Bb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,l=r.softNmsSigma;bz(a,"NonMaxSuppressionWithScore");var c=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,d=DV(c,h,o,s,u,l),f=d.selectedIndices,p=d.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([p.length],"float32",new Float32Array(p))]}},OV=Rz((function(e,t){return e!==t?1:0})),zV=Jz(Ob,OV,null,"bool"),UV={kernelName:Ob,backendName:"cpu",kernelFunc:zV};var BV={kernelName:Vb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;bz(a,"oneHot");var l=lg(a.shape),c=new Float32Array(l*o);c.fill(u);for(var h=n.data.get(a.dataId).values,d=0;d<l;++d)h[d]>=0&&h[d]<o&&(c[d*o+h[d]]=s);return n.makeTensorInfo([].concat(g(a.shape),[o]),i,c)}};function WV(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=Xz({inputs:{input:r},backend:n}),i=WV({inputs:{x:a},backend:n}),o=rB({inputs:{input:r},backend:n}),s=WV({inputs:{x:o},backend:n}),u=Gz({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return lW({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var VV={kernelName:Kx,backendName:"cpu",kernelFunc:WV};var GV={kernelName:Wb,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=Xz({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=rB({inputs:{input:a},backend:r}),u=WV({inputs:{x:s},backend:r}),l=Gz({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),l}return lW({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function HV(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return qB({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){sg(a,e.shape,"All tensors passed to stack must have matching shapes"),og(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=iB({inputs:t.map((function(e){var t=qB({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}var jV={kernelName:Gb,backendName:"cpu",kernelFunc:HV};var XV={kernelName:Hb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;bz(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),l=n.data.get(a.dataId).values,c=lg(a.shape),h=a.shape.length,d=Mg(a.shape),f=lg(s),p=s.length,v=Mg(s),m=yg(a.dtype,f);0!==o&&m.fill(o);for(var g=0;g<c;g++){m[Pg(Dg(g,h,d).map((function(e,t){return e+u[t]})),p,v)]=l[g]}return{dataId:n.write(m,s,a.dtype),shape:s,dtype:a.dtype}}},qV=Rz((function(e,t){return Math.pow(e,t)})),KV=Jz(jb,qV),YV={kernelName:jb,backendName:"cpu",kernelFunc:KV};function ZV(e,t,n,r){for(var a=x(lT(e,r),2),i=a[0],o=a[1],s=$w(t,"int32"),u=Rg(lg(i),s),l=lg(o),c=0;c<u.length;++c){for(var h=c*l,d=1,f=0;f<l;++f)d*=n[h+f];u[c]=d}return{outVals:u,outShape:i,outDtype:s}}var JV={kernelName:qb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;bz(a,"prod");var s=a.shape.length,u=mg(i,a.shape),l=dT(u,s),c=u,h=a,d=[];null!=l&&(h=mU({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(h),c=pT(c.length,s));var f=n.data.get(h.dataId).values,p=ZV(h.shape,h.dtype,f,c),v=p.outVals,m=p.outShape,g=p.outDtype,y=m;return o&&(y=cT(m,u)),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,v)}};function QV(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,l=0;l<t.length-1;++l){u*=t[l];for(var c=t[l+1],h=1;h<u+1;++h)s[l].push(h*c)}for(var d=0;d<e.length;++d){for(var f=e[d],p=e[d]+1,v=0;v<n.length;++v){var m=n[v],g=v+t.length-1;if(g>=0)for(var y=s[g],b=y[y.length-1]-m[f],x=f;x<p;++x)s[g].push(m[x+1]+b);f=m[f],p=m[p]}p!==f&&(a.push([f,p]),i+=p-f)}return{outSplits:s,valueSlices:a,numValues:i}}function $V(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function eG(e,t,n,r,a){var i=t.slice();i[0]=a;var o=bg(n,lg(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=$V(t,2)[1],u=$V(i,2)[1],l=0,c=N(n);try{for(c.s();!(o=c.n()).done;)for(var h=o.value,d=h[0];d<h[1];++d){for(var f=0;f<r;++f)a[l*u+f]=e[d*s+f];++l}}catch(R0){c.e(R0)}finally{c.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function tG(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=Dg(r,t.length,Mg(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=QV(i,o,e,r[0]),l=u.outSplits,c=u.valueSlices,h=u.numValues,d=function(e){for(var t=[],n=function(){var n=bg("int32",e[r].length);t.push(n),e[r].forEach((function(e,t){return n[t]=e}))},r=0;r<e.length;++r)n();return t}(l),f=eG(n,r,a,c,h);return[d,f[0],f[1]]}var nG={kernelName:Kb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=(r.outputRaggedRank,a.map((function(e){return n.data.get(e.dataId).values}))),u=a.map((function(e){return e.shape})),l=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values,h=x(tG(s,u,l,i.shape,i.dtype,c,o.shape),3),d=h[0],f=h[1],p=h[2],v=d.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),m=n.makeTensorInfo(p,i.dtype,f);return v.concat([m])}},rG=2147483647;function aG(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=0===t.length,u=0===a.length,l=0===o.length,c=[];s||c.push(t[0]),u||c.push(a[0]),l||c.push(o[0]);for(var h=1;h<c.length;++h)if(c[h]!==c[h-1])throw new Error("starts, limits, and deltas must have the same shape");var d=0===c.length?1:c[0],f=bg("int32",d+1);f[0]=0;for(var p=0;p<d;++p){var v=s?e[0]:e[p],m=u?r[0]:r[p],g=l?i[0]:i[p];if(0===g)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&m<v||g<0&&m>v)y=0;else if((y=Math.ceil(Math.abs((m-v)/g)))>rG)throw new Error("Requires ((limit - start) / delta) <= ".concat(rG));f[p+1]=f[p]+y}for(var b=bg(n,f[d]),x=0,w=0;w<d;++w)for(var k=f[w+1]-f[w],S=s?e[0]:e[w],_=l?i[0]:i[w],E=0;E<k;++E)b[x++]=S,S+=_;return[f,b]}var iG={kernelName:Yb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,l=x(aG(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),c=l[0],h=l[1];return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([h.length],r.dtype,h)]}},oG=nC,sG=function(){function e(t,n,r,a,i,o,s,u,l,c){var h;E(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=function(e){var t,n={FIRST_DIM_SIZE:nC.FIRST_DIM_SIZE,VALUE_ROWIDS:nC.VALUE_ROWIDS,ROW_LENGTHS:nC.ROW_LENGTHS,ROW_SPLITS:nC.ROW_SPLITS,ROW_LIMITS:nC.ROW_LIMITS,ROW_STARTS:nC.ROW_STARTS},r=[],a=N(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch(R0){a.e(R0)}finally{a.f()}return r}(c),this.raggedRank=0===(h=this.rowPartitionTypes).length?0:h[0]===nC.FIRST_DIM_SIZE?h.length-1:h.length}return M(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===oG.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===oG.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case oG.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case oG.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(oG[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return lG(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape;!function(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}(this.defaultValueShape,t);var n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=function(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}(this.raggedRank,n,t),a=r;a[0]<0&&(a[0]=e);for(var i=1;i<=this.raggedRank;++i)a[i]<0&&(a[i]=this.getMaxWidth(i));return a}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return og(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),l=t[o];-1===l&&(u=0);for(var c=0;c<u;++c)i.push(l),l+=n;for(var h=0;h<s-u;++h)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var l=1;l<a;++l){var c=e[l];if(c===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=c,c>=t.length)throw new Error("Got nextValueRowId=".concat(c," which is not less than ").concat(t.length));u=t[c]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case oG.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case oG.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(oG[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case oG.FIRST_DIM_SIZE:return e[0];case oG.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case oG.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(oG[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=lG(t,!1),i=bg(this.valuesDType,lg(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s){o=this.calculateOutputIndex(s-1,o,n[s],t[s])}this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice(),s=lg(o=o.slice(e+1)),u=t.length,l=this.defaultValue;if(l.length!==s&&1!==l.length){var c=this.defaultValueShape;BS((function(){var e=mE(l,c),t=SE(e,o);l=t.dataSync()}))}for(var h=0,d=0,f=0,p=0;p<=u;++p){var v=p<u?t[p]:-1;if(v!==f){if(d<f){var m=a.subarray(h*s);uG(i.subarray(d*s),m,(f-d)*s)}if(p>=u){var g=n.length;v=Math.floor(g/s)}if(v>f)if(1===this.defaultValue.length)i.subarray(f*s,v*s).fill(this.defaultValue[0]),f=v;else for(;v>f;){uG(i.slice(f*s),l,s),++f}v<0?(h=p+1,d=f):(h=p,f=(d=f)+1)}else++f}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function uG(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function lG(e,t){var n,r=[],a=N(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(R0){a.e(R0)}finally{a.f()}return r}function cG(e,t,n,r,a,i,o,s,u,l){return new sG(e,t,n,r,a,i,o,s,u,l).compute()}var hG={kernelName:Zb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,l=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,d=s.map((function(e){return n.data.get(e.dataId).values})),f=s.map((function(e){return e.shape})),p=x(cG(l,a.shape,c,i.shape,i.dtype,h,o.shape,d,f,u),2),v=p[0],m=p[1];return n.makeTensorInfo(v,i.dtype,m)}};function dG(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Rg(0,r);var a=Rg(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var fG={kernelName:Jb,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=dG(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},pG=Sz($b,(function(e){return 1/e})),vG={kernelName:$b,backendName:"cpu",kernelFunc:pG};var mG={kernelName:ax,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;bz(a,"resizeBilinear");for(var u=Mg(a.shape),l=x(s,2),c=l[0],h=l[1],d=x(a.shape,4),f=d[0],p=d[1],v=d[2],m=d[3],g=n.data.get(a.dataId).values,y=new Float32Array(lg([f,c,h,m])),b=[i&&c>1?p-1:p,i&&h>1?v-1:v],w=[i&&c>1?c-1:c,i&&h>1?h-1:h],k=0,S=b[0]/w[0],_=b[1]/w[1],E=0;E<f;E++)for(var T=0;T<c;T++){var M=void 0;M=o?S*(T+.5)-.5:S*T;for(var C=Math.max(0,Math.floor(M)),I=M-C,A=Math.min(p-1,Math.ceil(M)),R=E*u[0]+C*u[1],N=E*u[0]+A*u[1],L=0;L<h;L++){var P=void 0;P=o?_*(L+.5)-.5:_*L;for(var D=Math.max(0,Math.floor(P)),F=P-D,O=Math.min(v-1,Math.ceil(P)),z=R+D*u[2],U=N+D*u[2],B=R+O*u[2],W=N+O*u[2],V=0;V<m;V++){var G=g[z+V],H=g[U+V],j=G+(g[B+V]-G)*F,X=j+(H+(g[W+V]-H)*F-j)*I;y[k++]=X}}}return n.makeTensorInfo([f,c,h,m],"float32",y)}};var gG={kernelName:ix,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;bz([i,a],"resizeBilinearGrad");for(var s=Mg(a.shape),u=x(a.shape,4),l=u[0],c=u[1],h=u[2],d=u[3],f=x(i.shape,3),p=f[1],v=f[2],m=new Float32Array(l*c*h*d),g=[o&&p>1?c-1:c,o&&v>1?h-1:h],y=[o&&p>1?p-1:p,o&&v>1?v-1:v],b=g[0]/y[0],w=g[1]/y[1],k=n.data.get(i.dataId).values,S=0,_=0;_<l;_++)for(var E=_*s[0],T=0;T<p;T++)for(var M=T*b,C=Math.floor(M),I=Math.min(Math.ceil(M),c-1),A=E+C*s[1],R=E+I*s[1],N=M-C,L=1-N,P=0;P<v;P++)for(var D=P*w,F=Math.floor(D),O=Math.min(Math.ceil(D),h-1),z=D-F,U=1-z,B=A+F*s[2],W=A+O*s[2],V=R+F*s[2],G=R+O*s[2],H=L*U,j=L*z,X=N*U,q=N*z,K=0;K<d;K++){var Y=k[S++];m[B+K]+=Y*H,m[W+K]+=Y*j,m[V+K]+=Y*X,m[G+K]+=Y*q}return n.makeTensorInfo([l,h,c,d],"float32",m)}};var yG={kernelName:nx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;bz(a,"resizeNearestNeighbor");for(var u=Mg(a.shape),l=x(s,2),c=l[0],h=l[1],d=x(a.shape,4),f=d[0],p=d[1],v=d[2],m=d[3],g=n.data.get(a.dataId).values,y=new Float32Array(f*c*h*m),b=[i&&c>1?p-1:p,i&&h>1?v-1:v],w=[i&&c>1?c-1:c,i&&h>1?h-1:h],k=b[0]/w[0],S=b[1]/w[1],_=0,E=0;E<f;E++)for(var T=E*u[0],M=0;M<c;M++){var C=o?k*(M+.5):k*M,I=Math.min(p-1,i?Math.round(C):Math.floor(C));o&&(I=Math.max(0,I));for(var A=T+I*u[1],R=0;R<h;R++){var N=o?S*(R+.5):S*R,L=Math.min(v-1,i?Math.round(N):Math.floor(N));o&&(L=Math.max(0,L));for(var P=A+L*u[2],D=0;D<m;D++){var F=g[P+D];y[_++]=F}}}return n.makeTensorInfo([f,c,h,m],a.dtype,y)}};var bG={kernelName:rx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;bz([i,a],"resizeNearestNeighborGrad");for(var s=Mg(a.shape),u=Mg(i.shape),l=x(a.shape,4),c=l[0],h=l[1],d=l[2],f=l[3],p=x(i.shape,3),v=p[1],m=p[2],g=new Float32Array(c*h*d*f),y=n.data.get(i.dataId).values,b=[o&&v>1?h-1:h,o&&m>1?d-1:d],w=[o&&v>1?v-1:v,o&&m>1?m-1:m],k=b[0]/w[0],S=b[1]/w[1],_=1/k,E=1/S,T=2*Math.ceil(_)+2,M=2*Math.ceil(E)+2,C=0;C<c;C++)for(var I=C*s[0],A=0;A<h;A++)for(var R=I+A*s[1],N=Math.floor(A*_),L=Math.floor(N-T/2),P=0;P<d;P++)for(var D=R+P*s[2],F=Math.floor(P*E),O=Math.floor(F-M/2),z=0;z<f;z++){for(var U=0,B=0;B<T;B++){var W=B+L;if(!(W<0||W>=v)){var V=I+W*u[1],G=W*k;if(A===Math.min(h-1,o?Math.round(G):Math.floor(G)))for(var H=0;H<M;H++){var j=H+O;if(!(j<0||j>=m)){var X=V+j*u[2],q=j*S;P===Math.min(d-1,o?Math.round(q):Math.floor(q))&&(U+=y[X+z])}}}}g[D+z]=U}return n.makeTensorInfo(a.shape,a.dtype,g)}};var xG={kernelName:sx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;bz(a,"reverse");var o=a.shape.length,s=mg(i,a.shape);if(0===o)return Mz({inputs:{x:a},backend:n});for(var u=new Ww(a.shape,a.dtype),l=n.bufferSync(a),c=function(){var e=u.indexToLoc(h),t=e.slice();s.forEach((function(e){return t[e]=a.shape[e]-1-t[e]})),u.set.apply(u,[l.get.apply(l,g(t))].concat(g(e)))},h=0;h<u.size;h++)c();return n.makeTensorInfo(u.shape,u.dtype,u.values)}},wG={kernelName:Zx,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,l=yg(a.dtype,lg(a.shape)),c=x(a.shape,4),h=c[0],d=c[1],f=c[2],p=c[3],v=x(fC(s,d,f),2),m=v[0],g=v[1],y=Math.sin(i),b=Math.cos(i),w=u.data.get(a.dataId).values,k=0;k<h;k++)for(var S=k*f*d*p,_=0;_<d;_++)for(var E=_*(f*p),T=0;T<f;T++)for(var M=T*p,C=0;C<p;C++){var I=[h,_,T,C],A=I[2],R=I[1],N=(A-m)*b-(R-g)*y,L=(A-m)*y+(R-g)*b;N=Math.round(N+m),L=Math.round(L+g);var P=o;if("number"!==typeof o&&(P=3===C?255:o[C]),N>=0&&N<f&&L>=0&&L<d)P=w[S+L*(f*p)+N*p+C];l[S+E+M+C]=P}return{dataId:u.write(l,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},kG=Sz(ux,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),SG={kernelName:ux,backendName:"cpu",kernelFunc:kG},_G=kz((function(e){return 1/Math.sqrt(e)})),EG=_z(lx,_G),TG={kernelName:lx,backendName:"cpu",kernelFunc:EG};function MG(e,t,n,r,a,i,o,s,u,l){var c=[r/a,a],h=e.values,d=t.values;if(0===r)return PS(n,t.dtype);var f=u instanceof Ww?u:PS(c,t.dtype);"string"===typeof u||"number"===typeof u?f.values.fill(u):"boolean"===typeof u&&f.values.fill(+u);for(var p=0;p<i;p++){for(var v=[],m=0,g=0;g<o;g++){var y=h[p*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(n));for(var b=0;b<a;b++)l?f.values[m*a+b]+=d[p*a+b]:f.values[m*a+b]=0===t.rank?d[0]:d[p*a+b]}return f}var CG={kernelName:cx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=xC(0,a,o),u=s.sliceRank,l=s.numUpdates,c=s.sliceSize,h=s.strides,d=s.outputSize,f=MG(n.bufferSync(a),n.bufferSync(i),o,d,c,l,u,h,0,!0);return n.makeTensorInfo(o,f.dtype,f.values)}};function IG(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function AG(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var RG={kernelName:dx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=bg("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),l=s*a,c=0;c<a;++c)o[l+c]="left"===i?IG(u,t[c+l]):AG(u,t[c+l]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var NG={kernelName:fx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;bz([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,c=$w(a.dtype,i.dtype),h=Rg(lg(a.shape),c),d=0,f=0===o||o>1||1===a.shape.length?1:lg(a.shape.slice(1)),p=0;p<s.length;p++)for(var v=0;v<f;v++)1===s[p]?h[d++]=u[p]:h[d++]=l[p];return n.makeTensorInfo(a.shape,c,h)}},LG=Sz(px,(function(e){return e>=0?1.0507009873554805*e:1.7580993408473768*(Math.exp(e)-1)})),PG={kernelName:px,backendName:"cpu",kernelFunc:LG},DG=Sz(yx,(function(e){return e<0?-1:e>0?1:0})),FG={kernelName:yx,backendName:"cpu",kernelFunc:DG},OG=Sz(mx,(function(e){return Math.sin(e)})),zG={kernelName:mx,backendName:"cpu",kernelFunc:OG},UG=Sz(gx,(function(e){return Math.sinh(e)})),BG={kernelName:gx,backendName:"cpu",kernelFunc:UG},WG=Math.log(1.1920928955078125e-7)+2,VG=Sz(xx,(function(e){var t=e>-WG,n=e<WG,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),GG={kernelName:xx,backendName:"cpu",kernelFunc:VG};var HG={kernelName:Sx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;bz([a],"spaceToBatchND");var s=lg(i),u=[[0,0]];u.push.apply(u,g(o));for(var l=1+i.length;l<a.shape.length;++l)u.push([0,0]);var c=XV.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=pC(c.shape,i,s,!1),d=vC(h.length,i.length,!1),f=mC(c.shape,i,s,!1),p=rU({inputs:{x:c},backend:n,attrs:{shape:h}}),v=mU({inputs:{x:p},backend:n,attrs:{perm:d}}),m=rU({inputs:{x:v},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),m}};function jG(e,t,n,r,a,i,o){var s=t[0],u=i[0],l=new Array(u),c=new Array(s),h=t[1];if(0===u){if(0!==s)throw new Error("Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(s));return[bg(n,0),[0,h],bg(a,0),l,c]}for(var d,f=!0,p=0,v=new Array(u).fill(0),m=0;m<s;++m){var g=e[m*h];if(g<0)throw new Error((d=g,"indices(".concat(m,", 0) is invalid: ").concat(d," < 0")));if(g>=u)throw new Error(HC(m,g,u));++v[g],f=f&&g>=p,p=g}for(var y=!0,b=0;b<u;++b){var x=0===v[b];l[b]=x,y=y&&!x,v[b]=Math.max(v[b],1),b>0&&(v[b]+=v[b-1])}if(y&&f){for(var w=e,k=r,S=0;S<s;++S)c[S]=S;return[w,[s,h],k,l,c]}for(var _=v[u-1],E=bg(n,_*h),T=bg(a,_),M=new Array(u).fill(0),C=0;C<s;++C){var I=e[C*h],A=M[I],R=(0===I?0:v[I-1])+A;M[I]++;for(var N=0;N<h;++N)E[R*h+N]=e[C*h+N];T[R]=r[C],c[C]=R}for(var L=0;L<u;++L){if(0===M[L]){var P=0===L?0:v[L-1];E[P*h+0]=L;for(var D=1;D<h;++D)E[P*h+D]=0;T[P]=o}}return[E,[_,h],T,l,c]}var XG={kernelName:Tx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values[0],h=x(jG(s,r.shape,r.dtype,u,a.dtype,l,c),5),d=h[0],f=h[1],p=h[2],v=h[3],m=h[4];return[n.makeTensorInfo(f,r.dtype,d),n.makeTensorInfo([f[0]],a.dtype,p),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};function qG(e,t,n,r,a){for(var i,o,s=lg(r),u=t[0],l=a.length,c=[],h=1,d=-1,f=0;f<l;++f){var p=a[f];if(-1===p){if(-1!==d)throw new Error((o=f,"only one output dimension may be -1, not both ".concat(d," and ").concat(o)));d=f,c.push(1)}else{if(p<0)throw new Error((i=p,"size ".concat(f," must be non-negative, not ").concat(i)));h*=p,c.push(p)}}if(-1!==d){if(h<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");var v=Math.trunc(s/h);if(h*v!==s)throw new Error(function(e,t){var n=lg(e),r=lg(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}(r,c));c[d]=v}if(lg(c)!==s)throw new Error(function(e,t){var n=lg(e),r=lg(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}(r,c));var m=r.length,g=[];if(m>0){g[m-1]=1;for(var y=m-2;y>=0;--y)g[y]=g[y+1]*r[y+1]}var b=[];if(l>0){b[l-1]=1;for(var x=l-2;x>=0;--x)b[x]=b[x+1]*c[x+1]}for(var w=bg(n,u*l),k=0;k<u;++k){for(var S=0,_=0;_<m;++_)S+=e[k*m+_]*g[_];for(var E=0;E<l;++E)w[k*l+E]=Math.trunc(S/b[E]),S%=b[E]}return[w,[u,l],c]}var KG={kernelName:Mx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),l=x(qG(s,r.shape,r.dtype,o,u),3),c=l[0],h=l[1],d=l[2];return[n.makeTensorInfo(h,r.dtype,c),n.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}};function YG(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],l=u[1],c=s>0?a[s-1]+1:0;if(c<0)throw new Error("segment ids must be >= 0");var h=t.slice();h[0]=c;var d=bg(n,h.reduce((function(e,t){return e*t}),1));if(0===s)return c>0&&d.fill(o),[d,h];if(c<=0)throw new Error("segment ids must be >= 0");for(var f=0,p=1,v=0,m=a[f];;){var g=0;if(p<s){if(m===(g=a[p])){++p;continue}if(m>=g)throw new Error("segment ids are not increasing")}if(m<0||m>=c)throw new Error(jC(m,c));m>v&&d.fill(o,v*l,m*l);for(var y=f;y<p;++y){var b=r[y];if(b<0||b>=u[0])throw new Error(XC(y,r[y],u[0]));for(var x=0;x<l;x++)d[m*l+x]+=e[b*l+x]}if(i)for(var w=0;w<l;w++)d[m*l+w]/=p-f;if(f=p,v=m+1,m=g,++p>s)break}return v<c&&d.fill(o,v*l,c*l),[d,h]}var ZG={kernelName:Cx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,l=x(YG(o,r.shape,r.dtype,s,u,!0),2),c=l[0],h=l[1];return n.makeTensorInfo(h,r.dtype,c)}};var JG={kernelName:Ix,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,l=x(YG(o,r.shape,r.dtype,s,u),2),c=l[0],h=l[1];return n.makeTensorInfo(h,r.dtype,c)}};var QG={kernelName:Ax,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,l=xC(0,i,u),c=l.sliceRank,h=l.numUpdates,d=l.sliceSize,f=l.strides,p=l.outputSize,v=!1,m=r.bufferSync(i);switch(o.dtype){case"bool":t=MG(m,r.bufferSync(o),u,p,d,h,c,f,Boolean(r.data.get(s.dataId).values[0]),v);break;case"float32":t=MG(m,r.bufferSync(o),u,p,d,h,c,f,r.data.get(s.dataId).values[0],v);break;case"int32":t=MG(m,r.bufferSync(o),u,p,d,h,c,f,r.data.get(s.dataId).values[0],v);break;case"string":t=MG(m,r.bufferSync(o),u,p,d,h,c,f,Cw(r.data.get(s.dataId).values[0]),v);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var $G={kernelName:_x,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=mg(r.axis,a.shape)[0],s=GC(a,i,o),u=new Array(a.shape.length).fill(0),l=a.shape.slice();return s.map((function(e){var t=g(l);t[o]=e;var r=VU({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r}))}},eH=kz((function(e){return Math.sqrt(e)})),tH=Sz(wx,(function(e){return Math.sqrt(e)})),nH={kernelName:wx,backendName:"cpu",kernelFunc:tH},rH={kernelName:Nx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;bz(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},aH=Rz((function(e,t){var n=e-t;return n*n})),iH=Jz(Rx,aH),oH={kernelName:Rx,backendName:"cpu",kernelFunc:iH},sH=kz((function(e,t){var n=t.pattern,r=t.replaceGlobal,a=t.rewrite;return e.replace(new RegExp(n,r?"g":""),a)})),uH=_z(Lx,sH),lH={kernelName:Lx,backendName:"cpu",kernelFunc:uH},cH=Sz(Yx,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),hH={kernelName:Yx,backendName:"cpu",kernelFunc:cH};function dH(e,t,n,r){for(var a=PS(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(g(o)))}return a}var fH={kernelName:Px,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,l=r.endMask,c=r.ellipsisMask,h=r.newAxisMask,d=r.shrinkAxisMask;bz(a,"stridedSlice");var f,p=Z_(a.shape,i,o,s,u,l,c,h,d),v=p.finalShapeSparse,m=p.finalShape,g=p.isIdentity,y=p.sliceDim0,b=p.isSimpleSlice,x=p.begin,w=p.end,k=p.strides;if(g)f=rU({inputs:{x:a},backend:n,attrs:{shape:m}});else if(y||b){og(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var S=X_(x,w,k),_=VU({inputs:{x:a},backend:n,attrs:{begin:x,size:S}});f=rU({inputs:{x:_},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(_)}else{var E=dH(v,n.bufferSync(a),k,x);f=n.makeTensorInfo(m,E.dtype,E.values)}return f}},pH=function(){function e(t,n,r,a,i,o){E(this,e),this.separator=Mw(t),this.nGramWidths=n,this.leftPad=Mw(r),this.rightPad=Mw(a),this.padWidth=i,this.preserveShort=o}return M(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(){var s=o.getPadWidth(i),l=Math.max(0,s-u),c=Math.max(0,s-(a-(u+1))),h=i-(l+c),d=t+(l>0?0:u-s),f=0;f+=l*o.leftPad.length;for(var p=0;p<h;++p)f+=e[d+p].length;f+=c*o.rightPad.length,f+=(l+c+h-1)*o.separator.length,n[r+u]=new Uint8Array(f);for(var v=n[r+u],m=0,g=function(e){return e.forEach((function(e){return v[m++]=e}))},y=0;y<l;++y)g(o.leftPad),g(o.separator);for(var b=0;b<h-1;++b)g(e[d+b]),g(o.separator);if(h>0){g(e[d+h-1]);for(var x=0;x<c;++x)g(o.separator),g(o.rightPad)}else{for(var w=0;w<c-1;++w)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,l=bg("int32",a);if(0===r||0===a){for(var c=new Array(r),h=0;h<=u;++h)l[h]=0;return[c,l]}l[0]=0;for(var d=function(){var e=t[f]-t[f-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),l[f]=l[f-1]+r},f=1;f<=u;++f)d();for(var p=new Array(l[u]),v=function(r){var a=t[r],i=l[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,p,i,u,o),i+=u})),n.preserveShort&&i===l[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,p,i,1,s)}},m=0;m<u;++m)v(m);return[p,l]}}]),e}();function vH(e,t,n,r,a,i,o,s){return new pH(n,r,a,i,o,s).compute(e,t)}var mH={kernelName:Dx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,l=r.preserveShortSequences,c=t.data,h=t.dataSplits,d=x(vH(n.data.get(c.dataId).values,n.data.get(h.dataId).values,a,i,o,s,u,l),2),f=d[0],p=d[1];return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",p)]}};function gH(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);n&&0===o.length||r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var l=e.subarray(0,u);n&&0===l.length||r.push(l),u=(e=e.subarray(u+1)).indexOf(s)}n&&0===e.length||r.push(e)}else for(var c=0;c<e.length;++c)r.push(e.subarray(c,c+1))}function yH(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var l=a.length;gH(e[u],t,n,a);var c=a.length-l;s[u]=c,i+=c,o=Math.max(o,c)}for(var h=bg("int32",2*i),d=new Array(i),f=[r,o],p=0,v=0;v<r;++v)for(var m=0;m<s[v];++m)h[2*p]=v,h[2*p+1]=m,d[p]=a[p],++p;return[h,d,f]}var bH={kernelName:Fx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=x(yH(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),3),s=o[0],u=o[1],l=o[2],c=u.length;return[n.makeTensorInfo([c,2],"int32",s),n.makeTensorInfo([c],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(l))]}};function xH(e,t){for(var n=bg("int32",e.length),r=0;r<e.length;++r)n[r]=Sw(e[r]).modulo(t).getLowBitsUnsigned();return n}var wH={kernelName:Ox,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=xH(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},kH=Sz(Ux,(function(e){return Math.tan(e)})),SH={kernelName:Ux,backendName:"cpu",kernelFunc:kH},_H=Sz(Bx,(function(e){return Math.tanh(e)}));var EH={kernelName:hx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.tensor,a=t.indices,i=t.updates,o=xC(0,a,r.shape),s=o.sliceRank,u=o.numUpdates,l=o.sliceSize,c=o.strides,h=o.outputSize,d=n.bufferSync(a),f=n.bufferSync(i),p=n.bufferSync(r),v=MG(d,f,r.shape,h,l,u,s,c,p,!1);return n.makeTensorInfo(r.shape,v.dtype,v.values)}};function TH(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=PS(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var l=e.locToIndex(s);a.values[i]=e.values[l]}return a}var MH={kernelName:Wx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;bz(a,"tile");var o=TH(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},CH=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function IH(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);IH(e,t,Math.max(n,Math.floor(t-i*s/a+u)),Math.min(r,Math.floor(t+(a-i)*s/a+u)))}var l=e[t],c=n,h=r;for(ag(e,n,t),CH(e[r],l)>0&&ag(e,n,r);c<h;){for(ag(e,c,h),c++,h--;CH(e[c],l)<0;)c+=1;for(;CH(e[h],l)>0;)h-=1}0===CH(e[n],l)?ag(e,n,h):ag(e,h+=1,r),h<=t&&(n=h+1),t<=h&&(r=h-1)}}function AH(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=yg(n,o*r),l=yg("int32",o*r),c=function(){var t=h*s,n=e.subarray(t,t+s),i=new Array(n.length);n.forEach((function(e,t){return i[t]={value:e,index:t}})),r<i.length&&(IH(i,r),i=i.slice(0,r)),a&&i.sort(CH);for(var o=h*r,c=u.subarray(o,o+r),d=l.subarray(o,o+r),f=0;f<r;f++)c[f]=i[f].value,d[f]=i[f].index},h=0;h<o;h++)c();var d=t.slice();return d[d.length-1]=r,[PS(d,n,u),PS(d,"int32",l)]}var RH={kernelName:Vx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;bz(a,"topk");var s=x(AH(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),2),u=s[0],l=s[1];return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var NH={kernelName:Gx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,l=n.outputShape,c=x(a.shape,4),h=c[0],d=c[1],f=c[2],p=c[3],v=x(null!=l?l:[d,f],2),m=v[0],g=v[1],y=[h,m,g,p],b=Mg(a.shape),w=b[0],k=b[1],S=b[2],_=Mg(y),E=_[0],T=_[1],M=_[2],C=yg(a.dtype,lg(y));C.fill(u);for(var I=r.data.get(a.dataId).values,A=r.data.get(i.dataId).values,R=0;R<h;++R){for(var N=1===i.shape[0]?A:A.subarray(8*R,8*R+8),L=0;L<m;++L)for(var P=0;P<g;++P)for(var D=0;D<p;++D){var F=void 0,O=N[6]*P+N[7]*L+1;if(0!==O){var z=(N[0]*P+N[1]*L+N[2])/O,U=(N[3]*P+N[4]*L+N[5])/O,B=LH(z,f,s),W=LH(U,d,s);switch(o){case"nearest":F=DH(I,d,f,w,k,S,R,W,B,D,u);break;case"bilinear":F=FH(I,d,f,w,k,S,R,W,B,D,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}C[R*E+L*T+P*M+D]=F}}return r.makeTensorInfo(y,a.dtype,C)}return{dataId:r.write(C,y,a.dtype),shape:a.shape,dtype:a.dtype}}};function LH(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return ng(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return ng(0,n,t-1)}(e,t);case"nearest":return function(e,t){return ng(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function PH(e,t,n,r,a,i,o,s,u,l,c){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+l]:c}function DH(e,t,n,r,a,i,o,s,u,l,c){return PH(e,t,n,r,a,i,o,Math.round(s),Math.round(u),l,c)}function FH(e,t,n,r,a,i,o,s,u,l,c){var h=Math.floor(s),d=Math.floor(u),f=h+1,p=d+1;return(f-s)*((p-u)*PH(e,t,n,r,a,i,o,h,d,l,c)+(u-d)*PH(e,t,n,r,a,i,o,h,p,l,c))+(s-h)*((p-u)*PH(e,t,n,r,a,i,o,f,d,l,c)+(u-d)*PH(e,t,n,r,a,i,o,f,p,l,c))}function OH(e,t,n,r){for(var a=mg(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u=new Map,l=new Int32Array(n[a]),c=new Ww(i,r,e),h=[],d=1===i[0]&&1===i[2],f=0;f<n[a];f++){var p=void 0;if(d)p=e[f].toString();else{for(var v=[],m=0;m<i[0];m++)for(var g=0;g<i[2];g++)v.push(c.get(m,f,g));p=v.join(",")}var y=u.get(p);if(null!=y)l[f]=y;else{var b=u.size;u.set(p,b),l[f]=b,h.push(f)}}var x=i.slice();x[1]=u.size;var w=new Ww(x,r);h.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)w.set(c.get(n,e,r),n,t,r)}));var k=n.slice();return k[a]=x[1],{outputValues:w.values,outputShape:k,indices:l}}var zH={kernelName:jx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;bz(i,"unique");var o=OH(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,l=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([l.length],"int32",l)]}};var UH={kernelName:Xx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),l=0,c=0;c<o;c++)c!==i&&(u[l++]=a.shape[c]);var h=new Array(o).fill(0),d=a.shape.slice();d[i]=1;for(var f=new Array(s),p=0;p<f.length;p++){h[i]=p;var v=VU({inputs:{x:a},backend:n,attrs:{begin:h,size:d}});f[p]=rU({inputs:{x:v},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(v)}return f}};for(var BH={kernelName:qx,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;bz(a,"unsortedSegmentSum");for(var s=[],u=[],l=a.shape.length-i.shape.length,c=i,h=0;h<l;++h){var d=qB({inputs:{input:c},backend:n,attrs:{dim:h+1}});c=d,u.push(d)}for(var f=0;f<o;++f){var p=_w(f,"int32"),v=n.makeTensorInfo([],"int32",p),m=BB({inputs:{a:v,b:c},backend:n}),g=Yz({inputs:{x:m},backend:n,attrs:{dtype:"float32"}}),y=LB({inputs:{a:g,b:a},backend:n}),b=DB({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(v),u.push(m),u.push(g),u.push(y),u.push(b)}var x=HV({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},WH=0,VH=[sU,lU,hU,fU,nU,pU,yU,bU,xU,wU,SU,EU,MU,AU,NU,FU,OU,zU,UU,oU,BU,HU,qU,KU,YU,Zz,QU,eB,Hz,tB,oB,uB,lB,cB,hB,dB,fB,vB,gB,yB,bB,xB,wB,kB,_B,EB,TB,MB,CB,IB,AB,OB,Tz,zB,WB,GB,XB,KB,JB,uW,cW,hW,pW,gW,yW,bW,wW,SW,TW,IW,Cz,AW,aB,NW,PW,FW,Az,UW,VW,HW,qW,YW,QW,eV,rV,aV,iV,uV,hV,dV,fV,pV,vV,mV,gV,yV,wV,kV,EV,CV,PB,AV,NV,PV,FV,UV,BV,GV,jV,XV,YV,Pz,JV,nG,iG,hG,fG,qz,eW,vG,Fz,zz,aU,mG,gG,yG,bG,xG,wG,SG,TG,CG,RG,NG,PG,Wz,FG,zG,BG,GU,MV,GG,HG,XG,KG,ZG,JG,QG,$G,nH,rH,oH,lH,hH,fH,mH,bH,wH,aW,FB,SH,{kernelName:Bx,backendName:"cpu",kernelFunc:_H},EH,MH,RH,NH,gU,zH,UH,BH,VV];WH<VH.length;WH++){ow(VH[WH])}var GH,HH,jH,XH={},qH={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function KH(e,t){if(!(e in XH)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if(Bg().getBool("IS_SAFARI")||"undefined"===typeof OffscreenCanvas||2!==e){if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(e):t;n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete XH[e]}),!1),Bg().getBool("SOFTWARE_WEBGL_ENABLED")&&(qH.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",qH)||n.getContext("experimental-webgl",qH);return n.getContext("webgl2",qH)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;XH[e]=n}var r=XH[e];return null==r||r.isContextLost()?(delete XH[e],KH(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),XH[e])}function YH(e,t){return[t,e]}function ZH(e){var t=lg(e);return dg(Math.ceil(t/4))}function JH(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function QH(e,t){var n,r,a,i,o,s,u,l,c,h,d=e;return 2===Bg().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,a=d.RGBA16F,i=d.RGBA32F,o=d.RED,u=4,l=1,c=d.HALF_FLOAT,h=d.FLOAT,s=d.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=d.RGBA,o=e.RGBA,u=4,l=4,c=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:l,textureTypeHalfFloat:c,textureTypeFloat:h}}function $H(e,t){var n=t();return Bg().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(GH||(GH={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(HH||(HH={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(jH||(jH={}));function ej(e){return!!(Bg().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function tj(e,t){return dj(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}var nj,rj,aj=/ERROR: [0-9]+:([0-9]+):/g;function ij(e,t){var n=aj.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return fg((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var l=o.slice(0,r-1),c=o.slice(r-1,r),h=o.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(fg(c[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}function oj(e,t){if($H(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function sj(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&($H(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),$H(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),$H(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function uj(e,t,n,r){$H(e,(function(){return function(e,t,n){fj(e,n),$H(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),$H(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),$H(e,(function(){return e.uniform1i(n,r)}))}function lj(e,t,n){$H(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),$H(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function cj(e,t){$H(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),$H(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function hj(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function dj(e,t,n){var r=$H(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function fj(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function pj(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return lg(e.slice(0,e.length-t))}function vj(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function mj(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[pj(e)].concat(g(vj(e)))),t}function gj(e){return e%2===0}function yj(e,t){if(cg(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e[e.length-1],r=t[t.length-1];if(n===r)return!0;if(gj(n)&&gj(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&gj(e[0])&&gj(t[0])}function bj(e,t){return null!=e.getExtension(t)}function xj(e){try{if(null!=KH(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function wj(e){if(0===e)return!1;var t=KH(e);if(1!==e){if(bj(t,"EXT_color_buffer_float"))return kj(t);var n="EXT_color_buffer_half_float";if(bj(t,n)){var r=t.getExtension(n);return function(e,t){var n=QH(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!!bj(t,"OES_texture_float")&&(!!bj(t,"WEBGL_color_buffer_float")&&kj(t))}function kj(e){var t=QH(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function Sj(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&og("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var _j=Bg();function Ej(){var e,t,n,r,a,i,o,s,u,l;return 2===Bg().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=Bg().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Tj(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Mg(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function Mj(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Mg(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function Cj(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=e.map((function(e,t){return t})),a=function(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(r,t);return a.map((function(t,r){var i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")})).join("")}function Ij(e){var t=Mg(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}_j.registerFlag("HAS_WEBGL",(function(){return _j.getNumber("WEBGL_VERSION")>0})),_j.registerFlag("WEBGL_VERSION",(function(){return xj(2)?2:xj(1)?1:0})),_j.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),_j.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===_j.get("WEBGL_VERSION")})),_j.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),_j.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),_j.registerFlag("WEBGL_PACK",(function(){return _j.getBool("HAS_WEBGL")})),_j.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_PACK_CLIP",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_PACK_REDUCE",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_CONV_IM2COL",(function(){return _j.getBool("WEBGL_PACK")})),_j.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==nj){var t=KH(e);nj=t.getParameter(t.MAX_TEXTURE_SIZE)}return nj}(_j.getNumber("WEBGL_VERSION"))})),_j.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==rj){var t=KH(e);rj=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,rj)}(_j.getNumber("WEBGL_VERSION"))})),_j.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=_j.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=KH(e);return bj(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:bj(t,"EXT_disjoint_timer_query")?1:0}(e)})),_j.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return _j.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!pk()})),_j.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=KH(e);if(1===e){if(!bj(t,"OES_texture_float"))return!1}else if(!bj(t,"EXT_color_buffer_float"))return!1;return kj(t)}(_j.getNumber("WEBGL_VERSION"))})),_j.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!_j.getBool("WEBGL_FORCE_F16_TEXTURES")&&_j.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),_j.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return wj(_j.getNumber("WEBGL_VERSION"))})),_j.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=_j.getNumber("WEBGL_VERSION"))&&null!=KH(e).fenceSync;var e})),_j.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return _j.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),_j.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))})),_j.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return pk()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))})),_j.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),_j.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),_j.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),_j.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),_j.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),_j.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return _j.getBool("IS_TEST")})),_j.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),_j.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),_j.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1})),_j.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var Aj="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",Rj=c_;function Nj(e,t,n){var r=[];if(e.forEach((function(e){var t=lg(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(Vj(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?Pj(e,r):Lj(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;i.length<=o.length&&(a+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=Rj(e.shapeInfo.logicalShape,t.logicalShape),l=Wj(s),c=s-o,h=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(h[e+c]," = 0;")})).join("\n");var d="";d=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+c])})).join(", ");var f="return outputValue;",p=1===lg(e.shapeInfo.logicalShape),v=lg(t.logicalShape),m=1===v;if(1!==o||p||m){if(p&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var g=o-2,y=o-1;u.indexOf(g)>-1&&u.indexOf(y)>-1?f="return vec4(outputValue.x);":u.indexOf(g)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(y)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(d,");\n      ").concat(f,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&cg(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var l,c=Wj(u),h=Rj(e.shapeInfo.logicalShape,t.logicalShape),d=u-s,f=["x","y","z","w","u","v"];l=0===s?"":u<2&&h.length>=1?"coords = 0;":h.map((function(e){return"coords.".concat(f[e+d]," = 0;")})).join("\n");var p="";p=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(f[t+d])})).join(", ");return"\n    float ".concat(a,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(l,"\n      return get").concat(r,"(").concat(p,");\n    }\n  ")}(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,l=Ej(),c=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(l),h=function(e){var t="".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(Dj,"\n    ").concat(Fj,"\n    ").concat(Oj,"\n  ");return t}(l);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(cg(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",l=2;l<e.length-1;l++)o*=e[e.length-l-1],s="\n      int b".concat(l," = index / ").concat(o,";\n      index -= b").concat(l," * ").concat(o,";\n    ")+s,u="b".concat(l,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(l)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(cg(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){var r=Mj(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(r,"\n    return ivec3(r, c, d);\n  }\n")}var a=Tj(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){var r=Mj(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}var a=Tj(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=Tj(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=Tj(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(l)),n.packedInputs&&(h+=zj),[h,c,i,o,a,s,n.userCode].join("\n")}function Lj(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=x(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Uj(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=x(e.shapeInfo.texShape,2),l=u[0],c=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(l,", ").concat(c,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(Bj(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Uj(n);if(1===o)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(1===i)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(t)return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&cg(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=gg(n),l=u.newShape,c=u.keptDims,h=l;if(h.length<n.length){var d=Gj(e,h),f=["row","col"];return"\n      ".concat(Lj(d,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(Hj(f,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(Bj(e),"\n      }\n    ");var p=i[0],v=i[1],m=Uj(r);if(1===v)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(p,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(1===p)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(v,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(t)return"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(m,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");return"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(m,";\n    vec2 uv = uvFromFlat(").concat(p,", ").concat(v,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=gg(n),u=s.newShape,l=s.keptDims,c=u;if(c.length<n.length){var h=Gj(e,c),d=["row","col","depth"];return"\n        ".concat(Lj(h,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(Hj(d,l),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(Bj(e),"\n      }\n    ");var f=e.shapeInfo.texShape,p=f[0],v=f[1],m=e.shapeInfo.flatOffset;if(v===i&&null==m)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(v,".0, ").concat(p,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(v===o&&null==m)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(v,".0, ").concat(p,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var g=Uj(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    ");return"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(g,";\n        vec2 uv = uvFromFlat(").concat(p,", ").concat(v,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=gg(n),l=u.newShape,c=u.keptDims;if(l.length<n.length){var h=Gj(e,l),d=["row","col","depth","depth2"];return"\n      ".concat(Lj(h,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(Hj(d,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(Bj(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],m=p[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(m===s&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(g,"\n        ").concat(y,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(m===i&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var x=Uj(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(g,"\n      ").concat(y,"\n      ").concat(b,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(m,", index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=gg(t),l=u.newShape,c=u.keptDims;if(l.length<t.length){var h=Gj(e,l),d=["row","col","depth","depth2","depth3"];return"\n      ".concat(Lj(h),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Hj(d,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(Bj(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],m=p[1];if(m===s&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(m===a&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=Uj(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(m,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=gg(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=Gj(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(Lj(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Hj(u,o),");\n      }\n    ")}var l=t[5],c=t[4]*l,h=t[3]*c,d=t[2]*h,f=t[1]*d;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(f,", ").concat(d,", ").concat(h,", ").concat(c,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(l,", 1)));\n        ").concat(Bj(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,m=v[0],g=v[1];if(g===f&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(d,", ").concat(h,", ").concat(c,", ").concat(l,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===l&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=Uj(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(f," + col * ").concat(d," + depth * ").concat(h," +\n          depth2 * ").concat(c," + depth3 * ").concat(l," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function Pj(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Ej();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=Ej();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=Ej();if(null!=i&&cg(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(c,", ").concat(l[0],", ").concat(l[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=Gj(e,n.slice(1)),l=["b","row","col"];return"\n        ".concat(Pj(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(Hj(l,s),");\n        }\n      ")}var c=Ej();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ");var h=o[0],d=o[1],f=Math.ceil(n[2]/2),p=f*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(h,", ").concat(d,", ").concat(p,", ").concat(f,", b, row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Ej();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=u[0],c=u[1],h=Math.ceil(i[o-1]/2),d=h*Math.ceil(i[o-2]/2),f="int b, int row, int col",p="b * ".concat(d," + (row / 2) * ").concat(h," + (col / 2)"),v=2;v<o-1;v++)f="int b".concat(v,", ")+f,d*=i[o-v-1],p="b".concat(v," * ").concat(d," + ")+p;return"\n    vec4 ".concat(r,"(").concat(f,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(c,";\n      int texC = index - texR * ").concat(c,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(c,", ").concat(l,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var Dj="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Fj="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Oj="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",zj="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Uj(e){return"offset".concat(e)}function Bj(e){var t=e.name,n=lg(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Wj(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Vj(e,t,n){var r=gg(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,l=!e&&o>1&&!cg(t,n)&&a.length<o||s;return{useSqueezeShape:l,uniformShape:l?u:t,keptDims:i}}function Gj(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Hj(e,t){return t.map((function(t){return e[t]})).join(", ")}function jj(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=Nj(a,o,t),u=function(e,t){var n=dj(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if($H(e,(function(){return e.shaderSource(n,t)})),$H(e,(function(){return e.compileShader(n)})),Bg().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw ij(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),l=e.createProgram(u);return Bg().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:l,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(l),Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:l,inShapeInfos:i,outShapeInfo:o},Xj(e,t,l)))}function Xj(e,t,n){var r,a,i,o,s=[],u=[],l=null;o=e.getUniformLocation(n,"NAN",!1),1===Bg().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(n,"INFINITY",!1));var c,h=!1,d=N(t.variableNames);try{for(d.s();!(c=d.n()).done;){var f=c.value,p={name:f,uniform:e.getUniformLocation(n,f,h),offset:e.getUniformLocation(n,"offset".concat(f),h)};t.enableShapeUniforms&&(p.shape=e.getUniformLocation(n,"".concat(f,"Shape"),h),p.texShape=e.getUniformLocation(n,"".concat(f,"TexShape"),h)),s.push(p)}}catch(R0){d.e(R0)}finally{d.f()}if(t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",h),i=e.getUniformLocation(n,"outShapeStrides",h),a=e.getUniformLocation(n,"outTexShape",h)),t.customUniforms){var v,m=N(t.customUniforms);try{for(m.s();!(v=m.n()).done;){var g=v.value;u.push(e.getUniformLocation(n,g.name,h))}}catch(R0){m.e(R0)}finally{m.f()}}return{variablesLocations:s,customUniformLocations:u,infLoc:l,nanLoc:o,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function qj(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!cg(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!cg(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function Kj(e){return Bg().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var Yj=M((function e(t){E(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=GH.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Ej();this.outputShape=t,this.enableShapeUniforms=Kj(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Mj(["r","c","d"],t):Tj(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Zj=M((function e(t){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=GH.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Ej();this.outputShape=t,this.enableShapeUniforms=Kj(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Mj(["r","c","d"],t):Tj(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Jj=M((function e(t){E(this,e),this.variableNames=["A"],this.outTexUsage=HH.DOWNLOAD;var n=Ej();this.outputShape=t,this.userCode="\n      ".concat(Aj,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),Qj=M((function e(t){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=HH.DOWNLOAD;var n=Ej();this.outputShape=t,this.userCode="\n      ".concat(Aj,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),$j={R:0,G:1,B:2,A:3},eX=M((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";E(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=Ej();this.outputShape=t,this.enableShapeUniforms=Kj(this.outputShape.length);var i="result";n&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+="\n          if(offset == ".concat(s,") {\n            result = values[").concat($j[u],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Ij(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(r.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(r.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(a.texture2D,"(A, uv);\n          ").concat(o,"\n        }\n        ").concat(a.output," = vec4(").concat(i,", 0., 0., 0.);\n      }\n    ")})),tX=M((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=Ej();this.outputShape=t,this.enableShapeUniforms=Kj(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Ij(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")}));function nX(e){var t=Ej();return function(e,t){var n=dj(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if($H(e,(function(){return e.shaderSource(n,t)})),$H(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function rX(e){return function(e,t){var n=dj(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return $H(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),$H(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function aX(e){return function(e,t){var n=dj(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return $H(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),$H(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function iX(e,t,n,r,a,i){!function(e,t){var n=Bg().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);var o=function(e){return dj(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return $H(e,(function(){return e.bindTexture(s,o)})),$H(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),$H(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),$H(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),$H(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===Bg().getNumber("WEBGL_VERSION")?$H(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):$H(e,(function(){return e.texStorage2D(s,1,r,t,n)})),$H(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function oX(e){return e.internalFormatFloat}function sX(e){return e.internalFormatHalfFloat}function uX(e){return e.downloadTextureFormat}function lX(e){return e.internalFormatPackedFloat}function cX(e){return e.internalFormatPackedHalfFloat}function hX(e,t,n,r,a,i,o,s){var u=e,l=new Float32Array(function(e,t){var n=x(JH(e,t),2);return n[0]*n[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}var dX=function(){function e(t){E(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var n=Bg().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,function(e,t){XH[e]=t}(n,t)):this.gl=KH(n),t=this.gl,2===Bg().getNumber("WEBGL_VERSION")){var r=t;this.createVertexArray=function(){return $H(r,(function(){return r.createVertexArray()}))},this.bindVertexArray=function(e){return $H(r,(function(){return r.bindVertexArray(e)}))},this.deleteVertexArray=function(e){return $H(r,(function(){return r.deleteVertexArray(e)}))},this.getVertexArray=function(){return $H(r,(function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)}))}}else if(null!=t){var a=t.getExtension("OES_vertex_array_object");if(null==a)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return $H(t,(function(){return a.createVertexArrayOES()}))},this.bindVertexArray=function(e){return $H(t,(function(){return a.bindVertexArrayOES(e)}))},this.deleteVertexArray=function(e){return $H(t,(function(){return a.deleteVertexArrayOES(e)}))},this.getVertexArray=function(){return $H(t,(function(){return t.getParameter(a.VERTEX_ARRAY_BINDING_OES)}))}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===Bg().getNumber("WEBGL_VERSION")){var s="OES_texture_half_float";if(this.textureFloatExtension=tj(this.gl,"OES_texture_float"),bj(this.gl,s))this.textureHalfFloatExtension=tj(this.gl,s);else if(Bg().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),bj(this.gl,o))this.colorBufferHalfFloatExtension=tj(this.gl,o);else if(Bg().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",bj(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else{if(!bj(this.gl,o))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(o)}this.vertexBuffer=rX(this.gl),this.indexBuffer=aX(this.gl),this.framebuffer=function(e){return dj(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=QH(this.gl,this.textureHalfFloatExtension)}return M(e,[{key:"debug",get:function(){return Bg().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;$H(t,(function(){return t.finish()})),$H(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),$H(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),$H(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),$H(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),$H(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=x(YH(t,n),2);return iX(e,a[0],a[1],oX(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=x(YH(t,n),2);return iX(e,a[0],a[1],sX(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=x(YH(t,n),2);return iX(e,a[0],a[1],uX(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){$H(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===Bg().getNumber("WEBGL_VERSION")?$H(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):$H(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===Bg().getNumber("WEBGL_VERSION")?$H(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):$H(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),$H(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;$H(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===Bg().getNumber("WEBGL_VERSION")?$H(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):$H(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),$H(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=x(JH(t,n),2);return iX(e,a[0],a[1],cX(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=x(JH(t,n),2);return iX(e,a[0],a[1],lX(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(cj(this.gl,this.framebuffer),this.outputTexture=null),$H(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=x(YH(t,n),2),i=a[0],o=a[1],s=new Uint8Array(t*n*4);return $H(e,(function(){return e.readPixels(0,0,i,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return hX(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();$H(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return $H(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),$H(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),$H(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(Bg().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return $H(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=nX(n));var r=function(e){return dj(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(n);$H(n,(function(){return n.attachShader(r,t.vertexShader)})),$H(n,(function(){return n.attachShader(r,e)})),function(e,t){if($H(e,(function(){return e.linkProgram(t)})),!Bg().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(n,r);var a=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&oj(n,a),a}},{key:"buildVao",value:function(e){var t=this;this.setProgram(e),this.bindVertexArray(e.vao);var n=this.gl;$H(n,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)})),function(e,t,n){$H(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),sj(e,t,"clipSpacePos",n,3,20,0)&&sj(e,t,"uv",n,2,20,12)}(n,e,this.vertexBuffer)}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&($H(this.gl,(function(){return t.gl.deleteProgram(e)})),this.deleteVertexArray(e.vao))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&oj(this.gl,this.program),$H(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return dj(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),$H(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),uj(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=x(JH(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&oj(this.gl,this.program),hj(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}$H(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),$H(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=tj(this.gl,2===Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=c(u().mark((function e(t){var n=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pg((function(){return n.disposed||n.isQueryAvailable(t,Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var r=void 0;"setTimeoutCustom"in Bg().platform&&(r=Bg().platform.setTimeoutCustom.bind(Bg().platform)),pg((function(){return n.pollItems(),0===n.itemsToPoll.length}),(function(){return 0}),null,r)}}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),lj(this.gl,e,this.framebuffer),this.debug&&hj(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(lj(this.gl,this.outputTexture,this.framebuffer),this.debug&&hj(this.gl)):cj(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;lj(r,e,this.framebuffer),this.debug&&hj(r),this.outputTexture=e,$H(r,(function(){return r.viewport(0,0,t,n)})),$H(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),$H(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var fX=$z,pX=jU,vX=XU,mX=Kz,gX=ZU,yX=nB,bX=UB,xX=HB,wX=YB,kX=dW,SX=xW,_X=kW,EX=_W,TX=MW,MX=OW,CX=BW,IX=GW,AX=jW,RX=oV,NX=lV,LX=bV,PX=RB,DX=IV,FX=OV,OX=ZV,zX=tG,UX=aG,BX=cG,WX=dG,VX=_G,GX=MG,HX=Uz,jX=uU,XX=WU,qX=jG,KX=qG,YX=YG,ZX=eH,JX=sH,QX=dH,$X=vH,eq=yH,tq=xH,nq=tW,rq=TH,aq=AH,iq=vU,oq=OH;function sq(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function uq(e,t){return 1===t?[e]:sq(e,t)}var lq=function(){function e(t){if(E(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Kj(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=uq("rc",this.rank),r=Wj(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return M(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);if(1===this.rank){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),cq=M((function e(t,n){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Kj(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){var n=t?Cj(["r","c","d"],"inputShape"):Tj(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Ij(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var hq=function(){function e(t){E(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}return M(e,[{key:"acquireTexture",value:function(e,t,n){var r=fq(t,n),a=pq(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=dq(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].pop();return this.usedTextures[a].push(s),s}return r===jH.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===jH.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===jH.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===jH.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===jH.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=fq(n,r),i=pq(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=dq(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=Bg().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],l=u&&u.indexOf(e);if(null==l||l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[l]=u[u.length-1],u.pop(),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function dq(e,t,n,r,a){var i,o=function(e,t){switch(e){case jH.PACKED_2X2_FLOAT32:return lX(t);case jH.PACKED_2X2_FLOAT16:return cX(t);case jH.UNPACKED_FLOAT32:return oX(t);case jH.UNPACKED_FLOAT16:return sX(t);case jH.PACKED_4X1_UNSIGNED_BYTE:return uX(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=x(JH(e[0],e[1]),2);i=s[0]*s[1]}else{var u=x(YH(e[0],e[1]),2);i=u[0]*u[1]}var l=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*l}function fq(e,t){if(e===HH.UPLOAD)return jH.PACKED_2X2_FLOAT32;if(e===HH.RENDER||null==e)return function(e){return Bg().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?jH.PACKED_2X2_FLOAT32:jH.UNPACKED_FLOAT32:e?jH.PACKED_2X2_FLOAT16:jH.UNPACKED_FLOAT16}(t);if(e===HH.DOWNLOAD||e===HH.PIXELS)return jH.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function pq(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var vq=M((function e(t,n){E(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Kj(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),mq="if (isnan(x)) return x;",gq="return x;",yq="return abs(x);";var bq="return (x >= 0.0) ? x : (exp(x) - 1.0);",xq=mq+"\n  return (x < 0.0) ? 0.0 : x;\n",wq=mq+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",kq="return x;",Sq="return 1.0 / (1.0 + exp(-1.0 * x));",_q="return x;",Eq="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Tq="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Mq="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Cq="return 1.0 / (1.0 + exp(-1.0 * x));",Iq=M((function e(t,n){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Kj(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),Aq=M((function e(t){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Kj(this.outputShape.length);var n=t.length,r=uq("rc",n),a=Wj(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),Rq=YC,Nq={};var Lq=Bg().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var Pq=function(e){C(n,e);var t=R(n);function n(e){var r,a,i;if(E(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Bg().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof dX)a=e;else{var o=KH(Bg().getNumber("WEBGL_VERSION"),e);a=new dX(o)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var s=KH(Bg().getNumber("WEBGL_VERSION"));a=new dX(s),r.binaryCache=((i=Bg().getNumber("WEBGL_VERSION"))in Nq||(Nq[i]={}),Nq[i]),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new hq(r.gpgpu),r.numMBBeforeWarning=null==Bg().global.screen?1024:Bg().global.screen.height*Bg().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new Qm(A(r),zS()),r}return M(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"writeTexture",value:function(e,t,n,r,a,i){var o=this.makeTensorInfo(t,n),s=this.texData.get(o.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[r,a]},s.texShape=[r,a];var u=mj(t),l=new eX(u,!1,i),c=this.runWebGLProgram(l,[o],n,[[r,a]]);return c.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(o),c.dataId}},{key:"write",value:function(e,t,n){if((Bg().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Bg().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:HH.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(Bg().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:HH.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new Iq(o,kq):new vq(o,kq);var l=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),c=this.readSync(l.dataId);return this.disposeIntermediateTensorInfo(l),c}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var h,d,f=null!=this.activeTimers;(f&&(h=Tw()),"complex64"===r)?d=IC(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):d=this.getValuesFromTexture(e);return f&&(this.downloadWaitMs+=Tw()-h),this.convertAndCacheOnCPU(e,d)}},{key:"read",value:function(){var e=c(u().mark((function e(t){var n,r,a,i,o,s,l,c,h,d,f,p,v,m,y,b,x,w,k,S,_,E,T;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,l=r.complexTensorInfos,c=r.isPacked,null==o){e.next=11;break}return h=c?new Iq(i,kq):new vq(i,kq),d=this.runWebGLProgram(h,[{dataId:t,shape:i,dtype:s}],s),f=this.read(d.dataId),this.disposeIntermediateTensorInfo(d),e.abrupt("return",f);case 11:if(null==a){e.next=13;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 13:if(!Bg().getBool("DEBUG")){e.next=16;break}if(Bg().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==Bg().getNumber("WEBGL_VERSION")){e.next=16;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 16:if(p=null,"complex64"!==s&&Bg().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),y=this.texData.get(v.dataId),p=(m=this.gpgpu).createBufferFromTexture.apply(m,[y.texture.texture].concat(g(ZH(i))))),this.pendingRead.set(t,[]),"complex64"===s){e.next=22;break}return e.next=22,this.gpgpu.createAndWaitForFence();case 22:if("complex64"!==s){e.next=31;break}return e.next=25,Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]);case 25:x=e.sent,w=x[0],k=x[1],b=IC(w,k),e.next=32;break;case 31:null==p?b=this.getValuesFromTexture(t):(S=lg(i),b=this.gpgpu.downloadFloat32MatrixFromBuffer(p,S));case 32:return null!=v&&this.disposeIntermediateTensorInfo(v),null!=p&&$H(_=this.gpgpu.gl,(function(){return _.deleteBuffer(p)})),E=this.convertAndCacheOnCPU(t,b),T=this.pendingRead.get(t),this.pendingRead.delete(t),T.forEach((function(e){return e(E)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&zS().removeDataId(t,this),this.pendingDeletes--),e.abrupt("return",E);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var l;l=s?new Iq(a,kq):new vq(a,kq);var c=this.runWebGLProgram(l,[{dataId:e,shape:a,dtype:o}],o),h=this.readToGPU(c,t);return this.disposeIntermediateTensorInfo(c),h}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(e,t.customTexShape),f=zS().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:f},p.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Cw(e)}));return PS(e.shape,e.dtype,n)}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return PS(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!ej(n)){if(Bg().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=lg(n);if(Bg().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),l=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat(g(ZH(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),l}var c=Bg().getBool("WEBGL_PACK")&&!0===a,h=c?mj(n):n,d=c?new Qj(h):new Jj(h),f=this.runWebGLProgram(d,[{shape:h,dtype:r,dataId:e}],"float32"),p=this.texData.get(f.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture.texture,p.texShape[0],p.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(f),v}},{key:"timerAvailable",value:function(){return Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=Aw(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=Aw(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return c(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=8;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=ig(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=9;break;case 8:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 9:return t.uploadWaitMs=0,t.downloadWaitMs=0,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Tw(),endMs:null}}},{key:"endTimer",value:function(e){return Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Tw(),e)}},{key:"getQueryTime",value:function(){var e=c(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Bg().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e).complexTensorInfos;return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Lq;return Bg().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&lg(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){ew("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Rq(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new Iq(e.shape,t),a=this.compileAndRun(r,[e],n);return zS().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=jX(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Bg().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,yq,e.dtype);var n=new vq(e.shape,yq),r=this.compileAndRun(n,[e]);return zS().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&kg(n[0])){var a=n.map((function(e){return Mw(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return zS().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new Aq(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new lq(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[pj(e.shape)].concat(g(vj(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[pj(t)].concat(g(vj(t))),i=new cq(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;null!=t&&og(lg(a)<=t[0]*t[1]*4,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}));var o,s=mj(a);o=r?new Zj(s):new Yj(s);var u=[null!=t?t:ZH(s)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(o,[{shape:s,dtype:i,dataId:e}],i,u,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===GH.DENSE){var l=null!=o?o:ZH(e.outputShape);u.texShape=l.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===lg(s.shape))return u.values=yg(s.dtype,0),s;var c=[],h=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&lg(t.shape)<=Bg().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),c.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!yj(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),c.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var d,f={shape:s.shape,texData:u,isUniform:!1},p=function(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=Vj(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,l=o.keptDims,c="",h="",d="";if(1===u.length&&e.packedInputs){var f=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];c="".concat(f[0]>1,"_").concat(f[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var p=Mg(u);d="".concat(p[0]===i[1],"_").concat(p[p.length-1]===i[1])}}else h="".concat(u[0]>1,"_").concat(u[1]>1);var v=t.shape.length,m=2===u.length&&cg(t.shape,i),g=1===lg(t.shape),y=c_(t.shape,n.shape),b=!e.packedInputs&&v===n.shape.length&&cg(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(v,"_").concat(b,"_").concat(s?l:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(m,"_").concat(c,"_").concat(h,"_").concat(d,"_").concat(x,"_").concat(a)}else{var w=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(w,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+"_"+r+"_"+a+"".concat(Bg().getNumber("WEBGL_VERSION"))}(e,h,f),v=this.getAndSaveBinary(p,(function(){return jj(a.gpgpu,e,h,f)})),m=null!=this.activeTimers;m&&(d=this.startTimer()),Bg().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(qj(t.inShapeInfos,n),qj([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===Bg().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(var s=0;s<n.length;++s){var u=n[s],l=t.variablesLocations[s],c=l.uniform,h=l.offset,d=l.shape,f=l.texShape;if(d){var p=Vj(t.program.packedInputs,u.shape,u.texData.texShape).uniformShape;switch(p.length){case 1:e.gl.uniform1iv(d,new Int32Array(p));break;case 2:e.gl.uniform2iv(d,new Int32Array(p));break;case 3:e.gl.uniform3iv(d,new Int32Array(p));break;case 4:e.gl.uniform4iv(d,new Int32Array(p))}}if(f&&e.gl.uniform2i(f,u.texData.texShape[0],u.texData.texShape[1]),null!=c)if(u.isUniform)if(lg(u.shape)<2)e.gl.uniform1f(c,u.uniformValues[0]);else{var v=u.uniformValues;v instanceof Float32Array||(v=new Float32Array(v)),e.gl.uniform1fv(c,v)}else null!=u.texData.slice&&null!=h&&e.gl.uniform1i(h,u.texData.slice.flatOffset),e.setInputMatrixTexture(u.texData.texture.texture,c,s)}var m=t.outShapeLocation;if(m)switch(r.shape.length){case 1:e.gl.uniform1iv(m,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(m,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(m,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(m,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var g=Mg(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(g));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(g));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(g))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(var y=0;y<t.program.customUniforms.length;++y){var b=t.program.customUniforms[y],x=t.customUniformLocations[y],w=a[y];if("float"===b.type)e.gl.uniform1fv(x,w);else if("vec2"===b.type)e.gl.uniform2fv(x,w);else if("vec3"===b.type)e.gl.uniform3fv(x,w);else if("vec4"===b.type)e.gl.uniform4fv(x,w);else if("int"===b.type)e.gl.uniform1iv(x,w);else if("ivec2"===b.type)e.gl.uniform2iv(x,w);else if("ivec3"===b.type)e.gl.uniform3iv(x,w);else{if("ivec4"!==b.type)throw Error("uniform type ".concat(b.type," is not supported yet."));e.gl.uniform4iv(x,w)}}e.executeProgram()}(this.gpgpu,v,h,f,r),c.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),m&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)}));var g=Bg().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=Tw();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!Bg().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;if(!this.disposed){if(!Bg().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}));this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=BS((function(){if(!Bg().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Bg().getBool("DEBUG");Bg().set("DEBUG",!1);var n=e.abs(QS(1e-8)).dataSync()[0];if(Bg().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,l=null!=this.activeTimers;l&&(u=Tw());var c=t.texShape;if(null==c&&(c=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Bg().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Bg().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&Bg().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,e=e.map((function(t,n){return n>=e.length-2?rg(e[n]):e[n]})),1===e.length&&(e=[2,e[0]])),2!==e.length){var a=gg(e);e=a.newShape}var i=lg(e),o=null;e.length<=1&&i<=n?o=[1,i]:2===e.length&&e[0]<=n&&e[1]<=n?o=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?o=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?o=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?o=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(o=[e[0],e[1]*e[2]*e[3]]);var s=null!=o&&Math.max.apply(Math,g(o))>r&&Math.min.apply(Math,g(o))<=(t?2:1)&&Math.min.apply(Math,g(o))>0;if(null==o||s)if(t){var u=pj(e),l=2,c=2;if(e.length){var h=x(vj(e),2);l=h[0],c=h[1]}o=dg(i=u*(l/2)*(c/2)).map((function(e){return 2*e}))}else o=dg(i);return o}(n,s),t.texShape=c),null!=a){var h,d=mj(n),f=c[1],p=c[0],v=a instanceof Uint8Array||a instanceof Uint8ClampedArray;if(s||!v){var m=x(JH(c[0],c[1]),2);f=m[0],p=m[1]}h=s?new tX(d,v):new eX(d,v);var y=v?[p,f]:c,b=this.makeTensorInfo(y,r),w=this.texData.get(b.dataId);w.usage=v?HH.PIXELS:HH.UPLOAD,w.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),f,p,a);var k=[[p,f]],S=this.runWebGLProgram(h,[b],r,k,!0),_=this.texData.get(S.dataId);t.texShape=_.texShape,t.isPacked=_.isPacked,t.usage=_.usage,Bg().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(t.texture=_.texture,t.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=Tw()-u)}else{var E=this.acquireTexture(c,o,r,s);t.texture=E}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*wg(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=x(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=c(u().mark((function e(){var t,n,r,a,i,o,s,l,c=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=x(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:o=u().mark((function e(){var n,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=x(l[s],2),r=n[1],a=new Promise((function(e){try{c.checkCompletion_(r),e(!0)}catch(t){throw t}})),t.push(a);case 3:case"end":return e.stop()}}),e)})),s=0,l=Object.entries(this.binaryCache);case 8:if(!(s<l.length)){e.next=13;break}return e.delegateYield(o(),"t0",10);case 10:s++,e.next=8;break;case 13:return e.abrupt("return",Promise.all(t));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}return e.abrupt("return",this.checkCompletion_(t));case 4:return e.next=6,uC();case 6:return e.abrupt("return",this.checkCompletionAsync_(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw ij(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.values(this.binaryCache);e<t.length;e++){var n=t[e];this.gpgpu.buildVao(n.webGLProgram);var r=Xj(this.gpgpu,n.program,n.webGLProgram),a=r.variablesLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.outShapeLocation,l=r.outShapeStridesLocation,c=r.outTexShapeLocation;n.variablesLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.outShapeLocation=u,n.outShapeStridesLocation=l,n.outTexShapeLocation=c}}},{key:"createTensorFromGPUData",value:function(e,t,n){e.channels=e.channels||"RGBA";var r=e.texture,a=e.height,i=e.width,o=e.channels,s=zS().backend;if(!s.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var u=s.writeTexture(r,t,n,a,i,o);return zS().makeTensorFromDataId(u,t,n,s)}}]),n}($m);Pq.nextDataId=0;vk()&&GS("webgl",(function(){return new Pq}),2);var Dq="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",Fq=M((function e(t,n,r){E(this,e),this.variableNames=["A","B"],this.outputShape=d_(n,r),this.enableShapeUniforms=Kj(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),Oq="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",zq=M((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];E(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=d_(n,r);var i=this.outputShape.length;this.enableShapeUniforms=Kj(i);var o="";if(a)if(0===i||1===lg(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{var s=Wj(i);if(o="\n          ".concat(s," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=uq("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function Uq(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Bq={kernelName:ib,backendName:"webgl",kernelFunc:Uq};function Wq(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=Uq({inputs:{x:r},backend:n}),u=Uq({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var Vq={kernelName:gy,backendName:"webgl",kernelFunc:Wq},Gq="return (a < 0.) ? b * a : a;",Hq="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var jq={kernelName:hb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",_w(i,"float32")),s=Bg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zq(Hq,a.shape,o.shape):new Fq(Gq,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},Xq="return (a < 0.) ? b * a : a;",qq="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var Kq={kernelName:Xb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=Bg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zq(qq,r.shape,a.shape):new Fq(Xq,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},Yq="if (isnan(x)) return x;";function Zq(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,l=s,c=a||u.dtype;if(l.shouldExecuteOnCPU([u])&&null!=r){var h=l.texData.get(u.dataId),d=r(h.values,c);return l.makeTensorInfo(u.shape,c,d)}return i=Bg().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new Iq(u.shape,n):new vq(u.shape,t),l.runWebGLProgram(i,[u],c)}}function Jq(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,l=r.a,c=r.b,h=i;if(o&&"complex64"===l.dtype){var d=h.texData.get(l.dataId),f=h.texData.get(c.dataId),p=[[d.complexTensorInfos.real,f.complexTensorInfos.real],[d.complexTensorInfos.imag,f.complexTensorInfos.imag]].map((function(e){var n=x(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:l.shape},o={dataId:a.dataId,dtype:a.dtype,shape:c.shape},s=new Fq(t,l.shape,c.shape);return h.runWebGLProgram(s,[i,o],$w(r.dtype,a.dtype))})),v=x(p,2),m=v[0],g=v[1],y=Wq({inputs:{real:m,imag:g},backend:h});return h.disposeIntermediateTensorInfo(m),h.disposeIntermediateTensorInfo(g),y}var b,w=u||$w(l.dtype,c.dtype);if(("string"===l.dtype||"string"===c.dtype||h.shouldExecuteOnCPU([l,c]))&&null!=s){var k=h.texData.get(l.dataId).values,S=h.texData.get(c.dataId).values,_="string"===l.dtype?KC(k):k,E="string"===l.dtype?KC(S):S,T=x(s(l.shape,c.shape,_,E,w),2),M=T[0],C=T[1],I=h.makeTensorInfo(C,w);return h.texData.get(I.dataId).values=M,I}return b=Bg().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new zq(n,l.shape,c.shape,a):new Fq(t,l.shape,c.shape),h.runWebGLProgram(b,[l,c],w)}}function Qq(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?_q:gq;if("relu"===e)return t?Tq:xq;if("elu"===e)return t?Eq:bq;if("relu6"===e)return t?Mq:wq;if("prelu"===e)return t?qq:Xq;if("leakyrelu"===e)return t?Hq:Gq;if("sigmoid"===e)return t?Cq:Sq;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var $q=M((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];E(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Kj(this.outputShape.length);var c=a?t[1]:t[2],h=Math.ceil(c/2),d=a?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",p=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";s&&(m=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):l?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");var b="rc.x",x="rc.x";t[0]<n[0]?b="imod(rc.x, ".concat(t[0],")"):n[0]<t[0]&&(x="imod(rc.x, ".concat(n[0],")")),this.userCode="\n      ".concat(m,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(h,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(b,";\n        int batchB = ").concat(x,";\n        for (int i = 0; i < ").concat(h,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(d,");\n          vec4 b = getMatrixB(batchB, ").concat(f,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(p[0]," * ").concat(v[0],");\n          result += (").concat(p[1]," * ").concat(v[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),eK={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},tK=M((function e(t,n,r){E(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=d_(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),nK="return a * b;";function rK(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=$w(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),l=new tK(eK.REAL,a.shape,i.shape),c=new tK(eK.IMAG,a.shape,i.shape),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],d=r.runWebGLProgram(l,h,"float32"),f=r.runWebGLProgram(c,h,"float32"),p=Wq({inputs:{real:d,imag:f},backend:r});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(f),p}if(r.shouldExecuteOnCPU([a,i])){var v=r.texData.get(a.dataId),m=r.texData.get(i.dataId),g=x(PX(a.shape,i.shape,v.values,m.values,o),2),y=g[0],b=g[1],w=r.makeTensorInfo(b,o);return r.texData.get(w.dataId).values=y,w}return t=Bg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zq(nK,a.shape,i.shape):new Fq(nK,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var aK={kernelName:Db,backendName:"webgl",kernelFunc:rK};function iK(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=lg(a.shape),u=vg(i,s),l=lg(u);og(s===l,(function(){return"The new shape (".concat(u,") has ").concat(l," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."}));var c=o.texData.get(a.dataId);return!c.isPacked||yj(a.shape,u)||null!==c.texture&&yj(c.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[pj(e.shape)].concat(g(vj(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[pj(t)].concat(g(vj(t))),o=new cq(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var oK={kernelName:tx,backendName:"webgl",kernelFunc:iK},sK=M((function e(t,n){E(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,l="sumValue += dot(values, ones);";if(null!=n){var c=1/n;l="sumValue += dot(values * ".concat(hg(c)?c.toPrecision(2):c,", ones);")}var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),uK=M((function e(t,n){E(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var l="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?l="sumValue":"prod"===n?l="prodValue":"all"===n?l="allValue":"any"===n&&(l="anyValue");var c=4*Math.floor(r/4),h=r%4,d="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),f="vec4";"all"===n?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(c,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(d,"\n        }\n\n        int inIdx = inOffset + ").concat(c,";\n        if (").concat(1===h,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(2===h,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(3===h,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(d,"\n        }\n        setOutput(").concat(l,");\n      }\n    ")}));function lK(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=dC(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],l=u.inSize,c=u.windowSize,h=u.outSize,d=void 0;d="mean"===n?0===o?new sK({windowSize:c,inSize:l,batchSize:e.shape[0],outSize:h},l):new sK({windowSize:c,inSize:l,batchSize:e.shape[0],outSize:h}):new uK({windowSize:c,inSize:l,batchSize:e.shape[0],outSize:h},n),s=i,i=r.runWebGLProgram(d,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var cK=M((function e(t,n){E(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=Wj(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var hK=M((function e(t,n){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Wj(this.rank),o=sq("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var l="vec2(".concat(s.slice(-2).join(),")"),c="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(l,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(c,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(c,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function dK(e,t,n){var r=Bg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hK(e.shape,t):new cK(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function fK(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=mg(a,e.shape),s=o,u=dT(s,i),l=null!=u,c=e;l&&(c=dK(e,u,r),s=pT(s.length,i)),hT("sum",s,i);var h=x(lT(c.shape,s),2),d=h[0],f=h[1],p=d;n&&(p=cT(d,o));var v=lg(f),m=iK({inputs:{x:c},attrs:{shape:[lg(e.shape)/v,v]},backend:r}),g=lK(m,ek(e.dtype),"sum",r),y=iK({inputs:{x:g},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),l&&r.disposeIntermediateTensorInfo(c),y}(t.x,r.axis,r.keepDims,n)}var pK={kernelName:kx,backendName:"webgl",kernelFunc:fK};function vK(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,l=new Array(u),c=0;c<l.length;c++)l[c]=i.shape[o[c]];if(s.shouldExecuteOnCPU([i])){var h=s.texData.get(i.dataId).values,d=iq(h,i.shape,i.dtype,o,l);t=s.makeTensorInfo(l,i.dtype),s.texData.get(t.dataId).values=d}else t=dK(i,o,s);return t}var mK={kernelName:Hx,backendName:"webgl",kernelFunc:vK},gK=1e3;function yK(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,l=void 0===u?null:u,c=e.leakyreluAlpha,h=void 0===c?0:c,d=e.activation,f=void 0===d?null:d,p=t.shape.length,v=n.shape.length,m=r?t.shape[p-2]:t.shape[p-1],g=a?n.shape[v-1]:n.shape[v-2],y=r?t.shape[p-1]:t.shape[p-2],b=a?n.shape[v-2]:n.shape[v-1],x=t.shape.slice(0,-2),w=n.shape.slice(0,-2),k=lg(x),S=lg(w),_=d_(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);og(m===g,(function(){return"Error in matMul: inner shapes (".concat(m,") and (")+"".concat(g,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")}));var E,T=r?[k,m,y]:[k,y,m],M=a?[S,b,g]:[S,g,b],C=iK({inputs:{x:t},backend:i,attrs:{shape:T}}),I=iK({inputs:{x:n},backend:i,attrs:{shape:M}}),A=[C,I],R=Math.max(k,S),N=r?C.shape[1]:C.shape[2],L=null!=s,P=null!=l,D="leakyrelu"===f,F=null!=f?Qq(f,!0):null;if((1===y||1===b)&&N>gK&&!1===(L||P||D||null!=F)){var O=C,z=I;r&&(O=vK({inputs:{x:C},backend:i,attrs:{perm:[0,2,1]}}),A.push(O)),a&&(z=vK({inputs:{x:I},backend:i,attrs:{perm:[0,2,1]}}),A.push(z));var U=1===b,B=O;1!==b&&(B=iK({inputs:{x:O},backend:i,attrs:{shape:[R,N,1]}}),A.push(B));var W=1===b?2:1,V=z;U&&(V=iK({inputs:{x:z},backend:i,attrs:{shape:[R,1,N]}}),A.push(V));var G=rK({inputs:{a:B,b:V},backend:i});E=fK({inputs:{x:G},backend:i,attrs:{axis:W,keepDims:!0}}),A.push(G)}else{var H=$w(t.dtype,n.dtype),j=new $q(T,M,[R,y,b],r,a,L,F,P,D),X=[C,I];if(null!=s&&X.push(s),P&&X.push(l),D){var q=i.makeTensorInfo([],"float32",_w(h,"float32"));X.push(q),A.push(q)}E=i.runWebGLProgram(j,X,H)}var K=iK({inputs:{x:E},backend:i,attrs:{shape:_}});A.push(E);for(var Y=0,Z=A;Y<Z.length;Y++){var J=Z[Y];i.disposeIntermediateTensorInfo(J)}return K}var bK={kernelName:Jx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,l=r.transposeB,c=r.activation;return yK({a:a,b:i,transposeA:u,transposeB:l,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:c})}},xK="return abs(x);";var wK={kernelName:jg,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=jX(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=Bg().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Iq(a.shape,xK):new vq(a.shape,xK),r.runWebGLProgram(t,[a],a.dtype)}},kK=Zq({opSnippet:mq+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),SK={kernelName:Xg,backendName:"webgl",kernelFunc:kK},_K=Zq({opSnippet:mq+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),EK={kernelName:qg,backendName:"webgl",kernelFunc:_K},TK="return a + b;",MK=Jq({opSnippet:TK,packedOpSnippet:TK,supportsComplex:!0,cpuKernelImpl:fX}),CK={kernelName:Kg,backendName:"webgl",kernelFunc:MK},IK=M((function e(t,n){E(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),AK=M((function e(t,n){E(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var RK={kernelName:Yg,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return Uq({inputs:{x:a[0]},backend:r});if(a.length>Bg().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return $w(e,t)})),l=a.map((function(e){return e.shape})),c=Bg().getBool("WEBGL_PACK")?new AK(a[0].shape,l):new IK(a[0].shape,l);return r.runWebGLProgram(c,a,u)}};var NK={kernelName:Zg,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=mg(i,a.shape),l=u,c=dT(l,s),h=a;null!=c&&(h=vK({inputs:{x:a},backend:n,attrs:{perm:c}}),l=pT(l.length,s)),hT("all",l,s);var d,f=x(lT(h.shape,l),2),p=f[0],v=iK({inputs:{x:h},backend:n,attrs:{shape:[-1,lg(f[1])]}}),m=lK(v,v.dtype,"all",n);return d=iK(o?{inputs:{x:m},backend:n,attrs:{shape:cT(p,u)}}:{inputs:{x:m},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(h),d}};var LK={kernelName:Jg,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=mg(i,a.shape),l=u,c=dT(l,s),h=a;null!=c&&(h=vK({inputs:{x:a},backend:n,attrs:{perm:c}}),l=pT(l.length,s)),hT("any",l,s);var d,f=x(lT(h.shape,l),2),p=f[0],v=iK({inputs:{x:h},backend:n,attrs:{shape:[-1,lg(f[1])]}}),m=lK(v,v.dtype,"any",n);return d=iK(o?{inputs:{x:m},backend:n,attrs:{shape:cT(p,u)}}:{inputs:{x:m},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(h),d}},PK=M((function e(t,n,r){E(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),DK=M((function e(t,n,r,a){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,og(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,l=this.outputShape,c=l.length,h=Wj(c),d=uq("coords",c);if(1===o){var f=Wj(u=c+1);s="\n        ".concat(f," sourceLocR = ").concat(f,"(").concat(d.join(),", 0);\n        ++").concat(d[c-1],";\n        ").concat(f," sourceLocG = ").concat(f,"(").concat(d.join(),", 0);\n        ++").concat(d[c-2],";\n        ").concat(f," sourceLocA = ").concat(f,"(").concat(d.join(),", 0);\n        --").concat(d[c-1],";\n        ").concat(f," sourceLocB = ").concat(f,"(").concat(d.join(),", 0);\n        --").concat(d[c-2],";")}else u=c,s="\n        ".concat(h," sourceLocR = coords;\n        ++").concat(d[c-1],";\n        ").concat(h," sourceLocG = coords;\n        ++").concat(d[c-2],";\n        ").concat(h," sourceLocA = coords;\n        --").concat(d[c-1],";\n        ").concat(h," sourceLocB = coords;\n        --").concat(d[c-2],";");var p=["x","y","z","w","u","v"].slice(0,u),v="."+p[u-1],m=p.map((function(e){return"int "+e})),g=uq("sourceLocR",u-1).concat("inIdx.r"),y=uq("sourceLocG",u-1).concat("inIdx.g"),b=uq("sourceLocB",u-1).concat("inIdx.b"),x=uq("sourceLocA",u-1).concat("inIdx.a"),w="max"===r?"greaterThan":"lessThan",k=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),S="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),_=a?"":"\n      float getBestIndicesAChannel(".concat(m.join(),") {\n        return getChannel(getBestIndicesA(").concat(p.join(),"),\n                                          vec2(").concat(p.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(m.join(),") {\n        return getChannel(getA(").concat(p.join(),"),\n                               vec2(").concat(p.slice(-2).join(),"));\n      }\n      ").concat(_,"\n      void main() {\n        ").concat(h," coords = getOutputCoords();\n        bool hasNextCol = ").concat(d[c-1]," < ").concat(l[c-1]-1,";\n        bool hasNextRow = ").concat(d[c-2]," < ").concat(l[c-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(v,", sourceLocG").concat(v,",\n          sourceLocB").concat(v,", sourceLocA").concat(v,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(S,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(k,"\n          vec4 candidate = ").concat(S,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(w,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function FK(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=dC(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new PK(s,n,null==r),l=[t];null!=r&&l.push(r);var c=e.runWebGLProgram(u,l,"int32");if(1===c.shape[1])return c;var h=FK(e,t,n,c);return e.disposeIntermediateTensorInfo(c),h}function OK(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=dC(a[a.length-1]),o=new DK(a,i,n,null==r),s=null==r?[t]:[t,r],u=e.runWebGLProgram(o,s,"int32");if(u.shape.length===t.shape.length){var l=OK(e,t,n,u);return e.disposeIntermediateTensorInfo(u),l}return u}function zK(e,t,n,r){var a=[n];if(hT("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!Bg().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=x(lT(s.shape,a),2),l=u[0],c=lg(u[1]),h=iK({inputs:{x:s},backend:e,attrs:{shape:[-1,c]}});i.push(h);var d=FK(e,h,r);i.push(d);var f=iK({inputs:{x:d},backend:e,attrs:{shape:l}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),f}return OK(e,t,r)}var UK={kernelName:Qg,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=mg(r.axis,a.shape),o=dT(i,a.shape.length),s=a,u=[];null!=o&&(s=vK({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=pT(i.length,s.shape.length)),hT("argMax",[i[0]],s.shape.length);var l=zK(n,s,i[0],"max");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}};var BK={kernelName:$g,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=mg(r.axis,a.shape),o=dT(i,a.shape.length),s=a,u=[];null!=o&&(s=vK({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=pT(i.length,s.shape.length)),hT("argMin",[i[0]],s.shape.length);var l=zK(n,s,i[0],"min");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}},WK=Zq({opSnippet:mq+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),VK={kernelName:ey,backendName:"webgl",kernelFunc:WK},GK=Zq({opSnippet:mq+"return log(x + sqrt(x * x + 1.0));"}),HK={kernelName:ty,backendName:"webgl",kernelFunc:GK},jK=Zq({opSnippet:mq+"\n  return atan(x);\n"}),XK={kernelName:ny,backendName:"webgl",kernelFunc:jK},qK=Jq({opSnippet:Dq+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+Oq+"\n  return result;\n"}),KK={kernelName:ay,backendName:"webgl",kernelFunc:qK},YK=Zq({opSnippet:mq+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),ZK={kernelName:ry,backendName:"webgl",kernelFunc:YK},JK=M((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(E(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===n,m="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="0.0";if(v||(y="-1.0 / 1e-20"),r){this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(f,", ").concat(p,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(l,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(c,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(">="," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?m:g:"wR * ".concat(d," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var b="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(b="avgValue / max(count, 1.0)");var x=4*Math.floor(o/4),w=o%4,k="\n      if (".concat(v,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(f,", ").concat(p,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(l,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(c,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              getValue(batch, xR, xC + 3 * ").concat(c,", d)\n            );\n\n            ").concat(k,"\n          }\n\n          int xC = xCCorner + ").concat(x,";\n          if (").concat(1===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(2===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(3===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              initializationValue\n            );\n\n            ").concat(k,"\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}})),QK=M((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(E(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,l=t.strideWidth,c=t.dilationDepth,h=t.dilationHeight,d=t.dilationWidth,f=t.effectiveFilterDepth,p=t.effectiveFilterHeight,v=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,x="0.0";if(b||(x="-1.0 / 1e-20"),r){this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(l,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(f,";\n              wD += ").concat(c,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(p,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(v,";\n                  wC += ").concat(d,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(">="," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(p," * ").concat(v," +\n                      wR * ").concat(v," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(w="avgValue / max(count, 1.0)");var k=4*Math.floor(o/4),S=o%4,_="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(l,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(f,";\n            wD += ").concat(c,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(k,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(d,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(d,", ch)\n              );\n\n              ").concat(_,"\n            }\n\n            int xC = xCCorner + ").concat(k,";\n            if (").concat(1===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(2===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(3===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                initializationValue\n              );\n\n              ").concat(_,"\n            }\n          }\n        }\n        setOutput(").concat(w,");\n      }\n    ")}}));var $K={kernelName:iy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Sj(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;og(dE(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var l=nE(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&cg(l.inShape,l.outShape))return Uq({inputs:{x:a},backend:n});var c=new JK(l,"avg",!1);return n.runWebGLProgram(c,[a],"float32")}};var eY={kernelName:sy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,l=r.dataFormat,c=rE(a.shape,i,o,[1,1,1],s,u,l),h=new QK(c,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}},tY=M((function e(t){E(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=u-1-t.padInfo.top,h=l-1-t.padInfo.left,d=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(c,", ").concat(h,");\n      const float avgMultiplier = float(").concat(d,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(l,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),nY=M((function e(t){E(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,h=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,p=h-1-t.padInfo.front,v=d-1-t.padInfo.top,m=f-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(v,", ").concat(m,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(h,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(l,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(c,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var rY={kernelName:uy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,l=r.dimRoundingMode,c=rE(i.shape,o,s,[1,1,1],u,l),h=new nY(c);return n.runWebGLProgram(h,[a],i.dtype)}};var aY={kernelName:oy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Sj([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,l=r.pad,c=nE(o.shape,s,u,1,l),h=new tY(c);return n.runWebGLProgram(h,[a],o.dtype)}};var iY={kernelName:ly,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return yK({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},oY=M((function e(t,n,r,a,i,o){E(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],d_(t,n),d_(t,r);var s="0.0";null!=a&&(d_(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(d_(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),sY=M((function e(t,n,r,a,i,o){E(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],d_(t,n),d_(t,r);var s="vec4(0.0)";null!=a&&(d_(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(d_(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),uY={kernelName:eb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;og(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),og(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),og(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var l=r.varianceEpsilon;null==l&&(l=.001);var c=[a,i,o],h=null;null!=s&&(h=s.shape,c.push(s));var d=null;null!=u&&(d=u.shape,c.push(u));var f=Bg().getBool("WEBGL_PACK_NORMALIZATION")?new sY(a.shape,i.shape,o.shape,h,d,l):new oY(a.shape,i.shape,o.shape,h,d,l);return n.runWebGLProgram(f,c,c[0].dtype)}},lY=M((function e(t){E(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=Wj(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return cY.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(cY[t]," = start[").concat(t,"] + coords.").concat(cY[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),cY=["x","y","z","w","u","v"];var hY=M((function e(t){E(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=Wj(this.rank),r=uq("coords",this.rank),a=uq("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),l=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(l,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function dY(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=x(Y_(a,r.begin,r.size),2),o=i[0],s=i[1];if(j_(a,o,s),0===lg(s))return n.makeTensorInfo(s,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var u=n.texData.get(a.dataId),l=XX(u.values,o,s,a.shape,a.dtype);return n.makeTensorInfo(s,a.dtype,l)}var c=n.texData.get(a.dataId).isPacked,h=q_(a.shape,o,s);if(c||!h){var d=Bg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hY(s):new lY(s),f=[o];return n.runWebGLProgram(d,[a],a.dtype,f)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=K_(t,Mg(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,o,s,n)}var fY={kernelName:vx,backendName:"webgl",kernelFunc:dY},pY={kernelName:cy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;og(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=pC(a.shape,i,s),l=vC(u.length,i.length),c=mC(a.shape,i,s),h=gC(o,i.length),d=yC(c,o,i.length),f=[],p=iK({inputs:{x:a},backend:n,attrs:{shape:u}}),v=vK({inputs:{x:p},backend:n,attrs:{perm:l}}),m=iK({inputs:{x:v},backend:n,attrs:{shape:c}}),g=dY({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return f.push(p),f.push(v),f.push(m),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var vY={kernelName:hy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),l=pX(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}};var mY={kernelName:fy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=d_(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},gY=Jq({opSnippet:"return float(a != b);",cpuKernelImpl:FX,dtype:"bool"}),yY={kernelName:Ob,backendName:"webgl",kernelFunc:gY};function bY(e){var t=e.inputs,n=e.backend,r=t.input;return Uq({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var xY={kernelName:Qb,backendName:"webgl",kernelFunc:bY},wY="return float(int(x));";var kY={kernelName:py,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return Uq({inputs:{x:i},backend:r});var s=bT(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),l=Wq({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),l}if("complex64"===i.dtype){var c=bY({inputs:{input:i},backend:r}),h=e({inputs:{x:c},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(c),h}if(!xg(i.dtype,o)){var d=Uq({inputs:{x:i},backend:r});return{dataId:d.dataId,shape:d.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){var f=r.texData.get(i.dataId).values,p=x(mX(f,i.shape,i.dtype,o),3),v=p[0],m=p[1],g=p[2];return r.makeTensorInfo(v,m,g)}if("int32"===o)return function(e,t){var n=new vq(e.shape,wY),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var y=r.makeTensorInfo([],"bool",yg("bool",1)),b=gY({inputs:{a:i,b:y},backend:r});return r.disposeIntermediateTensorInfo(y),b}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},SY="return ceil(x);",_Y=Zq({opSnippet:SY,packedOpSnippet:SY,cpuKernelImpl:gX}),EY={kernelName:vy,backendName:"webgl",kernelFunc:_Y},TY=M((function e(t){E(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),MY=M((function e(t){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var CY={kernelName:my,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=Bg().getBool("WEBGL_PACK_CLIP")?new MY(i.shape):new TY(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},IY=M((function e(t){E(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function AY(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var RY={kernelName:yy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new IY(r.shape),o=[AY(r,a.complexTensorInfos.real),AY(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},NY=M((function e(t){E(this,e),this.outputShape=[],this.outputShape=cC(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),LY=M((function e(t,n){E(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=cC(t,n);var r=this.outputShape,a=r.length,i=Wj(a),o=uq("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var l=1;l<u.length;l++)u[l]=u[l-1]+t[l][n];for(var c=s[n],h=s.slice(-2),d=s.join(),f="if (".concat(c," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(d,"), vec2(").concat(h.join(),"));\n        }"),p=1;p<u.length;p++){var v=u[p-1];f+="\n        if (".concat(c," < ").concat(u[p],"  && ").concat(c," >= ").concat(u[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(PY(s,c,v),"),\n            vec2(").concat(PY(h,c,v),"));\n        }")}var m=u.length,g=u[u.length-1];f+="\n        return getChannel(\n          getT".concat(m,"(").concat(PY(s,c,g),"),\n          vec2(").concat(PY(h,c,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(f,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function PY(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function DY(e){var t=e.inputs,n=e.backend,r=t.input;return Uq({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var FY={kernelName:sb,backendName:"webgl",kernelFunc:DY};function OY(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return bY({inputs:{input:e},backend:n})})),i=e.map((function(e){return DY({inputs:{input:e},backend:n})})),o=OY(a,t,n),s=OY(i,t,n),u=Wq({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var l=n.shouldExecuteOnCPU(e);if("string"===r&&(l=!0),l){var c=e.map((function(e){var r=lg(e.shape.slice(t));return iK({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),h=c.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),d=cC(c.map((function(e){return e.shape})),1),f=1===c[0].shape[0],p=yX(h,d,r,f),v=cC(e.map((function(e){return e.shape})),t),m=n.makeTensorInfo(v,r,p);return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}var g=e.filter((function(e){return lg(e.shape)>0})),y=Bg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&g[0].shape.length>1;if(1===g.length){var b=y?new vq(e[0].shape,kq):new Iq(e[0].shape,kq);return n.runWebGLProgram(b,e,r)}var x=Bg().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(g.length>x){for(var w=[],k=0;k<g.length;k+=x){var S=g.slice(k,k+x);w.push(OY(S,t,n))}for(var _=OY(w,t,n),E=0,T=w;E<T.length;E++){var M=T[E];n.disposeIntermediateTensorInfo(M)}return _}if(y){var C=new LY(g.map((function(e){return e.shape})),t);return n.runWebGLProgram(C,g,r)}var I=function(e,t,n){var r=cC(e.map((function(e){return e.shape})),t),a=e.map((function(e){return iK({inputs:{x:e},attrs:{shape:[-1,lg(e.shape.slice(t))]},backend:n})}));return{tensors2D:a,outShape:r}}(g,t,n),A=I.tensors2D,R=I.outShape,N=new NY(A.map((function(e){return e.shape}))),L=n.runWebGLProgram(N,A,r);A.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var P=iK({inputs:{x:L},attrs:{shape:R},backend:n});return n.disposeIntermediateTensorInfo(L),P}function zY(e){var t=e.inputs,n=e.backend,r=mg(e.attrs.axis,t[0].shape)[0];lC(t.map((function(e){return e.shape})),r);var a=cC(t.map((function(e){return e.shape})),r);if(0===lg(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return lg(e.shape)>0}));return 1===i.length?Uq({inputs:{x:i[0]},backend:n}):OY(i,r,n)}var UY={kernelName:by,backendName:"webgl",kernelFunc:zY},BY=M((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];E(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,p=4*Math.floor(t.inChannels/4),v=t.inChannels%4,m="channelsLast"===t.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1,x="",w="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),w="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(l,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(c,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(h,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===v,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(p,") *\n                    getW(wR, wC, ").concat(p,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(p,", xR, xC) *\n                    getW(wR, wC, ").concat(p,", d2);\n              }\n\n            } else if (").concat(2===v,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===v,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2),\n                getW(wR, wC, ").concat(p," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1),\n                  getX(batch, xR, xC, ").concat(p," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC),\n                  getX(batch, ").concat(p," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(k,"\n        ").concat(w,"\n        setOutput(result);\n      }\n    ")})),WY=M((function e(t){E(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,h=t.filterDepth,d=t.filterHeight,f=t.filterWidth,p=4*Math.floor(t.inChannels/4),v=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(d,"; wR++) {\n            int xR = xRCorner + wR * ").concat(l,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,"; wC++) {\n              int xC = xCCorner + wC * ").concat(c,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===v,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(p,") *\n                  getW(wF, wR, wC, ").concat(p,", d2);\n              } else if (").concat(2===v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1),\n                  getX(batch, xF, xR, xC, ").concat(p," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2),\n                  getW(wF, wR, wC, ").concat(p," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),VY=M((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];E(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Kj(this.outputShape.length);for(var o=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,h=c,d="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",f=0;f<c;f++)d+="\n           vec4 xTexelC".concat(2*f,";\n           int xTexelC").concat(2*f,"Ready;\n           vec4 xTexelC").concat(2*f+1,";\n           int xTexelC").concat(2*f+1,"Ready;\n           vec4 xC").concat(f,";");d+="\n     for (int r = 0; r < ".concat(l,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var p=0;p<c;p++)d+="\n           xTexelC".concat(2*p," = vec4(0.0);\n           xTexelC").concat(2*p,"Ready = 0;\n           xTexelC").concat(2*p+1," = vec4(0.0);\n           xTexelC").concat(2*p+1,"Ready = 0;\n           xC").concat(p," = vec4(0.0);");d+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var v=0;v<(h+1)/2;v++){var m=2*v;if(d+="\n           xC = xCCorner + ".concat(m*u,";\n           "),1===s){if(m<c&&(o%2===1?(d+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(m,"Ready == 0) {\n                   xTexelC").concat(m," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(m,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(m,"Ready = 1;\n                 }\n               "),d+=1===u&&m>0?"\n                 xC".concat(m," = vec4(xTexelC").concat(m-2,".zw, xTexelC").concat(m,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(m," = vec4(previous.zw, xTexelC").concat(m,".xy);\n                   } else {\n                     xC").concat(m," = vec4(0.0, 0.0, xTexelC").concat(m,".xy);\n                   }\n                   ")):d+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(m,"Ready == 0) {\n                   xTexelC").concat(m," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(m,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(m,"Ready = 1;\n                 }\n\n                 xC").concat(m," = xTexelC").concat(m,";\n                 "),m+1<c)){var g=o%2===0?rg(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(d+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(g,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(m+1,"Ready == 0) {\n                     xTexelC").concat(m+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(m+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(m+1,"Ready = 1;\n                   }\n                   "),d+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(m+1," = vec4(previous.zw, xTexelC").concat(m+1,".xy);\n                     } else {\n                      xC").concat(m+1," = vec4(0.0, 0.0, xTexelC").concat(m+1,".xy);\n                     }\n                     "):"\n                     xC".concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,".xy);\n                     ")):d+=1===g?"\n                     xC".concat(m+1," = xTexelC").concat(m,";\n                     "):"\n                     xCOffset = xC + ".concat(g,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(m+1,"Ready == 0) {\n                       xTexelC").concat(m+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(m+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(m+1,"Ready = 1;\n                     }\n\n                     xC").concat(m+1," = xTexelC").concat(m+1,";\n                     ")}}else m<c&&(o%2===1?(d+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(m,"Ready == 0) {\n                   xTexelC").concat(m," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(m,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(m,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(m+1,"Ready == 0) {\n                   xTexelC").concat(m+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(m+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(m+1,"Ready = 1;\n                 }\n\n                 xC").concat(m," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,".zw);\n               "),m+1<c&&(d+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(m+1," = vec4(xTexelC").concat(m+1,".xy, final.xy);\n                 "))):(d+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(m,"Ready == 0) {\n                   xTexelC").concat(m," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(m,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(m,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(m+1,"Ready == 0) {\n                   xTexelC").concat(m+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(m+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(m+1,"Ready = 1;\n                 }\n\n                 xC").concat(m," = vec4(\n                   xTexelC").concat(m,".xy, xTexelC").concat(m+1,".xy);\n               "),m+1<c&&(d+="\n                   xC".concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,".zw);\n                 "))));m<c&&(d+="\n             wTexel = getW(r, ".concat(m,", d1, d2);\n             dotProd += xC").concat(m,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(m,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),m+1<c&&(d+="\n               wTexel = getW(r, ".concat(m+1,", d1, d2);\n               dotProd += xC").concat(m+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(m+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}d+="\n     }\n   ",d+="\n     }\n   ",d+="\n     }\n   ";var y="",b="";r&&(y=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),b="result = activation(result);");var x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(y,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(d,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(x,"\n         ").concat(b,"\n         setOutput(result);\n       }\n     ")})),GY=M((function e(t,n){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Kj(this.outputShape.length);for(var r=n.dataFormat,a=Ej(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),l="",c=0;c<=1;c++)for(var h=0;h<=1;h++)l+="\n          blockIndex = rc.z + ".concat(h,";\n          pos = rc.y + ").concat(c,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*c+h,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*c+h,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(l,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function HY(e,t){var n=e.length;return n>=3?[].concat(g(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function jY(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,l=void 0===u?null:u,c=e.leakyreluAlpha,h=void 0===c?0:c,d=e.activation,f=void 0===d?null:d,p=n.shape,v=i.texData.get(n.dataId),m=a.inChannels,g=p[0]*p[1]*p[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(null!=l){var w=HY(l.shape,b);null!=w&&(l=iK({inputs:{x:l},backend:i,attrs:{shape:w}}),x.push(l))}if(null!=s){var k=HY(s.shape,b);null!=k&&(s=iK({inputs:{x:s},backend:i,attrs:{shape:k}}),x.push(s))}if(!((1===g||1===y)&&m>gK)&&v.isPacked&&b&&null!=v.texture&&p[2]%2!==0&&cg(v.shape.slice(-3),p.slice(-3))){var S=p[0]*p[1]*(p[2]+1),_={dataId:n.dataId,shape:[1,S,a.inChannels],dtype:n.dtype},E=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,og(yj(v.shape,_.shape),(function(){return"packed reshape ".concat(v.shape," to ").concat(_.shape," isn't free")}));var T=iK({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(T);var M=yK({a:_,b:T,backend:i,transposeA:!1,transposeB:false,bias:s,activation:f,preluActivationWeights:l,leakyreluAlpha:h}),C=i.texData.get(M.dataId);og(C.isPacked,(function(){return"batchMatMul result is expected to be packed"})),v.shape=E,C.shape=a.outShape,(t=Uq({inputs:{x:M},backend:i})).shape=a.outShape,x.push(M)}else{var I=a.outHeight*a.outWidth,A=iK({inputs:{x:n},backend:i,attrs:{shape:b?[a.batchSize,I,a.inChannels]:[a.batchSize,a.inChannels,I]}}),R=iK({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),N=yK({a:b?A:R,b:b?R:A,transposeA:!b,transposeB:false,backend:i,bias:s,activation:f,preluActivationWeights:l,leakyreluAlpha:h});t=iK({inputs:{x:N},backend:i,attrs:{shape:a.outShape}}),x.push(A),x.push(R),x.push(N)}for(var L=0,P=x;L<P.length;L++){var D=P[L];i.disposeIntermediateTensorInfo(D)}return t}function XY(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,l=e.leakyreluAlpha,c=void 0===l?0:l,h=e.activation,d=void 0===h?null:h,f=r.filterWidth,p=r.filterHeight,v=r.inChannels,m=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=f*p*v,x=g*m,w=[r.batchSize,b,x],k=[];if(null!=u){var S=HY(u.shape,y);null!=S&&(u=iK({inputs:{x:u},backend:a,attrs:{shape:S}}),k.push(u))}if(null!=o){var _=HY(o.shape,y);null!=_&&(o=iK({inputs:{x:o},backend:a,attrs:{shape:_}}),k.push(o))}var E=iK({inputs:{x:n},backend:a,attrs:{shape:[1,b,lg(n.shape)/b]}});k.push(E);var T=new GY(w,r),M=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],C=a.runWebGLProgram(T,[t],"float32",M),I=iK({inputs:{x:C},backend:a,attrs:{shape:w}});k.push(C),k.push(I);var A=null!=o,R=null!=u,N="leakyrelu"===d,L=d?Qq(d,!0):null,P=new $q(y?I.shape:E.shape,y?E.shape:I.shape,y?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,A,L,R,N),D=y?[I,E]:[E,I];if(o&&D.push(o),R&&D.push(u),N){var F=a.makeTensorInfo([],"float32",_w(c,"float32"));D.push(F),k.push(F)}var O=a.runWebGLProgram(P,D,"float32"),z=iK({inputs:{x:O},backend:a,attrs:{shape:r.outShape}});k.push(O);for(var U=0,B=k;U<B.length;U++){var W=B[U];a.disposeIntermediateTensorInfo(W)}return z}var qY={kernelName:xy,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,l=a.dataFormat,c=a.dilations,h=a.dimRoundingMode,d=pE(l),f=aE(i.shape,o.shape,s,c,u,h,!1,d);if(1!==f.filterHeight||1!==f.filterWidth||1!==f.dilationHeight||1!==f.dilationWidth||1!==f.strideHeight||1!==f.strideWidth||"SAME"!==f.padInfo.type&&"VALID"!==f.padInfo.type)if(f.strideWidth<=2&&"channelsLast"===d&&Bg().getBool("WEBGL_EXP_CONV")){var p=new VY(f),v=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];t=r.runWebGLProgram(p,[i,o],"float32",v)}else if(Bg().getBool("WEBGL_CONV_IM2COL"))t=XY({x:i,filter:o,convInfo:f,backend:r});else{var m=new BY(f);t=r.runWebGLProgram(m,[i,o],"float32")}else t=jY({x:i,filter:o,convInfo:f,backend:r});var g=iK({inputs:{x:t},backend:r,attrs:{shape:f.outShape}});return r.disposeIntermediateTensorInfo(t),g}},KY=M((function e(t){E(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              ").concat(o?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),YY=M((function e(t){E(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,l=o?1:2,c=o?2:3,h=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(h,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(l,"], coords[").concat(c,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),ZY=M((function e(t){E(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),JY=M((function e(t){E(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,l=r-1-t.padInfo.top,c=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(l,", ").concat(c,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var QY={kernelName:wy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=r.filterShape,h=pE(u),d=aE(a.shape,c,o,1,s,l,!1,h),f=new KY(d);return n.runWebGLProgram(f,[a,i],"float32")}},$Y=M((function e(t){E(this,e),this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=Kj(this.outputShape.length);var n=t.filterHeight,r=t.filterWidth,a=n-1-t.padInfo.top,i=r-1-t.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(t.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(t.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}));var eZ={kernelName:ky,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,l=r.dataFormat,c=r.dimRoundingMode,h=pE(l),d=aE(o,i.shape,s,1,u,c,!1,h);if(Bg().getBool("WEBGL_PACK")&&"channelsLast"===h){var f=[[d.strideHeight,d.strideWidth]],p=new $Y(d);return n.runWebGLProgram(p,[a,i],"float32",f)}var v=new YY(d);return n.runWebGLProgram(v,[a,i],"float32")}};var tZ={kernelName:Sy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,l=iE(a.shape,i.shape,o,u,s),c=new WY(l);return n.runWebGLProgram(c,[a,i],"float32")}};var nZ={kernelName:_y,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,l=iE(a.shape,u,o,1,s),c=new ZY(l);return n.runWebGLProgram(c,[a,i],"float32")}};var rZ,aZ={kernelName:Ey,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=iE(r.inputShape,i.shape,s,1,o),l=new JY(u);return n.runWebGLProgram(l,[a,i],"float32")}},iZ=Zq({opSnippet:Yq+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(Oq,"\n  return result;\n")}),oZ={kernelName:Ty,backendName:"webgl",kernelFunc:iZ},sZ=Zq({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),uZ={kernelName:My,backendName:"webgl",kernelFunc:sZ},lZ=M((function e(t,n,r,a,i){E(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=x(t,4),s=o[0],u=o[1],l=o[2],c=o[3],h=x(n,1)[0],d=x(r,2),f=d[0],p=d[1];this.outputShape=[h,f,p,c];var v="bilinear"===a?1:0,m="".concat(u-1,".0"),g="".concat(l-1,".0"),y=x(f>1?["".concat((u-1)/(f-1)),"(y2-y1) * height_ratio","y1*".concat(m," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(m)],3),b=y[0],w=y[1],k=y[2],S=x(p>1?["".concat((l-1)/(p-1)),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(g)],3),_=S[0],T=S[1],M=S[2];this.userCode="\n      const float height_ratio = float(".concat(b,");\n      const float width_ratio = float(").concat(_,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(w,";\n        float width_scale = ").concat(T,";\n\n        float in_y = ").concat(k,";\n        if( in_y < 0.0 || in_y > ").concat(m," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(M,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(v," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),cZ={kernelName:Ay,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,l=r.extrapolationValue,c=new lZ(a.shape,i.shape,s,u,l);return n.runWebGLProgram(c,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(rZ||(rZ={}));var hZ=M((function e(t,n,r,a){E(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===rZ.Prod?"1.0":"0.0",s=r?o:"getX(".concat(dZ(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],l="",c="";r?(l=a?"end != ".concat(u-1):"end != 0",c=a?"end + 1":"end - 1"):(l=a?"end + pow2 < ".concat(u):"end >= pow2",c=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(Wj(i)," coords = getOutputCoords();\n        int end = ").concat(fZ(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(l,") {\n          int idx = ").concat(c,";\n          ").concat(fZ(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(dZ(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function dZ(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function fZ(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function pZ(e,t,n,r,a,i){var o=t.shape.length,s=dT([r],o),u=t;null!=s&&(u=vK({inputs:{x:t},backend:n,attrs:{perm:s}}));var l=pT(1,o)[0];if(l!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));for(var c=u.shape[l],h=Uq({inputs:{x:u},backend:n}),d=0;d<=Math.ceil(Math.log2(c))-1;d++){var f=new hZ(e,u.shape,!1,i),p=[[d]],v=h;h=n.runWebGLProgram(f,[h],h.dtype,p),n.disposeIntermediateTensorInfo(v)}if(a){var m=new hZ(e,u.shape,a,i),g=h;h=n.runWebGLProgram(m,[h],h.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=s){var y=vK({inputs:{x:h},backend:n,attrs:{perm:fT(s)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(u),y}return h}var vZ={kernelName:Cy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return pZ(rZ.Prod,a,n,i,o,s)}};var mZ={kernelName:Iy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return pZ(rZ.Sum,a,n,i,o,s)}};var gZ={kernelName:Ry,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),l=n.readSync(i.dataId),c=pX(u,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}if(2===a.shape.length){var h=n.bufferSync(a),d=n.bufferSync(i),f=vX(h,d,o,s);return n.makeTensorInfo(f.shape,i.dtype,f.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}},yZ=function(){function e(t,n,r){E(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return M(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var bZ={kernelName:Ny,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,l=("NHWC"===o?a.shape[2]:a.shape[3])*i,c=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),h=new yZ("NHWC"===o?[s,u,l,c]:[s,c,u,l],i,o);return n.runWebGLProgram(h,[a],a.dtype)}},xZ=M((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];E(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Kj(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,l="",c="";r&&(l=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),c="result = activation(result);");var h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(l,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(h,"\n        ").concat(c,"\n        setOutput(result);\n      }\n    ")})),wZ=M((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];E(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Kj(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,l=t.dilationWidth,c=t.filterHeight,h=t.filterWidth,d=h,f="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",p=0;p<h;p++)f+="\n          vec4 xTexelC".concat(2*p,";\n          int xTexelC").concat(2*p,"Ready;\n          vec4 xTexelC").concat(2*p+1,";\n          int xTexelC").concat(2*p+1,"Ready;\n          vec4 xC").concat(p,";");f+="\n    for (int r = 0; r < ".concat(c,"; r++) {\n      ");for(var v=0;v<h;v++)f+="\n          xTexelC".concat(2*v," = vec4(0.0);\n          xTexelC").concat(2*v,"Ready = 0;\n          xTexelC").concat(2*v+1," = vec4(0.0);\n          xTexelC").concat(2*v+1,"Ready = 0;\n          xC").concat(v," = vec4(0.0);");f+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var m=0;m<(d+1)/2;m++){var g=2*m;if(f+="\n          xC = xCCorner + ".concat(g*l,";\n          "),1===u){if(g<h&&(s%2===1?(f+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n              "),f+=1===l&&g>0?"\n                xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                  } else {\n                    xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                  }\n                  ")):f+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xC").concat(g," = xTexelC").concat(g,";\n                "),g+1<h)){var y=s%2===0?rg(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(f+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                    xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(g+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(g+1,"Ready = 1;\n                  }\n                  "),f+=l>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(g+1," = vec4(previous.zw, xTexelC").concat(g+1,".xy);\n                    } else {\n                     xC").concat(g+1," = vec4(0.0, 0.0, xTexelC").concat(g+1,".xy);\n                    }\n                    "):"\n                    xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                    ")):f+=1===y?"\n                    xC".concat(g+1," = xTexelC").concat(g,";\n                    "):"\n                    xCOffset = xC + ".concat(y,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                      xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(g+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(g+1,"Ready = 1;\n                    }\n\n                    xC").concat(g+1," = xTexelC").concat(g+1,";\n                    ")}}else g<h&&(s%2===1?(f+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n              "),g+1<h&&(f+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                "))):(f+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(\n                  xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n              "),g+1<h&&(f+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                "))));g<h&&(f+="\n            wTexel = getW(r, ".concat(g,", d1, q);\n            dotProd += xC").concat(g," * vec4(wTexel.xz, wTexel.xz);\n          "),g+1<h&&(f+="\n              wTexel = getW(r, ".concat(g+1,", d1, q);\n              dotProd += xC").concat(g+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}f+="\n    }\n  ",f+="\n      }\n    ";var b="",x="";r&&(b=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),x="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(b,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(f,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(w,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")}));var kZ={kernelName:Ly,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,l=r.dimRoundingMode,c=u;null==c&&(c=[1,1]),og(dE(o,c),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(c,"'")}));var h,d=aE(a.shape,i.shape,o,c,s,l,!0);h=Bg().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?new wZ(d):new xZ(d);var f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(h,[a,i],"float32",f)}},SZ=M((function e(t){E(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),_Z=M((function e(t){E(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var EZ={kernelName:Py,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,l=r.dimRoundingMode,c=r.filterShape,h=aE(a.shape,c,o,s,u,l,!0),d=new SZ(h);return n.runWebGLProgram(d,[a,i],"float32")}};var TZ={kernelName:Dy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,l=r.dimRoundingMode,c=aE(r.inputShape,i.shape,o,s,u,l,!0),h=new _Z(c);return n.runWebGLProgram(h,[a,i],"float32")}},MZ=M((function e(t){E(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var CZ={kernelName:Fy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(g(r.shape),g(r.shape)),i=lg(r.shape),o=iK({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new MZ(i),u=n.runWebGLProgram(s,[o],o.dtype),l=iK({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),l}},IZ=M((function e(t){E(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,l=t.dilationHeight,c=t.dilationWidth,h=a.top,d=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(h,", ").concat(d,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(l,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(c,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var AZ={kernelName:Oy,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,l=a.dilations,c=tE(i.shape,o.shape,s,u,"NHWC",l),h=new IZ(c),d=iK({inputs:{x:t=r.runWebGLProgram(h,[i,o],"float32")},backend:r,attrs:{shape:c.outShape}});return r.disposeIntermediateTensorInfo(t),d}};var RZ={kernelName:Wy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=OC(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;UC(i.length,s,r);for(var u=BC(o,s),l=u.path,c=u.steps,h=c.length,d=null,f=i.length,p=[],v=0;v<h;++v){var m,g=N(c[v]);try{for(g.s();!(m=g.n()).done;){var y=m.value,b=zC(f,s[y]),x=b.permutationIndices,w=b.expandDims,k=void 0;WC(x)?k=r[y]:(k=vK({inputs:{x:r[y]},backend:n,attrs:{perm:x}}),p.push(k));for(var S=k.shape.slice(),_=0;_<w.length;++_)S.splice(w[_],0,1);cg(k.shape,S)||(k=iK({inputs:{x:k},backend:n,attrs:{shape:S}}),p.push(k)),null===d?d=k:(d=rK({inputs:{a:k,b:d},backend:n}),p.push(d))}}catch(R0){g.e(R0)}finally{g.f()}v<h-1&&(l[v]>=0&&(d=fK({inputs:{x:d},backend:n,attrs:{axis:l[v]-(i.length-f),keepDims:!1}}),p.push(d)),f--)}for(var E=0,T=p;E<T.length;E++){var M=T[E];M!==d&&n.disposeIntermediateTensorInfo(M)}return d}},NZ=Zq({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),LZ={kernelName:Vy,backendName:"webgl",kernelFunc:NZ},PZ={kernelName:Gy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=Bg().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zq("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new Fq("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},DZ=Jq({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:bX}),FZ={kernelName:jy,backendName:"webgl",kernelFunc:DZ},OZ=Zq({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(SC,";\n  float a1 = ").concat(_C,";\n  float a2 = ").concat(EC,";\n  float a3 = ").concat(TC,";\n  float a4 = ").concat(MC,";\n  float a5 = ").concat(CC,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),zZ={kernelName:Hy,backendName:"webgl",kernelFunc:OZ},UZ=Zq({opSnippet:Yq+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:xX,dtype:"float32"}),BZ={kernelName:Xy,backendName:"webgl",kernelFunc:UZ};function WZ(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(og(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),iK({inputs:{x:i},backend:r,attrs:{shape:s}})}var VZ={kernelName:qy,backendName:"webgl",kernelFunc:WZ},GZ="return exp(x) - 1.0;",HZ=Zq({opSnippet:GZ,packedOpSnippet:GZ,cpuKernelImpl:wX}),jZ={kernelName:Ky,backendName:"webgl",kernelFunc:HZ},XZ=M((function e(t,n,r){E(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function qZ(e,t,n){var r=n.texData.get(e.dataId),a=lg(e.shape),i=e.shape[e.shape.length-1],o=iK({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new XZ("real",s,t),l=new XZ("imag",s,t),c=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],h=n.runWebGLProgram(u,c,"float32"),d=n.runWebGLProgram(l,c,"float32"),f=Wq({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);var p=iK({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(f),p}var KZ={kernelName:Yy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return qZ(t.input,!1,n)}},YZ=M((function e(t,n){E(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function ZZ(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||_g(a))){var o=bg(i,lg(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new YZ(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var JZ,QZ={kernelName:Zy,backendName:"webgl",kernelFunc:ZZ},$Z=M((function e(t){E(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),eJ={kernelName:Jy,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new $Z(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},tJ="return floor(x);",nJ=Zq({opSnippet:tJ,packedOpSnippet:tJ,cpuKernelImpl:kX}),rJ={kernelName:Qy,backendName:"webgl",kernelFunc:nJ},aJ=Jq({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),iJ={kernelName:$y,backendName:"webgl",kernelFunc:aJ},oJ=M((function e(t){E(this,e),this.variableNames=["A"];var n=Ej(),r=x(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),sJ=M((function e(t){E(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Ej(),r=x(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),uJ={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,u=x(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),l=u[0],c=u[1],h=[c,l],d=[c,l,i];if(s||o){var f=Bg().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=JZ&&f===lJ||(lJ=f,JZ=document.createElement("canvas").getContext("2d",{willReadFrequently:lJ})),JZ.canvas.width=l,JZ.canvas.height=c,JZ.drawImage(a,0,0,l,c),a=JZ.canvas}var p=n.makeTensorInfo(h,"int32");n.texData.get(p.dataId).usage=HH.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);var v=Bg().getBool("WEBGL_PACK")?new sJ(d):new oJ(d),m=n.runWebGLProgram(v,[p],"int32");return n.disposeData(p.dataId),m}},lJ=Bg().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var cJ={kernelName:Qx,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,l=a.strides,c=a.pad,h=a.dataFormat,d=a.dilations,f=a.dimRoundingMode,p=a.activation,v=a.leakyreluAlpha,m=pE(h),g=aE(i.shape,o.shape,l,d,c,f,!1,m),y=[],b=null!=s,x=null!=u,w="leakyrelu"===p,k=function(){var e=[i,o],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=iK({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&e.push(t(s,h)),x&&e.push(t(u,h)),w){var n=r.makeTensorInfo([],"float32",_w(v,"float32"));e.push(n),y.push(n)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===m&&Bg().getBool("WEBGL_EXP_CONV")){var S=p?Qq(p,!0):null,_=new VY(g,b,S,x,w),E=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=k();t=r.runWebGLProgram(_,T,"float32",E)}else if(Bg().getBool("WEBGL_CONV_IM2COL"))t=XY({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:p,preluActivationWeights:u,leakyreluAlpha:v});else{var M=p?Qq(p,!1):null,C=new BY(g,b,M,x,w),I=k();t=r.runWebGLProgram(C,I,"float32")}else t=jY({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:p,preluActivationWeights:u,leakyreluAlpha:v});var A=iK({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),A}};var hJ={kernelName:$x,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,l=r.pad,c=r.dilations,h=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,p=[],v=c;null==v&&(v=[1,1]),og(dE(u,v),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(v,"'")}));var m,g=aE(a.shape,i.shape,u,v,l,h,!0),y=Bg().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=d?Qq(d,y):null,x=[a,i],w=null!=o,k=null!=s,S="leakyrelu"===d;if(w&&x.push(o),k&&x.push(s),S){var _=n.makeTensorInfo([],"float32",_w(f,"float32"));x.push(_),p.push(_)}m=y?new wZ(g,w,b,k,S):new xZ(g,w,b,k,S);var E=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=n.runWebGLProgram(m,x,"float32",E);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),T}},dJ=M((function e(t,n,r,a){E(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=Wj(r.length),o="\n    int index;",s=0;s<this.sliceDim;s++)o+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(o,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var fJ={kernelName:nb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=lg(r.shape),u=x(bC(r,a),4),l=u[0],c=u[1],h=u[2],d=u[3],f=iK({inputs:{x:a},backend:n,attrs:{shape:[c,o]}}),p=iK({inputs:{x:r},backend:n,attrs:{shape:[lg(r.shape)/h,h]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var v=n.readSync(a.dataId),m=n.bufferSync(r),g=SX(v,m,r.dtype,c,o,h,d,r.shape,s);return n.makeTensorInfo(l,r.dtype,g.values)}var y=new dJ(o,d,[c,h],r.shape),b=n.runWebGLProgram(y,[p,f],p.dtype),w=iK({inputs:{x:b},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(b),w}},pJ=M((function e(t,n){E(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=Wj(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function vJ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=mg(o,a.shape)[0];if(Bg().get("DEBUG"))for(var l=n.readSync(i.dataId),c=a.shape[u],h=function(){var e=l[d];og(e<=c-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(c-1,"]")}))},d=0;d<l.length;++d)h();var f=qC(a,i,u,s),p=lg(i.shape),v=[],m=iK({inputs:{x:a},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),g=iK({inputs:{x:i},backend:n,attrs:{shape:[f.batchSize,p/f.batchSize]}});v.push(m),v.push(g);var y=[f.batchSize,f.outerSize,p/f.batchSize,f.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var b=n.bufferSync(g),x=n.bufferSync(m),w=_X(x,b,y);return v.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(f.outputShape,w.dtype,w.values)}var k=new pJ(m.shape,y),S=n.runWebGLProgram(k,[m,g],m.dtype);v.push(S);var _=iK({inputs:{x:S},backend:n,attrs:{shape:f.outputShape}});return v.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),_}var mJ={kernelName:tb,backendName:"webgl",kernelFunc:vJ},gJ=Jq({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:EX,dtype:"bool"}),yJ={kernelName:rb,backendName:"webgl",kernelFunc:gJ},bJ=Jq({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:TX}),xJ={kernelName:ab,backendName:"webgl",kernelFunc:bJ};var wJ={kernelName:ob,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return qZ(t.input,!0,n)}},kJ=Zq({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),SJ={kernelName:ub,backendName:"webgl",kernelFunc:kJ},_J=Zq({opSnippet:"return float(isinf(x));",dtype:"bool"}),EJ={kernelName:lb,backendName:"webgl",kernelFunc:_J},TJ=Zq({opSnippet:"return float(isnan(x));",dtype:"bool"}),MJ={kernelName:cb,backendName:"webgl",kernelFunc:TJ},CJ=Jq({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:MX,dtype:"bool"}),IJ={kernelName:db,backendName:"webgl",kernelFunc:CJ},AJ=Jq({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:CX,dtype:"bool"}),RJ={kernelName:fb,backendName:"webgl",kernelFunc:AJ};var NJ={kernelName:pb,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=IX(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},LJ=Zq({opSnippet:Yq+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:AX}),PJ={kernelName:vb,backendName:"webgl",kernelFunc:LJ},DJ=Zq({opSnippet:Yq+"\n  return log(1.0 + x);\n"}),FJ={kernelName:mb,backendName:"webgl",kernelFunc:DJ},OJ=Jq({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),zJ={kernelName:gb,backendName:"webgl",kernelFunc:OJ},UJ=Zq({opSnippet:"return float(!(x >= 1.0));"}),BJ={kernelName:yb,backendName:"webgl",kernelFunc:UJ},WJ=Jq({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),VJ={kernelName:bb,backendName:"webgl",kernelFunc:WJ},GJ=M((function e(t,n,r,a,i){E(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var l="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(l,")"):1===i?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")})),HJ=M((function e(t,n,r,a,i){E(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var l="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(l,")"):1===i?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")})),jJ={kernelName:xb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,l=Bg().getBool("WEBGL_PACK_NORMALIZATION")?new HJ(a.shape,i,o,s,u):new GJ(a.shape,i,o,s,u);return n.runWebGLProgram(l,[a],a.dtype)}},XJ=M((function e(t,n,r,a,i){E(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),qJ={kernelName:wb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,l=r.alpha,c=r.beta,h=new XJ(a.shape,s,u,l,c);return n.runWebGLProgram(h,[a,i,o],a.dtype)}};function KJ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=mg(i,a.shape),l=u,c=dT(l,s),h=null!=c,d=n.shouldExecuteOnCPU([a]),f=a;if(h){if(d){for(var p=n.texData.get(f.dataId).values,v=new Array(s),m=0;m<v.length;m++)v[m]=a.shape[c[m]];var g=iq(p,a.shape,a.dtype,c,v);f=n.makeTensorInfo(v,a.dtype),n.texData.get(f.dataId).values=g}else f=dK(a,c,n);l=pT(l.length,s)}hT("max",l,s);var y,b=x(lT(f.shape,l),2),w=b[0],k=b[1],S=w;if(o&&(S=cT(w,u)),d){var _=n.texData.get(f.dataId).values,E=RX(_,lg(k),S,a.dtype);y=n.makeTensorInfo(S,a.dtype),n.texData.get(y.dataId).values=E}else y=function(e,t,n,r){var a=lg(t),i=iK({inputs:{x:e},attrs:{shape:[lg(e.shape)/a,a]},backend:r}),o=lK(i,e.dtype,"max",r),s=iK({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(f,k,S,n);return h&&n.disposeIntermediateTensorInfo(f),y}var YJ={kernelName:kb,backendName:"webgl",kernelFunc:KJ},ZJ=Jq({opSnippet:Dq+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+Oq+"\n  return result;\n",cpuKernelImpl:NX}),JJ={kernelName:Sb,backendName:"webgl",kernelFunc:ZJ};var QJ={kernelName:_b,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Sj(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;og(dE(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var l=nE(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&cg(l.inShape,l.outShape))return Uq({inputs:{x:a},backend:n});var c=new JK(l,"max",!1);return n.runWebGLProgram(c,[a],a.dtype)}};var $J={kernelName:Tb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,l=r.dimRoundingMode,c=rE(a.shape,i,o,[1,1,1],s,l,u),h=new QK(c,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}},eQ=M((function e(t){E(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,l=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(l," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),tQ=M((function e(t){E(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,c=t.effectiveFilterWidth,h=u-1-t.padInfo.front,d=l-1-t.padInfo.top,f=c-1-t.padInfo.left,p=u*l*c-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(d,", ").concat(f,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(l,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(c,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(p," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(l," * ").concat(c," +\n                  wR * ").concat(c," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var nQ={kernelName:Mb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,l=r.dimRoundingMode,c=rE(i.shape,o,s,[1,1,1],u,l),h=new QK(c,"max",!0),d=n.runWebGLProgram(h,[i],i.dtype),f=new tQ(c),p=n.runWebGLProgram(f,[a,d],i.dtype);return n.disposeIntermediateTensorInfo(d),p}};var rQ={kernelName:Eb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Sj([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,l=r.pad,c=r.dimRoundingMode,h=nE(o.shape,s,u,1,l,c),d=new JK(h,"max",!0),f=n.runWebGLProgram(d,[o],o.dtype),p=new eQ(h),v=n.runWebGLProgram(p,[a,f],o.dtype);return n.disposeIntermediateTensorInfo(f),v}};var aQ={kernelName:Cb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,l=r;og(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var c=[1,1];og(dE(o,c),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")}));var h=nE(a.shape,i,o,c,s),d=function(e,t,n,r){var a=new JK(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new JK(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,h,l),f=x(d,2);return[f[0],f[1]]}};var iQ={kernelName:Ib,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,l=mg(o,a.shape),c=l,h=dT(c,u),d=null!=h,f=s.shouldExecuteOnCPU([a]),p=[],v=a;if(d){if(f){for(var m=s.texData.get(v.dataId).values,g=new Array(u),y=0;y<g.length;y++)g[y]=a.shape[h[y]];var b=iq(m,a.shape,a.dtype,h,g);v=s.makeTensorInfo(g,a.dtype),s.texData.get(v.dataId).values=b}else v=dK(a,h,s);p.push(v),c=pT(c.length,u)}hT("sum",c,u);var w=x(lT(v.shape,c),2),k=w[0],S=w[1],_=k;i&&(_=cT(k,l));for(var E=function(e,t,n,r){var a=lg(t),i=iK({inputs:{x:e},attrs:{shape:[lg(e.shape)/a,a]},backend:r}),o=lK(i,"float32","mean",r),s=iK({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(v,S,_,s),T=0,M=p;T<M.length;T++){var C=M[T];s.disposeIntermediateTensorInfo(C)}return E}};var oQ={kernelName:Ab,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=mg(i,a.shape),l=u,c=dT(l,s),h=a;null!=c&&(h=vK({inputs:{x:a},backend:n,attrs:{perm:c}}),l=pT(l.length,a.shape.length)),hT("min",l,s);var d,f=x(lT(h.shape,l),2),p=f[0],v=iK({inputs:{x:h},backend:n,attrs:{shape:[-1,lg(f[1])]}}),m=lK(v,v.dtype,"min",n);return d=iK(o?{inputs:{x:m},backend:n,attrs:{shape:cT(p,u)}}:{inputs:{x:m},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(h),d}},sQ=Jq({opSnippet:Dq+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+Oq+"\n  return result;\n",cpuKernelImpl:LX}),uQ={kernelName:Rb,backendName:"webgl",kernelFunc:sQ},lQ=M((function e(t,n,r){E(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=Wj(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),l="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(l,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(l,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(l,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(l,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),cQ=M((function e(t,n,r){E(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=Wj(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=uq("rc",a),l=uq("source",a),c="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(l.slice(-2).join(),")"),d="reflect"===r?0:1,f="";if(1===a){var p="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(d,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(d,";\n        }\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(p,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(c,") {\n          ").concat(p,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(h,");\n        }\n      ")}else{var v="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(d,") +\n                gte * ((end - 1) * 2 - source + ").concat(d,");\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(v,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(c,") {\n          ").concat(v,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(h,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(v,"\n          result[2] = getChannel(getX(").concat(l.join(),"), ").concat(h,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(c,") {\n            ").concat(v,"\n            result[3] = getChannel(getX(").concat(l.join(),"), ").concat(h,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),hQ={kernelName:Nb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=Bg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cQ(a.shape,i,o):new lQ(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},dQ=Jq({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+Oq+"\n  return result;\n"}),fQ={kernelName:Lb,backendName:"webgl",kernelFunc:dQ},pQ=M((function e(t,n,r){E(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),vQ=Jq({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),mQ={kernelName:By,backendName:"webgl",kernelFunc:vQ},gQ="return a - b;",yQ=Jq({opSnippet:gQ,packedOpSnippet:gQ,supportsComplex:!0,cpuKernelImpl:nq}),bQ={kernelName:zx,backendName:"webgl",kernelFunc:yQ};function xQ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=mg([r.dim],a.shape),o=KJ({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=cT(o.shape,i),u=iK({inputs:{x:o},backend:n,attrs:{shape:s}}),l=yQ({inputs:{a:a,b:u},backend:n}),c=UZ({inputs:{x:l},backend:n}),h=fK({inputs:{x:c},backend:n,attrs:{axis:i,keepDims:!1}}),d=iK({inputs:{x:h},backend:n,attrs:{shape:s}}),f=vQ({inputs:{a:c,b:d},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),f}var wQ={kernelName:Ex,backendName:"webgl",kernelFunc:xQ};var kQ={kernelName:Pb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:xQ({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),l=u.shape[0],c=u.shape[1],h=new pQ(l,c,i),d=[[o]],f=n.runWebGLProgram(h,[u],"int32",d);return s||n.disposeIntermediateTensorInfo(u),f}},SQ=mq+"\n  return -x;\n";var _Q={kernelName:Fb,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=x(DX(i.values,a.shape,a.dtype),2),s=o[0],u=o[1];return r.makeTensorInfo(u,a.dtype,s)}return t=Bg().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Iq(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new vq(a.shape,SQ),r.runWebGLProgram(t,[a],a.dtype)}},EQ=_M;var TQ={kernelName:zb,backendName:"webgl",kernelFunc:function(e){ew("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,l=n.readSync(a.dataId),c=n.readSync(i.dataId),h=EQ(l,c,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},MQ=EM;var CQ={kernelName:Ub,backendName:"webgl",kernelFunc:function(e){ew("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,l=r.padToMaxOutputSize,c=n.readSync(a.dataId),h=n.readSync(i.dataId),d=MQ(c,h,o,s,u,l),f=d.selectedIndices,p=d.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},IQ=TM;var AQ={kernelName:Bb,backendName:"webgl",kernelFunc:function(e){ew("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,l=r.softNmsSigma,c=n.readSync(a.dataId),h=n.readSync(i.dataId),d=IQ(c,h,o,s,u,l),f=d.selectedIndices,p=d.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([p.length],"float32",new Float32Array(p))]}},RQ=M((function e(t,n,r,a){E(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),NQ={kernelName:Vb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,l=lg(a.shape),c=new RQ(l,o,s,u),h=iK({inputs:{x:a},backend:n,attrs:{shape:[l]}}),d=n.runWebGLProgram(c,[h],i);n.disposeIntermediateTensorInfo(h);var f=iK({inputs:{x:d},backend:n,attrs:{shape:[].concat(g(a.shape),[o])}});return n.disposeIntermediateTensorInfo(d),f}};function LQ(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=bY({inputs:{input:r},backend:n}),i=LQ({inputs:{x:a},backend:n}),o=DY({inputs:{input:r},backend:n}),s=LQ({inputs:{x:o},backend:n}),u=Wq({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return ZZ({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var PQ={kernelName:Kx,backendName:"webgl",kernelFunc:LQ};var DQ={kernelName:Wb,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=bY({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=DY({inputs:{input:a},backend:r}),u=LQ({inputs:{x:s},backend:r}),l=Wq({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),l}return ZZ({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var FQ={kernelName:Gb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return WZ({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){sg(a,e.shape,"All tensors passed to stack must have matching shapes"),og(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=zY({inputs:t.map((function(e){var t=WZ({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},OQ=M((function e(t,n,r){E(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=Wj(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),zQ=M((function e(t,n,r){E(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=Wj(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=uq("rc",a),l=uq("source",a),c="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(l.slice(-2).join(),")"),d=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(c,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(c,") {")],f=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",v=0,m=1===a?2:4;v<m;v++)p+="\n        ".concat(d[v],"\n        if (").concat(f,") {\n          result[").concat(v,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(v,"] = getChannel(getX(").concat(l.join(),"), ").concat(h,");\n        }\n      ");p+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")})),UQ=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===lg(a.shape)){var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]}));return ZZ({backend:n,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=Bg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zQ(a.shape,i,o):new OQ(a.shape,i,o),l=[[o]];return n.runWebGLProgram(u,[a],a.dtype,l)},BQ={kernelName:Hb,backendName:"webgl",kernelFunc:UQ},WQ=Jq({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+Oq+"\n  return result;\n"}),VQ={kernelName:jb,backendName:"webgl",kernelFunc:WQ};var GQ={kernelName:qb,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,l=[],c=mg(o,i.shape),h=c,d=dT(h,u),f=i;if(null!=d&&(f=vK({inputs:{x:i},backend:r,attrs:{perm:d}}),h=pT(h.length,u),l.push(f)),hT("prod",h,u),r.shouldExecuteOnCPU([f])){var p=r.texData.get(f.dataId).values,v=OX(f.shape,f.dtype,p,h),m=v.outVals,g=v.outShape,y=v.outDtype;t=r.makeTensorInfo(g,y,m)}else{var b=x(lT(f.shape,h),2),w=b[0],k=lg(b[1]),S=iK({inputs:{x:f},backend:r,attrs:{shape:[-1,k]}}),_=lK(S,ek(i.dtype),"prod",r);t=iK({inputs:{x:_},backend:r,attrs:{shape:w}}),l.push(S),l.push(_)}if(s){l.push(t);var E=cT(t.shape,c);t=iK({inputs:{x:t},backend:r,attrs:{shape:E}})}return l.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var HQ={kernelName:Kb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=r.outputRaggedRank,u=a.map((function(e){return n.readSync(e.dataId)})),l=a.map((function(e){return e.shape})),c=n.readSync(i.dataId),h=n.readSync(o.dataId),d=x(zX(u,l,c,i.shape,i.dtype,h,o.shape,s),3),f=d[0],p=d[1],v=d[2],m=f.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),g=n.makeTensorInfo(v,i.dtype,p);return m.concat([g])}};var jQ={kernelName:Yb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),l=x(UX(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),c=l[0],h=l[1];return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([h.length],r.dtype,h)]}};var XQ={kernelName:Zb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,l=n.readSync(a.dataId),c=n.readSync(i.dataId),h=n.readSync(o.dataId),d=s.map((function(e){return n.readSync(e.dataId)})),f=s.map((function(e){return e.shape})),p=x(BX(l,a.shape,c,i.shape,i.dtype,h,o.shape,d,f,u),2),v=p[0],m=p[1];return n.makeTensorInfo(v,i.dtype,m)}},qQ=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=WX(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},KQ={kernelName:Jb,backendName:"webgl",kernelFunc:qQ},YQ=Zq({opSnippet:"return 1.0 / x;"}),ZQ={kernelName:$b,backendName:"webgl",kernelFunc:YQ},JQ=Zq({opSnippet:mq+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),QQ={kernelName:ex,backendName:"webgl",kernelFunc:JQ},$Q=Zq({opSnippet:mq+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),e$={kernelName:ox,backendName:"webgl",kernelFunc:$Q},t$=M((function e(t,n,r,a,i){E(this,e),this.variableNames=["A"],this.outputShape=[];var o=x(t,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,n,r,c];var h,d=[a&&n>1?u-1:u,a&&r>1?l-1:l],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),n$=M((function e(t,n,r,a,i){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=x(t,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,n,r,c];var h,d=[a&&n>1?u-1:u,a&&r>1?l-1:l],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],",\n          ").concat(d[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(l,".0,\n                                     ").concat(l,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var r$={kernelName:ax,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=x(r.size,2),u=s[0],l=s[1],c=Bg().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new n$(a.shape,u,l,i,o):new t$(a.shape,u,l,i,o);return n.runWebGLProgram(c,[a],"float32")}},a$=M((function e(t,n,r){E(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=x(n,3),i=a[1],o=a[2],s=x(t,3),u=s[1],l=s[2],c=[r&&u>1?i-1:i,r&&l>1?o-1:o],h=[r&&u>1?u-1:u,r&&l>1?l-1:l],d=c[0]/h[0],f=c[1]/h[1],p=1/d,v=1/f,m=2*Math.ceil(p)+2,g=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(p,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(m,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var i$={kernelName:ix,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new a$(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},o$=M((function e(t,n,r,a,i){E(this,e),this.variableNames=["A"],this.outputShape=[];var o=x(t,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,n,r,c];var h,d=[a&&n>1?u-1:u,a&&r>1?l-1:l],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],p=a?"0.5":"0.0";h=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(p,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),s$=M((function e(t,n,r,a,i){E(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=x(t,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,n,r,c];var h,d=[a&&n>1?u-1:u,a&&r>1?l-1:l],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],p=a?"0.5":"0.0";h=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],",\n          ").concat(d[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(l,".0,\n                                     ").concat(l,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(p,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var u$={kernelName:nx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=x(r.size,2),u=s[0],l=s[1],c=Bg().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new s$(a.shape,u,l,i,o):new o$(a.shape,u,l,i,o);return n.runWebGLProgram(c,[a],a.dtype)}},l$=M((function e(t,n,r){E(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=x(n,3),i=a[1],o=a[2],s=x(t,3),u=s[1],l=s[2],c=[r&&u>1?i-1:i,r&&l>1?o-1:o],h=[r&&u>1?u-1:u,r&&l>1?l-1:l],d=c[0]/h[0],f=c[1]/h[1],p=1/d,v=1/f,m=2*Math.ceil(p)+2,g=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(p,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(m,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(c[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(c[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var c$={kernelName:rx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new l$(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},h$=M((function e(t,n){E(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=Wj(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),d$=M((function e(t,n){E(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=uq("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=Wj(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var f$={kernelName:sx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=mg(i,a.shape);if(0===o)return Uq({inputs:{x:a},backend:n});var u=Bg().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new d$(a.shape,s):new h$(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},p$=M((function e(t,n){E(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"===typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),v$={kernelName:Zx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,l=new p$(a.shape,o),c=x(fC(s,a.shape[1],a.shape[2]),2),h=[[c[0],c[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(l,[a],a.dtype,h)}},m$=Zq({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),g$={kernelName:ux,backendName:"webgl",kernelFunc:m$},y$=Zq({opSnippet:"return inversesqrt(x);",cpuKernelImpl:VX}),b$={kernelName:lx,backendName:"webgl",kernelFunc:y$},x$=M((function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];E(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=Wj(i.length),l=Wj(o.length),c="";1===r?c="i":2===r&&(c="i, j");var h="getIndices(".concat(c,")"),d="";1===a?d="i":2===a&&(d="i, coords[1]");var f="getUpdates(".concat(d,")"),p="";s&&(p="coords[0], coords[1]");var v="getDefaultValue(".concat(p,")"),m=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(h,");\n              flattenedIndex += index * ").concat(m,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(f,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(v,", sum, float(found)));\n        }\n      ")})),w$=M((function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];E(this,e),this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;var u=Wj(i.length),l=Wj(o.length),c="";1===r?c="i":2===r&&(c="i, j");var h="getIndices(".concat(c,")"),d="";1===a?d="i":2===a&&(d="i, coords[1]");var f="getUpdates(".concat(d,")"),p="";s&&(p="coords[0], coords[1]");var v="getDefaultValue(".concat(p,")"),m=n>1?"strides[j]":"strides",g=n>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(t,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(n,"; j+=2) {\n              ivec4 index = round(").concat(h,");\n              flattenedIndex += index.xz * ").concat(m,";\n              if (j + 1 < ").concat(n,") {\n                flattenedIndex += index.yw * ").concat(g,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(f,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(v,", sum, found));\n        }\n      ")}));var k$={kernelName:cx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=xC(0,a,o),u=s.sliceRank,l=s.numUpdates,c=s.sliceSize,h=s.strides,d=s.outputSize,f=[d/c,c];if(0===d)return n.makeTensorInfo(o,a.dtype);var p,v=iK({inputs:{x:a},backend:n,attrs:{shape:[l,u]}}),m=iK({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));p=Bg().getBool("WEBGL_PACK")?new w$(l,u,v.shape.length,m.shape.length,h,f):new x$(l,u,v.shape.length,m.shape.length,h,f);var y=n.runWebGLProgram(p,[m,v,g],m.dtype),b=iK({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}},S$=M((function e(t,n,r,a){E(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===Bg().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var _$={kernelName:dx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new S$(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},E$=M((function e(t,n,r){var a,i;if(E(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],l=0;l<n.length;l++)u.push("".concat(o[l])),l<t&&s.push("".concat(o[l]));a=s.join(),i=u.join()}var c=Wj(r);this.userCode="\n      void main() {\n        ".concat(c," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var T$={kernelName:fx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new E$(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],$w(a.dtype,i.dtype))}},M$=Zq({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(wC,";\n  float scale = ").concat(kC,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),C$={kernelName:px,backendName:"webgl",kernelFunc:M$},I$=Zq({opSnippet:Yq+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:HX}),A$={kernelName:bx,backendName:"webgl",kernelFunc:I$},R$=Zq({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),N$={kernelName:yx,backendName:"webgl",kernelFunc:R$},L$=Zq({opSnippet:Yq+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(Oq,"\n  return result;\n")}),P$={kernelName:mx,backendName:"webgl",kernelFunc:L$},D$=Zq({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),F$={kernelName:gx,backendName:"webgl",kernelFunc:D$},O$=Zq({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),z$={kernelName:xx,backendName:"webgl",kernelFunc:O$},U$={kernelName:Sx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;og(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,g(o));for(var l=1+i.length;l<a.shape.length;++l)u.push([0,0]);var c=[],h=UQ({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=pC(h.shape,i,s,!1),f=vC(d.length,i.length,!1),p=mC(h.shape,i,s,!1),v=iK({inputs:{x:h},backend:n,attrs:{shape:d}}),m=vK({inputs:{x:v},backend:n,attrs:{perm:f}}),y=iK({inputs:{x:m},backend:n,attrs:{shape:p}});return c.push(h),c.push(v),c.push(m),c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}};var B$={kernelName:Tx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),l=n.readSync(i.dataId),c=n.readSync(o.dataId)[0],h=x(qX(s,r.shape,r.dtype,u,a.dtype,l,c),5),d=h[0],f=h[1],p=h[2],v=h[3],m=h[4];return[n.makeTensorInfo(f,r.dtype,d),n.makeTensorInfo([f[0]],a.dtype,p),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};var W$={kernelName:Mx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),l=x(KX(s,r.shape,r.dtype,o,u),3),c=l[0],h=l[1],d=l[2];return[n.makeTensorInfo(h,r.dtype,c),n.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}};var V$={kernelName:Cx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),l=x(YX(o,r.shape,r.dtype,s,u,!0),2),c=l[0],h=l[1];return n.makeTensorInfo(h,r.dtype,c)}};var G$={kernelName:Ix,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),l=x(YX(o,r.shape,r.dtype,s,u),2),c=l[0],h=l[1];return n.makeTensorInfo(h,r.dtype,c)}};var H$={kernelName:Ax,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=xC(0,a,s),l=u.sliceRank,c=u.numUpdates,h=u.sliceSize,d=u.strides,f=u.outputSize;if("string"===i.dtype){var p=n.bufferSync(a),v=n.bufferSync(i),m=Cw(n.readSync(o.dataId)[0]),g=GX(p,v,s,f,h,c,l,d,m,false);return n.makeTensorInfo(s,g.dtype,g.values)}var y=new x$(c,l,a.shape.length,i.shape.length,d,[f,1],false),b=n.runWebGLProgram(y,[i,a,o],i.dtype),x=iK({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),x}};var j$={kernelName:_x,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=mg(r.axis,a.shape)[0],s=GC(a,i,o),u=a.shape.length,l=new Array(u).fill(0),c=a.shape.slice();return s.map((function(e){var t=g(c);t[o]=e;var r=dY({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[o]+=e,r}))}},X$="return sqrt(x);",q$=Zq({opSnippet:X$,packedOpSnippet:X$,cpuKernelImpl:ZX}),K$={kernelName:wx,backendName:"webgl",kernelFunc:q$},Y$={kernelName:Nx,backendName:"webgl",kernelFunc:Zq({opSnippet:"return x * x;"})},Z$="return (a - b) * (a - b);",J$=Jq({opSnippet:Z$,packedOpSnippet:Z$}),Q$={kernelName:Rx,backendName:"webgl",kernelFunc:J$};var $$={kernelName:Lx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;if("string"!==a.dtype)throw new Error("Input must be of datatype string");var i=KC(n.readSync(a.dataId)),o=JX(i,"string",r);return n.makeTensorInfo(a.shape,"string",o)}};var e0={kernelName:Yx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=mq+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new vq(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},t0=M((function e(t,n,r){E(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=Wj(r.length),o=Wj(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var n0={kernelName:Px,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,l=a.beginMask,c=a.endMask,h=a.ellipsisMask,d=a.newAxisMask,f=a.shrinkAxisMask,p=Z_(i.shape,o,s,u,l,c,h,d,f),v=p.finalShapeSparse,m=p.finalShape,g=p.isIdentity,y=p.sliceDim0,b=p.isSimpleSlice,x=p.begin,w=p.end,k=p.strides;if(g)t=iK({inputs:{x:i},backend:r,attrs:{shape:m}});else if(y||b){og(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var S=X_(x,w,k),_=dY({inputs:{x:i},backend:r,attrs:{begin:x,size:S}});t=iK({inputs:{x:_},backend:r,attrs:{shape:m}}),r.disposeIntermediateTensorInfo(_)}else{if(r.shouldExecuteOnCPU([i])){var E=r.readSync(i.dataId),T=PS(i.shape,i.dtype,E),M=QX(v,T,k,x);t=r.makeTensorInfo(m,i.dtype,M.values)}else{var C=new t0(x,k,v);t=r.runWebGLProgram(C,[i],i.dtype)}}var I=iK({inputs:{x:t},backend:r,attrs:{shape:m}});return r.disposeIntermediateTensorInfo(t),I}};var r0={kernelName:Dx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,l=r.preserveShortSequences,c=t.data,h=t.dataSplits,d=n.readSync(c.dataId),f=n.readSync(h.dataId),p=x($X(d,f,a,i,o,s,u,l),2),v=p[0],m=p[1];return[n.makeTensorInfo([v.length],"string",v),n.makeTensorInfo(h.shape,"int32",m)]}};var a0={kernelName:Fx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=x(eq(o,s,r),3),l=u[0],c=u[1],h=u[2],d=c.length;return[n.makeTensorInfo([d,2],"int32",l),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};var i0={kernelName:Ox,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=tq(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},o0=Zq({opSnippet:"return tan(x);"}),s0={kernelName:Ux,backendName:"webgl",kernelFunc:o0},u0=Zq({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),l0={kernelName:Bx,backendName:"webgl",kernelFunc:u0};var c0={kernelName:hx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.tensor,i=t.indices,o=t.updates;!function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(r);var s=xC(0,i,a.shape),u=s.sliceRank,l=s.numUpdates,c=s.sliceSize,h=s.strides,d=s.outputSize,f=[d/c,c];if(0===d)return n.makeTensorInfo(a.shape,i.dtype);var p=iK({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),v=iK({inputs:{x:o},backend:n,attrs:{shape:[l,c]}}),m=iK({inputs:{x:a},backend:n,attrs:{shape:f}}),g=new x$(l,u,p.shape.length,v.shape.length,h,f,!1,!0),y=n.runWebGLProgram(g,[v,p,m],m.dtype),b=iK({inputs:{x:y},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),b}},h0=M((function e(t,n){E(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=Wj(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function d0(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return Cw(e)})):o,u=PS(a.shape,a.dtype,s),l=rq(u,i);return n.makeTensorInfo(l.shape,l.dtype,l.values)}var c=new h0(a.shape,i);return n.runWebGLProgram(c,[a],a.dtype)}var f0={kernelName:Wx,backendName:"webgl",kernelFunc:d0},p0=M((function e(t){E(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),v0=M((function e(t){E(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function m0(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function g0(e){for(var t=1;t<e;)t*=2;return t}var y0={kernelName:Vx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=Bg().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=Bg().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=a.shape,c=l[l.length-1];if(n.shouldExecuteOnCPU([a])||c<s||i>u){var h=n.readSync(a.dataId),d=x(aq(h,l,a.dtype,i,o),2),f=d[0],p=d[1];return[n.makeTensorInfo(f.shape,f.dtype,f.values),n.makeTensorInfo(p.shape,p.dtype,p.values)]}if(0===i)return l[l.length-1]=0,[n.makeTensorInfo(l,a.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(1===c)return[a,ZZ({attrs:{shape:l,dtype:"int32",value:0},backend:n})];var v=n.texData.get(a.dataId),m=null!==v&&v.isPacked,g=m?n.unpackTensor(a):a,y=lg(l)/c,b=iK({inputs:{x:g},attrs:{shape:[y,c]},backend:n});m&&m0(n,g);for(var w=g0(i),k=g0(c),S=null,_=function(){return null===S?[b,b]:[b,S]},E=function(e,t,r){var a=_(),i=new p0(r),o=[[c],[null===S?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=S;S=n.runWebGLProgram(i,a,"int32",o),m0(n,s)},T=1;T<w;T*=2)for(var M=2*T,C=T;C>=1;C/=2)E(M,C,[y,k]);for(var I=k;I>w;I/=2){var A=_(),R=new v0([y,I/2]),N=[[c],[null===S?1:0],[w]],L=S;S=n.runWebGLProgram(R,A,"int32",N),m0(n,L);for(var P=w/2,D=2*P,F=P;F>=1;F/=2)E(D,F,S.shape)}var O=S;S=dY({inputs:{x:S},backend:n,attrs:{begin:0,size:[y,i]}}),m0(n,O);var z=vJ({inputs:{x:b,indices:S},backend:n,attrs:{axis:1,batchDims:1}});m0(n,b);var U=l.slice(0,-1);U.push(i),O=S,S=iK({inputs:{x:S},attrs:{shape:U},backend:n}),m0(n,O);var B=z;return z=iK({inputs:{x:z},attrs:{shape:U},backend:n}),m0(n,B),[z,S]}},b0=M((function e(t,n,r,a,i,o){E(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var x0={kernelName:Gx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,l=r.outputShape,c=x(a.shape,4),h=c[0],d=c[1],f=c[2],p=c[3],v=x(null!=l?l:[d,f],2),m=v[0],g=v[1],y=new b0(d,f,o,s,u,[h,m,g,p]);return n.runWebGLProgram(y,[a,i],"float32")}};var w0={kernelName:jx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;Sj(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=oq(o,a,i.shape,i.dtype),u=s.outputValues,l=s.outputShape,c=s.indices;return[r.makeTensorInfo(l,i.dtype,u),r.makeTensorInfo([c.length],"int32",c)]}};var k0={kernelName:Xx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],l=new Array(s-1),c=0,h=0;h<s;h++)h!==i&&(l[c++]=o.shape[h]);var d=[],f=new Array(s).fill(0),p=o.shape.slice();p[i]=1;for(var v=new Array(u),m=0;m<v.length;m++){f[i]=m;var g=dY({inputs:{x:o},backend:n,attrs:{begin:f,size:p}}),y=iK({inputs:{x:g},backend:n,attrs:{shape:l}});v[m]=y,d.push(g)}return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}},S0=M((function e(t,n){E(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),l=r%4,c="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(d,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(c,"\n        } else if (").concat(2===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(c,"\n        } else if (").concat(3===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(c,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var _0={kernelName:qx,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],l=0,c=dT([l],s),h=a;null!=c&&(h=vK({inputs:{x:a},backend:n,attrs:{perm:c}}),u.push(h),l=pT(1,s)[0]);var d=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(h.shape,l,o),f=lg([h.shape[l]]),p=iK({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}});u.push(p);var v=function e(t,r,a,i,o){var s=t.shape[0],l=t.shape[1],c=function(e,t){var n,r=!1;for(e<=hC?(n=e,r=!0):n=Tg(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Tg(e,n+1);return n}(l,o),h=new S0({windowSize:c,inSize:l,batchSize:s,numSegments:o},r),d=n.compileAndRun(h,[t,a],i);if(u.push(d),d.shape[1]===o)return d;var f=qQ({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),p=d0({inputs:{x:f},backend:n,attrs:{reps:[l/c]}});return u.push(f),u.push(p),e(d,r,p,i,o)}(p,"unsortedSegmentSum",i,ek(a.dtype),o),m=iK({inputs:{x:v},backend:n,attrs:{shape:d}}),g=m;if(null!=c){u.push(m);var y=fT(c);g=vK({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},E0=0,T0=[bK,wK,SK,EK,CK,RK,NK,LK,UK,BK,VK,HK,XK,KK,ZK,$K,eY,rY,aY,iY,uY,pY,vY,mY,kY,EY,CY,Vq,RY,UY,qY,QY,eZ,tZ,nZ,aZ,oZ,uZ,cZ,vZ,mZ,gZ,bZ,kZ,EZ,TZ,CZ,AZ,RZ,LZ,PZ,FZ,zZ,BZ,VZ,jZ,KZ,QZ,eJ,rJ,iJ,uJ,cJ,hJ,fJ,mJ,yJ,xJ,Bq,wJ,FY,SJ,EJ,MJ,jq,IJ,RJ,NJ,PJ,FJ,zJ,BJ,VJ,jJ,qJ,YJ,JJ,QJ,$J,nQ,rQ,aQ,iQ,oQ,uQ,hQ,fQ,kQ,aK,_Q,TQ,CQ,AQ,yY,NQ,DQ,FQ,BQ,VQ,Kq,GQ,HQ,jQ,XQ,KQ,xY,mQ,ZQ,QQ,e$,oK,r$,i$,u$,c$,f$,v$,g$,b$,k$,_$,T$,C$,A$,N$,P$,F$,fY,wQ,z$,U$,B$,W$,V$,G$,H$,j$,K$,Y$,Q$,$$,e0,n0,r0,a0,i0,bQ,pK,s0,l0,c0,f0,y0,x0,mK,w0,k0,_0,PQ];E0<T0.length;E0++){ow(T0[E0])}var M0=n.p+"static/media/left.1c9c4457908cb7fa4cd6eab8f783a6c2.svg";var C0=n.p+"static/media/right.bcfc73b9184c1cfc410118f2a133c10d.svg",I0=n(184);var A0=function(){var e=Array.from({length:32},(function(){return Array.from({length:26},(function(){return Array.from({length:26},(function(){return 0}))}))})),t=Array.from({length:48},(function(){return Array.from({length:11},(function(){return Array.from({length:11},(function(){return 0}))}))})),n=Array.from({length:64},(function(){return Array.from({length:3},(function(){return Array.from({length:3},(function(){return 0}))}))})),r=new Array(784).fill(.1),a=new Array(10).fill(1),o=x((0,i.useState)([e,t,n,a]),2),s=o[0],l=o[1],h=x((0,i.useState)(r),2),d=h[0],f=h[1],p=function(){return am().camera.position.set(-55,25,50),null},v=function(e){var t=e.position,n=e.color,r=Math.round(Math.min(Math.max(255*n,25),255));return(0,I0.jsxs)("mesh",{position:t,children:[(0,I0.jsx)("boxBufferGeometry",{attach:"geometry"}),(0,I0.jsx)("meshLambertMaterial",{attach:"material",color:"rgb("+r+", "+r+", "+r+")"})]})},m=function(){for(var e=[],t=0,n=0;n<10;n++)for(var r=0;r<1;r++)e.push(v({position:[1.5*(n-4.5),1.5*(r-.5),30],color:s[3][t]})),t++;return e},g=function(){for(var e=[],t=0,n=28;n>0;n--)for(var r=0;r<28;r++)e.push(v({position:[1.5*(r-14),1.5*(n-14),-30],color:d[t]})),t++;return e},y=function(){return(0,I0.jsxs)("mesh",{position:[0,0,-5],onClick:function(){P(32),O(!0),B(0),R(1)},children:[(0,I0.jsx)("boxBufferGeometry",{attach:"geometry",args:[42,42,5]}),(0,I0.jsx)("meshLambertMaterial",{attach:"material",color:"rgb(30,30,30)"})]})},b=function(){return(0,I0.jsxs)("mesh",{position:[0,0,5],onClick:function(e){e.stopPropagation(),P(48),O(!0),B(1),R(1)},children:[(0,I0.jsx)("boxBufferGeometry",{attach:"geometry",args:[24,24,10]}),(0,I0.jsx)("meshLambertMaterial",{attach:"material",color:"rgb(30,30,30)"})]})},w=function(){return(0,I0.jsxs)("mesh",{position:[0,0,20],onClick:function(e){e.stopPropagation(),P(64),O(!0),B(2),R(1)},children:[(0,I0.jsx)("boxBufferGeometry",{attach:"geometry",args:[15,15,14]}),(0,I0.jsx)("meshLambertMaterial",{attach:"material",color:"rgb(30,30,30)"})]})},k=function(e){return Math.round(Math.min(Math.max(255*e,5),255))};(0,i.useEffect)((function(){R(0);var e=W.current,t=e.getContext("2d");function n(n){27===n.keyCode&&(t.fillStyle="black",t.fillRect(0,0,e.width,e.height))}return window.addEventListener("keydown",n),function(){window.removeEventListener("keydown",n)}}),[]);var S=x((0,i.useState)(!1),2),_=S[0],E=S[1],T=x((0,i.useState)(null),2),M=T[0],C=T[1],I=x((0,i.useState)(0),2),A=I[0],R=I[1],N=x((0,i.useState)(0),2),L=N[0],P=N[1],D=x((0,i.useState)(!1),2),F=D[0],O=D[1],z=x((0,i.useState)(0),2),U=z[0],B=z[1];(0,i.useEffect)((function(){var e=G.current,t=e.getContext("2d");e.width=200,e.height=200;for(var n=200/s[U][A].length,r=0;r<s[U][A].length;r++)for(var a=0;a<s[U][A][r].length;a++){var i=s[U][A][r][a],o=k(255*i);t.fillStyle="rgb("+o+", "+o+", "+o+")",t.fillRect(a*n,r*n,n,n)}}),[A,U,s]);var W=(0,i.useRef)(null),V=(0,i.useRef)(null),G=(0,i.useRef)(null),H=x((0,i.useState)(!1),2),j=H[0],X=H[1];function q(){return q=c(u().mark((function e(t,n){var r,a,i,o,s,c,h,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=t,i=1;case 3:if(!(i<n.layers.length)){e.next=43;break}if(a=n.layers[i].apply(a),o=a.clone(),1!==i){e.next=15;break}return s=o.transpose([3,1,2,0]).reshape([32,26,26]),e.t0=r,e.next=11,s.array();case 11:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),e.next=40;break;case 15:if(3!==i){e.next=24;break}return c=o.transpose([3,1,2,0]).reshape([48,11,11]),e.t2=r,e.next=20,c.array();case 20:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=40;break;case 24:if(5!==i){e.next=33;break}return h=o.transpose([3,1,2,0]).reshape([64,3,3]),e.t4=r,e.next=29,h.array();case 29:e.t5=e.sent,e.t4.push.call(e.t4,e.t5),e.next=40;break;case 33:if(9!==i){e.next=40;break}return d=o.reshape([10]),e.t6=r,e.next=38,d.array();case 38:e.t7=e.sent,e.t6.push.call(e.t6,e.t7);case 40:i++,e.next=3;break;case 43:return l(r),e.abrupt("return",r);case 45:case"end":return e.stop()}}),e)}))),q.apply(this,arguments)}(0,i.useEffect)((function(){function e(){return e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gD("/visualize-cnn/tfjs_model/model.json");case 2:t=e.sent,C(t),E(!0),console.log("Model Loaded:",t.layers);case 6:case"end":return e.stop()}}),e)}))),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),(0,i.useEffect)((function(){var e=W.current;e.width=200,e.height=200;var t=e.getContext("2d");t.lineCap="round",t.strokeStyle="white",t.lineWidth=15,V.current=t}),[]);var K=function(e){e.nativeEvent;if(j){V.current.closePath(),X(!1);for(var t=V.current.getImageData(0,0,W.current.width,W.current.height).data,n=W.current.width>28?28/W.current.width:1,r=[],a=0;a<28;a++){for(var i=[],o=0;o<28;o++){var s=Math.floor(o/n),u=4*(Math.floor(a/n)*W.current.width+s),l=(t[u]+t[u+1]+t[u+2])/3/255;i.push(l)}r.push(i)}var c=r.flat(),h=new Float32Array(c),d=Ek(Array.from(h),[1,28,28,1]);f(h),_?function(e,t){q.apply(this,arguments)}(d,M):console.log("Model not loaded yet")}};return(0,I0.jsxs)("div",{className:"App",children:[(0,I0.jsxs)(qm,{style:{width:"80vw",height:"100vh"},children:[(0,I0.jsx)(p,{}),(0,I0.jsx)(Jm,{}),(0,I0.jsx)("ambientLight",{intensity:.5}),(0,I0.jsx)("spotLight",{position:[200,250,200],angle:.2,intensity:1.5}),(0,I0.jsx)(g,{}),(0,I0.jsx)(y,{}),(0,I0.jsx)(b,{}),(0,I0.jsx)(w,{}),(0,I0.jsx)(m,{})]}),(0,I0.jsxs)("div",{className:"canvas-div",children:[(0,I0.jsx)("img",{className:"left-img",src:M0,alt:"left",onClick:function(){R(A>0?A-1:L-1)},style:{visibility:F?"visible":"hidden"}}),(0,I0.jsx)("canvas",{className:"hidden-canvas",width:200,height:200,ref:G,style:{visibility:F?"visible":"hidden"}}),(0,I0.jsx)("img",{className:"right-img",src:C0,alt:"right",onClick:function(){R(A<L-1?A+1:1)},style:{visibility:F?"visible":"hidden"}}),(0,I0.jsx)("canvas",{className:"drawing-canvas",width:28,height:28,ref:W,onMouseDown:function(e){var t=e.nativeEvent,n=t.offsetX,r=t.offsetY;V.current.beginPath(),V.current.imageSmoothingEnabled=!0,V.current.moveTo(n,r),V.current.lineTo(n,r),V.current.stroke(),X(!0),t.preventDefault()},onMouseMove:function(e){var t=e.nativeEvent;if(j){var n=t.offsetX,r=t.offsetY;V.current.lineTo(n,r),V.current.stroke(),t.preventDefault()}},onMouseUp:K,onMouseLeave:K,willReadFrequently:!0}),(0,I0.jsx)("span",{children:"Esc to clear"})]})]})};o.createRoot(document.getElementById("root")).render((0,I0.jsx)(i.StrictMode,{children:(0,I0.jsx)(A0,{})}))}()}();
//# sourceMappingURL=main.cb513824.js.map